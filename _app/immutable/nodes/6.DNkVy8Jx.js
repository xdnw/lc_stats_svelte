var Vn=Object.defineProperty,Hn=Object.defineProperties;var Qn=Object.getOwnPropertyDescriptors;var ut=Object.getOwnPropertySymbols;var Ca=Object.prototype.hasOwnProperty,Oa=Object.prototype.propertyIsEnumerable;var xa=(I,p,h)=>p in I?Vn(I,p,{enumerable:!0,configurable:!0,writable:!0,value:h}):I[p]=h,$t=(I,p)=>{for(var h in p||(p={}))Ca.call(p,h)&&xa(I,h,p[h]);if(ut)for(var h of ut(p))Oa.call(p,h)&&xa(I,h,p[h]);return I},Ft=(I,p)=>Hn(I,Qn(p));var Ta=(I,p)=>{var h={};for(var T in I)Ca.call(I,T)&&p.indexOf(T)<0&&(h[T]=I[T]);if(I!=null&&ut)for(var T of ut(I))p.indexOf(T)<0&&Oa.call(I,T)&&(h[T]=I[T]);return h};var wa=(I,p,h)=>new Promise((T,ee)=>{var ye=U=>{try{se(h.next(U))}catch(R){ee(R)}},L=U=>{try{se(h.throw(U))}catch(R){ee(R)}},se=U=>U.done?T(U.value):Promise.resolve(U.value).then(ye,L);se((h=h.apply(I,p)).next())});import{e as me,a as O,f as w,s as P,w as Yn,c as qn}from"../chunks/ByHfNYyH.js";import{i as Fa}from"../chunks/DPmMxCJa.js";import{c as Jn,o as za}from"../chunks/TrlPcG3m.js";import{p as Ba,g as e,b as Wa,s as g,c as f,r as m,u as c,e as d,m as k,z as Xn,t as V,l as X,a as Zn,i as be,d as er,j as at,k as oe,$ as tr,n as zt,h as ge}from"../chunks/MAWq1Bs-.js";import{i as Z}from"../chunks/DRn8owhI.js";import{f as pt,e as Ut,i as jt,h as ar,j as mt,s as Je,r as nr,a as rr,g as ir,k as or,d as La}from"../chunks/D5oqsy_p.js";import{r as sr,c as Bt,s as ft,a as Ra,g as lr}from"../chunks/CnrOJzGS.js";import{D as Gt,b as Xe,v as cr,B as dr,S as ur,F as Ea,s as nt,d as mr,z as vt,f as fr,y as vr,u as pr,a as gr,E as _r,G as Pa,P as hr}from"../chunks/BrECN6iW.js";import{b as br}from"../chunks/CTbw-bmO.js";import{C as yr}from"../chunks/DcxSc3jB.js";import{b as Wt}from"../chunks/B8xhrJ_g.js";import{s as Ir,a as Sr}from"../chunks/D9W9dS64.js";import{t as Ua}from"../chunks/C-5gSOKl.js";import{K as Ar,b as Nr,d as kr,r as Ka,a as xr,m as Cr,e as Me,p as Or,s as Tr,c as Da,f as wr}from"../chunks/DC_DG9dt.js";import{S as Lr,v as Rr,f as Er,b as Pr}from"../chunks/B6FWrDFz.js";import{p as rt}from"../chunks/BTi-TpZb.js";function Ge(I,p,h,T,ee){let ye=I.coalitions,L=I.damage_header,se=I.header_type,U=[],R=[],te=[],Oe=[],le={},ae=null;switch(p){case 0:ae=null;break;case 1:ae=null;break;case 2:ae=null;break}R.push("name");for(let A=0;A<L.length;A++){let H=Ua(L[A]),de=se[A];de==0?(R.push("loss:".concat(H)),R.push("dealt:".concat(H.replace("_loss","").replace("loss_",""))),R.push("net:".concat(H.replace("_loss","").replace("loss_","")))):de==1&&(R.push("def:".concat(H)),R.push("off:".concat(H)),R.push("both:".concat(H)))}te.push(0),p===0?le.formatCol=[0]:p===1?le.formatAA=[0]:p===2&&(le.formatNation=[0]);let $e=[Math.max(0,R.indexOf(T)),ee];const K=new Set(h);le.formatNumber=[],le.formatMoney=[];for(let A=0;A<R.length;A++)K.has(R[A])&&Oe.push(A),A>0&&(R[A].includes("~")||R[A].includes("damage")||R[A].includes("infra")&&!R[A].includes("attacks")?le.formatMoney.push(A):le.formatNumber.push(A));let _e=(A,H,de)=>{for(let l=0;l<H.length;l++){let Ae=H[l],S=de[l],o=se[l],J;o==0?J=S-Ae:J=S+Ae,A.push(Ae),A.push(S),A.push(J)}},Y=(A,H)=>{let de=A.alliance_ids,l=A.alliance_names,Ae=A.nation_ids,S=A.nation_names,o=A.nation_aa,J=A.damage;switch(p){case 0:let Te=[H];_e(Te,J[0],J[1]),U.push(Te);break;case 1:let Ve=2;for(let Q=0;Q<de.length;Q++){let Ie=[],Re=de[Q],Ee=Xe(l[Q],Re);Ie.push([Ee,Re]),_e(Ie,J[Q*2+Ve],J[Q*2+Ve+1]),U.push(Ie)}break;case 2:let Fe=2+de.length*2;for(let Q=0;Q<Ae.length;Q++){let Ie=[],Re=Ae[Q],Ee=Gt(S[Q],Re),E=o[Q];Ie.push([Ee,Re,E]),_e(Ie,J[Q*2+Fe],J[Q*2+Fe+1]),U.push(Ie)}break}};for(let A=0;A<ye.length;A++){let H=ye[A];Y(H,A)}return{columns:R,data:U,visible:Oe,searchable:te,cell_format:le,row_format:ae,sort:$e}}var Kr=Object.defineProperty,Dr=Object.defineProperties,Mr=Object.getOwnPropertyDescriptors,Ma=Object.getOwnPropertySymbols,$r=Object.prototype.hasOwnProperty,Fr=Object.prototype.propertyIsEnumerable,$a=(I,p,h)=>p in I?Kr(I,p,{enumerable:!0,configurable:!0,writable:!0,value:h}):I[p]=h,zr=(I,p)=>{for(var h in p||(p={}))$r.call(p,h)&&$a(I,h,p[h]);if(Ma)for(var h of Ma(p))Fr.call(p,h)&&$a(I,h,p[h]);return I},Br=(I,p)=>Dr(I,Mr(p));function Vt(I){const p="".concat(pt(),":presets");try{const h=localStorage.getItem(p);if(!h)return{};const T=JSON.parse(h);return!T||typeof T!="object"?{}:T}catch(h){return console.warn("Failed to read column presets",h),{}}}function Wr(I,p,h){const T="".concat(pt(),":presets");try{const ee=Vt(h);ee[I]=Br(zr({},p),{createdAt:Date.now()}),localStorage.setItem(T,JSON.stringify(ee))}catch(ee){console.warn("Failed to save column preset",ee)}}function Ur(I,p){const h="".concat(pt(),":presets");try{const T=Vt(p);Object.prototype.hasOwnProperty.call(T,I)&&(delete T[I],localStorage.setItem(h,JSON.stringify(T)))}catch(T){console.warn("Failed to delete column preset",T)}}var jr=w('<div class="small text-muted px-2">No saved layouts</div>'),Gr=w('<div class="preset-item px-2 py-1 small svelte-ukze6s"><div class="text-truncate" style="max-width:140px"> </div> <div><button class="btn ux-btn btn-sm me-1">Load</button> <button class="btn btn-sm btn-outline-danger">Delete</button></div></div>'),Vr=w('<div class="dropdown d-inline"><button class="btn ux-btn btn-sm" type="button" id="cpDropdown" data-bs-toggle="dropdown" aria-expanded="false">My layouts&nbsp;<i class="bi bi-chevron-down"></i></button> <div class="dropdown-menu p-2" aria-labelledby="cpDropdown" style="min-width:260px;"><div class="input-group input-group-sm mb-2"><input class="form-control form-control-sm" placeholder="Save current as..."/> <button class="btn ux-btn btn-sm">Save</button></div> <hr class="dropdown-divider"/> <div class="preset-list svelte-ukze6s"><!> <!></div></div></div>');function Hr(I,p){Ba(p,!1);let h=rt(p,"currentColumns",24,()=>[]),T=rt(p,"currentSort",8,""),ee=rt(p,"currentOrder",8,"desc"),ye=rt(p,"currentKpis",24,()=>[]),L=rt(p,"currentKpiConfig",8,null);const se=Jn();let U=k({}),R=k("");function te(){d(U,Vt())}za(te);function Oe(){const S=(e(R)||"").trim();if(!S){se("error",{message:"Name required"});return}e(U)[S]&&!confirm(`Overwrite layout "${S}"?`)||(Wr(S,{columns:h(),sort:T(),order:ee(),kpis:ye(),kpiConfig:L()}),d(R,""),te(),se("saved",{name:S}))}function le(S){const o=e(U)[S];o&&se("load",{name:S,preset:o})}function ae(S){confirm(`Delete layout "${S}"?`)&&(Ur(S),te(),se("deleted",{name:S}))}Fa();var fe=Vr(),$e=g(f(fe),2),K=f($e),_e=f(K);sr(_e);var Y=g(_e,2);m(K);var A=g(K,4),H=f(A);{var de=S=>{var o=jr();O(S,o)},l=Xn(()=>(e(U),c(()=>Object.keys(e(U)).length===0)));Z(H,S=>{e(l)&&S(de)})}var Ae=g(H,2);Ut(Ae,1,()=>(e(U),c(()=>Object.keys(e(U)))),jt,(S,o)=>{var J=Gr(),Te=f(J),Ve=f(Te,!0);m(Te);var Fe=g(Te,2),Q=f(Fe),Ie=g(Q,2);m(Fe),m(J),V(()=>P(Ve,e(o))),me("click",Q,()=>le(e(o))),me("click",Ie,()=>ae(e(o))),O(S,J)}),m(A),m($e),m(fe),cr(_e,()=>e(R),S=>d(R,S)),me("click",Y,Oe),O(I,fe),Wa()}var Qr=Yn(w('<script id="visjs" async="" src="https://cdnjs.cloudflare.com/ajax/libs/vis-timeline/7.7.3/vis-timeline-graph2d.min.js"><\/script><!>',1)),Yr=w('<a class="btn ux-btn fw-bold"> <i class="bi bi-box-arrow-up-right"></i></a>'),qr=w('<li><button class="btn ux-btn btn-sm">Show KPI</button></li>'),Jr=w('<div class="small text-muted">Duration</div> <div class="h6 m-0"> </div>',1),Xr=w('<div class="small text-muted">Wars tracked</div> <div class="h6 m-0"> </div>',1),Zr=w('<div class="small text-muted">Total damage exchanged</div> <div class="h6 m-0"> </div>',1),ei=w('<div class="small text-muted"> </div>'),ti=w('<div class="small text-muted">Damage gap</div> <div class="h6 m-0"> </div> <!>',1),ai=w('<div class="small text-muted"> </div> <div class="h6 m-0"> </div>',1),ni=w('<div class="small text-muted"> </div> <div class="h6 m-0"> </div>',1),ri=w('<div class="small text-muted"> </div>'),ii=w('<div class="small text-muted">Offensive wars per nation</div> <div class="h6 m-0"> </div> <!>',1),oi=w("<th>Alliance</th>"),si=w("<a> </a>"),li=w("<a> </a>"),ci=w("<td><a> </a></td>"),di=w('<tr><td></td><td><!></td><!><td class="text-end"> </td></tr>'),ui=w('<div class="small text-muted mb-1"> </div> <div class="table-responsive"><table class="table table-sm table-striped m-0"><thead><tr><th>#</th><th> </th><!><th class="text-end">Value</th></tr></thead><tbody></tbody></table></div>',1),mi=w('<div class="small text-muted"> </div> <div class="h6 m-0"> </div>',1),fi=w('<div><div role="group" draggable="true"><button type="button" class="btn-close kpi-card-close" aria-label="Remove KPI card"></button> <!></div></div>'),vi=w('<div class="ux-surface p-2 mb-3 rounded border"><div class="d-flex align-items-center justify-content-between mb-2"><h5 class="m-0">KPI</h5> <button type="button" class="btn-close" aria-label="Hide KPI"></button></div> <div class="row g-2"></div></div>'),pi=w('<div class="alert alert-danger m-2 d-flex justify-content-between align-items-center"><span> </span> <button class="btn btn-sm btn-outline-danger fw-bold">Retry</button></div>'),gi=w('<div class="col-md-6 col-sm-12"><div class="col-md-12 ms-2 p-2 rounded border ux-surface"><h3>Casus Belli</h3> <pre> </pre></div></div>'),_i=w('<div class="col-md-6 col-sm-12"><div class="col-md-12 ms-2 p-2 rounded border ux-surface"><h3>Status</h3> <pre> </pre></div></div>'),hi=w('<hr/> <div class="row m-0"><!> <!></div>',1),bi=w('<div class="small text-muted text-end mt-2"> </div>'),yi=w('<div class="container-fluid p-2 ux-page-body"><h1 class="m-0 mb-2 p-2 ux-surface ux-page-title"><div class="ux-page-title-stack"><!> <span class="ux-page-title-main"> </span></div> <!></h1> <!> <ul class="layout-picker-bar ux-floating-controls nav fw-bold nav-pills m-0 p-2 ux-surface mb-3 d-flex flex-wrap gap-1"><li class="d-flex align-items-center gap-2 me-1"><span>Layout Picker:</span> <button class="btn ux-btn btn-sm fw-bold">Choose layout preset</button></li> <li><!></li> <!> <li class="ms-auto"><button class="btn ux-btn btn-sm">KPI Builder</button></li> <li class="d-flex flex-wrap gap-1 justify-content-end"><!></li></ul> <!> <!> <!> <!> <!> <div id="conflict-table-1"></div> <!> <hr/> <div class="ux-surface p-2"><h4> </h4> <div class="m-0" id="visualization"></div></div> <!></div>');function $i(I,p){Ba(p,!1);const h=k(),T=k(),ee=k(),ye=k(),L=k(),se=k(),U=k(),R=k(),te=k(),Oe=k(),le=k(),ae=k(),fe=k(),$e=k(),K={COALITION:0,ALLIANCE:1,NATION:2};let _e=k(""),Y=k(null),A=k(!1),H=k(null),de=k(""),l=k(null),Ae=["GROUND_TANKS_MUNITIONS_USED_UNNECESSARY","DOUBLE_FORTIFY","GROUND_NO_TANKS_MUNITIONS_USED_UNNECESSARY","GROUND_NO_TANKS_MUNITIONS_USED_UNNECESSARY_INACTIVE","GROUND_TANKS_NO_LOOT_NO_ENEMY_AIR_INACTIVE","GROUND_TANKS_NO_LOOT_NO_ENEMY_AIR","AIRSTRIKE_SOLDIERS_NONE","AIRSTRIKE_SOLDIERS_SHOULD_USE_GROUND","AIRSTRIKE_TANKS_NONE","AIRSTRIKE_SHIP_NONE","AIRSTRIKE_INACTIVE_NO_GROUND","AIRSTRIKE_INACTIVE_NO_SHIP","AIRSTRIKE_FAILED_NOT_DOGFIGHT","AIRSTRIKE_AIRCRAFT_NONE","AIRSTRIKE_AIRCRAFT_NONE_INACTIVE","AIRSTRIKE_AIRCRAFT_LOW","AIRSTRIKE_INFRA","AIRSTRIKE_MONEY","NAVAL_MAX_VS_NONE"].map(t=>`off:${t.toLowerCase().replaceAll("_"," ")} attacks`),S={Summary:{sort:"off:wars",columns:["name","net:damage","off:wars","def:wars","dealt:damage","loss:damage"]},Dealt:{sort:"dealt:damage",columns:["name","dealt:infra","dealt:~$soldier","dealt:~$tank","dealt:~$aircraft","dealt:~$ship","dealt:~$unit","dealt:~$consume","dealt:~$loot","dealt:damage"]},Received:{sort:"loss:damage",columns:["name","loss:infra","loss:~$soldier","loss:~$tank","loss:~$aircraft","loss:~$ship","loss:~$unit","loss:~$consume","loss:~$loot","loss:damage"]},Units:{sort:"dealt:~$unit",columns:["name","dealt:soldier","dealt:tank","dealt:aircraft","dealt:ship","dealt:~$unit","loss:soldier","loss:tank","loss:aircraft","loss:ship","loss:~$unit","net:~$unit"]},Consumption:{sort:"name",columns:["name","loss:~$building","loss:gasoline","loss:munitions","loss:steel","loss:aluminum","loss:consume gas","loss:consume mun"]},Attacks:{sort:"off:attacks",columns:["name","off:attacks",...Ae]}},o=k({layout:K.COALITION,columns:S.Summary.columns,sort:S.Summary.sort,order:"desc"}),J;const Te=()=>pr(),Ve=[{id:"preset-duration",kind:"preset",key:"duration"},{id:"preset-total-dmg",kind:"preset",key:"damage-total"},{id:"preset-net-gap",kind:"preset",key:"net-gap"}],Fe=[{id:"rank-alliance-net",kind:"ranking",entity:"alliance",metric:"net:damage",scope:"all",limit:8},{id:"rank-nation-net",kind:"ranking",entity:"nation",metric:"net:damage",scope:"all",limit:10}],Q={duration:"Duration",wars:"Wars tracked","damage-total":"Total damage exchanged","net-gap":"Damage gap","c1-dealt":"Coalition 1 dealt","c2-dealt":"Coalition 2 dealt","off-wars-per-nation":"Offensive wars per nation"},Ie={duration:"Elapsed time for the conflict from start to now/end.",wars:"Maximum wars tracked by either coalition in the summary.","damage-total":"Combined damage dealt by both coalitions.","net-gap":"Absolute net-damage lead of the currently leading side.","c1-dealt":"Raw total damage dealt by Coalition 1.","c2-dealt":"Raw total damage dealt by Coalition 2.","off-wars-per-nation":"Average offensive wars launched per nation across summary rows."},Re={all:"All",coalition1:"Coalition 1",coalition2:"Coalition 2",selection:"Selection snapshot"},Ee=[...Ve,...Fe];let E=k([...Ee]),it=k([]),Ht=k([]),Qt=k([]),we=k(null),Pe=k(!1),ot=k(!1),gt=k(!1),_t=new Set,ht=new Set,Yt=k("No selection"),bt=k("nation"),He=k("net:damage"),Ne=k("all"),yt=k(10),It=k("nation"),Qe=k("net:damage"),ke=k("all"),St=k("sum"),At=k("");const Nt=()=>`${pt()}:kpi-collapsed`;function Ke(t){return t==null||isNaN(t)?"N/A":t.toLocaleString()}function ze(t){return Cr(t)}function Be(){if(!e(Y))return;const t=Ka(e(Y));t.widgets=e(E),xr(e(Y),t)}function qt(t){if(!t||typeof t!="object"||!Array.isArray(t.widgets))return;const a=t.widgets.map(n=>Tr(n,ze)).filter(n=>n!==null);a.length>0&&d(E,a)}function ja(){try{if(!e(Y))return;const t=Ka(e(Y));Array.isArray(t.widgets)&&t.widgets.length>0&&qt({widgets:t.widgets})}catch(t){console.warn("Failed to read KPI config",t)}}function Jt(t){d(E,e(E).filter(a=>a.id!==t)),Be()}function Ga(t,a){d(E,Nr(e(E),t,a)),Be()}function Va(t,a){d(E,wr(e(E),t,a)),Be()}function Ha(t){d(we,t)}function Qa(){d(we,null)}function Ya(t){if(!e(we)||e(we)===t){d(we,null);return}const a=e(E).findIndex(n=>n.id===t);if(a===-1){d(we,null);return}Va(e(we),a),d(we,null)}function kt(){const t=Array.from(_t),a=Array.from(ht),n=[];return t.length>0&&n.push(`${t.length} alliance${t.length===1?"":"s"}`),a.length>0&&n.push(`${a.length} nation${a.length===1?"":"s"}`),{allianceIds:t,nationIds:a,label:n.length>0?n.join(" · "):"No selection"}}function qa(t,a){return t!=="selection"?Re[t]:a!=null&&a.label?`Selection (${a.label})`:Re.selection}function Ze(t){return t!=="selection"?!0:_t.size>0||ht.size>0}function Xt(t){return t!=="selection"||Ze(t)?"":"Selection scope requires at least one selected alliance or nation row in the current table."}function Ja(t){return e(E).some(a=>a.kind==="preset"&&a.key===t)}function Zt(t,a){var v,r,b;const n=new Set,i=new Set;if(t===K.ALLIANCE)for(const u of a){const _=Number((v=u==null?void 0:u[0])==null?void 0:v[1]);Number.isFinite(_)&&n.add(_)}else if(t===K.NATION)for(const u of a){const _=Number((r=u==null?void 0:u[0])==null?void 0:r[1]),y=Number((b=u==null?void 0:u[0])==null?void 0:b[2]);Number.isFinite(_)&&i.add(_),Number.isFinite(y)&&n.add(y)}else if(e(l)&&t===K.COALITION)for(const u of a){const _=Number(u==null?void 0:u[0]);if(!Number.isFinite(_))continue;const y=e(l).coalitions[_];if(y){for(const N of y.alliance_ids)n.add(N);for(const N of y.nation_ids)i.add(N)}}_t=n,ht=i;const s=kt();d(Yt,s.label)}function xt(t){d(E,[...e(E),t]),Be()}function Xa(t){Ja(t)||xt({id:ze("preset"),kind:"preset",key:t})}function Za(){const t=e(Ne)==="selection"?kt():void 0;e(Ne)==="selection"&&!Ze(e(Ne))||xt({id:ze("ranking"),kind:"ranking",entity:e(bt),metric:e(He),scope:e(Ne),limit:Math.max(1,e(yt)),snapshot:t})}function en(){const t=e(ke)==="selection"?kt():void 0;e(ke)==="selection"&&!Ze(e(ke))||xt({id:ze("metric"),kind:"metric",entity:e(It),metric:e(Qe),scope:e(ke),aggregation:e(St),source:"conflict",normalizeBy:e(At)||null,snapshot:t})}function tn(){d(Pe,!e(Pe)),localStorage.setItem(Nt(),e(Pe)?"1":"0")}function an(){e(Pe)&&(d(Pe,!1),localStorage.setItem(Nt(),"0"))}let et=new Map,st=new Map,xe=new Map;function nn(){et.clear(),st.clear(),xe.clear()}function rn(t){var i,s,v,r;if(!t)return"-";const a=(s=(i=t.allianceIds)==null?void 0:i.join("."))!=null?s:"",n=(r=(v=t.nationIds)==null?void 0:v.join("."))!=null?r:"";return`${a}|${n}`}function ea(t){return t==="alliance"?e(le):e(ae)}function Ct(t,a){return Number(t==null?void 0:t[a])||0}function ta(t,a,n,i=!1){var b,u;if(i&&a===-1)return Number.isFinite(n)?Math.abs(n)<=100&&`${n}`.includes(".")?n.toLocaleString(void 0,{maximumFractionDigits:2}):n.toLocaleString():"0";const v=((u=(b=t==null?void 0:t.cell_format)==null?void 0:b.formatMoney)!=null?u:[]).includes(a),r=Number(n||0).toLocaleString(void 0,{maximumFractionDigits:2});return v?`$${r}`:r}function aa(t,a,n,i){var u,_,y,N,x,D;const s=`${t}|${a}|${rn(i)}`,v=et.get(s);if(v)return v;let r;if(a==="all")return n.data;if(a==="selection"){const G=new Set((u=i==null?void 0:i.allianceIds)!=null?u:[]),ve=new Set((_=i==null?void 0:i.nationIds)!=null?_:[]);return t==="alliance"?G.size===0?r=[]:r=n.data.filter(j=>{var q;const ne=Number((q=j[0])==null?void 0:q[1]);return G.has(ne)}):ve.size>0?r=n.data.filter(j=>{var q;const ne=Number((q=j[0])==null?void 0:q[1]);return ve.has(ne)}):G.size>0?r=n.data.filter(j=>{var q;const ne=Number((q=j[0])==null?void 0:q[2]);return G.has(ne)}):r=[],et.set(s,r),r}if(!e(l))return r=n.data,et.set(s,r),r;const b=a==="coalition1"?new Set((N=(y=e(l).coalitions[0])==null?void 0:y.alliance_ids)!=null?N:[]):new Set((D=(x=e(l).coalitions[1])==null?void 0:x.alliance_ids)!=null?D:[]);return r=n.data.filter(G=>{var j,ne;if(t==="alliance"){const q=Number((j=G[0])==null?void 0:j[1]);return b.has(q)}const ve=Number((ne=G[0])==null?void 0:ne[2]);return b.has(ve)}),et.set(s,r),r}function on(t){const a=st.get(t.id);if(a)return a;let n;if(t.source==="aava")return!t.aavaSnapshot||t.entity!=="alliance"?[]:e(l)?(n=Da(e(l),{header:t.aavaSnapshot.header,primaryIds:t.aavaSnapshot.primaryIds,vsIds:t.aavaSnapshot.vsIds}).map(r=>({label:r.alliance[0],allianceId:r.alliance[1],value:Ct(r,t.metric)})).sort((r,b)=>b.value-r.value).map(r=>Ft($t({},r),{valueText:ta(null,-1,r.value,!0)})).slice(0,Math.max(1,t.limit)),st.set(t.id,n),n):[];const i=ea(t.entity);if(!i)return[];const s=i.columns.indexOf(t.metric);return s===-1?[]:(n=aa(t.entity,t.scope,i,t.snapshot).map(r=>{var _,y,N,x,D;if(t.entity==="alliance"){const G=Number((_=r[0])==null?void 0:_[1]);return{label:Xe((y=r[0])==null?void 0:y[0],G),allianceId:G,value:Number(r[s])||0}}const b=Number((N=r[0])==null?void 0:N[1]),u=Number((x=r[0])==null?void 0:x[2]);return{label:Gt((D=r[0])==null?void 0:D[0],b),nationId:b,allianceName:Xe(Tt[u],u),allianceId:u,value:Number(r[s])||0}}).sort((r,b)=>b.value-r.value).map(r=>Ft($t({},r),{valueText:ta(i,s,r.value)})).slice(0,Math.max(1,t.limit)),st.set(t.id,n),n)}function sn(t){const a=xe.get(t.id);if(a!==void 0)return a;let n=null;if(t.source==="aava"){if(!t.aavaSnapshot||t.entity!=="alliance"||!e(l))return null;const u=Da(e(l),{header:t.aavaSnapshot.header,primaryIds:t.aavaSnapshot.primaryIds,vsIds:t.aavaSnapshot.vsIds}),_=u.map(N=>Ct(N,t.metric));if(_.length===0)return null;if(t.normalizeBy){const N=u.map(D=>Ct(D,t.normalizeBy));if(t.aggregation==="sum"){const D=_.reduce((ve,j)=>ve+j,0),G=N.reduce((ve,j)=>ve+j,0);return n=G===0?null:D/G,xe.set(t.id,n),n}const x=_.map((D,G)=>{const ve=N[G];return ve===0?null:D/ve}).filter(D=>D!=null);return x.length===0?(xe.set(t.id,null),null):(n=x.reduce((D,G)=>D+G,0)/x.length,xe.set(t.id,n),n)}const y=_.reduce((N,x)=>N+x,0);return n=t.aggregation==="avg"?y/_.length:y,xe.set(t.id,n),n}const i=ea(t.entity);if(!i)return null;const s=i.columns.indexOf(t.metric);if(s===-1)return null;const v=aa(t.entity,t.scope,i,t.snapshot),r=v.map(u=>Number(u[s])||0);if(r.length===0)return null;if(t.normalizeBy){const u=i.columns.indexOf(t.normalizeBy);if(u===-1)return null;const _=v.map(N=>Number(N[u])||0);if(t.aggregation==="sum"){const N=r.reduce((D,G)=>D+G,0),x=_.reduce((D,G)=>D+G,0);return n=x===0?null:N/x,xe.set(t.id,n),n}const y=r.map((N,x)=>{const D=_[x];return D===0?null:N/D}).filter(N=>N!=null);return y.length===0?(xe.set(t.id,null),null):(n=y.reduce((N,x)=>N+x,0)/y.length,xe.set(t.id,n),n)}const b=r.reduce((u,_)=>u+_,0);return n=t.aggregation==="avg"?b/r.length:b,xe.set(t.id,n),n}function We(t){return Ua(t)}function ln(t){const a=We(t),[n]=t.split(":",1);return n==="net"?`${a}: dealt value minus received value.`:n==="dealt"?`${a}: value dealt by the selected entity.`:n==="loss"?`${a}: value received/lost by the selected entity.`:n==="off"?`${a}: offensive activity count for the selected entity.`:n==="def"?`${a}: defensive activity count for the selected entity.`:`${a}: summed or averaged over the selected scope.`}function na(t){var a,n;if(t.source==="aava"){const i=(n=(a=t.aavaSnapshot)==null?void 0:a.header)!=null?n:"wars";return Me(t.metric,i)}return We(t.metric)}function ra(t){var a,n;if(!t.normalizeBy)return null;if(t.source==="aava"){const i=(n=(a=t.aavaSnapshot)==null?void 0:a.header)!=null?n:"wars";return Me(t.normalizeBy,i)}return We(t.normalizeBy)}function lt(t){var a,n;if((t.kind==="ranking"||t.kind==="metric")&&t.source==="aava"){const i=((a=t.aavaSnapshot)==null?void 0:a.label)||"AAvA snapshot",s=((n=t.aavaSnapshot)==null?void 0:n.header)||"wars";return`AAvA (${i} · ${s})`}return t.kind==="preset"?"Preset":qa(t.scope,t.snapshot)}function cn(t){if(t.kind==="preset")return Q[t.key];if(t.kind==="ranking")return`${t.entity} · ${na(t)} · ${lt(t)} · top ${t.limit}`;const a=ra(t)?` per ${ra(t)}`:"";return`${t.aggregation.toUpperCase()} ${t.entity} · ${na(t)}${a} · ${lt(t)}`}function dn(t,a,n,i,s){d(_e,t.name);const v=Ge(t,a,n,i,s);let r=t.coalitions,b=new Set(r[0].alliance_ids),u=new Set(r[1].alliance_ids);a===K.COALITION?v.row_format=(y,N)=>{let x=N[0];x==0?y.classList.add("bg-danger-subtle"):x==1&&y.classList.add("bg-info-subtle")}:a===K.ALLIANCE?v.row_format=(y,N)=>{let x=N[0][1];b.has(x)?y.classList.add("bg-danger-subtle"):u.has(x)&&y.classList.add("bg-info-subtle")}:a===K.NATION&&(v.row_format=(y,N)=>{let x=N[0][2];b.has(x)?y.classList.add("bg-danger-subtle"):u.has(x)&&y.classList.add("bg-info-subtle")}),v.onSelectionChange=y=>{Zt(a,y.selectedRows)},Zt(a,[]),J=v;const _=document.getElementById("conflict-table-1");Ir(_,J)}function un(t){let a=t.get("layout");a&&(a==="coalition"?oe(o,e(o).layout=K.COALITION):a==="alliance"||a==="1"?oe(o,e(o).layout=K.ALLIANCE):(a==="nation"||a==="2")&&oe(o,e(o).layout=K.NATION));let n=t.get("sort");n&&oe(o,e(o).sort=n);let i=t.get("order");i&&oe(o,e(o).order=i);let s=t.get("columns");s&&oe(o,e(o).columns=s.split("."));const v=or("kpiw",t.get("kpiw"));if(v)try{const r=Or(v,ze);r.length>0&&d(E,r)}catch(r){console.warn("Failed to parse KPI widgets from URL",r)}}function tt(){e(l)&&dn(e(l),e(o).layout,e(o).columns,e(o).sort,e(o).order)}function Ot(t=e(E)){return kr(t,ze)}function ct(){return{layout:K.COALITION,sort:S.Summary.sort,order:"desc",columns:S.Summary.columns.join("."),kpiw:Ot(Ee)}}function mn(){const t=Ot();mt({layout:e(o).layout,sort:e(o).sort,order:e(o).order,columns:e(o).columns.join("."),kpiw:t},{replace:!0,defaults:ct()}),Je()}function ia(t=!1){mt({layout:e(o).layout,sort:e(o).sort,order:e(o).order,columns:e(o).columns.join(".")},{replace:t,defaults:ct()})}function fn(t=!0){const a=Ot();mt({layout:e(o).layout,sort:e(o).sort,order:e(o).order,columns:e(o).columns.join("."),kpiw:a},{replace:t,defaults:ct()})}function oa(t){return t.map(a=>{const s=a,{id:n}=s;return Ta(s,["id"])})}function sa(t){d(H,null),d(A,!1);let a=`https://locutus.s3.ap-southeast-2.amazonaws.com/conflicts/${t}.gzip?${Bt.version.conflict_data}`;La(a).then(n=>wa(null,null,function*(){d(l,n),d(de,fr(Bt.version.conflict_data,n.update_ms)),la(n.coalitions[0].alliance_ids,n.coalitions[0].alliance_names),la(n.coalitions[1].alliance_ids,n.coalitions[1].alliance_names),yield vr(),tt(),n.posts&&Object.keys(n.posts).length&&Nn(n.posts),d(A,!0),Je(),(typeof window.requestIdleCallback=="function"?s=>window.requestIdleCallback(s,{timeout:2500}):s=>window.setTimeout(s,300))(()=>{const s=gr(t,Bt.version.graph_data);La(s).catch(()=>{})})})).catch(n=>{console.error("Failed to load conflict data",n),d(H,"Could not load conflict data. Please try again later."),d(A,!0)})}let Tt={};function la(t,a){for(let n=0;n<t.length;n++)Tt[t[n]]=Xe(a[n],t[n])}za(()=>{rr(["layout","sort","order","columns","kpiw"],["id"]),Sr(),nt("getIds",(n,i)=>{var s;return(s=e(l))==null?void 0:s.coalitions[i]}),nt("formatNation",n=>{let i=n[2],s=Xe(Tt[i],i),v=Gt(n[0],n[1]);return'<a href="https://politicsandwar.com/alliance/id='+n[2]+'">'+s+'</a> | <a href="https://politicsandwar.com/nation/id='+n[1]+'">'+v+"</a>"}),nt("formatAA",n=>{let i=n[1],s=Xe(n[0],i);return'<a href="https://politicsandwar.com/alliance/id='+i+'">'+s+"</a>"}),nt("formatCol",n=>{let i=n,s=document.createElement("button");return e(l)?(s.setAttribute("type","button"),s.setAttribute("class","ms-1 btn ux-btn btn-sm fw-bold"),s.setAttribute("onclick",`showNames('${e(l).coalitions[i].name}',${i})`),s.textContent=e(l).coalitions[i].name,s.outerHTML):""}),nt("download",function(i,s){mr(document.getElementById("conflict-table-1").querySelector("table"),i,_r[s])});const t=ir();un(t),d(Pe,localStorage.getItem(Nt())==="1");const a=t.get("id");a?(d(Y,a),ja(),sa(e(Y))):(d(H,"Missing conflict id in URL"),d(A,!0))});function vn(t){oe(o,e(o).layout=t),mt({layout:e(o).layout,sort:null,columns:null},{defaults:ct()}),Je(),tt()}function pn(t){oe(o,e(o).columns=S[t].columns),oe(o,e(o).sort=S[t].sort),ia(),Je(),tt()}function gn(){return Pr(Object.keys(S))}function ca(){var t;return(t=Object.keys(S).find(a=>{const n=S[a];return n.sort===e(o).sort&&n.columns.length===e(o).columns.length&&n.columns.every((i,s)=>i===e(o).columns[s])}))!=null?t:null}function _n(){d(ot,!0)}function hn(){d(ot,!1)}function bn(){d(gt,!0)}function yn(){d(gt,!1)}function In(t){const a=Er(t.detail.ids);!a||!(a in S)||(pn(a),d(ot,!1))}function Sn(){oe(o,e(o).layout=K.COALITION),oe(o,e(o).columns=S.Summary.columns),oe(o,e(o).sort=S.Summary.sort),oe(o,e(o).order="desc"),d(E,[...Ee]),Be(),nr(["layout","sort","order","columns","kpiw"],["id"]),fn(!0),Je(),tt()}function An(){e(Y)&&sa(e(Y))}let da=!1,dt=null;function ua(){const t=document.getElementById("visjs");if(da&&dt&&(t&&t.getAttribute("data-loaded")||typeof Te()!="undefined")){if(!e(l))return;const a=document.getElementById("visualization");if(!a)return;a.hasChildNodes()&&(a.innerHTML="");const n=Te(),i=new n.DataSet;for(const u in dt){const _=dt[u],y=_[0],N=`https://forum.politicsandwar.com/index.php?/topic/${y}-${_[1]}`,x=_[2],D=new Date(x);i.add({id:y,content:`<a href="${N}" target="_blank">${u}</a>`,start:D})}const s=e(l).start;let v=e(l).end;v===-1&&(v=Date.now());const r={start:s,end:v,height:"75vh",width:"100%",zoomKey:"ctrlKey",orientation:"top",verticalScroll:!0},b=new n.Timeline(a,i,r);b.addCustomTime(s,"t1"),b.addCustomTime(v,"t2")}}function Nn(t){dt=t,da=!0,ua()}function kn(t){t.target.setAttribute("data-loaded","true"),ua()}X(()=>e(o),()=>{d(h,e(o).layout===K.ALLIANCE?"Alliance":e(o).layout===K.NATION?"Nation":"Coalition")}),X(()=>e(E),()=>{const t=[],a=[],n=[];for(const i of e(E))i.kind==="preset"?t.push(i):i.kind==="ranking"?a.push(i):i.kind==="metric"&&n.push(i);d(it,t),d(Ht,a),d(Qt,n)}),X(()=>(e(l),Ea),()=>{d(T,(()=>{if(!e(l))return"N/A";const t=e(l).start,a=e(l).end===-1?Date.now():e(l).end;return t?Ea(Math.max(0,Math.round((a-t)/1e3))):"N/A"})())}),X(()=>(e(l),Ge),()=>{d(ee,e(l)?Ge(e(l),K.COALITION,S.Summary.columns,"name","asc"):null)}),X(()=>(e(l),Ge),()=>{d(ye,e(l)?Ge(e(l),K.NATION,S.Summary.columns,"name","asc"):null)}),X(()=>(e(l),e(ee)),()=>{d(L,(()=>{if(!e(l)||!e(ee))return null;const t=e(l),a=e(ee),n=a.columns.indexOf("dealt:damage"),i=a.columns.indexOf("loss:damage"),s=a.columns.indexOf("net:damage"),v=a.columns.indexOf("off:wars"),r=a.columns.indexOf("def:wars");return n===-1||i===-1||s===-1||v===-1||r===-1?null:a.data.slice(0,2).map((b,u)=>{var _,y;return{idx:u,name:(y=(_=t.coalitions[u])==null?void 0:_.name)!=null?y:`Coalition ${u+1}`,dealt:Number(b[n])||0,received:Number(b[i])||0,net:Number(b[s])||0,wars:(Number(b[v])||0)+(Number(b[r])||0)}})})())}),X(()=>e(L),()=>{d(se,e(L)?e(L).reduce((t,a)=>t+a.dealt,0):null)}),X(()=>e(L),()=>{d(U,e(L)?Math.max(...e(L).map(t=>t.wars)):null)}),X(()=>e(L),()=>{d(R,e(L)?Math.max(...e(L).map(t=>Math.abs(t.net))):null)}),X(()=>e(ye),()=>{d(te,(()=>{if(!e(ye))return null;const t=e(ye),a=t.columns.indexOf("off:wars");if(a===-1)return null;const n=t.data.length;if(n===0)return null;const i=t.data.reduce((s,v)=>s+(Number(v[a])||0),0);return{totalOffWars:i,totalNations:n,perNation:i/n}})())}),X(()=>e(L),()=>{d(Oe,e(L)?e(L).reduce((t,a)=>a.net>t.net?a:t,e(L)[0]):null)}),X(()=>(e(l),e(o)),()=>{d(le,e(l)?Ge(e(l),K.ALLIANCE,e(o).columns,e(o).sort,e(o).order):null)}),X(()=>(e(l),e(o)),()=>{d(ae,e(l)?Ge(e(l),K.NATION,e(o).columns,e(o).sort,e(o).order):null)}),X(()=>e(ae),()=>{d(fe,e(ae)?e(ae).columns.filter((t,a)=>{var s,v,r,b;if(a===0)return!1;const n=(v=(s=e(ae).cell_format)==null?void 0:s.formatMoney)!=null?v:[],i=(b=(r=e(ae).cell_format)==null?void 0:r.formatNumber)!=null?b:[];return n.includes(a)||i.includes(a)}):[])}),X(()=>(e(fe),e(He),e(Qe)),()=>{e(fe).length>0&&(e(fe).includes(e(He))||d(He,e(fe)[0]),e(fe).includes(e(Qe))||d(Qe,e(fe)[0]))}),X(()=>(e(l),e(le),e(ae),e(E)),()=>{e(l),e(le),e(ae),e(E),nn()}),X(()=>(e(o),e(E)),()=>{d($e,(()=>{const t=S.Summary.columns,a=e(o).columns.length===t.length&&e(o).columns.every((r,b)=>r===t[b]),n=e(o).layout===K.COALITION&&e(o).sort===S.Summary.sort&&e(o).order==="desc"&&a,i=JSON.stringify(oa(e(E))),s=JSON.stringify(oa(Ee));return!(n&&i===s)})())}),Zn(),Fa();var wt=yi();ar("mkmkyj",t=>{var a=Qr(),n=be(a);g(n),er(()=>{var i;tr.title=`Conflict ${(i=e(_e))!=null?i:""}`}),me("load",n,kn),O(t,a)});var Lt=f(wt),Rt=f(Lt),ma=f(Rt);{let t=ge(()=>[{label:"Home",href:`${Wt}/`},{label:"Conflicts",href:`${Wt}/conflicts`},{label:e(_e)||"Conflict",href:e(Y)?`${Wt}/conflict?id=`+e(Y):void 0},{label:e(h)}]);dr(ma,{get items(){return e(t)}})}var fa=g(ma,2),xn=f(fa);m(fa),m(Rt);var Cn=g(Rt,2);{var On=t=>{var a=Yr(),n=f(a);zt(),m(a),V(()=>{var i,s;ft(a,"href",`https://politicsandwar.fandom.com/wiki/${(i=(e(l),c(()=>e(l).wiki)))!=null?i:""}`),P(n,`Wiki:${(s=(e(l),c(()=>{var v;return(v=e(l))==null?void 0:v.wiki})))!=null?s:""} `)}),O(t,a)};Z(Cn,t=>{e(l),c(()=>{var a;return(a=e(l))==null?void 0:a.wiki})&&t(On)})}m(Lt);var va=g(Lt,2);yr(va,{get conflictId(){return e(Y)},mode:"layout-picker",get currentLayout(){return e(o),c(()=>e(o).layout)},active:"coalition",onLayoutSelect:vn});var Et=g(va,2),Pt=f(Et),Tn=g(f(Pt),2);m(Pt);var Kt=g(Pt,2),wn=f(Kt);{let t=ge(()=>(e(it),c(()=>e(it).map(n=>n.key)))),a=ge(()=>({widgets:e(E),presetCards:e(it),rankingCards:e(Ht),metricCards:e(Qt)}));Hr(wn,{get currentColumns(){return e(o),c(()=>e(o).columns)},get currentSort(){return e(o),c(()=>e(o).sort)},get currentOrder(){return e(o),c(()=>e(o).order)},get currentKpis(){return e(t)},get currentKpiConfig(){return e(a)},$$events:{load:n=>{const i=n.detail.preset;if(oe(o,e(o).columns=i.columns),i.sort&&oe(o,e(o).sort=i.sort),i.order&&oe(o,e(o).order=i.order),i.kpiConfig)qt(i.kpiConfig),Be();else if(Array.isArray(i.kpis)&&i.kpis.length>0){const s=i.kpis.filter(v=>v in Q).map(v=>v);s.length>0&&(d(E,s.map(v=>({id:ze("preset"),kind:"preset",key:v}))),Be())}ia(),Je(),tt()}}})}m(Kt);var pa=g(Kt,2);{var Ln=t=>{var a=qr(),n=f(a);m(a),me("click",n,an),O(t,a)};Z(pa,t=>{e(Pe)&&t(Ln)})}var Dt=g(pa,2),Rn=f(Dt);m(Dt);var ga=g(Dt,2),En=f(ga);ur(En,{onReset:Sn,onSharePrepare:mn,get resetDirty(){return e($e)}}),m(ga),m(Et);var _a=g(Et,2);{var Pn=t=>{var a=vi(),n=f(a),i=g(f(n),2);m(n);var s=g(n,2);Ut(s,5,()=>e(E),jt,(v,r)=>{const b=ge(()=>(e(r),c(()=>e(r).kind==="ranking")));var u=fi(),_=f(u);let y;var N=f(_),x=g(N,2);{var D=j=>{var ne=qn(),q=be(ne);{var Ue=B=>{var W=Jr(),M=g(be(W),2),re=f(M,!0);m(M),V(()=>P(re,e(T))),O(B,W)},Ye=B=>{var W=Xr(),M=g(be(W),2),re=f(M,!0);m(M),V($=>P(re,$),[()=>(e(U),c(()=>Ke(e(U))))]),O(B,W)},qe=B=>{var W=Zr(),M=g(be(W),2),re=f(M,!0);m(M),V($=>P(re,$),[()=>(e(se),c(()=>Ke(e(se))))]),O(B,W)},ue=B=>{var W=ti(),M=g(be(W),2),re=f(M,!0);m(M);var $=g(M,2);{var C=F=>{var z=ei(),he=f(z);m(z),V(()=>{var ie;return P(he,`Lead: ${(ie=(e(Oe),c(()=>e(Oe).name)))!=null?ie:""}`)}),O(F,z)};Z($,F=>{e(Oe)&&F(C)})}V(F=>P(re,F),[()=>(e(R),c(()=>Ke(e(R))))]),O(B,W)},ce=B=>{var W=ai(),M=be(W),re=f(M);m(M);var $=g(M,2),C=f($,!0);m($),V(F=>{var z;P(re,`${(z=(e(L),c(()=>{var he,ie,Se;return(Se=(ie=(he=e(L))==null?void 0:he[0])==null?void 0:ie.name)!=null?Se:"Coalition 1"})))!=null?z:""} dealt`),P(C,F)},[()=>(e(L),c(()=>{var F,z;return Ke((z=(F=e(L))==null?void 0:F[0])==null?void 0:z.dealt)}))]),O(B,W)},De=B=>{var W=ni(),M=be(W),re=f(M);m(M);var $=g(M,2),C=f($,!0);m($),V(F=>{var z;P(re,`${(z=(e(L),c(()=>{var he,ie,Se;return(Se=(ie=(he=e(L))==null?void 0:he[1])==null?void 0:ie.name)!=null?Se:"Coalition 2"})))!=null?z:""} dealt`),P(C,F)},[()=>(e(L),c(()=>{var F,z;return Ke((z=(F=e(L))==null?void 0:F[1])==null?void 0:z.dealt)}))]),O(B,W)},Le=B=>{var W=ii(),M=g(be(W),2),re=f(M,!0);m(M);var $=g(M,2);{var C=F=>{var z=ri(),he=f(z);m(z),V((ie,Se)=>P(he,`${ie!=null?ie:""}
                                            offensive / ${Se!=null?Se:""}
                                            nations`),[()=>(e(te),c(()=>Ke(e(te).totalOffWars))),()=>(e(te),c(()=>Ke(e(te).totalNations)))]),O(F,z)};Z($,F=>{e(te)&&F(C)})}V(F=>P(re,F),[()=>(e(te),c(()=>e(te)?e(te).perNation.toFixed(2):"N/A"))]),O(B,W)};Z(q,B=>{e(r),c(()=>e(r).key==="duration")?B(Ue):(e(r),c(()=>e(r).key==="wars")?B(Ye,1):(e(r),c(()=>e(r).key==="damage-total")?B(qe,2):(e(r),c(()=>e(r).key==="net-gap")?B(ue,3):(e(r),c(()=>e(r).key==="c1-dealt")?B(ce,4):(e(r),c(()=>e(r).key==="c2-dealt")?B(De,5):(e(r),c(()=>e(r).key==="off-wars-per-nation")&&B(Le,6)))))))})}O(j,ne)},G=j=>{const ne=ge(()=>(e(r),c(()=>on(e(r)))));var q=ui(),Ue=be(q),Ye=f(Ue);m(Ue);var qe=g(Ue,2),ue=f(qe),ce=f(ue),De=f(ce),Le=g(f(De)),B=f(Le,!0);m(Le);var W=g(Le);{var M=$=>{var C=oi();O($,C)};Z(W,$=>{e(r),c(()=>e(r).entity==="nation")&&$(M)})}zt(),m(De),m(ce);var re=g(ce);Ut(re,5,()=>e(ne),jt,($,C,F)=>{var z=di(),he=f(z);he.textContent=F+1;var ie=g(he),Se=f(ie);{var Bn=Ce=>{var pe=si(),je=f(pe,!0);m(pe),V(()=>{ft(pe,"href",(e(C),c(()=>`https://politicsandwar.com/alliance/id=${e(C).allianceId}`))),P(je,(e(C),c(()=>e(C).label)))}),O(Ce,pe)},Wn=Ce=>{var pe=li(),je=f(pe,!0);m(pe),V(()=>{ft(pe,"href",(e(C),c(()=>`https://politicsandwar.com/nation/id=${e(C).nationId}`))),P(je,(e(C),c(()=>e(C).label)))}),O(Ce,pe)};Z(Se,Ce=>{e(r),c(()=>e(r).entity==="alliance")?Ce(Bn):Ce(Wn,!1)})}m(ie);var Na=g(ie);{var Un=Ce=>{var pe=ci(),je=f(pe),Gn=f(je,!0);m(je),m(pe),V(()=>{ft(je,"href",(e(C),c(()=>`https://politicsandwar.com/alliance/id=${e(C).allianceId}`))),P(Gn,(e(C),c(()=>e(C).allianceName)))}),O(Ce,pe)};Z(Na,Ce=>{e(r),c(()=>e(r).entity==="nation")&&Ce(Un)})}var ka=g(Na),jn=f(ka,!0);m(ka),m(z),V(()=>P(jn,(e(C),c(()=>e(C).valueText)))),O($,z)}),m(re),m(ue),m(qe),V(($,C)=>{var F,z;P(Ye,`Top ${(F=(e(r),c(()=>e(r).limit)))!=null?F:""}
                                    ${(z=(e(r),c(()=>e(r).entity)))!=null?z:""}s by
                                    ${$!=null?$:""}
                                    (${C!=null?C:""})`),P(B,(e(r),c(()=>e(r).entity==="alliance"?"Alliance":"Nation")))},[()=>(e(r),at(Me),c(()=>{var $,C;return e(r).source==="aava"?Me(e(r).metric,(C=($=e(r).aavaSnapshot)==null?void 0:$.header)!=null?C:"wars"):We(e(r).metric)})),()=>(e(r),c(()=>lt(e(r))))]),O(j,q)},ve=j=>{var ne=mi(),q=be(ne),Ue=f(q);m(q);var Ye=g(q,2),qe=f(Ye,!0);m(Ye),V((ue,ce,De,Le,B)=>{var W;P(Ue,`${ue!=null?ue:""}
                                    ${(W=(e(r),c(()=>e(r).entity)))!=null?W:""}
                                    ${ce!=null?ce:""}
                                    ${De!=null?De:""}
                                    (${Le!=null?Le:""})`),P(qe,B)},[()=>(e(r),c(()=>e(r).aggregation.toUpperCase())),()=>(e(r),at(Me),c(()=>{var ue,ce;return e(r).source==="aava"?Me(e(r).metric,(ce=(ue=e(r).aavaSnapshot)==null?void 0:ue.header)!=null?ce:"wars"):We(e(r).metric)})),()=>(e(r),at(Me),c(()=>{var ue,ce;return e(r).normalizeBy?` per ${e(r).source==="aava"?Me(e(r).normalizeBy,(ce=(ue=e(r).aavaSnapshot)==null?void 0:ue.header)!=null?ce:"wars"):We(e(r).normalizeBy)}`:""})),()=>(e(r),c(()=>lt(e(r)))),()=>(e(r),c(()=>Ke(sn(e(r)))))]),O(j,ne)};Z(x,j=>{e(r),c(()=>e(r).kind==="preset")?j(D):(e(r),c(()=>e(r).kind==="ranking")?j(G,1):j(ve,!1))})}m(_),m(u),V(()=>{Ra(u,1,lr(e(b)?"col-12 col-lg-6":"col-12 col-sm-6 col-xl-4")),y=Ra(_,1,"ux-surface p-3 rounded border h-100 position-relative kpi-card",null,y,{"kpi-card-dragging":e(we)===e(r).id})}),me("click",N,()=>Jt(e(r).id)),me("dragstart",_,()=>Ha(e(r).id)),me("dragend",_,Qa),me("dragover",_,Pa(function(j){br.call(this,p,j)})),me("drop",_,Pa(()=>Ya(e(r).id))),O(v,u)}),m(s),m(a),me("click",i,tn),O(t,a)};Z(_a,t=>{e(l)&&!e(Pe)&&t(Pn)})}var ha=g(_a,2);{let t=ge(()=>c(gn)),a=ge(()=>c(()=>ca()?[ca()]:[]));Lr(ha,{get open(){return e(ot)},title:"Choose Layout Preset",description:"Pick a preset column layout for the current conflict table.",get items(){return e(t)},get selectedIds(){return e(a)},applyLabel:"Use preset",singleSelect:!0,searchPlaceholder:"Search presets...",validateSelection:n=>Rr(n,"layout preset"),$$events:{close:hn,apply:In}})}var ba=g(ha,2);{let t=ge(()=>(e(Ne),c(()=>Ze(e(Ne))))),a=ge(()=>(e(ke),c(()=>Ze(e(ke))))),n=ge(()=>(e(Ne),c(()=>Xt(e(Ne))))),i=ge(()=>(e(ke),c(()=>Xt(e(ke))))),s=ge(()=>!!e(Y)),v=ge(()=>e(Y)?`aava?id=${e(Y)}`:null);Ar(ba,{get open(){return e(gt)},title:"KPI Builder",description:"Add and arrange KPI widgets.",get widgets(){return e(E)},get presetCardLabels(){return Q},get presetCardDescriptions(){return Ie},scopeOptions:[{value:"all",label:"All"},{value:"coalition1",label:"Coalition 1"},{value:"coalition2",label:"Coalition 2"},{value:"selection",label:"Selection snapshot"}],get metricsOptions(){return e(fe)},get selectedSnapshotLabel(){return e(Yt)},get canAddRanking(){return e(t)},get canAddMetric(){return e(a)},get canAddRankingReason(){return e(n)},get canAddMetricReason(){return e(i)},widgetManagerLabel:cn,metricLabel:We,metricDescription:ln,get showAavaHint(){return e(s)},get aavaHref(){return e(v)},get rankingEntityToAdd(){return e(bt)},set rankingEntityToAdd(r){d(bt,r)},get rankingMetricToAdd(){return e(He)},set rankingMetricToAdd(r){d(He,r)},get rankingScopeToAdd(){return e(Ne)},set rankingScopeToAdd(r){d(Ne,r)},get rankingLimitToAdd(){return e(yt)},set rankingLimitToAdd(r){d(yt,r)},get metricEntityToAdd(){return e(It)},set metricEntityToAdd(r){d(It,r)},get metricMetricToAdd(){return e(Qe)},set metricMetricToAdd(r){d(Qe,r)},get metricScopeToAdd(){return e(ke)},set metricScopeToAdd(r){d(ke,r)},get metricAggToAdd(){return e(St)},set metricAggToAdd(r){d(St,r)},get metricNormalizeByToAdd(){return e(At)},set metricNormalizeByToAdd(r){d(At,r)},$$events:{close:yn,removeWidget:r=>Jt(r.detail.id),moveWidget:r=>Ga(r.detail.id,r.detail.delta),addPreset:r=>Xa(r.detail.key),addRanking:Za,addMetric:en},$$legacy:!0})}var ya=g(ba,2);{var Kn=t=>{hr(t)};Z(ya,t=>{e(A)||t(Kn)})}var Ia=g(ya,2);{var Dn=t=>{var a=pi(),n=f(a),i=f(n,!0);m(n);var s=g(n,2);m(a),V(()=>P(i,e(H))),me("click",s,An),O(t,a)};Z(Ia,t=>{e(H)&&t(Dn)})}var Sa=g(Ia,4);{var Mn=t=>{var a=hi(),n=g(be(a),2),i=f(n);{var s=b=>{var u=gi(),_=f(u),y=g(f(_),2),N=f(y,!0);m(y),m(_),m(u),V(()=>P(N,(e(l),c(()=>{var x;return(x=e(l))==null?void 0:x.cb})))),O(b,u)};Z(i,b=>{e(l),c(()=>{var u;return(u=e(l))==null?void 0:u.cb})&&b(s)})}var v=g(i,2);{var r=b=>{var u=_i(),_=f(u),y=g(f(_),2),N=f(y,!0);m(y),m(_),m(u),V(()=>P(N,(e(l),c(()=>{var x;return(x=e(l))==null?void 0:x.status})))),O(b,u)};Z(v,b=>{e(l),c(()=>{var u;return(u=e(l))==null?void 0:u.status})&&b(r)})}m(n),O(t,a)};Z(Sa,t=>{e(o),c(()=>e(o).layout==K.COALITION)&&t(Mn)})}var Mt=g(Sa,4),Aa=f(Mt),$n=f(Aa);m(Aa),zt(2),m(Mt);var Fn=g(Mt,2);{var zn=t=>{var a=bi(),n=f(a,!0);m(a),V(()=>P(n,e(de))),O(t,a)};Z(Fn,t=>{e(de)&&t(zn)})}m(wt),V((t,a)=>{var n;P(xn,`Conflict: ${(n=e(_e))!=null?n:""}`),P($n,`${t!=null?t:""} - ${a!=null?a:""}`)},[()=>(at(vt),e(l),c(()=>{var t,a;return vt((a=(t=e(l))==null?void 0:t.start)!=null?a:null)})),()=>(at(vt),e(l),c(()=>{var t,a;return vt((a=(t=e(l))==null?void 0:t.end)!=null?a:null)}))]),me("click",Tn,_n),me("click",Rn,bn),O(I,wt),Wa()}export{$i as component};
