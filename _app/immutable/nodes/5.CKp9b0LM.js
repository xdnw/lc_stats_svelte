import{h as Re,a as M,t as N,s as A,e as U}from"../chunks/disclose-version.B0B114Pu.js";import{i as Le}from"../chunks/legacy.DQ3BPbVs.js";import{p as Me,t as $,b as Ie,s as f,g as t,c as b,m as I,d as g,r as x,n as ne,f as Ne,h as oe}from"../chunks/runtime.mdILdFMH.js";import{o as We,i as q}from"../chunks/index-client.T9W-Qjf4.js";import{e as V,i as ce}from"../chunks/each.CSPNoT9w.js";import{c as de,s as je}from"../chunks/_layout.B2jEg47M.js";import{a as Fe,g as Te,d as Be,f as De,b as z,c as X,o as Z,p as Q,h as ue,P as Ee,S as qe,t as ee,r as He}from"../chunks/Progress.sJimGKi_.js";import{P as me,a as Ue,s as fe,c as ze,b as ve,e as pe,f as Qe,h as he,t as Oe,d as Ye}from"../chunks/index.Da-3W4gc.js";import{g as be,r as _e}from"../chunks/warWeb.da6xX1jT.js";import{C as Ge}from"../chunks/ConflictRouteTabs.B_9-Me3P.js";var Je=N('<a class="btn ux-btn fw-bold"> <i class="bi bi-box-arrow-up-right"></i></a>'),Ke=N('<div class="alert alert-danger m-2 d-flex justify-content-between align-items-center"><span> </span> <button class="btn btn-sm btn-outline-danger fw-bold">Retry</button></div>'),Ve=N('<button class="btn ux-btn btn-sm ms-1 mb-1 fw-bold"> </button>'),Xe=N('<button class="btn ux-btn btn-sm ms-1 mb-1 fw-bold"> </button>'),Ze=N('<button class="btn ux-btn btn-sm ms-1 mb-1 fw-bold"> </button>'),et=N('<div class="d-flex justify-content-between align-items-center mb-1"><span class="fw-bold">Layout Picker:</span> <!></div> <!> <hr class="m-1"> <div class="ux-coalition-panel ux-coalition-panel--compact ux-coalition-panel--red"> <!></div> <div class="ux-coalition-panel ux-coalition-panel--compact ux-coalition-panel--blue"> <!></div> <div class="small text-muted mt-2"> </div>',1),tt=N('<div class="small text-muted text-end mt-2"> </div>'),at=N(`<div class="container-fluid p-2 ux-page-body"><h1 class="m-0 mb-2 p-2 ux-surface ux-page-title"><a href="conflicts" aria-label="Back to conflicts"><i class="bi bi-arrow-left"></i></a> <!></h1> <!> <div class="ux-surface ux-tab-panel p-2 fw-bold" style="min-height: 116px;"><!> <!> <!></div> <div class="d-flex justify-content-center align-items-center mt-1"><div class="d-flex justify-content-center align-items-center alert alert-danger text-center mb-1 py-1 text-danger">Click or hover over one of the chords and then scroll down to view
            the table.</div></div> <div class="container bg-light-subtle"><div id="my_dataviz"></div> <div class="mt-1" id="myTooltip" style="min-height:15em"></div></div> <!> <br></div>`);function ft(ge,xe){Me(xe,!1);let te=I(""),T=I(null),o=I(null),k=I(new Set),w=I("wars"),B=I(!1),D=I(null),O=I("");We(()=>{Fe(["header","ids"],["id"]);let l=new URLSearchParams(window.location.search);const s=l.get("id");s?(f(T,s),ae(t(T),l)):(f(D,"Missing conflict id in URL"),f(B,!0))});function ae(l,s){f(D,null),f(B,!1);let c=Te(l,de.version.conflict_data);Be(c).then(r=>{var h,C,_;f(o,r),f(te,r.name),f(O,De(de.version.conflict_data,r.update_ms)),f(k,new Set([...r.coalitions[0].alliance_ids,...r.coalitions[1].alliance_ids])),f(w,be(r));let d=s.get("header");d&&((h=t(o))!=null&&h.war_web.headers.includes(d))&&f(w,d);let v=s.get("ids");if(v){let S=v.split(".").map(y=>+y);f(k,new Set(S)),(!((C=t(o))!=null&&C.coalitions[0].alliance_ids.some(y=>t(k).has(y)))||!((_=t(o))!=null&&_.coalitions[1].alliance_ids.some(y=>t(k).has(y))))&&f(k,new Set([...r.coalitions[0].alliance_ids,...r.coalitions[1].alliance_ids]))}H(),f(B,!0),z()}).catch(r=>{console.error("Failed to load chord web data",r),f(D,"Could not load conflict web data. Please try again later."),f(B,!0)})}function we(l){f(w,l),ue("header",l),z(),H()}function Y(l,s){t(o)&&(f(k,Oe(t(k),t(o).coalitions,l,s)),ue("ids",Array.from(t(k)).join(".")),z(),H())}function ye(){t(o)&&(f(w,be(t(o))),f(k,new Set([...t(o).coalitions[0].alliance_ids,...t(o).coalitions[1].alliance_ids])),He(["header","ids"],["id"]),z(),H())}function ke(){if(!t(T))return;const l=new URLSearchParams(window.location.search);ae(t(T),l)}function H(){Pe(t(o),t(k),t(w))}function Pe(l,s,c){let r={};l.coalitions.forEach(a=>{a.alliance_ids.forEach((i,P)=>{r[i]=X(a.alliance_names[P],i)})});let d=[],v=[],h=[...l.coalitions[0].alliance_ids,...l.coalitions[1].alliance_ids],C=h.filter(a=>s.has(a)),_=[];for(let a of l.coalitions[0].alliance_ids)d.push(me.REDS),s.has(a)&&(v.push(r[a]),_.push(0));for(let a of l.coalitions[1].alliance_ids)d.push(me.BLUES),s.has(a)&&(v.push(r[a]),_.push(1));let y=Ue(Ye,d).filter((a,i)=>s.has(h[i])),W=l.war_web.headers.indexOf(c),u=l.war_web.data[W],e=[];for(let a=0;a<h.length;(a+=1)-1){let i=h[a],P=u[a];if(s.has(i)){let R=P.filter((L,j)=>s.has(h[j]));e.push(R)}}e=e.map(a=>a.length===0?new Array(v.length).fill(0):a),e=e.map(a=>a.map(i=>isNaN(i)||i<0?0:i)),$e(e,v,y,C,_)}function $e(l,s,c,r,d){const v=_e(t(w));fe("#my_dataviz").selectAll("*").remove();const h=fe("#my_dataviz").append("svg").classed("svg-content-responsive",!0).attr("preserveAspectRatio","xMinYMin meet").attr("viewBox","0 0 600 600").append("g").attr("transform","translate(300,300)").classed("rect",!0).attr("width",440).attr("height",440),C=ze().padAngle(.01).sortSubgroups(ve).sortChords(ve)(l);h.datum(C).append("g").classed("rect",!0).attr("width",440).attr("height",440).selectAll("g").data(e=>e.groups).join("g").append("path").style("fill",(e,a)=>c[a]).style("stroke","#222").style("stroke-width","0.25px").attr("d",pe().innerRadius(210).outerRadius(220));let _=h.datum(C).append("g").selectAll("path").data(e=>e).join("path").attr("d",Qe().radius(208)).attr("fill-opacity",.75).attr("stroke-opacity",.5).style("fill",e=>c[e.source.index]).style("stroke",e=>he(c[e.source.index],25)).style("stroke-width","0.5px"),S=h.datum(C).append("g").selectAll("g").data(e=>e.groups).join("g");S.append("path").style("fill",(e,a)=>c[a]).style("stroke","#222").style("stroke-width","0.25px").attr("d",pe().innerRadius(210).outerRadius(220)),S.append("text").each(e=>{e.angle=(e.startAngle+e.endAngle)/2}).attr("dy",".35em").attr("transform",e=>`
        rotate(${e.angle*180/Math.PI-90})
        translate(221)
        ${e.angle>Math.PI?"rotate(180)":""}
    `).attr("text-anchor",e=>e.angle>Math.PI?"end":null).style("font-size","9px").text((e,a)=>s[a]);let y=-1,p=-1;r.filter((e,a)=>d[a]===0).length===1?W(d.indexOf(0)):r.filter((e,a)=>d[a]===1).length===1&&W(d.indexOf(1));function W(e){let a=document.getElementById("myTooltip"),i=new Set(l[e].map((n,m)=>n!==0||l[m][e]!==0?m:-1).filter(n=>n!==-1)),P=s.filter((n,m)=>i.has(m)),R=c.filter((n,m)=>i.has(m)),L=l[e].filter((n,m)=>i.has(m)),j=l.map((n,m)=>i.has(m)?n[e]:null).filter(n=>n!==null),E=Array.from({length:L.length},(n,m)=>m);E.sort((n,m)=>L[m]-L[n]),P=E.map(n=>P[n]),R=E.map(n=>R[n]),L=E.map(n=>L[n]),j=E.map(n=>j[n]);let F=`<h5>Selected alliance: ${s[e]} (${t(w)})</h5><div class='small text-muted mb-1'>${v.directionNote(t(w))} Net = Selected value minus Compared value.</div><table class='table fw-bold w-auto'><tr><th>Compared alliance</th><th>${v.primaryToRowLabel(t(w))}</th><th>${v.rowToPrimaryLabel(t(w))}</th><th>Net</th></tr>`;P.forEach((n,m)=>{F+=`<tr><td style='background-color:${he(R[m],50)};color:white'>${n}</td>`,F+=`<td>${Z(L[m])}</td>`,F+=`<td>${Z(j[m])}</td>`,F+=`<td>${Z(L[m]-j[m])}</td></tr>`}),F+="</table>",a.innerHTML=F}function u(){p!==y&&(p==-1?_.classed("d-none",!1):(_.filter(e=>e.source.index!==p&&e.target.index!==p).classed("d-none",!0),_.filter(e=>e.source.index===p||e.target.index===p).classed("d-none",!1),W(p)),y=p)}S.on("click",function(e,a){p=-1,y=-1,Y(d[a.index],r[a.index])}),S.on("mouseover",function(e,a){p=a.index,requestAnimationFrame(Q(100,u))}).on("mouseout",function(e,a){p=-1,requestAnimationFrame(Q(100,u))}).on("mouseover touchstart",function(e,a){p=a.index,requestAnimationFrame(Q(100,u))}).on("mouseout touchend",function(e,a){p=-1,requestAnimationFrame(Q(100,u))})}Le();var G=at();Re(l=>{});var J=g(G),le=b(g(J)),Ce=b(le);q(Ce,()=>{var l;return(l=t(o))==null?void 0:l.wiki},l=>{var s=Je(),c=g(s);ne(),x(s),$(()=>{var r,d,v;je(s,"href",`https://politicsandwar.fandom.com/wiki/${(r=t(o).wiki)!=null?r:""}`),A(c,`Wiki:${(v=(d=t(o))==null?void 0:d.wiki)!=null?v:""} `)}),M(l,s)}),x(J);var se=b(J,2);Ge(se,{get conflictId(){return t(T)},active:"chord"});var K=b(se,2),ie=g(K);q(ie,()=>!t(B),l=>{Ee(l)});var re=b(ie,2);q(re,()=>t(D),l=>{var s=Ke(),c=g(s),r=g(c,!0);x(c);var d=b(c,2);x(s),$(()=>A(r,t(D))),U("click",d,ke),M(l,s)});var Se=b(re,2);q(Se,()=>t(o),l=>{var s=et(),c=Ne(s),r=b(g(c),2);qe(r,{onReset:ye}),x(c);var d=b(c,2);V(d,1,()=>t(o).war_web.headers,u=>u,(u,e)=>{var a=Ve(),i=g(a,!0);x(a),$(()=>{ee(a,"active",t(w)===t(e)),A(i,t(e))}),U("click",a,()=>we(t(e))),M(u,a)});var v=b(d,4),h=g(v),C=b(h);V(C,1,()=>t(o).coalitions[0].alliance_ids,ce,(u,e,a)=>{var i=Xe();const P=oe(()=>t(k).has(t(e)));$(()=>ee(i,"active",t(P)));var R=g(i,!0);$(()=>A(R,X(t(o).coalitions[0].alliance_names[a],t(e)))),x(i),U("click",i,()=>Y(0,t(e))),M(u,i)}),x(v);var _=b(v,2),S=g(_),y=b(S);V(y,1,()=>t(o).coalitions[1].alliance_ids,ce,(u,e,a)=>{var i=Ze();const P=oe(()=>t(k).has(t(e)));$(()=>ee(i,"active",t(P)));var R=g(i,!0);$(()=>A(R,X(t(o).coalitions[1].alliance_names[a],t(e)))),x(i),U("click",i,()=>Y(1,t(e))),M(u,i)}),x(_);var p=b(_,2),W=g(p);$(()=>{var u;return A(W,`${(u=_e(t(w)).directionNote(t(w)))!=null?u:""}
                Hover a chord to inspect one Selected alliance versus Compared alliances.
                "Net" = Selected value minus Compared value.`)}),x(p),$(()=>{var u,e,a,i;A(h,`${(e=(u=t(o))==null?void 0:u.coalitions[0].name)!=null?e:""}: `),A(S,`${(i=(a=t(o))==null?void 0:a.coalitions[1].name)!=null?i:""}: `)}),M(l,s)}),x(K);var Ae=b(K,6);q(Ae,()=>t(O),l=>{var s=tt(),c=g(s,!0);x(s),$(()=>A(c,t(O))),M(l,s)}),ne(2),x(G),$(()=>{var l;return A(le,` Conflict: ${(l=t(te))!=null?l:""} `)}),M(ge,G),Ie()}export{ft as component};
