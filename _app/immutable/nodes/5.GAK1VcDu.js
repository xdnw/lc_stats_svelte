import{h as Le,a as I,t as N,s as S,e as z}from"../chunks/disclose-version.BGVnXwSC.js";import{i as Ie}from"../chunks/legacy.C5xHvBl9.js";import{p as Ne,l as We,a as je,t as $,b as De,s as u,g as e,c as _,m as R,d as x,r as w,n as ce,f as Fe,h as de}from"../chunks/runtime.Bz3ZCnid.js";import{o as Te,i as q}from"../chunks/index-client.Q1qAUnCw.js";import{a as Be,g as ue,d as Ee,s as Q,b as fe,e as V,i as me,r as qe}from"../chunks/binary.C_HE3RDK.js";import{c as ve,s as He}from"../chunks/_layout.C340yC5l.js";import{g as ze,f as Qe,a as X,j as Z,r as O,P as Oe,S as Ue,t as ee}from"../chunks/Progress.KQ1k3Mu0.js";import{P as pe,a as Ye,s as he,c as Ge,b as be,e as _e,f as Je,h as ge,t as Ke,d as Ve}from"../chunks/index.Da-3W4gc.js";import{g as te,r as ye}from"../chunks/warWeb.da6xX1jT.js";import{C as Xe}from"../chunks/ConflictRouteTabs.C9YpKmne.js";var Ze=N('<a class="btn ux-btn fw-bold"> <i class="bi bi-box-arrow-up-right"></i></a>'),et=N('<div class="alert alert-danger m-2 d-flex justify-content-between align-items-center"><span> </span> <button class="btn btn-sm btn-outline-danger fw-bold">Retry</button></div>'),tt=N('<button class="btn ux-btn btn-sm ms-1 mb-1 fw-bold"> </button>'),at=N('<button class="btn ux-btn btn-sm ms-1 mb-1 fw-bold"> </button>'),lt=N('<button class="btn ux-btn btn-sm ms-1 mb-1 fw-bold"> </button>'),st=N('<div class="d-flex justify-content-between align-items-center mb-1"><span class="fw-bold">Layout Picker:</span> <!></div> <!> <hr class="m-1"> <div class="ux-coalition-panel ux-coalition-panel--compact ux-coalition-panel--red"> <!></div> <div class="ux-coalition-panel ux-coalition-panel--compact ux-coalition-panel--blue"> <!></div> <div class="small text-muted mt-2"> </div>',1),it=N('<div class="small text-muted text-end mt-2"> </div>'),rt=N(`<div class="container-fluid p-2 ux-page-body"><h1 class="m-0 mb-2 p-2 ux-surface ux-page-title"><a href="conflicts" aria-label="Back to conflicts"><i class="bi bi-arrow-left"></i></a> <!></h1> <!> <div class="ux-surface ux-tab-panel p-2 fw-bold" style="min-height: 116px;"><!> <!> <!></div> <div class="d-flex justify-content-center align-items-center mt-1"><div class="d-flex justify-content-center align-items-center alert alert-danger text-center mb-1 py-1 text-danger">Click or hover over one of the chords and then scroll down to view
            the table.</div></div> <div class="container bg-light-subtle"><div id="my_dataviz"></div> <div class="mt-1" id="myTooltip" style="min-height:15em"></div></div> <!> <br></div>`);function bt(xe,we){Ne(we,!1);const ae=R();let le=R(""),F=R(null),r=R(null),g=R(new Set),h=R("wars"),T=R(!1),B=R(null),U=R("");Te(()=>{Be(["header","ids"],["id"]);let l=ue();const s=l.get("id");s?(u(F,s),se(e(F),l)):(u(B,"Missing conflict id in URL"),u(T,!0))});function se(l,s){u(B,null),u(T,!1);let c=ze(l,ve.version.conflict_data);Ee(c).then(n=>{var b,P,y;u(r,n),u(le,n.name),u(U,Qe(ve.version.conflict_data,n.update_ms)),u(g,new Set([...n.coalitions[0].alliance_ids,...n.coalitions[1].alliance_ids])),u(h,te(n));let d=s.get("header");d&&((b=e(r))!=null&&b.war_web.headers.includes(d))&&u(h,d);let v=s.get("ids");if(v){let A=v.split(".").map(k=>+k);u(g,new Set(A)),(!((P=e(r))!=null&&P.coalitions[0].alliance_ids.some(k=>e(g).has(k)))||!((y=e(r))!=null&&y.coalitions[1].alliance_ids.some(k=>e(g).has(k))))&&u(g,new Set([...n.coalitions[0].alliance_ids,...n.coalitions[1].alliance_ids]))}H(),u(T,!0),Q()}).catch(n=>{console.error("Failed to load chord web data",n),u(B,"Could not load conflict web data. Please try again later."),u(T,!0)})}function ke(l){u(h,l),fe("header",l),Q(),H()}function Y(l,s){e(r)&&(u(g,Ke(e(g),e(r).coalitions,l,s)),fe("ids",Array.from(e(g)).join(".")),Q(),H())}function Ce(){e(r)&&(u(h,te(e(r))),u(g,new Set([...e(r).coalitions[0].alliance_ids,...e(r).coalitions[1].alliance_ids])),qe(["header","ids"],["id"]),Q(),H())}function $e(){if(!e(F))return;const l=ue();se(e(F),l)}function H(){Pe(e(r),e(g),e(h))}function Pe(l,s,c){let n={};l.coalitions.forEach(a=>{a.alliance_ids.forEach((i,C)=>{n[i]=X(a.alliance_names[C],i)})});let d=[],v=[],b=[...l.coalitions[0].alliance_ids,...l.coalitions[1].alliance_ids],P=b.filter(a=>s.has(a)),y=[];for(let a of l.coalitions[0].alliance_ids)d.push(pe.REDS),s.has(a)&&(v.push(n[a]),y.push(0));for(let a of l.coalitions[1].alliance_ids)d.push(pe.BLUES),s.has(a)&&(v.push(n[a]),y.push(1));let k=Ye(Ve,d).filter((a,i)=>s.has(b[i])),W=l.war_web.headers.indexOf(c),f=l.war_web.data[W],t=[];for(let a=0;a<b.length;(a+=1)-1){let i=b[a],C=f[a];if(s.has(i)){let M=C.filter((L,j)=>s.has(b[j]));t.push(M)}}t=t.map(a=>a.length===0?new Array(v.length).fill(0):a),t=t.map(a=>a.map(i=>isNaN(i)||i<0?0:i)),Ae(t,v,k,P,y)}function Ae(l,s,c,n,d){const v=ye(e(h));he("#my_dataviz").selectAll("*").remove();const b=he("#my_dataviz").append("svg").classed("svg-content-responsive",!0).attr("preserveAspectRatio","xMinYMin meet").attr("viewBox","0 0 600 600").append("g").attr("transform","translate(300,300)").classed("rect",!0).attr("width",440).attr("height",440),P=Ge().padAngle(.01).sortSubgroups(be).sortChords(be)(l);b.datum(P).append("g").classed("rect",!0).attr("width",440).attr("height",440).selectAll("g").data(t=>t.groups).join("g").append("path").style("fill",(t,a)=>c[a]).style("stroke","#222").style("stroke-width","0.25px").attr("d",_e().innerRadius(210).outerRadius(220));let y=b.datum(P).append("g").selectAll("path").data(t=>t).join("path").attr("d",Je().radius(208)).attr("fill-opacity",.75).attr("stroke-opacity",.5).style("fill",t=>c[t.source.index]).style("stroke",t=>ge(c[t.source.index],25)).style("stroke-width","0.5px"),A=b.datum(P).append("g").selectAll("g").data(t=>t.groups).join("g");A.append("path").style("fill",(t,a)=>c[a]).style("stroke","#222").style("stroke-width","0.25px").attr("d",_e().innerRadius(210).outerRadius(220)),A.append("text").each(t=>{t.angle=(t.startAngle+t.endAngle)/2}).attr("dy",".35em").attr("transform",t=>`
        rotate(${t.angle*180/Math.PI-90})
        translate(221)
        ${t.angle>Math.PI?"rotate(180)":""}
    `).attr("text-anchor",t=>t.angle>Math.PI?"end":null).style("font-size","9px").text((t,a)=>s[a]);let k=-1,p=-1;n.filter((t,a)=>d[a]===0).length===1?W(d.indexOf(0)):n.filter((t,a)=>d[a]===1).length===1&&W(d.indexOf(1));function W(t){let a=document.getElementById("myTooltip"),i=new Set(l[t].map((o,m)=>o!==0||l[m][t]!==0?m:-1).filter(o=>o!==-1)),C=s.filter((o,m)=>i.has(m)),M=c.filter((o,m)=>i.has(m)),L=l[t].filter((o,m)=>i.has(m)),j=l.map((o,m)=>i.has(m)?o[t]:null).filter(o=>o!==null),E=Array.from({length:L.length},(o,m)=>m);E.sort((o,m)=>L[m]-L[o]),C=E.map(o=>C[o]),M=E.map(o=>M[o]),L=E.map(o=>L[o]),j=E.map(o=>j[o]);let D=`<h5>Selected alliance: ${s[t]} (${e(h)})</h5><div class='small text-muted mb-1'>${v.directionNote(e(h))} Net = Selected value minus Compared value.</div><table class='table fw-bold w-auto'><tr><th>Compared alliance</th><th>${v.primaryToRowLabel(e(h))}</th><th>${v.rowToPrimaryLabel(e(h))}</th><th>Net</th></tr>`;C.forEach((o,m)=>{D+=`<tr><td style='background-color:${ge(M[m],50)};color:white'>${o}</td>`,D+=`<td>${Z(L[m])}</td>`,D+=`<td>${Z(j[m])}</td>`,D+=`<td>${Z(L[m]-j[m])}</td></tr>`}),D+="</table>",a.innerHTML=D}function f(){p!==k&&(p==-1?y.classed("d-none",!1):(y.filter(t=>t.source.index!==p&&t.target.index!==p).classed("d-none",!0),y.filter(t=>t.source.index===p||t.target.index===p).classed("d-none",!1),W(p)),k=p)}A.on("click",function(t,a){p=-1,k=-1,Y(d[a.index],n[a.index])}),A.on("mouseover",function(t,a){p=a.index,requestAnimationFrame(O(100,f))}).on("mouseout",function(t,a){p=-1,requestAnimationFrame(O(100,f))}).on("mouseover touchstart",function(t,a){p=a.index,requestAnimationFrame(O(100,f))}).on("mouseout touchend",function(t,a){p=-1,requestAnimationFrame(O(100,f))})}We(()=>(e(r),e(h),e(g)),()=>{u(ae,(()=>{if(!e(r))return!1;const l=te(e(r)),s=e(r).coalitions[0].alliance_ids.length+e(r).coalitions[1].alliance_ids.length;return e(h)!==l||e(g).size!==s})())}),je(),Ie();var G=rt();Le(l=>{});var J=x(G),ie=_(x(J)),Se=_(ie);q(Se,()=>{var l;return(l=e(r))==null?void 0:l.wiki},l=>{var s=Ze(),c=x(s);ce(),w(s),$(()=>{var n,d,v;He(s,"href",`https://politicsandwar.fandom.com/wiki/${(n=e(r).wiki)!=null?n:""}`),S(c,`Wiki:${(v=(d=e(r))==null?void 0:d.wiki)!=null?v:""} `)}),I(l,s)}),w(J);var re=_(J,2);Xe(re,{get conflictId(){return e(F)},active:"chord"});var K=_(re,2),ne=x(K);q(ne,()=>!e(T),l=>{Oe(l)});var oe=_(ne,2);q(oe,()=>e(B),l=>{var s=et(),c=x(s),n=x(c,!0);w(c);var d=_(c,2);w(s),$(()=>S(n,e(B))),z("click",d,$e),I(l,s)});var Me=_(oe,2);q(Me,()=>e(r),l=>{var s=st(),c=Fe(s),n=_(x(c),2);Ue(n,{onReset:Ce,get resetDirty(){return e(ae)}}),w(c);var d=_(c,2);V(d,1,()=>e(r).war_web.headers,f=>f,(f,t)=>{var a=tt(),i=x(a,!0);w(a),$(()=>{ee(a,"active",e(h)===e(t)),S(i,e(t))}),z("click",a,()=>ke(e(t))),I(f,a)});var v=_(d,4),b=x(v),P=_(b);V(P,1,()=>e(r).coalitions[0].alliance_ids,me,(f,t,a)=>{var i=at();const C=de(()=>e(g).has(e(t)));$(()=>ee(i,"active",e(C)));var M=x(i,!0);$(()=>S(M,X(e(r).coalitions[0].alliance_names[a],e(t)))),w(i),z("click",i,()=>Y(0,e(t))),I(f,i)}),w(v);var y=_(v,2),A=x(y),k=_(A);V(k,1,()=>e(r).coalitions[1].alliance_ids,me,(f,t,a)=>{var i=lt();const C=de(()=>e(g).has(e(t)));$(()=>ee(i,"active",e(C)));var M=x(i,!0);$(()=>S(M,X(e(r).coalitions[1].alliance_names[a],e(t)))),w(i),z("click",i,()=>Y(1,e(t))),I(f,i)}),w(y);var p=_(y,2),W=x(p);$(()=>{var f;return S(W,`${(f=ye(e(h)).directionNote(e(h)))!=null?f:""}
                Hover a chord to inspect one Selected alliance versus Compared alliances.
                "Net" = Selected value minus Compared value.`)}),w(p),$(()=>{var f,t,a,i;S(b,`${(t=(f=e(r))==null?void 0:f.coalitions[0].name)!=null?t:""}: `),S(A,`${(i=(a=e(r))==null?void 0:a.coalitions[1].name)!=null?i:""}: `)}),I(l,s)}),w(K);var Re=_(K,6);q(Re,()=>e(U),l=>{var s=it(),c=x(s,!0);w(s),$(()=>S(c,e(U))),I(l,s)}),ce(2),w(G),$(()=>{var l;return S(ie,` Conflict: ${(l=e(le))!=null?l:""} `)}),I(xe,G),De()}export{bt as component};
