import{a as R,t as M}from"../chunks/disclose-version.xy21-f78.js";import{i as Wt}from"../chunks/legacy.N0bfMBuo.js";import{p as qt,f as vt,t as P,b as zt,s as p,g as t,c as b,m as F,e as k,r as $,n as Z,i as mt}from"../chunks/runtime.DMLHWUus.js";import{h as Dt,e as E,s as L}from"../chunks/render.CoimT3AH.js";import{o as It,i as I}from"../chunks/index-client.D_ywJSmp.js";import{N as Ht,F as Ot,s as W,e as tt,i as bt}from"../chunks/Footer.C7bm1xTi.js";import{a as Qt,d as Ut,f as Yt,s as O,P as _t,l as Gt,m as gt,n as et,o as Q,h as wt,j as Jt,r as Kt,i as Vt,t as at}from"../chunks/index.DcoiBfme.js";import{s as yt,c as Xt,a as xt,b as kt,r as Zt,d as te}from"../chunks/index.C7g7TsCB.js";import{c as $t}from"../chunks/_layout.BJmI2Ulo.js";var ee=M('<a class="btn ux-btn fw-bold"> <i class="bi bi-box-arrow-up-right"></i></a>'),ae=M('<div class="alert alert-danger m-2 d-flex justify-content-between align-items-center"><span> </span> <button class="btn btn-sm btn-outline-danger fw-bold">Retry</button></div>'),se=M('<button class="btn ux-btn btn-sm ms-1 mb-1 fw-bold"> </button>'),le=M('<button class="btn ux-btn btn-sm ms-1 mb-1 fw-bold"> </button>'),ie=M('<button class="btn ux-btn btn-sm ms-1 mb-1 fw-bold"> </button>'),ne=M('<span class="fw-bold">Layout Picker:</span> <!> <hr class="m-1"> <div class="ux-coalition-panel ux-coalition-panel--compact ux-coalition-panel--red"> <!></div> <div class="ux-coalition-panel ux-coalition-panel--compact ux-coalition-panel--blue"> <!></div>',1),re=M('<div class="small text-muted mt-1"> </div>'),oe=M(`<!> <div class="container-fluid p-2" style="min-height: calc(100vh - 203px);"><h1 class="m-0 mb-2 p-2 ux-surface ux-page-title"><a href="conflicts" aria-label="Back to conflicts"><i class="bi bi-arrow-left"></i></a> <!></h1> <hr class="mt-2 mb-2"> <div class="row p-0 m-0 ux-tabstrip fw-bold"><a class="col-2 ps-0 pe-0 btn">â—‘&nbsp;Coalition</a> <a class="col-2 btn ps-0 pe-0">ğ–£¯&nbsp;Alliance</a> <a class="col-2 ps-0 pe-0 btn">â™Ÿ&nbsp;Nation</a> <a class="col-2 ps-0 pe-0 btn">ğŸ“Š&nbsp;Tier/Time</a> <a class="col-2 ps-0 pe-0 btn">ğŸ“ˆ&nbsp;Bubble/Time</a> <button class="col-2 ps-0 pe-0 btn is-active">ğŸŒ&nbsp;Web</button></div> <div class="ux-surface ux-tab-panel p-2 fw-bold" style="min-height: 116px;"><!> <!> <div class="d-flex gap-1 mb-2"><button class="btn ux-btn btn-sm fw-bold">Copy share link</button> <button class="btn ux-btn btn-sm fw-bold">Reset</button></div> <!></div> <div class="d-flex justify-content-center align-items-center mt-1"><div class="d-flex justify-content-center align-items-center alert alert-danger text-center mb-1 py-1 text-danger">Click or hover over one of the chords and then scroll down to view
            the table.</div></div> <div class="container bg-light-subtle"><div id="my_dataviz"></div> <div class="mt-1" id="myTooltip" style="min-height:15em"></div></div> <!> <br></div> <!>`,1);function _e(At,Pt){qt(Pt,!1);let st=F(""),S=F(null),h=F(null),v=F(new Set),T=F("wars"),q=F(!1),z=F(null),U=F("");It(()=>{Qt(["header","ids"],["id"]);let a=new URLSearchParams(window.location.search);const s=a.get("id");s?(p(S,s),lt(t(S),a)):(p(z,"Missing conflict id in URL"),p(q,!0))});function lt(a,s){p(z,null),p(q,!1);let i=`https://locutus.s3.ap-southeast-2.amazonaws.com/conflicts/${a}.gzip?${$t.version.conflict_data}`;Ut(i).then(n=>{var y,w,x;p(h,n),console.log(n),p(st,n.name),p(U,Yt($t.version.conflict_data,n.update_ms)),p(v,new Set([...n.coalitions[0].alliance_ids,...n.coalitions[1].alliance_ids]));let o=s.get("header");o&&((y=t(h))!=null&&y.war_web.headers.includes(o))&&p(T,o);let m=s.get("ids");if(m){let _=m.split(".").map(l=>+l);p(v,new Set(_)),(!((w=t(h))!=null&&w.coalitions[0].alliance_ids.some(l=>t(v).has(l)))||!((x=t(h))!=null&&x.coalitions[1].alliance_ids.some(l=>t(v).has(l))))&&p(v,new Set([...n.coalitions[0].alliance_ids,...n.coalitions[1].alliance_ids]))}H(),p(q,!0),O()}).catch(n=>{console.error("Failed to load chord web data",n),p(z,"Could not load conflict web data. Please try again later."),p(q,!0)})}function St(a){p(T,a),wt("header",a),O(),H()}function Y(a,s){var _,l;let i=(_=t(h))==null?void 0:_.coalitions[a],n=i==null?void 0:i.alliance_ids.every(d=>t(v).has(d)),o=i==null?void 0:i.alliance_ids.filter(d=>t(v).has(d)).length,m=t(v).has(s),y=a===0?1:0,w=(l=t(h))==null?void 0:l.coalitions[y],x=w==null?void 0:w.alliance_ids.every(d=>t(v).has(d));m?n&&x?p(v,new Set([...w==null?void 0:w.alliance_ids,s])):o==1?p(v,new Set([...t(v),...i==null?void 0:i.alliance_ids])):p(v,new Set([...t(v)].filter(d=>d!==s))):p(v,new Set([...t(v),s])),wt("ids",Array.from(t(v)).join(".")),O(),H()}function Ct(){t(h)&&(p(T,"wars"),p(v,new Set([...t(h).coalitions[0].alliance_ids,...t(h).coalitions[1].alliance_ids])),Kt(["header","ids"],["id"]),O(),H())}function Lt(){if(!t(S))return;const a=new URLSearchParams(window.location.search);lt(t(S),a)}function H(){Rt(t(h),t(v),t(T))}function Rt(a,s,i){let n={};a.coalitions.forEach(c=>{c.alliance_ids.forEach((A,j)=>{n[A]=c.alliance_names[j]})}),console.log(a.war_web.headers);let o=[],m=[],y=[...a.coalitions[0].alliance_ids,...a.coalitions[1].alliance_ids],w=y.filter(c=>s.has(c)),x=[];for(let c of a.coalitions[0].alliance_ids)o.push(_t.REDS),s.has(c)&&(m.push(n[c]),x.push(0));for(let c of a.coalitions[1].alliance_ids)o.push(_t.BLUES),s.has(c)&&(m.push(n[c]),x.push(1));let l=Gt(te,o).filter((c,A)=>s.has(y[A])),u=a.war_web.headers.indexOf(i),e=a.war_web.data[u],r=[];for(let c=0;c<y.length;(c+=1)-1){let A=y[c],j=e[c];if(s.has(A)){let C=j.filter((D,N)=>s.has(y[N]));r.push(C)}}r=r.map(c=>c.length===0?new Array(m.length).fill(0):c),r=r.map(c=>c.map(A=>isNaN(A)||A<0?0:A)),Ft(r,m,l,w,x)}function Ft(a,s,i,n,o){yt("#my_dataviz").selectAll("*").remove();const m=yt("#my_dataviz").append("svg").classed("svg-content-responsive",!0).attr("preserveAspectRatio","xMinYMin meet").attr("viewBox","0 0 600 600").append("g").attr("transform","translate(300,300)").classed("rect",!0).attr("width",440).attr("height",440),y=Xt().padAngle(.01).sortSubgroups(xt).sortChords(xt)(a);m.datum(y).append("g").classed("rect",!0).attr("width",440).attr("height",440).selectAll("g").data(e=>e.groups).join("g").append("path").style("fill",(e,r)=>i[r]).style("stroke","#222").style("stroke-width","0.25px").attr("d",kt().innerRadius(210).outerRadius(220));let w=m.datum(y).append("g").selectAll("path").data(e=>e).join("path").attr("d",Zt().radius(208)).attr("fill-opacity",.75).attr("stroke-opacity",.5).style("fill",e=>i[e.source.index]).style("stroke",e=>gt(i[e.source.index],25)).style("stroke-width","0.5px"),x=m.datum(y).append("g").selectAll("g").data(e=>e.groups).join("g");x.append("path").style("fill",(e,r)=>i[r]).style("stroke","#222").style("stroke-width","0.25px").attr("d",kt().innerRadius(210).outerRadius(220)),x.append("text").each(e=>{e.angle=(e.startAngle+e.endAngle)/2}).attr("dy",".35em").attr("transform",e=>`
        rotate(${e.angle*180/Math.PI-90})
        translate(221)
        ${e.angle>Math.PI?"rotate(180)":""}
    `).attr("text-anchor",e=>e.angle>Math.PI?"end":null).style("font-size","9px").text((e,r)=>s[r]);let _=-1,l=-1;n.filter((e,r)=>o[r]===0).length===1?d(o.indexOf(0)):n.filter((e,r)=>o[r]===1).length===1&&d(o.indexOf(1));function d(e){let r=document.getElementById("myTooltip"),c=new Set(a[e].map((f,g)=>f!==0||a[g][e]!==0?g:-1).filter(f=>f!==-1)),A=s.filter((f,g)=>c.has(g)),j=i.filter((f,g)=>c.has(g)),C=a[e].filter((f,g)=>c.has(g)),D=a.map((f,g)=>c.has(g)?f[e]:null).filter(f=>f!==null),N=Array.from({length:C.length},(f,g)=>g);N.sort((f,g)=>C[g]-C[f]),A=N.map(f=>A[f]),j=N.map(f=>j[f]),C=N.map(f=>C[f]),D=N.map(f=>D[f]);let B=`<h5>${s[e]} - ${t(T)}</h5><table class='table fw-bold w-auto'><tr><th></th><th>${s[e]}</th><th>Other</th><th>Net</th></tr>`;A.forEach((f,g)=>{B+=`<tr><td style='background-color:${gt(j[g],50)};color:white'>${f}</td>`,B+=`<td>${et(C[g])}</td>`,B+=`<td>${et(D[g])}</td>`,B+=`<td>${et(C[g]-D[g])}</td></tr>`}),B+="</table>",r.innerHTML=B}function u(){l!==_&&(l==-1?w.classed("d-none",!1):(w.filter(e=>e.source.index!==l&&e.target.index!==l).classed("d-none",!0),w.filter(e=>e.source.index===l||e.target.index===l).classed("d-none",!1),d(l)),_=l)}x.on("click",function(e,r){l=-1,_=-1,Y(o[r.index],n[r.index])}),x.on("mouseover",function(e,r){l=r.index,requestAnimationFrame(Q(100,u))}).on("mouseout",function(e,r){l=-1,requestAnimationFrame(Q(100,u))}).on("mouseover touchstart",function(e,r){l=r.index,requestAnimationFrame(Q(100,u))}).on("mouseout touchend",function(e,r){l=-1,requestAnimationFrame(Q(100,u))})}Wt();var it=oe();Dt(a=>{});var nt=vt(it);Ht(nt,{});var G=b(nt,2),J=k(G),rt=b(k(J)),Mt=b(rt);I(Mt,()=>{var a;return(a=t(h))==null?void 0:a.wiki},a=>{var s=ee(),i=k(s);Z(),$(s),P(()=>{var n,o,m;W(s,"href",`https://politicsandwar.fandom.com/wiki/${(n=t(h).wiki)!=null?n:""}`),L(i,`Wiki:${(m=(o=t(h))==null?void 0:o.wiki)!=null?m:""}Â `)}),R(a,s)}),$(J);var K=b(J,4),ot=k(K),ct=b(ot,2),dt=b(ct,2),ut=b(dt,2),jt=b(ut,2);Z(2),$(K);var V=b(K,2),ft=k(V);I(ft,()=>!t(q),a=>{Vt(a)});var pt=b(ft,2);I(pt,()=>t(z),a=>{var s=ae(),i=k(s),n=k(i,!0);$(i);var o=b(i,2);$(s),P(()=>L(n,t(z))),E("click",o,Lt),R(a,s)});var X=b(pt,2),ht=k(X),Nt=b(ht,2);$(X);var Tt=b(X,2);I(Tt,()=>t(h),a=>{var s=ne(),i=b(vt(s),2);tt(i,1,()=>t(h).war_web.headers,_=>_,(_,l)=>{var d=se(),u=k(d,!0);$(d),P(()=>{at(d,"active",t(T)===t(l)),L(u,t(l))}),E("click",d,()=>St(t(l))),R(_,d)});var n=b(i,4),o=k(n),m=b(o);tt(m,1,()=>t(h).coalitions[0].alliance_ids,bt,(_,l,d)=>{var u=le();const e=mt(()=>t(v).has(t(l)));P(()=>at(u,"active",t(e)));var r=k(u,!0);$(u),P(()=>L(r,t(h).coalitions[0].alliance_names[d])),E("click",u,()=>Y(0,t(l))),R(_,u)}),$(n);var y=b(n,2),w=k(y),x=b(w);tt(x,1,()=>t(h).coalitions[1].alliance_ids,bt,(_,l,d)=>{var u=ie();const e=mt(()=>t(v).has(t(l)));P(()=>at(u,"active",t(e)));var r=k(u,!0);$(u),P(()=>L(r,t(h).coalitions[1].alliance_names[d])),E("click",u,()=>Y(1,t(l))),R(_,u)}),$(y),P(()=>{var _,l,d,u;L(o,`${(l=(_=t(h))==null?void 0:_.coalitions[0].name)!=null?l:""}: `),L(w,`${(u=(d=t(h))==null?void 0:d.coalitions[1].name)!=null?u:""}: `)}),R(a,s)}),$(V);var Bt=b(V,6);I(Bt,()=>t(U),a=>{var s=re(),i=k(s,!0);$(s),P(()=>L(i,t(U))),R(a,s)}),Z(2),$(G);var Et=b(G,2);Ot(Et,{}),P(()=>{var a,s,i,n,o,m;L(rt,`Â Conflict: ${(a=t(st))!=null?a:""} `),W(ot,"href",`conflict?id=${(s=t(S))!=null?s:""}&layout=coalition`),W(ct,"href",`conflict?id=${(i=t(S))!=null?i:""}&layout=alliance`),W(dt,"href",`conflict?id=${(n=t(S))!=null?n:""}&layout=nation`),W(ut,"href",`tiering?id=${(o=t(S))!=null?o:""}`),W(jt,"href",`bubble?id=${(m=t(S))!=null?m:""}`)}),E("click",ht,()=>Jt()),E("click",Nt,Ct),R(At,it),zt()}export{_e as component};
