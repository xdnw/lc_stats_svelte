var bt=Object.defineProperty,_t=Object.defineProperties;var yt=Object.getOwnPropertyDescriptors;var He=Object.getOwnPropertySymbols;var xt=Object.prototype.hasOwnProperty,gt=Object.prototype.propertyIsEnumerable;var Ke=(I,w,f)=>w in I?bt(I,w,{enumerable:!0,configurable:!0,writable:!0,value:f}):I[w]=f,ke=(I,w)=>{for(var f in w||(w={}))xt.call(w,f)&&Ke(I,f,w[f]);if(He)for(var f of He(w))gt.call(w,f)&&Ke(I,f,w[f]);return I},ze=(I,w)=>_t(I,yt(w));var Te=(I,w,f)=>new Promise((ve,ue)=>{var N=T=>{try{J(f.next(T))}catch(G){ue(G)}},H=T=>{try{J(f.throw(T))}catch(G){ue(G)}},J=T=>T.done?ve(T.value):Promise.resolve(T.value).then(N,H);J((f=f.apply(I,w)).next())});import{h as kt,a as K,t as W,s as se,e as we}from"../chunks/disclose-version.B0B114Pu.js";import{i as zt}from"../chunks/legacy.DQ3BPbVs.js";import{p as wt,l as We,a as Nt,t as ne,b as Ct,s as u,g as t,c as b,m as j,j as Je,d as x,r as g,n as Mt,f as Pt,e as St}from"../chunks/runtime.mdILdFMH.js";import{o as $t,a as jt,i as fe}from"../chunks/index-client.T9W-Qjf4.js";import{c as et,s as It,r as Be}from"../chunks/_layout.B2jEg47M.js";import{a as Oe,c as Et}from"../chunks/misc.CV3rZvPR.js";import{b as tt}from"../chunks/this.BUleMenJ.js";import{n as Lt,S as Tt}from"../chunks/nouislider.CAHvkam5.js";import{C as Bt}from"../chunks/ConflictRouteTabs.B_9-Me3P.js";import{a as Ot,i as Rt,d as Gt,f as Ft,b as oe,j as Ut,k as Qt,l as Dt,h as ce,c as Yt,m as Zt,P as At,S as Vt,r as Xt}from"../chunks/Progress.sJimGKi_.js";import{P as qt,g as Ht,d as Kt,r as Wt}from"../chunks/index.Da-3W4gc.js";var Jt=W('<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/noUiSlider/15.7.1/nouislider.css">'),ea=W('<a class="btn ux-btn fw-bold"> <i class="bi bi-box-arrow-up-right"></i></a>'),ta=W('<div class="alert alert-danger m-2 d-flex justify-content-between align-items-center"><span> </span> <button class="btn btn-sm btn-outline-danger fw-bold">Retry</button></div>'),aa=W('<div class="empty" slot="empty"> </div>'),ia=W(`<div class="d-flex justify-content-between align-items-center"><span class="fw-bold">Select 3 <button type="button" class="btn btn-link btn-sm p-0 ms-1 align-baseline" title="Metrics with ':' are cumulative sums over time. Metrics without ':' are point-in-time values for each frame." aria-label="Metric behavior help"><i class="bi bi-info-circle"></i></button></span> <!></div> <div class="select-compact mb-2" style="position: relative; z-index: 3;"><!></div> <div class="small text-muted mb-2"> </div> <span class="fw-bold">Per Unit or Nation:</span> <div class="form-check form-check-inline" style="position: relative; z-index: 2;"><label class="form-check-label" for="inlineCheckbox1">X</label> <input class="form-check-input" type="checkbox" id="inlineCheckbox1"></div> <div class="form-check form-check-inline" style="position: relative; z-index: 2;"><label class="form-check-label" for="inlineCheckbox2">Y</label> <input class="form-check-input" type="checkbox" id="inlineCheckbox2"></div> <div class="form-check form-check-inline" style="position: relative; z-index: 2;"><label class="form-check-label" for="inlineCheckbox3">Z</label> <input class="form-check-input" type="checkbox" id="inlineCheckbox3"></div>`,1),la=W('<div class="small text-muted text-end mt-2"> </div>'),ra=W('<div class="container-fluid p-2 ux-page-body"><h1 class="m-0 mb-2 p-2 ux-surface ux-page-title"><a href="conflicts" aria-label="Back to conflicts"><i class="bi bi-arrow-left"></i></a> <!></h1> <!> <div class="row m-0 p-0 ux-surface ux-tab-panel" style="min-height: 116px; position: relative; z-index: 80; overflow: visible;"><!> <!> <div class="col-12"><div style="width: calc(100% - 30px);margin-left:15px;"><div class="mt-3 mb-5" style="position: relative; z-index: 1;"></div></div> <!></div></div> <div class="row m-0 p-0 mt-2 ux-surface" style="overflow-x: hidden; position: relative; z-index: 1;"><div class="col-12 m-0 p-0"><div class="m-0 p-0"></div></div></div> <!></div>');function ya(I,w){wt(w,!1);const f=j(),ve=j();function ue(){return Zt()}let N=j(),H=j(null),J=j(),T=j(!1),G=j(null),Ne=j(""),ee=j(!1),te=j(!1),ae=j(!1),pe=0,he=j(),k=j([0,70]),O=0,be=null,ie=null,le=null,z=j(["dealt:loss_value","loss:loss_value","off:wars"].map(e=>({value:e,label:e}))),_e=[];function Ce(){var e;return(e=t(he))==null?void 0:e.noUiSlider}function at(){var e;t(z).length!=3||Et(_e,t(z))||(u(f,((e=t(z))==null?void 0:e.length)===3),_e=t(z).slice(),ce("selected",t(z).map(a=>a.value).join(".")),oe(),me(t(N)))}function Me(){return Te(this,null,function*(){yield St();let e=(t(ee)?1:0)+(t(te)?2:0)+(t(ae)?4:0);return pe==e?!1:(pe=e|0,ce("normalize",e==0?null:e,{replace:!0}),oe(),me(t(N)),!0)})}function it(){u(k,[0,70]),O=0,u(ee,!1),u(te,!1),u(ae,!1),pe=0,u(z,["dealt:loss_value","loss:loss_value","off:wars"].map(a=>({value:a,label:a}))),_e=t(z).slice(),Xt(["city_min","city_max","time","normalize","selected"],["id"]),ce("selected",t(z).map(a=>a.value).join("."),{replace:!0}),oe();const e=Ce();e&&e.set([t(k)[0],t(k)[1]]),t(N)&&me(t(N))}function lt(e){var h;let a=e.get("time");a&&!isNaN(+a)&&Number.isInteger(+a)&&(O=+a);let r=e.get("city_min"),c=e.get("city_max");r&&!isNaN(+r)&&Number.isInteger(+r)&&Je(k,t(k)[0]=+r),c&&!isNaN(+c)&&Number.isInteger(+c)&&Je(k,t(k)[1]=+c);let l=e.get("selected");l&&u(z,l.split(".").map(_=>({value:_,label:_}))),_e=t(z).slice(),u(f,((h=t(z))==null?void 0:h.length)===3);let d=e.get("normalize");if(d&&!isNaN(+d)&&Number.isInteger(+d)){let _=+d;u(ee,(_&1)!=0),u(te,(_&2)!=0),u(ae,(_&4)!=0),pe=_}}let F=j();$t(()=>Te(this,null,function*(){var r;Ot(["city_min","city_max","time","normalize","selected"],["id"]);let e=new URLSearchParams(window.location.search);lt(e);const a=e.get("id");a?(u(H,a),Re(t(H))):u(G,"Missing conflict id in URL"),Lt.create(t(he),{start:t(k),connect:!0,step:1,tooltips:[{to:c=>`City ${Math.round(c)}`},{to:c=>`City ${Math.round(c)}`}],range:{min:0,max:70},pips:{mode:"steps",density:5,filter:(c,l)=>c%5?0:2}}),be=c=>{u(k,c.map(l=>parseInt(l))),ce("city_min",t(k)[0]==0?null:t(k)[0],{replace:!0}),ce("city_max",t(k)[1]==70?null:t(k)[1],{replace:!0}),oe(),me(t(N))},(r=Ce())==null||r.on("set",be)})),jt(()=>{var a,r,c;const e=Ce();if(e&&(be&&e.off("set",be),e.destroy()),t(F)){const l=t(F);ie&&((a=l.removeListener)==null||a.call(l,"plotly_animated",ie)),le&&((r=l.removeListener)==null||r.call(l,"plotly_sliderchange",le)),(c=ue())==null||c.purge(t(F))}});function Re(e){let a=Rt(e,et.version.graph_data);Gt(a).then(r=>{u(J,r.name),u(N,r),u(Ne,Ft(et.version.graph_data,r.update_ms)),u(G,null),me(t(N)),u(T,!0),oe()}).catch(r=>{console.error("Failed to load bubble graph data",r),u(G,"Could not load conflict graph data. Please try again later."),u(T,!0)})}function rt(){t(H)&&(u(T,!1),u(G,null),Re(t(H)))}function Ge(e){let a=e.name;return e.cumulative&&(a+=" (sum)"),e.normalize&&(a+=" (avg)"),a}function st(e,a,r,c,l,d){let h={x:[0,Number.MIN_SAFE_INTEGER],y:[0,Number.MIN_SAFE_INTEGER],z:[0,Number.MIN_SAFE_INTEGER]},_=Object.keys(h),E=[a,r,c];const C=Wt(e,E);if(!C)return null;let Y=C.metric_indexes,R=C.metric_is_turn,$=C.metric_normalize,L=C.isAnyTurn,v={};for(let i=0;i<e.coalitions.length;(i+=1)-1){let n=e.coalitions[i],m=n.cities.findIndex(y=>y>=l),o=n.cities.slice().reverse().findIndex(y=>y<=d);o!==-1&&(o=n.cities.length-1-o),m==-1&&(m=0),o==-1&&(o=n.cities.length);let p=n.turn.range[0],P=n.day.range[0],B=L?p:P,Q=L?n.turn.range[1]:n.day.range[1];for(let y=0;y<n.alliance_ids.length;(y+=1)-1){let re=n.alliance_ids[y],ft=Yt(n.alliance_names[y],re),D=[0,0,0],Ae=-1;for(let Z=B;Z<=Q;(Z+=1)-1){let de=v[Z];de||(de={},v[Z]=de);let A=de[i];A||(A={x:[],y:[],id:[],text:[],customdata:[],marker:{size:[]}},de[i]=A),A.id.push(re),A.text.push(ft);let vt=L?Z:Math.floor(Z*12),ye=L?Math.floor(Z/12):Z;for(let S=0;S<E.length;(S+=1)-1){let V=R[S];if(!V&&Ae==ye)continue;let pt=E[S].cumulative,Ve=Y[S],Xe=V?n.turn.data[Ve][y]:n.day.data[Ve][y];if(!Xe)continue;let Ee=Xe[V?vt-p:ye-P];if(!Ee||Object.keys(Ee).length==0)continue;let xe=0;for(let X=m;X<=o;(X+=1)-1)xe+=Ee[X];let Le=$[S];if(Le!=-1){let X=0,qe=n.day.data[0][y];if(!qe)continue;let ge=qe[ye-P];if(!ge||ge.length==0)continue;if(Le==0)for(let q=m;q<=o;(q+=1)-1)X+=ge[q];else for(let q=m;q<=o;(q+=1)-1){let ht=n.cities[q];X+=ge[q]*ht*Le}X!=0&&(xe/=X)}pt?D[S]+=xe:D[S]=xe}A.x.push(D[0]),A.y.push(D[1]),A.customdata.push(D[2]);for(let S=0;S<3;(S+=1)-1){let V=_[S];D[S]<h[V][0]&&(h[V][0]=D[S]),D[S]>h[V][1]&&(h[V][1]=D[S])}Ae=ye}}}let M=Math.min(...Object.keys(v).map(Number)),U=Math.max(...Object.keys(v).map(Number));return{traces:v,times:{start:M,end:U,is_turn:L},ranges:h}}function me(e){if(!e)return;let a=t(z).map(E=>E.value);if(a.length!=3)return;let r={name:a[0],cumulative:a[0].includes(":"),normalize:t(ee)},c={name:a[1],cumulative:a[1].includes(":"),normalize:t(te)},l={name:a[2],cumulative:a[2].includes(":"),normalize:t(ae)},d=st(e,r,c,l,t(k)[0],t(k)[1]);if(!d)return;let h=e.coalitions.map(E=>E.name),_=[r,c,l];nt(d.traces,d.times,d.ranges,h,_)}function nt(e,a,r,c,l){var d=Object.keys(e).map(Number);if(d.length===0)return;O=Math.min(Math.max(O,0),Math.max(d.length-1,0));var h=e[a.start+O];if(!h)return;var _=Object.keys(h).map(Number);for(let s=a.start;s<=a.end;(s+=1)-1){let i=e[s];if(!i)continue;let n=0;for(let m=0;m<c.length;(m+=1)-1){let o=i[m];o&&(n=Math.max(n,Math.max(...o.customdata)))}for(let m=0;m<c.length;(m+=1)-1){let o=i[m];o&&(o.marker={size:o.customdata.map(p=>n>0?p/n:1)})}}function E(s,i){let n=e[s];n||(n=e[s]={});let m=n[i];return m||(m=n[i]={x:[],y:[],customdata:[],id:[],text:[],marker:{size:[]}}),m}let C={};var Y=[];for(let s=0;s<d.length;(s+=1)-1){let i=[];for(let n=0;n<_.length;(n+=1)-1){let m=_[n],o=C[m];o||(o=C[m]={x:{},y:{},z:{}});let p=E(d[s],m);for(let P=0;P<p.id.length;(P+=1)-1){let B=p.id[P],Q=o.x[B],y=o.y[B],re=o.z[B];Q||(Q=o.x[B]=[],y=o.y[B]=[],re=o.z[B]=[]),Q.push(p.x[P]),y.push(p.y[P]),re.push(p.customdata[P]),i.push({x:Q.slice(),y:y.slice(),customdata:re.slice(),mode:"lines"})}i.push(p)}Y.push({name:d[s],data:i})}var R=[];for(let s=0;s<_.length;(s+=1)-1){let i=_[s];var $=h[i];let n=Object.keys(qt).map(Number).indexOf(i),m=Ht(Kt,$.id.length,n),o=C[i];o||(o=C[i]={x:{},y:{},z:{}});for(let p=0;p<$.id.length;(p+=1)-1){let P=$.id[p],B=o.x[P],Q=o.y[P],y=o.z[P];B||(B=[],Q=[],y=[]),R.push({x:B.slice(0,O+1),y:Q.slice(0,O+1),customdata:y.slice(0,O+1),mode:"lines",line:{width:.3,color:m[p]},hoverinfo:"all",showlegend:!1,hovertemplate:`${$.text[p]}<br>${l[0].name}: %{x}<br>${l[1].name}: %{y}<br>${l[2].name}: %{customdata}<extra></extra>`})}R.push({name:c[s],x:$.x.slice(),y:$.y.slice(),customdata:$.customdata.slice(),id:$.id.slice(),text:$.text.slice(),mode:"markers+text",textposition:"middle center",textfont:{size:7,color:"rgba(0, 0, 0, 0.75)"},marker:{size:$.marker.size,sizemode:"area",sizeref:.001,sizemin:1,color:m},hovertemplate:`%{text}<br>${l[0].name}: %{x}<br>${l[1].name}: %{y}<br>${l[2].name}: %{customdata}<extra></extra>`})}let L=a.is_turn?Ut:Qt;var v=[];for(let s=0;s<d.length;(s+=1)-1)v.push({method:"animate",label:L(d[s]),args:[[d[s]],{mode:"immediate",transition:{duration:200},frame:{duration:200,redraw:!0}}]});var M={height:window.innerHeight*.8,margin:{l:0,r:0,t:30,b:60},xaxis:{title:Ge(l[0])},yaxis:{title:Ge(l[1])},hovermode:"closest",legend:{x:.5,y:1.1,itemsizing:"constant",xanchor:"center",yanchor:"top"},updatemenus:[{x:0,y:0,yanchor:"top",xanchor:"left",showactive:!1,direction:"left",type:"buttons",pad:{t:87,r:10},buttons:[{method:"animate",args:[null,{mode:"immediate",fromcurrent:!0,transition:{duration:200},frame:{duration:200,redraw:!0}}],label:"Play"},{method:"animate",args:[[null],{mode:"immediate",transition:{duration:0},frame:{duration:0,redraw:!0}}],label:"Pause"}]}],sliders:[{active:O,pad:{l:130,t:55},currentvalue:{visible:!0,prefix:"",xanchor:"right",font:{size:20,color:"#666"}},steps:v}]};if(document.documentElement.getAttribute("data-bs-theme")==="dark"){let s=getComputedStyle(document.documentElement).getPropertyValue("--bs-body-bg"),i=getComputedStyle(document.documentElement).getPropertyValue("--bs-body-color");M.plot_bgcolor=s,M.paper_bgcolor=s,M.font={color:i},M.xaxis=ze(ke({},M.xaxis),{gridcolor:i,zerolinecolor:i,tickfont:{color:i},titlefont:{color:i}}),M.yaxis=ze(ke({},M.yaxis),{gridcolor:i,zerolinecolor:i,tickfont:{color:i},titlefont:{color:i}}),M.legend=ze(ke({},M.legend),{font:{color:i}})}Dt(["plotjs"]).then(()=>{var n,m,o,p;const s=ue();if(!s)return;const i=t(F);s.purge(t(F)),s.react(t(F),{data:R,layout:M,frames:Y}),ie&&((n=i.removeListener)==null||n.call(i,"plotly_animated",ie)),le&&((m=i.removeListener)==null||m.call(i,"plotly_sliderchange",le)),ie=function(){s.relayout(t(F),{"xaxis.autorange":!0,"yaxis.autorange":!0})},le=function(P){O=P.slider.active,ce("time",O,{replace:!0}),oe()},(o=i.on)==null||o.call(i,"plotly_animated",ie),(p=i.on)==null||p.call(i,"plotly_sliderchange",le)})}We(()=>t(z),()=>{var e;u(f,((e=t(z))==null?void 0:e.length)===3)}),We(()=>(t(f),t(N)),()=>{u(ve,t(f)||!t(N)?[]:[...t(N).metric_names.map(e=>({value:e,label:e}))])}),Nt(),zt();var Pe=ra();kt(e=>{var a=Jt();K(e,a)});var Se=x(Pe),Fe=b(x(Se)),ot=b(Fe);fe(ot,()=>{var e;return(e=t(N))==null?void 0:e.wiki},e=>{var a=ea(),r=x(a);Mt(),g(a),ne(()=>{var c,l,d;It(a,"href",`https://politicsandwar.fandom.com/wiki/${(c=t(N).wiki)!=null?c:""}`),se(r,`Wiki:${(d=(l=t(N))==null?void 0:l.wiki)!=null?d:""} `)}),K(e,a)}),g(Se);var Ue=b(Se,2);Bt(Ue,{get conflictId(){return t(H)},active:"bubble"});var $e=b(Ue,2),Qe=x($e);fe(Qe,()=>!t(T),e=>{At(e)});var De=b(Qe,2);fe(De,()=>t(G),e=>{var a=ta(),r=x(a),c=x(r,!0);g(r);var l=b(r,2);g(a),ne(()=>se(c,t(G))),we("click",l,rt),K(e,a)});var Ye=b(De,2),je=x(Ye),ct=x(je);tt(ct,e=>u(he,e),()=>t(he)),g(je);var ut=b(je,2);fe(ut,()=>t(N),e=>{var a=ia(),r=Pt(a),c=b(x(r),2);Vt(c,{onReset:it}),g(r);var l=b(r,2),d=x(l);Tt(d,{multiple:!0,get items(){return t(ve)},get value(){return t(z)},set value(v){u(z,v)},showChevron:!0,$$events:{change:at},$$slots:{empty:(v,M)=>{var U=aa(),s=x(U,!0);g(U),ne(()=>se(s,t(f)?"Max 3 items":"No options")),K(v,U)}},$$legacy:!0}),g(l);var h=b(l,2),_=x(h);ne(()=>{var v,M,U;return se(_,`Metrics: ${(v=t(z).map(s=>s.label).join(" / "))!=null?v:""} • Cities ${(M=t(k)[0])!=null?M:""}-${(U=t(k)[1])!=null?U:""}`)}),g(h);var E=b(h,4),C=b(x(E),2);Be(C),C.value=(C.__value="option1")==null?"":"option1",g(E);var Y=b(E,2),R=b(x(Y),2);Be(R),R.value=(R.__value="option2")==null?"":"option2",g(Y);var $=b(Y,2),L=b(x($),2);Be(L),L.value=(L.__value="option3")==null?"":"option3",g($),Oe(C,()=>t(ee),v=>u(ee,v)),we("change",C,Me),Oe(R,()=>t(te),v=>u(te,v)),we("change",R,Me),Oe(L,()=>t(ae),v=>u(ae,v)),we("change",L,Me),K(e,a)}),g(Ye),g($e);var Ie=b($e,2),Ze=x(Ie),mt=x(Ze);tt(mt,e=>u(F,e),()=>t(F)),g(Ze),g(Ie);var dt=b(Ie,2);fe(dt,()=>t(Ne),e=>{var a=la(),r=x(a,!0);g(a),ne(()=>se(r,t(Ne))),K(e,a)}),g(Pe),ne(()=>{var e;return se(Fe,` Conflict: ${(e=t(J))!=null?e:""} `)}),K(I,Pe),Ct()}export{ya as component};
