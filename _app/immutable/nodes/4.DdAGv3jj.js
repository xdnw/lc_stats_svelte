var yt=Object.defineProperty,xt=Object.defineProperties;var gt=Object.getOwnPropertyDescriptors;var Je=Object.getOwnPropertySymbols;var kt=Object.prototype.hasOwnProperty,zt=Object.prototype.propertyIsEnumerable;var et=(j,N,y)=>N in j?yt(j,N,{enumerable:!0,configurable:!0,writable:!0,value:y}):j[N]=y,ze=(j,N)=>{for(var y in N||(N={}))kt.call(N,y)&&et(j,y,N[y]);if(Je)for(var y of Je(N))zt.call(N,y)&&et(j,y,N[y]);return j},we=(j,N)=>xt(j,gt(N));var Oe=(j,N,y)=>new Promise((V,me)=>{var pe=R=>{try{G(y.next(R))}catch(Y){me(Y)}},C=R=>{try{G(y.throw(R))}catch(Y){me(Y)}},G=R=>R.done?V(R.value):Promise.resolve(R.value).then(pe,C);G((y=y.apply(j,N)).next())});import{h as wt,a as te,t as ae,s as ne,e as Ne}from"../chunks/disclose-version.BGVnXwSC.js";import{i as Nt}from"../chunks/legacy.C5xHvBl9.js";import{p as Ct,l as Re,a as Mt,t as oe,b as Pt,s,g as e,c as _,m as w,j as tt,d as k,r as z,n as $t,f as It,e as St}from"../chunks/runtime.Bz3ZCnid.js";import{o as jt,a as Et,i as ve}from"../chunks/index-client.Q1qAUnCw.js";import{c as at,s as Tt,r as Ge}from"../chunks/_layout.C340yC5l.js";import{a as Fe,c as Lt}from"../chunks/misc.BJslMcuk.js";import{b as it}from"../chunks/this.BQwQtl1q.js";import{n as Bt,S as Ot}from"../chunks/nouislider.CNG0Ofn8.js";import{C as Rt}from"../chunks/ConflictRouteTabs.C9YpKmne.js";import{b as Gt,f as Ft,c as Dt,e as Qt,h as Ut,a as Vt,i as Yt,P as Zt,S as At}from"../chunks/Progress.KQ1k3Mu0.js";import{P as Xt,g as qt,d as Ht,r as Kt}from"../chunks/index.Da-3W4gc.js";import{a as Wt,g as Jt,d as ea,s as ce,b as ue,r as ta}from"../chunks/binary.C_HE3RDK.js";var aa=ae('<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/noUiSlider/15.7.1/nouislider.css">'),ia=ae('<a class="btn ux-btn fw-bold"> <i class="bi bi-box-arrow-up-right"></i></a>'),la=ae('<div class="alert alert-danger m-2 d-flex justify-content-between align-items-center"><span> </span> <button class="btn btn-sm btn-outline-danger fw-bold">Retry</button></div>'),ra=ae('<div class="empty" slot="empty"> </div>'),sa=ae(`<div class="d-flex justify-content-between align-items-center"><span class="fw-bold">Select 3 <button type="button" class="btn btn-link btn-sm p-0 ms-1 align-baseline" title="Metrics with ':' are cumulative sums over time. Metrics without ':' are point-in-time values for each frame." aria-label="Metric behavior help"><i class="bi bi-info-circle"></i></button></span> <!></div> <div class="select-compact mb-2" style="position: relative; z-index: 3;"><!></div> <div class="small text-muted mb-2"> </div> <span class="fw-bold">Per Unit or Nation:</span> <div class="form-check form-check-inline" style="position: relative; z-index: 2;"><label class="form-check-label" for="inlineCheckbox1">X</label> <input class="form-check-input" type="checkbox" id="inlineCheckbox1"></div> <div class="form-check form-check-inline" style="position: relative; z-index: 2;"><label class="form-check-label" for="inlineCheckbox2">Y</label> <input class="form-check-input" type="checkbox" id="inlineCheckbox2"></div> <div class="form-check form-check-inline" style="position: relative; z-index: 2;"><label class="form-check-label" for="inlineCheckbox3">Z</label> <input class="form-check-input" type="checkbox" id="inlineCheckbox3"></div>`,1),na=ae('<div class="small text-muted text-end mt-2"> </div>'),oa=ae('<div class="container-fluid p-2 ux-page-body"><h1 class="m-0 mb-2 p-2 ux-surface ux-page-title"><a href="conflicts" aria-label="Back to conflicts"><i class="bi bi-arrow-left"></i></a> <!></h1> <!> <div class="row m-0 p-0 ux-surface ux-tab-panel" style="min-height: 116px; position: relative; z-index: 80; overflow: visible;"><!> <!> <div class="col-12"><div style="width: calc(100% - 30px);margin-left:15px;"><div class="mt-3 mb-5" style="position: relative; z-index: 1;"></div></div> <!></div></div> <div class="row m-0 p-0 mt-2 ux-surface" style="overflow-x: hidden; position: relative; z-index: 1;"><div class="col-12 m-0 p-0"><div class="m-0 p-0"></div></div></div> <!></div>');function ka(j,N){Ct(N,!1);const y=w(),V=w(),me=w();function pe(){return Yt()}let C=w(),G=w(null),R=w(),Y=w(!1),ie=w(null),Ce=w(""),Z=w(!1),A=w(!1),X=w(!1),he=0,be=w(),v=w([0,70]),E=w(0),_e=null,le=null,re=null;const Me=["dealt:loss_value","loss:loss_value","off:wars"];let h=w(Me.map(t=>({value:t,label:t}))),ye=[];function Pe(){var t;return(t=e(be))==null?void 0:t.noUiSlider}function lt(){var t;e(h).length!=3||Lt(ye,e(h))||(s(V,((t=e(h))==null?void 0:t.length)===3),ye=e(h).slice(),ue("selected",e(h).map(a=>a.value).join(".")),ce(),de(e(C)))}function $e(){return Oe(this,null,function*(){yield St();let t=(e(Z)?1:0)+(e(A)?2:0)+(e(X)?4:0);return he==t?!1:(he=t|0,ue("normalize",t==0?null:t,{replace:!0}),ce(),de(e(C)),!0)})}function rt(){s(v,[0,70]),s(E,0),s(Z,!1),s(A,!1),s(X,!1),he=0,s(h,["dealt:loss_value","loss:loss_value","off:wars"].map(a=>({value:a,label:a}))),ye=e(h).slice(),ta(["city_min","city_max","time","normalize","selected"],["id"]),ue("selected",e(h).map(a=>a.value).join("."),{replace:!0}),ce();const t=Pe();t&&t.set([e(v)[0],e(v)[1]]),e(C)&&de(e(C))}function st(t){var b;let a=t.get("time");a&&!isNaN(+a)&&Number.isInteger(+a)&&s(E,+a);let r=t.get("city_min"),n=t.get("city_max");r&&!isNaN(+r)&&Number.isInteger(+r)&&tt(v,e(v)[0]=+r),n&&!isNaN(+n)&&Number.isInteger(+n)&&tt(v,e(v)[1]=+n);let l=t.get("selected");l&&s(h,l.split(".").map(x=>({value:x,label:x}))),ye=e(h).slice(),s(V,((b=e(h))==null?void 0:b.length)===3);let d=t.get("normalize");if(d&&!isNaN(+d)&&Number.isInteger(+d)){let x=+d;s(Z,(x&1)!=0),s(A,(x&2)!=0),s(X,(x&4)!=0),he=x}}let F=w();jt(()=>Oe(this,null,function*(){var r;Wt(["city_min","city_max","time","normalize","selected"],["id"]);let t=Jt();st(t);const a=t.get("id");a?(s(G,a),De(e(G))):s(ie,"Missing conflict id in URL"),Bt.create(e(be),{start:e(v),connect:!0,step:1,tooltips:[{to:n=>`City ${Math.round(n)}`},{to:n=>`City ${Math.round(n)}`}],range:{min:0,max:70},pips:{mode:"steps",density:5,filter:(n,l)=>n%5?0:2}}),_e=n=>{s(v,n.map(l=>parseInt(l))),ue("city_min",e(v)[0]==0?null:e(v)[0],{replace:!0}),ue("city_max",e(v)[1]==70?null:e(v)[1],{replace:!0}),ce(),de(e(C))},(r=Pe())==null||r.on("set",_e)})),Et(()=>{var a,r,n;const t=Pe();if(t&&(_e&&t.off("set",_e),t.destroy()),e(F)){const l=e(F);le&&((a=l.removeListener)==null||a.call(l,"plotly_animated",le)),re&&((r=l.removeListener)==null||r.call(l,"plotly_sliderchange",re)),(n=pe())==null||n.purge(e(F))}});function De(t){let a=Gt(t,at.version.graph_data);ea(a).then(r=>{s(R,r.name),s(C,r),s(Ce,Ft(at.version.graph_data,r.update_ms)),s(ie,null),de(e(C)),s(Y,!0),ce()}).catch(r=>{console.error("Failed to load bubble graph data",r),s(ie,"Could not load conflict graph data. Please try again later."),s(Y,!0)})}function nt(){e(G)&&(s(Y,!1),s(ie,null),De(e(G)))}function Qe(t){let a=t.name;return t.cumulative&&(a+=" (sum)"),t.normalize&&(a+=" (avg)"),a}function ot(t,a,r,n,l,d){let b={x:[0,Number.MIN_SAFE_INTEGER],y:[0,Number.MIN_SAFE_INTEGER],z:[0,Number.MIN_SAFE_INTEGER]},x=Object.keys(b),T=[a,r,n];const M=Kt(t,T);if(!M)return null;let q=M.metric_indexes,O=M.metric_is_turn,S=M.metric_normalize,L=M.isAnyTurn,f={};for(let i=0;i<t.coalitions.length;(i+=1)-1){let c=t.coalitions[i],m=c.cities.findIndex(g=>g>=l),u=c.cities.slice().reverse().findIndex(g=>g<=d);u!==-1&&(u=c.cities.length-1-u),m==-1&&(m=0),u==-1&&(u=c.cities.length);let p=c.turn.range[0],$=c.day.range[0],B=L?p:$,Q=L?c.turn.range[1]:c.day.range[1];for(let g=0;g<c.alliance_ids.length;(g+=1)-1){let se=c.alliance_ids[g],pt=Vt(c.alliance_names[g],se),U=[0,0,0],qe=-1;for(let H=B;H<=Q;(H+=1)-1){let fe=f[H];fe||(fe={},f[H]=fe);let K=fe[i];K||(K={x:[],y:[],id:[],text:[],customdata:[],marker:{size:[]}},fe[i]=K),K.id.push(se),K.text.push(pt);let ht=L?H:Math.floor(H*12),xe=L?Math.floor(H/12):H;for(let I=0;I<T.length;(I+=1)-1){let W=O[I];if(!W&&qe==xe)continue;let bt=T[I].cumulative,He=q[I],Ke=W?c.turn.data[He][g]:c.day.data[He][g];if(!Ke)continue;let Le=Ke[W?ht-p:xe-$];if(!Le||Object.keys(Le).length==0)continue;let ge=0;for(let J=m;J<=u;(J+=1)-1)ge+=Le[J];let Be=S[I];if(Be!=-1){let J=0,We=c.day.data[0][g];if(!We)continue;let ke=We[xe-$];if(!ke||ke.length==0)continue;if(Be==0)for(let ee=m;ee<=u;(ee+=1)-1)J+=ke[ee];else for(let ee=m;ee<=u;(ee+=1)-1){let _t=c.cities[ee];J+=ke[ee]*_t*Be}J!=0&&(ge/=J)}bt?U[I]+=ge:U[I]=ge}K.x.push(U[0]),K.y.push(U[1]),K.customdata.push(U[2]);for(let I=0;I<3;(I+=1)-1){let W=x[I];U[I]<b[W][0]&&(b[W][0]=U[I]),U[I]>b[W][1]&&(b[W][1]=U[I])}qe=xe}}}let P=Math.min(...Object.keys(f).map(Number)),D=Math.max(...Object.keys(f).map(Number));return{traces:f,times:{start:P,end:D,is_turn:L},ranges:b}}function de(t){if(!t)return;let a=e(h).map(T=>T.value);if(a.length!=3)return;let r={name:a[0],cumulative:a[0].includes(":"),normalize:e(Z)},n={name:a[1],cumulative:a[1].includes(":"),normalize:e(A)},l={name:a[2],cumulative:a[2].includes(":"),normalize:e(X)},d=ot(t,r,n,l,e(v)[0],e(v)[1]);if(!d)return;let b=t.coalitions.map(T=>T.name),x=[r,n,l];ct(d.traces,d.times,d.ranges,b,x)}function ct(t,a,r,n,l){var d=Object.keys(t).map(Number);if(d.length===0)return;s(E,Math.min(Math.max(e(E),0),Math.max(d.length-1,0)));var b=t[a.start+e(E)];if(!b)return;var x=Object.keys(b).map(Number);for(let o=a.start;o<=a.end;(o+=1)-1){let i=t[o];if(!i)continue;let c=0;for(let m=0;m<n.length;(m+=1)-1){let u=i[m];u&&(c=Math.max(c,Math.max(...u.customdata)))}for(let m=0;m<n.length;(m+=1)-1){let u=i[m];u&&(u.marker={size:u.customdata.map(p=>c>0?p/c:1)})}}function T(o,i){let c=t[o];c||(c=t[o]={});let m=c[i];return m||(m=c[i]={x:[],y:[],customdata:[],id:[],text:[],marker:{size:[]}}),m}let M={};var q=[];for(let o=0;o<d.length;(o+=1)-1){let i=[];for(let c=0;c<x.length;(c+=1)-1){let m=x[c],u=M[m];u||(u=M[m]={x:{},y:{},z:{}});let p=T(d[o],m);for(let $=0;$<p.id.length;($+=1)-1){let B=p.id[$],Q=u.x[B],g=u.y[B],se=u.z[B];Q||(Q=u.x[B]=[],g=u.y[B]=[],se=u.z[B]=[]),Q.push(p.x[$]),g.push(p.y[$]),se.push(p.customdata[$]),i.push({x:Q.slice(),y:g.slice(),customdata:se.slice(),mode:"lines"})}i.push(p)}q.push({name:d[o],data:i})}var O=[];for(let o=0;o<x.length;(o+=1)-1){let i=x[o];var S=b[i];let c=Object.keys(Xt).map(Number).indexOf(i),m=qt(Ht,S.id.length,c),u=M[i];u||(u=M[i]={x:{},y:{},z:{}});for(let p=0;p<S.id.length;(p+=1)-1){let $=S.id[p],B=u.x[$],Q=u.y[$],g=u.z[$];B||(B=[],Q=[],g=[]),O.push({x:B.slice(0,e(E)+1),y:Q.slice(0,e(E)+1),customdata:g.slice(0,e(E)+1),mode:"lines",line:{width:.3,color:m[p]},hoverinfo:"all",showlegend:!1,hovertemplate:`${S.text[p]}<br>${l[0].name}: %{x}<br>${l[1].name}: %{y}<br>${l[2].name}: %{customdata}<extra></extra>`})}O.push({name:n[o],x:S.x.slice(),y:S.y.slice(),customdata:S.customdata.slice(),id:S.id.slice(),text:S.text.slice(),mode:"markers+text",textposition:"middle center",textfont:{size:7,color:"rgba(0, 0, 0, 0.75)"},marker:{size:S.marker.size,sizemode:"area",sizeref:.001,sizemin:1,color:m},hovertemplate:`%{text}<br>${l[0].name}: %{x}<br>${l[1].name}: %{y}<br>${l[2].name}: %{customdata}<extra></extra>`})}let L=a.is_turn?Dt:Qt;var f=[];for(let o=0;o<d.length;(o+=1)-1)f.push({method:"animate",label:L(d[o]),args:[[d[o]],{mode:"immediate",transition:{duration:200},frame:{duration:200,redraw:!0}}]});var P={height:window.innerHeight*.8,margin:{l:0,r:0,t:30,b:60},xaxis:{title:Qe(l[0])},yaxis:{title:Qe(l[1])},hovermode:"closest",legend:{x:.5,y:1.1,itemsizing:"constant",xanchor:"center",yanchor:"top"},updatemenus:[{x:0,y:0,yanchor:"top",xanchor:"left",showactive:!1,direction:"left",type:"buttons",pad:{t:87,r:10},buttons:[{method:"animate",args:[null,{mode:"immediate",fromcurrent:!0,transition:{duration:200},frame:{duration:200,redraw:!0}}],label:"Play"},{method:"animate",args:[[null],{mode:"immediate",transition:{duration:0},frame:{duration:0,redraw:!0}}],label:"Pause"}]}],sliders:[{active:e(E),pad:{l:130,t:55},currentvalue:{visible:!0,prefix:"",xanchor:"right",font:{size:20,color:"#666"}},steps:f}]};if(document.documentElement.getAttribute("data-bs-theme")==="dark"){let o=getComputedStyle(document.documentElement).getPropertyValue("--bs-body-bg"),i=getComputedStyle(document.documentElement).getPropertyValue("--bs-body-color");P.plot_bgcolor=o,P.paper_bgcolor=o,P.font={color:i},P.xaxis=we(ze({},P.xaxis),{gridcolor:i,zerolinecolor:i,tickfont:{color:i},titlefont:{color:i}}),P.yaxis=we(ze({},P.yaxis),{gridcolor:i,zerolinecolor:i,tickfont:{color:i},titlefont:{color:i}}),P.legend=we(ze({},P.legend),{font:{color:i}})}Ut(["plotjs"]).then(()=>{var c,m,u,p;const o=pe();if(!o)return;const i=e(F);o.purge(e(F)),o.react(e(F),{data:O,layout:P,frames:q}),le&&((c=i.removeListener)==null||c.call(i,"plotly_animated",le)),re&&((m=i.removeListener)==null||m.call(i,"plotly_sliderchange",re)),le=function(){o.relayout(e(F),{"xaxis.autorange":!0,"yaxis.autorange":!0})},re=function($){s(E,$.slider.active),ue("time",e(E),{replace:!0}),ce()},(u=i.on)==null||u.call(i,"plotly_animated",le),(p=i.on)==null||p.call(i,"plotly_sliderchange",re)})}Re(()=>(e(h),e(Z),e(A),e(X),e(E),e(v)),()=>{s(y,(()=>{const t=e(h).map(n=>n.value),a=t.length===Me.length&&t.every((n,l)=>n===Me[l]),r=(e(Z)?1:0)+(e(A)?2:0)+(e(X)?4:0);return e(E)!==0||e(v)[0]!==0||e(v)[1]!==70||r!==0||!a})())}),Re(()=>e(h),()=>{var t;s(V,((t=e(h))==null?void 0:t.length)===3)}),Re(()=>(e(V),e(C)),()=>{s(me,e(V)||!e(C)?[]:[...e(C).metric_names.map(t=>({value:t,label:t}))])}),Mt(),Nt();var Ie=oa();wt(t=>{var a=aa();te(t,a)});var Se=k(Ie),Ue=_(k(Se)),ut=_(Ue);ve(ut,()=>{var t;return(t=e(C))==null?void 0:t.wiki},t=>{var a=ia(),r=k(a);$t(),z(a),oe(()=>{var n,l,d;Tt(a,"href",`https://politicsandwar.fandom.com/wiki/${(n=e(C).wiki)!=null?n:""}`),ne(r,`Wiki:${(d=(l=e(C))==null?void 0:l.wiki)!=null?d:""} `)}),te(t,a)}),z(Se);var Ve=_(Se,2);Rt(Ve,{get conflictId(){return e(G)},active:"bubble"});var je=_(Ve,2),Ye=k(je);ve(Ye,()=>!e(Y),t=>{Zt(t)});var Ze=_(Ye,2);ve(Ze,()=>e(ie),t=>{var a=la(),r=k(a),n=k(r,!0);z(r);var l=_(r,2);z(a),oe(()=>ne(n,e(ie))),Ne("click",l,nt),te(t,a)});var Ae=_(Ze,2),Ee=k(Ae),mt=k(Ee);it(mt,t=>s(be,t),()=>e(be)),z(Ee);var dt=_(Ee,2);ve(dt,()=>e(C),t=>{var a=sa(),r=It(a),n=_(k(r),2);At(n,{onReset:rt,get resetDirty(){return e(y)}}),z(r);var l=_(r,2),d=k(l);Ot(d,{multiple:!0,get items(){return e(me)},get value(){return e(h)},set value(f){s(h,f)},showChevron:!0,$$events:{change:lt},$$slots:{empty:(f,P)=>{var D=ra(),o=k(D,!0);z(D),oe(()=>ne(o,e(V)?"Max 3 items":"No options")),te(f,D)}},$$legacy:!0}),z(l);var b=_(l,2),x=k(b);oe(()=>{var f,P,D;return ne(x,`Metrics: ${(f=e(h).map(o=>o.label).join(" / "))!=null?f:""} • Cities ${(P=e(v)[0])!=null?P:""}-${(D=e(v)[1])!=null?D:""}`)}),z(b);var T=_(b,4),M=_(k(T),2);Ge(M),M.value=(M.__value="option1")==null?"":"option1",z(T);var q=_(T,2),O=_(k(q),2);Ge(O),O.value=(O.__value="option2")==null?"":"option2",z(q);var S=_(q,2),L=_(k(S),2);Ge(L),L.value=(L.__value="option3")==null?"":"option3",z(S),Fe(M,()=>e(Z),f=>s(Z,f)),Ne("change",M,$e),Fe(O,()=>e(A),f=>s(A,f)),Ne("change",O,$e),Fe(L,()=>e(X),f=>s(X,f)),Ne("change",L,$e),te(t,a)}),z(Ae),z(je);var Te=_(je,2),Xe=k(Te),ft=k(Xe);it(ft,t=>s(F,t),()=>e(F)),z(Xe),z(Te);var vt=_(Te,2);ve(vt,()=>e(Ce),t=>{var a=na(),r=k(a,!0);z(a),oe(()=>ne(r,e(Ce))),te(t,a)}),z(Ie),oe(()=>{var t;return ne(Ue,` Conflict: ${(t=e(R))!=null?t:""} `)}),te(j,Ie),Pt()}export{ka as component};
