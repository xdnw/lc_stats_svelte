var Nt=Object.defineProperty,Ct=Object.defineProperties;var Mt=Object.getOwnPropertyDescriptors;var it=Object.getOwnPropertySymbols;var It=Object.prototype.hasOwnProperty,Pt=Object.prototype.propertyIsEnumerable;var lt=(E,N,v)=>N in E?Nt(E,N,{enumerable:!0,configurable:!0,writable:!0,value:v}):E[N]=v,ze=(E,N)=>{for(var v in N||(N={}))It.call(N,v)&&lt(E,v,N[v]);if(it)for(var v of it(N))Pt.call(N,v)&&lt(E,v,N[v]);return E},$e=(E,N)=>Ct(E,Mt(N));var De=(E,N,v)=>new Promise((he,me)=>{var C=L=>{try{ee(v.next(L))}catch(U){me(U)}},D=L=>{try{ee(v.throw(L))}catch(U){me(U)}},ee=L=>L.done?he(L.value):Promise.resolve(L.value).then(C,D);ee((v=v.apply(E,N)).next())});import{a as A,t as J}from"../chunks/disclose-version.xy21-f78.js";import{i as St}from"../chunks/legacy.N0bfMBuo.js";import{p as jt,l as rt,a as Et,f as nt,t as ne,b as Tt,s as c,g as t,n as st,c as p,m as S,d as ot,e as y,r as x,h as Lt}from"../chunks/runtime.DMLHWUus.js";import{h as Dt,s as se,e as oe}from"../chunks/render.CoimT3AH.js";import{o as Ot,a as Bt,i as pe}from"../chunks/index-client.D_ywJSmp.js";import{N as Ft,F as Ut,s as ce,r as Oe}from"../chunks/Footer.C7bm1xTi.js";import{b as Be}from"../chunks/input.DKMbOmpf.js";import{b as ct}from"../chunks/props.C-rJn9xF.js";import{n as Gt,S as Rt}from"../chunks/nouislider.CNARa_Me.js";import{a as Qt,d as Yt,f as Zt,s as ve,P as Vt,g as Xt,b as qt,c as Wt,e as Ht,h as ue,U as Kt,i as At,j as Jt,k as ea,r as ta}from"../chunks/index.DcoiBfme.js";import{d as aa}from"../chunks/index.C7g7TsCB.js";import{c as ut}from"../chunks/_layout.BJmI2Ulo.js";var ia=J(`<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/noUiSlider/15.7.1/nouislider.css"> <style>.noUi-value {
            color: #666; /* Change this to the color you want */
        }</style>`,1),la=J('<a class="btn ux-btn fw-bold"> <i class="bi bi-box-arrow-up-right"></i></a>'),ra=J('<div class="alert alert-danger m-2 d-flex justify-content-between align-items-center"><span> </span> <button class="btn btn-sm btn-outline-danger fw-bold">Retry</button></div>'),na=J('<div class="empty" slot="empty"> </div>'),sa=J('<div class="small text-muted mb-2"> </div>'),oa=J(`<div class="d-flex justify-content-between align-items-center"><span class="fw-bold">Select 3:</span> <div class="d-flex gap-1"><button class="btn ux-btn btn-sm fw-bold">Copy share link</button> <button class="btn ux-btn btn-sm fw-bold">Reset</button></div></div> <div class="small text-muted mb-1" title="Metrics with ':' are cumulative sums over time. Metrics without ':' are point-in-time values for each frame.">‚Ñπ Metric behavior: cumulative (sum over time) vs point-in-time.</div> <div class="select-compact mb-2" style="position: relative; z-index: 3;"><!></div> <div class="small text-muted mb-2"> </div> <!> <span class="fw-bold">Per Unit or Nation:</span> <div class="form-check form-check-inline" style="position: relative; z-index: 2;"><label class="form-check-label" for="inlineCheckbox1">X</label> <input class="form-check-input" type="checkbox" id="inlineCheckbox1"></div> <div class="form-check form-check-inline" style="position: relative; z-index: 2;"><label class="form-check-label" for="inlineCheckbox2">Y</label> <input class="form-check-input" type="checkbox" id="inlineCheckbox2"></div> <div class="form-check form-check-inline" style="position: relative; z-index: 2;"><label class="form-check-label" for="inlineCheckbox3">Z</label> <input class="form-check-input" type="checkbox" id="inlineCheckbox3"></div>`,1),ca=J('<!> <div class="container-fluid p-2" style="min-height: calc(100vh - 203px);"><h1 class="m-0 mb-2 p-2 ux-surface ux-page-title"><a href="conflicts" aria-label="Back to conflicts"><i class="bi bi-arrow-left"></i></a> <!></h1> <hr class="mt-2 mb-2"> <div class="row p-0 m-0 ux-tabstrip fw-bold"><a class="col-2 ps-0 pe-0 btn">‚óë&nbsp;Coalition</a> <a class="col-2 btn ps-0 pe-0">ñ£Ø&nbsp;Alliance</a> <a class="col-2 ps-0 pe-0 btn">‚ôü&nbsp;Nation</a> <a class="col-2 ps-0 pe-0 btn">üìä&nbsp;Tier/Time</a> <button class="col-2 ps-0 pe-0 btn is-active">üìà&nbsp;Bubble/Time</button> <a class="col-2 ps-0 pe-0 btn">üåê&nbsp;Web</a></div> <div class="row m-0 p-0 ux-surface ux-tab-panel" style="min-height: 116px; position: relative; z-index: 80; overflow: visible;"><!> <!> <div class="col-12"><div style="width: calc(100% - 30px);margin-left:15px;"><div class="mt-3 mb-5" style="position: relative; z-index: 1;"></div></div> <!></div></div> <div class="row m-0 p-0 mt-2 ux-surface" style="overflow-x: hidden; position: relative; z-index: 1;"><div class="col-12 m-0 p-0"><div class="m-0 p-0"></div></div></div></div> <!>',1);function wa(E,N){jt(N,!1);const v=S(),he=S();function me(){return window.Plotly}let C=S(),D=S(null),ee=S(),L=S(!1),U=S(null),Ne=S(""),te=S(!1),ae=S(!1),ie=S(!1),be=0,_e=S(),k=S([0,70]),O=0,ye=null,le=null,re=null,w=S(["dealt:loss_value","loss:loss_value","off:wars"].map(e=>({value:e,label:e}))),xe=[];function Ce(){var e;return(e=t(_e))==null?void 0:e.noUiSlider}function mt(){var e;t(w).length!=3||ea(xe,t(w))||(c(v,((e=t(w))==null?void 0:e.length)===3),xe=t(w).slice(),ue("selected",t(w).map(l=>l.value).join(".")),ve(),de(t(C)))}function Me(){return De(this,null,function*(){yield Lt();let e=(t(te)?1:0)+(t(ae)?2:0)+(t(ie)?4:0);return be==e?!1:(be=e|0,ue("normalize",e==0?null:e,{replace:!0}),ve(),de(t(C)),!0)})}function dt(){c(k,[0,70]),O=0,c(te,!1),c(ae,!1),c(ie,!1),be=0,c(w,["dealt:loss_value","loss:loss_value","off:wars"].map(l=>({value:l,label:l}))),xe=t(w).slice(),ta(["city_min","city_max","time","normalize","selected"],["id"]),ue("selected",t(w).map(l=>l.value).join("."),{replace:!0}),ve();const e=Ce();e&&e.set([t(k)[0],t(k)[1]]),t(C)&&de(t(C))}function ft(e){var d;let l=e.get("time");l&&!isNaN(+l)&&Number.isInteger(+l)&&(O=+l);let o=e.get("city_min"),r=e.get("city_max");o&&!isNaN(+o)&&Number.isInteger(+o)&&ot(k,t(k)[0]=+o),r&&!isNaN(+r)&&Number.isInteger(+r)&&ot(k,t(k)[1]=+r);let n=e.get("selected");n&&c(w,n.split(".").map(z=>({value:z,label:z}))),xe=t(w).slice(),c(v,((d=t(w))==null?void 0:d.length)===3);let h=e.get("normalize");if(h&&!isNaN(+h)&&Number.isInteger(+h)){let z=+h;c(te,(z&1)!=0),c(ae,(z&2)!=0),c(ie,(z&4)!=0),be=z}}let R=S();Ot(()=>De(this,null,function*(){var o;Qt(["city_min","city_max","time","normalize","selected"],["id"]);let e=new URLSearchParams(window.location.search);ft(e);const l=e.get("id");l?(c(D,l),Fe(t(D))):c(U,"Missing conflict id in URL"),Gt.create(t(_e),{start:t(k),connect:!0,step:1,tooltips:[{to:r=>`City ${Math.round(r)}`},{to:r=>`City ${Math.round(r)}`}],range:{min:0,max:70},pips:{mode:"steps",density:5,filter:(r,n)=>r%5?0:2}}),ye=r=>{c(k,r.map(n=>parseInt(n))),ue("city_min",t(k)[0]==0?null:t(k)[0],{replace:!0}),ue("city_max",t(k)[1]==70?null:t(k)[1],{replace:!0}),ve(),de(t(C))},(o=Ce())==null||o.on("set",ye)})),Bt(()=>{var l,o,r;const e=Ce();if(e&&(ye&&e.off("set",ye),e.destroy()),t(R)){const n=t(R);le&&((l=n.removeListener)==null||l.call(n,"plotly_animated",le)),re&&((o=n.removeListener)==null||o.call(n,"plotly_sliderchange",re)),(r=me())==null||r.purge(t(R))}});function Fe(e){let l=Date.now(),o=`https://locutus.s3.ap-southeast-2.amazonaws.com/conflicts/graphs/${e}.gzip?${ut.version.graph_data}`;Yt(o).then(r=>{console.log(`Loaded ${o} in ${Date.now()-l}ms`),l=Date.now(),c(ee,r.name),c(C,r),c(Ne,Zt(ut.version.graph_data,r.update_ms)),c(U,null),de(t(C)),c(L,!0),ve()}).catch(r=>{console.error("Failed to load bubble graph data",r),c(U,"Could not load conflict graph data. Please try again later."),c(L,!0)})}function pt(){t(D)&&(c(L,!1),c(U,null),Fe(t(D)))}function Ue(e){let l=e.name;return e.cumulative&&(l+=" (sum)"),e.normalize&&(l+=" (avg)"),l}function vt(e,l,o,r,n,h){let d={x:[0,Number.MIN_SAFE_INTEGER],y:[0,Number.MIN_SAFE_INTEGER],z:[0,Number.MIN_SAFE_INTEGER]},z=Object.keys(d),I=[l,o,r],B=[],F=[],G=[];for(let u=0;u<I.length;(u+=1)-1){let a=I[u],i=e.metric_names.indexOf(a.name);if(i==-1)return console.error(`Metric ${a.name} not found`),null;let s=e.metrics_turn.includes(i);if(F.push(s),B.push(s?e.metrics_turn.indexOf(i):e.metrics_day.indexOf(i)),B[u]==-1)return console.error(`Metric ${a.name} not found ${i}`),null;if(a.normalize){let f=Kt[a.name];G.push(f|0)}else G.push(-1)}let P=F.reduce((u,a)=>u||a),_={};for(let u=0;u<e.coalitions.length;(u+=1)-1){let a=e.coalitions[u],i=a.cities.findIndex(b=>b>=n),s=a.cities.slice().reverse().findIndex(b=>b<=h);s!==-1&&(s=a.cities.length-1-s),i==-1&&(i=0),s==-1&&(s=a.cities.length);let f=a.turn.range[0],m=a.day.range[0],g=P?f:m,j=P?a.turn.range[1]:a.day.range[1];for(let b=0;b<a.alliance_ids.length;(b+=1)-1){let Y=a.alliance_ids[b],Z=a.alliance_names[b],T=[0,0,0],Je=-1;for(let V=g;V<=j;(V+=1)-1){let fe=_[V];fe||(fe={},_[V]=fe);let X=fe[u];X||(X={x:[],y:[],id:[],text:[],customdata:[],marker:{size:[]}},fe[u]=X),X.id.push(Y),X.text.push(Z);let wt=P?V:Math.floor(V*12),ge=P?Math.floor(V/12):V;for(let M=0;M<I.length;(M+=1)-1){let q=F[M];if(!q&&Je==ge)continue;let zt=I[M].cumulative,et=B[M],tt=q?a.turn.data[et][b]:a.day.data[et][b];if(!tt)continue;let Te=tt[q?wt-f:ge-m];if(!Te||Object.keys(Te).length==0)continue;let ke=0;for(let W=i;W<=s;(W+=1)-1)ke+=Te[W];let Le=G[M];if(Le!=-1){let W=0,at=a.day.data[0][b];if(!at)continue;let we=at[ge-m];if(!we||we.length==0)continue;if(Le==0)for(let H=i;H<=s;(H+=1)-1)W+=we[H];else for(let H=i;H<=s;(H+=1)-1){let $t=a.cities[H];W+=we[H]*$t*Le}W!=0&&(ke/=W)}zt?T[M]+=ke:T[M]=ke}X.x.push(T[0]),X.y.push(T[1]),X.customdata.push(T[2]);for(let M=0;M<3;(M+=1)-1){let q=z[M];T[M]<d[q][0]&&(d[q][0]=T[M]),T[M]>d[q][1]&&(d[q][1]=T[M])}Je=ge}}}let Q=Math.min(...Object.keys(_).map(Number)),K=Math.max(...Object.keys(_).map(Number));return{traces:_,times:{start:Q,end:K,is_turn:P},ranges:d}}function de(e){if(!e)return;let l=t(w).map(B=>B.value);if(l.length!=3)return;let o=Date.now(),r={name:l[0],cumulative:l[0].includes(":"),normalize:t(te)},n={name:l[1],cumulative:l[1].includes(":"),normalize:t(ae)},h={name:l[2],cumulative:l[2].includes(":"),normalize:t(ie)},d=vt(e,r,n,h,t(k)[0],t(k)[1]);if(!d)return;let z=e.coalitions.map(B=>B.name),I=[r,n,h];console.log(`Generated traces in ${Date.now()-o}ms`),ht(d.traces,d.times,d.ranges,z,I)}function ht(e,l,o,r,n){let h=Date.now();var d=Object.keys(e).map(Number);if(d.length===0)return;O=Math.min(Math.max(O,0),Math.max(d.length-1,0));var z=e[l.start+O];if(!z)return;var I=Object.keys(z).map(Number);for(let a=l.start;a<=l.end;(a+=1)-1){let i=e[a];if(!i)continue;let s=0;for(let f=0;f<r.length;(f+=1)-1){let m=i[f];m&&(s=Math.max(s,Math.max(...m.customdata)))}for(let f=0;f<r.length;(f+=1)-1){let m=i[f];m&&(m.marker={size:m.customdata.map(g=>s>0?g/s:1)})}}function B(a,i){let s=e[a];s||(s=e[a]={});let f=s[i];return f||(f=s[i]={x:[],y:[],customdata:[],id:[],text:[],marker:{size:[]}}),f}let F={};var G=[];for(let a=0;a<d.length;(a+=1)-1){let i=[];for(let s=0;s<I.length;(s+=1)-1){let f=I[s],m=F[f];m||(m=F[f]={x:{},y:{},z:{}});let g=B(d[a],f);for(let j=0;j<g.id.length;(j+=1)-1){let b=g.id[j],Y=m.x[b],Z=m.y[b],T=m.z[b];Y||(Y=m.x[b]=[],Z=m.y[b]=[],T=m.z[b]=[]),Y.push(g.x[j]),Z.push(g.y[j]),T.push(g.customdata[j]),i.push({x:Y.slice(),y:Z.slice(),customdata:T.slice(),mode:"lines"})}i.push(g)}G.push({name:d[a],data:i})}var P=[];for(let a=0;a<I.length;(a+=1)-1){let i=I[a];var _=z[i];let s=Object.keys(Vt).map(Number).indexOf(i),f=Xt(aa,_.id.length,s),m=F[i];m||(m=F[i]={x:{},y:{},z:{}});for(let g=0;g<_.id.length;(g+=1)-1){let j=_.id[g],b=m.x[j],Y=m.y[j],Z=m.z[j];b||(b=[],Y=[],Z=[]),P.push({x:b.slice(0,O+1),y:Y.slice(0,O+1),customdata:Z.slice(0,O+1),mode:"lines",line:{width:.3,color:f[g]},hoverinfo:"all",showlegend:!1,hovertemplate:`${_.text[g]}<br>${n[0].name}: %{x}<br>${n[1].name}: %{y}<br>${n[2].name}: %{customdata}<extra></extra>`})}P.push({name:r[a],x:_.x.slice(),y:_.y.slice(),customdata:_.customdata.slice(),id:_.id.slice(),text:_.text.slice(),mode:"markers+text",textposition:"middle center",textfont:{size:7,color:"rgba(0, 0, 0, 0.75)"},marker:{size:_.marker.size,sizemode:"area",sizeref:.001,sizemin:1,color:f},hovertemplate:`%{text}<br>${n[0].name}: %{x}<br>${n[1].name}: %{y}<br>${n[2].name}: %{customdata}<extra></extra>`})}let Q=l.is_turn?qt:Wt;var K=[];for(let a=0;a<d.length;(a+=1)-1)K.push({method:"animate",label:Q(d[a]),args:[[d[a]],{mode:"immediate",transition:{duration:200},frame:{duration:200,redraw:!0}}]});var $={height:window.innerHeight*.8,xaxis:{title:Ue(n[0])},yaxis:{title:Ue(n[1])},hovermode:"closest",legend:{x:.5,y:1.1,itemsizing:"constant",xanchor:"center",yanchor:"top"},updatemenus:[{x:0,y:0,yanchor:"top",xanchor:"left",showactive:!1,direction:"left",type:"buttons",pad:{t:87,r:10},buttons:[{method:"animate",args:[null,{mode:"immediate",fromcurrent:!0,transition:{duration:200},frame:{duration:200,redraw:!0}}],label:"Play"},{method:"animate",args:[[null],{mode:"immediate",transition:{duration:0},frame:{duration:0,redraw:!0}}],label:"Pause"}]}],sliders:[{active:O,pad:{l:130,t:55},currentvalue:{visible:!0,prefix:"",xanchor:"right",font:{size:20,color:"#666"}},steps:K}]};if(document.documentElement.getAttribute("data-bs-theme")==="dark"){console.log("Dark theme");let a=getComputedStyle(document.documentElement).getPropertyValue("--bs-body-bg"),i=getComputedStyle(document.documentElement).getPropertyValue("--bs-body-color");$.plot_bgcolor=a,$.paper_bgcolor=a,$.font={color:i},$.xaxis=$e(ze({},$.xaxis),{gridcolor:i,zerolinecolor:i,tickfont:{color:i},titlefont:{color:i}}),$.yaxis=$e(ze({},$.yaxis),{gridcolor:i,zerolinecolor:i,tickfont:{color:i},titlefont:{color:i}}),$.legend=$e(ze({},$.legend),{font:{color:i}})}console.log(`Generated graph data in ${Date.now()-h}ms`),h=Date.now(),Ht(["plotjs"]).then(()=>{var s,f,m,g;const a=me();if(!a)return;const i=t(R);a.purge(t(R)),a.react(t(R),{data:P,layout:$,frames:G}),le&&((s=i.removeListener)==null||s.call(i,"plotly_animated",le)),re&&((f=i.removeListener)==null||f.call(i,"plotly_sliderchange",re)),le=function(){a.relayout(t(R),{"xaxis.autorange":!0,"yaxis.autorange":!0})},re=function(j){O=j.slider.active,ue("time",O,{replace:!0})},(m=i.on)==null||m.call(i,"plotly_animated",le),(g=i.on)==null||g.call(i,"plotly_sliderchange",re),console.log(`Setup reactive plot in ${Date.now()-h}ms`),h=Date.now()})}rt(()=>t(w),()=>{var e;c(v,((e=t(w))==null?void 0:e.length)===3)}),rt(()=>(t(v),t(C)),()=>{c(he,t(v)||!t(C)?[]:[...t(C).metric_names.map(e=>({value:e,label:e}))])}),Et(),St();var Ge=ca();Dt(e=>{var l=ia();st(2),A(e,l)});var Re=nt(Ge);Ft(Re,{});var Ie=p(Re,2),Pe=y(Ie),Qe=p(y(Pe)),bt=p(Qe);pe(bt,()=>{var e;return(e=t(C))==null?void 0:e.wiki},e=>{var l=la(),o=y(l);st(),x(l),ne(()=>{var r,n,h;ce(l,"href",`https://politicsandwar.fandom.com/wiki/${(r=t(C).wiki)!=null?r:""}`),se(o,`Wiki:${(h=(n=t(C))==null?void 0:n.wiki)!=null?h:""}¬†`)}),A(e,l)}),x(Pe);var Se=p(Pe,4),Ye=y(Se),Ze=p(Ye,2),Ve=p(Ze,2),Xe=p(Ve,2),_t=p(Xe,4);x(Se);var je=p(Se,2),qe=y(je);pe(qe,()=>!t(L),e=>{At(e)});var We=p(qe,2);pe(We,()=>t(U),e=>{var l=ra(),o=y(l),r=y(o,!0);x(o);var n=p(o,2);x(l),ne(()=>se(r,t(U))),oe("click",n,pt),A(e,l)});var He=p(We,2),Ee=y(He),yt=y(Ee);ct(yt,e=>c(_e,e),()=>t(_e)),x(Ee);var xt=p(Ee,2);pe(xt,()=>t(C),e=>{var l=oa(),o=nt(l),r=p(y(o),2),n=y(r),h=p(n,2);x(r),x(o);var d=p(o,4),z=y(d);Rt(z,{multiple:!0,get items(){return t(he)},get value(){return t(w)},set value(u){c(w,u)},showChevron:!0,$$events:{change:mt},$$slots:{empty:(u,a)=>{var i=na(),s=y(i,!0);x(i),ne(()=>se(s,t(v)?"Max 3 items":"No options")),A(u,i)}},$$legacy:!0}),x(d);var I=p(d,2),B=y(I);ne(()=>{var u,a,i;return se(B,`Metrics: ${(u=t(w).map(s=>s.label).join(" / "))!=null?u:""} ‚Ä¢ Cities ${(a=t(k)[0])!=null?a:""}-${(i=t(k)[1])!=null?i:""}`)}),x(I);var F=p(I,2);pe(F,()=>t(Ne),u=>{var a=sa(),i=y(a,!0);x(a),ne(()=>se(i,t(Ne))),A(u,a)});var G=p(F,4),P=p(y(G),2);Oe(P),P.value=(P.__value="option1")==null?"":"option1",x(G);var _=p(G,2),Q=p(y(_),2);Oe(Q),Q.value=(Q.__value="option2")==null?"":"option2",x(_);var K=p(_,2),$=p(y(K),2);Oe($),$.value=($.__value="option3")==null?"":"option3",x(K),oe("click",n,()=>Jt()),oe("click",h,dt),Be(P,()=>t(te),u=>c(te,u)),oe("change",P,Me),Be(Q,()=>t(ae),u=>c(ae,u)),oe("change",Q,Me),Be($,()=>t(ie),u=>c(ie,u)),oe("change",$,Me),A(e,l)}),x(He),x(je);var Ke=p(je,2),Ae=y(Ke),gt=y(Ae);ct(gt,e=>c(R,e),()=>t(R)),x(Ae),x(Ke),x(Ie);var kt=p(Ie,2);Ut(kt,{}),ne(()=>{var e,l,o,r,n,h;se(Qe,`¬†Conflict: ${(e=t(ee))!=null?e:""} `),ce(Ye,"href",`conflict?id=${(l=t(D))!=null?l:""}&layout=coalition`),ce(Ze,"href",`conflict?id=${(o=t(D))!=null?o:""}&layout=alliance`),ce(Ve,"href",`conflict?id=${(r=t(D))!=null?r:""}&layout=nation`),ce(Xe,"href",`tiering?id=${(n=t(D))!=null?n:""}`),ce(_t,"href",`chord?id=${(h=t(D))!=null?h:""}`)}),A(E,Ge),Tt()}export{wa as component};
