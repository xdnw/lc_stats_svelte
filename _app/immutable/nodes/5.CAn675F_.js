var je=(ee,te,W)=>new Promise((B,M)=>{var i=I=>{try{g(W.next(I))}catch(j){M(j)}},m=I=>{try{g(W.throw(I))}catch(j){M(j)}},g=I=>I.done?B(I.value):Promise.resolve(I.value).then(i,m);g((W=W.apply(ee,te)).next())});import{a as Q,f as J,s as T,e as V}from"../chunks/ByHfNYyH.js";import{i as vt}from"../chunks/DPmMxCJa.js";import{o as gt}from"../chunks/TrlPcG3m.js";import{p as bt,l as X,a as _t,t as O,b as xt,g as e,s as y,c as h,e as o,m as S,r as v,u as N,n as Le,h as ue,i as yt,j as wt}from"../chunks/MAWq1Bs-.js";import{i as G}from"../chunks/DRn8owhI.js";import{h as Ct,b as fe,s as Y,a as St,g as Te,d as We,r as kt}from"../chunks/D5oqsy_p.js";import{c as me,s as At}from"../chunks/CnrOJzGS.js";import{b as pe}from"../chunks/B8xhrJ_g.js";import{B as $t,b as he,o as ve,r as Z,g as Mt,f as It,y as Pt,a as Et,P as Rt,S as Dt,m as Ht,k as Nt}from"../chunks/BrECN6iW.js";import{P as Be,a as Ft,d as jt,s as qe,c as Lt,b as ze,e as Ue,f as Tt,h as Ke,t as Wt,E as Bt}from"../chunks/Cyw-96Kf.js";import{r as ge,g as be}from"../chunks/C-5gSOKl.js";import{S as Qe,v as qt,f as zt,t as Ut,b as Kt,a as Qt}from"../chunks/B6FWrDFz.js";import{C as Ot}from"../chunks/DcxSc3jB.js";var Gt=J('<a class="btn ux-btn fw-bold"> <i class="bi bi-box-arrow-up-right"></i></a>'),Yt=J('<div class="alert alert-danger m-2 d-flex justify-content-between align-items-center"><span> </span> <button class="btn btn-sm btn-outline-danger fw-bold">Retry</button></div>'),Jt=J('<div class="d-flex justify-content-between align-items-center mb-1"><div class="d-flex align-items-center gap-2 flex-wrap"><span class="fw-bold"> </span> <button class="btn ux-btn btn-sm fw-bold">Choose metric header</button></div> <!></div> <div class="d-flex justify-content-end mb-2"><!></div> <hr class="m-1"/> <div class="ux-coalition-panel ux-coalition-panel--compact ux-coalition-panel--red"><div class="d-flex align-items-center gap-2 flex-wrap"><span class="fw-bold"> </span></div> <div class="mt-2"><button class="btn ux-btn btn-sm fw-bold">Edit alliances</button></div></div> <div class="ux-coalition-panel ux-coalition-panel--compact ux-coalition-panel--blue"><div class="d-flex align-items-center gap-2 flex-wrap"><span class="fw-bold"> </span></div> <div class="mt-2"><button class="btn ux-btn btn-sm fw-bold">Edit alliances</button></div></div> <div class="small text-muted mt-2"> </div>',1),Vt=J('<div class="small text-muted text-end mt-2"> </div>'),Xt=J(`<div class="container-fluid p-2 ux-page-body"><h1 class="m-0 mb-2 p-2 ux-surface ux-page-title"><div class="ux-page-title-stack"><!> <span class="ux-page-title-main"> </span></div> <!></h1> <!> <div class="ux-surface ux-tab-panel p-2 fw-bold" style="min-height: 116px;"><!> <!> <!></div> <div class="d-flex justify-content-center align-items-center mt-1"><div class="d-flex justify-content-center align-items-center alert alert-danger text-center mb-1 py-1 text-danger">Click or hover over one of the chords and then scroll down to view
            the table.</div></div> <div class="container bg-light-subtle"><div id="my_dataviz"></div> <div class="mt-1" id="myTooltip" style="min-height:15em"></div></div> <!> <!> <!> <br/></div>`);function ma(ee,te){bt(te,!1);const W=S();let B=S(""),M=S(null),i=S(null),m=S(new Set),g=S("wars"),I=S(!1),j=S(!1),_e=S([]),xe=S([]),ae=S([]),L=S(0),q=S(!1),z=S(null),le=S(""),ye=S("matrix"),ie=null;const Oe=[{key:"matrix",label:"Full directed matrix"},{key:"edges",label:"Edge list (non-zero)"},{key:"settings",label:"Current filter settings"}],we=["from_alliance","from_alliance_id","from_coalition","to_alliance","to_alliance_id","to_coalition","value"];gt(()=>{St(["header","ids"],["id"]);let t=Te();const a=t.get("id");a?(o(M,a),Ce(e(M),t)):(o(z,"Missing conflict id in URL"),o(q,!0))});function Ce(t,a){o(z,null),o(q,!1);let r=Mt(t,me.version.conflict_data);We(r).then(n=>je(null,null,function*(){var A,w,P;o(i,n),o(B,n.name),o(le,It(me.version.conflict_data,n.update_ms)),o(m,new Set([...n.coalitions[0].alliance_ids,...n.coalitions[1].alliance_ids])),o(g,be(n));let d=a.get("header");d&&((A=e(i))!=null&&A.war_web.headers.includes(d))&&o(g,d);let b=a.get("ids");if(b){let _=b.split(".").map(u=>+u);o(m,new Set(_)),(!((w=e(i))!=null&&w.coalitions[0].alliance_ids.some(u=>e(m).has(u)))||!((P=e(i))!=null&&P.coalitions[1].alliance_ids.some(u=>e(m).has(u))))&&o(m,new Set([...n.coalitions[0].alliance_ids,...n.coalitions[1].alliance_ids]))}yield Pt(),U(),o(q,!0),Y(),(typeof window.requestIdleCallback=="function"?_=>window.requestIdleCallback(_,{timeout:2500}):_=>window.setTimeout(_,300))(()=>{const _=Et(t,me.version.graph_data);We(_).catch(()=>{})})})).catch(n=>{console.error("Failed to load chord web data",n),o(z,"Could not load conflict web data. Please try again later."),o(q,!0)})}function Ge(t){o(g,t),fe("header",t),Y(),U()}function Ye(){o(I,!0)}function Je(){o(I,!1)}function Ve(t){const a=zt(t.detail.ids);a&&(Ge(a),o(I,!1))}function Xe(t,a){e(i)&&(o(m,Wt(e(m),e(i).coalitions,t,a)),fe("ids",Array.from(e(m)).join(".")),Y(),U())}function Ze(t){return t.length>0?null:"Keep at least one alliance selected."}function Se(t){o(L,t),e(i)&&o(ae,e(i).coalitions[t].alliance_ids.filter(a=>e(m).has(a))),o(j,!0)}function et(){o(j,!1)}function tt(t){if(!e(i))return;const a=Ut(t.detail.ids),r=e(L)===0?1:0,n=e(i).coalitions[r].alliance_ids.filter(d=>e(m).has(d));o(m,new Set([...n,...a])),o(j,!1),fe("ids",Array.from(e(m)).join(".")),Y(),U()}function at(){e(i)&&(o(g,be(e(i))),o(m,new Set([...e(i).coalitions[0].alliance_ids,...e(i).coalitions[1].alliance_ids])),kt(["header","ids"],["id"]),Y(),U())}function lt(){if(!e(M))return;const t=Te();Ce(e(M),t)}function U(){it(e(i),e(m),e(g))}function it(t,a,r){let n={};t.coalitions.forEach(s=>{s.alliance_ids.forEach((p,$)=>{n[p]=he(s.alliance_names[$],p)})});let d=[],b=[],k=[...t.coalitions[0].alliance_ids,...t.coalitions[1].alliance_ids],A=k.filter(s=>a.has(s)),w=[];for(let s of t.coalitions[0].alliance_ids)d.push(Be.REDS),a.has(s)&&(b.push(n[s]),w.push(0));for(let s of t.coalitions[1].alliance_ids)d.push(Be.BLUES),a.has(s)&&(b.push(n[s]),w.push(1));let _=Ft(jt,d).filter((s,p)=>a.has(k[p])),R=t.war_web.headers.indexOf(r),D=t.war_web.data[R],l=[];for(let s=0;s<k.length;s++){let p=k[s],$=D[s];if(a.has(p)){let H=$.filter((x,C)=>a.has(k[C]));l.push(H)}}l=l.map(s=>s.length===0?new Array(b.length).fill(0):s),l=l.map(s=>s.map(p=>isNaN(p)||p<0?0:p)),ie={header:r,labels:b.slice(),allianceIds:A.slice(),coalitionIds:w.slice(),matrix:l.map(s=>s.slice())},nt(l,b,_,A,w)}function st(t){var _,u,R,D,l,s,p,$,H;if(!ie)return;const{labels:a,allianceIds:r,coalitionIds:n,matrix:d,header:b}=ie,k=[],A=[];for(let x=0;x<d.length;x++)for(let C=0;C<d[x].length;C++){const F=(_=d[x][C])!=null?_:0,E=[(u=a[x])!=null?u:`AA:${r[x]}`,(R=r[x])!=null?R:-1,(D=n[x])!=null?D:-1,(l=a[C])!=null?l:`AA:${r[C]}`,(s=r[C])!=null?s:-1,(p=n[C])!=null?p:-1,F];k.push(E),F>0&&A.push(E)}const w=Ht([["conflict_id",($=e(M))!=null?$:""],["conflict_name",e(B)],["header",b],["selected_alliance_count",r.length],["selected_alliance_ids",r]]),P={baseFileName:`chord-${(H=e(M))!=null?H:"conflict"}`,meta:{conflictId:e(M),conflictName:e(B),header:b,selectedAllianceIds:r,coalitionIds:n},tables:[{key:"matrix",label:"Full directed matrix",columns:we,rows:k},{key:"edges",label:"Edge list (non-zero)",columns:we,rows:A},{key:"settings",label:"Current filter settings",columns:["key","value"],rows:w}]};Nt({bundle:P,datasetKey:t.datasetKey,format:t.format,target:t.target})}function nt(t,a,r,n,d){const b=ge(e(g));qe("#my_dataviz").selectAll("*").remove();const k=qe("#my_dataviz").append("svg").classed("svg-content-responsive",!0).attr("preserveAspectRatio","xMinYMin meet").attr("viewBox","0 0 600 600").append("g").attr("transform","translate(300,300)").classed("rect",!0).attr("width",440).attr("height",440),A=Lt().padAngle(.01).sortSubgroups(ze).sortChords(ze)(t);k.datum(A).append("g").classed("rect",!0).attr("width",440).attr("height",440).selectAll("g").data(l=>l.groups).join("g").append("path").style("fill",(l,s)=>r[s]).style("stroke","#222").style("stroke-width","0.25px").attr("d",Ue().innerRadius(210).outerRadius(220));let w=k.datum(A).append("g").selectAll("path").data(l=>l).join("path").attr("d",Tt().radius(208)).attr("fill-opacity",.75).attr("stroke-opacity",.5).style("fill",l=>r[l.source.index]).style("stroke",l=>Ke(r[l.source.index],25)).style("stroke-width","0.5px"),P=k.datum(A).append("g").selectAll("g").data(l=>l.groups).join("g");P.append("path").style("fill",(l,s)=>r[s]).style("stroke","#222").style("stroke-width","0.25px").attr("d",Ue().innerRadius(210).outerRadius(220)),P.append("text").each(l=>{l.angle=(l.startAngle+l.endAngle)/2}).attr("dy",".35em").attr("transform",l=>`
        rotate(${l.angle*180/Math.PI-90})
        translate(221)
        ${l.angle>Math.PI?"rotate(180)":""}
    `).attr("text-anchor",l=>l.angle>Math.PI?"end":null).style("font-size","9px").text((l,s)=>a[s]);let _=-1,u=-1;n.filter((l,s)=>d[s]===0).length===1?R(d.indexOf(0)):n.filter((l,s)=>d[s]===1).length===1&&R(d.indexOf(1));function R(l){let s=document.getElementById("myTooltip"),p=new Set(t[l].map((f,c)=>f!==0||t[c][l]!==0?c:-1).filter(f=>f!==-1)),$=a.filter((f,c)=>p.has(c)),H=r.filter((f,c)=>p.has(c)),x=t[l].filter((f,c)=>p.has(c)),C=t.map((f,c)=>p.has(c)?f[l]:null).filter(f=>f!==null),F=Array.from({length:x.length},(f,c)=>c);F.sort((f,c)=>x[c]-x[f]),$=F.map(f=>$[f]),H=F.map(f=>H[f]),x=F.map(f=>x[f]),C=F.map(f=>C[f]);let E=`<h5>Selected alliance: ${a[l]} (${e(g)})</h5><div class='small text-muted mb-1'>${b.directionNote(e(g))} Net = Selected value minus Compared value.</div><table class='table fw-bold w-auto'><tr><th>Compared alliance</th><th>${b.primaryToRowLabel(e(g))}</th><th>${b.rowToPrimaryLabel(e(g))}</th><th>Net</th></tr>`;$.forEach((f,c)=>{E+=`<tr><td style='background-color:${Ke(H[c],50)};color:white'>${f}</td>`,E+=`<td>${ve(x[c])}</td>`,E+=`<td>${ve(C[c])}</td>`,E+=`<td>${ve(x[c]-C[c])}</td></tr>`}),E+="</table>",s.innerHTML=E}function D(){u!==_&&(u==-1?w.classed("d-none",!1):(w.filter(l=>l.source.index!==u&&l.target.index!==u).classed("d-none",!0),w.filter(l=>l.source.index===u||l.target.index===u).classed("d-none",!1),R(u)),_=u)}P.on("click",function(l,s){u=-1,_=-1,Xe(d[s.index],n[s.index])}),P.on("mouseover",function(l,s){u=s.index,requestAnimationFrame(Z(100,D))}).on("mouseout",function(l,s){u=-1,requestAnimationFrame(Z(100,D))}).on("mouseover touchstart",function(l,s){u=s.index,requestAnimationFrame(Z(100,D))}).on("mouseout touchend",function(l,s){u=-1,requestAnimationFrame(Z(100,D))})}X(()=>(e(i),e(g),e(m)),()=>{o(W,(()=>{if(!e(i))return!1;const t=be(e(i)),a=e(i).coalitions[0].alliance_ids.length+e(i).coalitions[1].alliance_ids.length;return e(g)!==t||e(m).size!==a})())}),X(()=>e(i),()=>{var t,a;o(_e,Kt((a=(t=e(i))==null?void 0:t.war_web.headers)!=null?a:[]))}),X(()=>(e(i),e(L),he),()=>{o(xe,(()=>{if(!e(i))return[];const t=e(i).coalitions[e(L)];return t?Qt([t],he):[]})())}),X(()=>(e(i),e(L),e(m)),()=>{o(ae,e(i)?e(i).coalitions[e(L)].alliance_ids.filter(t=>e(m).has(t)):[])}),_t(),vt();var se=Xt();Ct("1uauf75",t=>{});var ne=h(se),re=h(ne),ke=h(re);{let t=ue(()=>[{label:"Home",href:`${pe}/`},{label:"Conflicts",href:`${pe}/conflicts`},{label:e(B)||"Conflict",href:e(M)?`${pe}/conflict?id=`+e(M):void 0},{label:"Chord"}]);$t(ke,{get items(){return e(t)}})}var Ae=y(ke,2),rt=h(Ae);v(Ae),v(re);var ot=y(re,2);{var ct=t=>{var a=Gt(),r=h(a);Le(),v(a),O(()=>{var n,d;At(a,"href",`https://politicsandwar.fandom.com/wiki/${(n=(e(i),N(()=>e(i).wiki)))!=null?n:""}`),T(r,`Wiki:${(d=(e(i),N(()=>{var b;return(b=e(i))==null?void 0:b.wiki})))!=null?d:""}Â `)}),Q(t,a)};G(ot,t=>{e(i),N(()=>{var a;return(a=e(i))==null?void 0:a.wiki})&&t(ct)})}v(ne);var $e=y(ne,2);Ot($e,{get conflictId(){return e(M)},active:"chord"});var oe=y($e,2),Me=h(oe);{var dt=t=>{Rt(t)};G(Me,t=>{e(q)||t(dt)})}var Ie=y(Me,2);{var ut=t=>{var a=Yt(),r=h(a),n=h(r,!0);v(r);var d=y(r,2);v(a),O(()=>T(n,e(z))),V("click",d,lt),Q(t,a)};G(Ie,t=>{e(z)&&t(ut)})}var ft=y(Ie,2);{var mt=t=>{var a=Jt(),r=yt(a),n=h(r),d=h(n),b=h(d);v(d);var k=y(d,2);v(n);var A=y(n,2);Dt(A,{onReset:at,get resetDirty(){return e(W)}}),v(r);var w=y(r,2),P=h(w);Bt(P,{get datasets(){return Oe},onExport:st,get selectedDatasetKey(){return e(ye)},set selectedDatasetKey(c){o(ye,c)},$$legacy:!0}),v(w);var _=y(w,4),u=h(_),R=h(u),D=h(R);v(R),v(u);var l=y(u,2),s=h(l);v(l),v(_);var p=y(_,2),$=h(p),H=h($),x=h(H);v(H),v($);var C=y($,2),F=h(C);v(C),v(p);var E=y(p,2),f=h(E);v(E),O((c,ce,de)=>{var Re,De,He,Ne,Fe;T(b,`Metric header: ${(Re=e(g))!=null?Re:""}`),T(D,`${(De=(e(i),N(()=>{var K;return(K=e(i))==null?void 0:K.coalitions[0].name})))!=null?De:""} selected: ${c!=null?c:""}/${(He=(e(i),N(()=>e(i).coalitions[0].alliance_ids.length)))!=null?He:""}`),T(x,`${(Ne=(e(i),N(()=>{var K;return(K=e(i))==null?void 0:K.coalitions[1].name})))!=null?Ne:""} selected: ${ce!=null?ce:""}/${(Fe=(e(i),N(()=>e(i).coalitions[1].alliance_ids.length)))!=null?Fe:""}`),T(f,`${de!=null?de:""}
                Hover a chord to inspect one Selected alliance versus Compared alliances.
                "Net" = Selected value minus Compared value.`)},[()=>(e(i),e(m),N(()=>e(i).coalitions[0].alliance_ids.filter(c=>e(m).has(c)).length)),()=>(e(i),e(m),N(()=>e(i).coalitions[1].alliance_ids.filter(c=>e(m).has(c)).length)),()=>(wt(ge),e(g),N(()=>ge(e(g)).directionNote(e(g))))]),V("click",k,Ye),V("click",s,()=>Se(0)),V("click",F,()=>Se(1)),Q(t,a)};G(ft,t=>{e(i)&&t(mt)})}v(oe);var Pe=y(oe,6);{var pt=t=>{var a=Vt(),r=h(a,!0);v(a),O(()=>T(r,e(le))),Q(t,a)};G(Pe,t=>{e(le)&&t(pt)})}var Ee=y(Pe,2);{let t=ue(()=>[e(g)]);Qe(Ee,{get open(){return e(I)},title:"Choose Metric Header",description:"Pick the active header used to generate chord edges and flow tables.",get items(){return e(_e)},get selectedIds(){return e(t)},applyLabel:"Use header",singleSelect:!0,searchPlaceholder:"Search layouts...",validateSelection:a=>qt(a,"header"),$$events:{close:Je,apply:Ve}})}var ht=y(Ee,2);{let t=ue(()=>(e(i),e(L),N(()=>{var a,r,n;return`Filter Alliances: ${(n=(r=(a=e(i))==null?void 0:a.coalitions[e(L)])==null?void 0:r.name)!=null?n:"Coalition"}`})));Qe(ht,{get open(){return e(j)},get title(){return e(t)},description:"Select alliances for the coalition associated with the button you clicked.",get items(){return e(xe)},get selectedIds(){return e(ae)},searchPlaceholder:"Search alliances...",validateSelection:Ze,$$events:{close:et,apply:tt}})}Le(2),v(se),O(()=>{var t;return T(rt,`Conflict: ${(t=e(B))!=null?t:""}`)}),Q(ee,se),xt()}export{ma as component};
