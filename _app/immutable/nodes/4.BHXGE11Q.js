var Ut=Object.defineProperty,Gt=Object.defineProperties;var Ot=Object.getOwnPropertyDescriptors;var ut=Object.getOwnPropertySymbols;var qt=Object.prototype.hasOwnProperty,Ft=Object.prototype.propertyIsEnumerable;var dt=(T,I,N)=>I in T?Ut(T,I,{enumerable:!0,configurable:!0,writable:!0,value:N}):T[I]=N,Me=(T,I)=>{for(var N in I||(I={}))qt.call(I,N)&&dt(T,N,I[N]);if(ut)for(var N of ut(I))Ft.call(I,N)&&dt(T,N,I[N]);return T},Ce=(T,I)=>Gt(T,Ot(I));var pe=(T,I,N)=>new Promise((A,fe)=>{var be=O=>{try{U(N.next(O))}catch(Y){fe(Y)}},P=O=>{try{U(N.throw(O))}catch(Y){fe(Y)}},U=O=>O.done?A(O.value):Promise.resolve(O.value).then(be,P);U((N=N.apply(T,I)).next())});import{a as ae,f as re,s as oe,e as $e}from"../chunks/DLCQTpuP.js";import{i as Dt}from"../chunks/DT10vATe.js";import{o as Qt,a as At}from"../chunks/Di_BE8QR.js";import{p as Yt,l as Ae,a as Kt,t as ce,b as Vt,g as e,s as z,m as $,h as Wt,c as k,e as s,r as w,u as ue,k as mt,n as Zt,i as Xt,f as Ht}from"../chunks/DVbRBn6a.js";import{i as he}from"../chunks/Bxs4rezJ.js";import{h as Jt,a as ea,g as ta,b as de,s as me,d as ft,r as aa}from"../chunks/BLlCKcKh.js";import{c as Ye,s as ra,r as Ke}from"../chunks/DnCfu7FQ.js";import{a as Ve}from"../chunks/BsffpG_N.js";import{b as vt}from"../chunks/CDhy3Brg.js";import{n as la,S as ia}from"../chunks/TkRnm2n8.js";import{C as na}from"../chunks/Ce5oxAg0.js";import{B as sa,a as oa,f as ca,y as ua,c as da,e as ma,h as fa,g as va,i as pa,b as ha,P as ba,S as _a,j as ga}from"../chunks/DqDmrPFw.js";import{b as We}from"../chunks/DjEpIcmV.js";import{P as ya,g as xa,d as ka,r as wa}from"../chunks/BX37AVBw.js";var za=re('<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/noUiSlider/15.7.1/nouislider.css"/>'),Na=re('<a class="btn ux-btn fw-bold"> <i class="bi bi-box-arrow-up-right"></i></a>'),Ma=re('<div class="alert alert-danger m-2 d-flex justify-content-between align-items-center"><span> </span> <button class="btn btn-sm btn-outline-danger fw-bold">Retry</button></div>'),Ca=re('<div class="empty" slot="empty"> </div>'),$a=re(`<div class="d-flex justify-content-between align-items-center"><span class="fw-bold">Select 3 <button type="button" class="btn btn-link btn-sm p-0 ms-1 align-baseline" title="Metrics with ':' are cumulative sums over time. Metrics without ':' are point-in-time values for each frame." aria-label="Metric behavior help"><i class="bi bi-info-circle"></i></button></span> <!></div> <div class="select-compact mb-2" style="position: relative; z-index: 3;"><!></div> <div class="small text-muted mb-2"> </div> <span class="fw-bold">Per Unit or Nation:</span> <div class="form-check form-check-inline" style="position: relative; z-index: 2;"><label class="form-check-label" for="inlineCheckbox1">X</label> <input class="form-check-input" type="checkbox" id="inlineCheckbox1"/></div> <div class="form-check form-check-inline" style="position: relative; z-index: 2;"><label class="form-check-label" for="inlineCheckbox2">Y</label> <input class="form-check-input" type="checkbox" id="inlineCheckbox2"/></div> <div class="form-check form-check-inline" style="position: relative; z-index: 2;"><label class="form-check-label" for="inlineCheckbox3">Z</label> <input class="form-check-input" type="checkbox" id="inlineCheckbox3"/></div>`,1),Ia=re('<div class="small text-muted text-end mt-2"> </div>'),Pa=re('<div class="container-fluid p-2 ux-page-body"><h1 class="m-0 mb-2 p-2 ux-surface ux-page-title"><div class="ux-page-title-stack"><!> <span class="ux-page-title-main"> </span></div> <!></h1> <!> <div class="row m-0 p-0 ux-surface ux-tab-panel" style="min-height: 116px; position: relative; z-index: 80; overflow: visible;"><!> <!> <div class="col-12"><div style="width: calc(100% - 30px);margin-left:15px;"><div class="mt-3 mb-5" style="position: relative; z-index: 1;"></div></div> <!></div></div> <div class="row m-0 p-0 mt-2 ux-surface" style="overflow-x: hidden; position: relative; z-index: 1;"><div class="col-12 m-0 p-0"><div class="m-0 p-0"></div></div></div> <!></div>');function Ya(T,I){Yt(I,!1);const N=$(),A=$(),fe=$();function be(){return pa()}let P=$(),U=$(null),O=$(),Y=$(!1),le=$(null),Ie=$(""),K=$(!1),V=$(!1),W=$(!1),_e=0,ge=$(),v=$([0,70]),B=$(0),ye=null,ie=null,ne=null,Pe=new Map,Ee=!1,te=null,pt=0,je=0;const Se=["dealt:loss_value","loss:loss_value","off:wars"];let y=$(Se.map(t=>({value:t,label:t}))),xe=[];function Le(){var t;return(t=e(ge))==null?void 0:t.noUiSlider}function ht(){var t;e(y).length!=3||ga(xe,e(y))||(s(A,((t=e(y))==null?void 0:t.length)===3),xe=e(y).slice(),de("selected",e(y).map(a=>a.value).join(".")),me(),ke())}function Te(){return pe(this,null,function*(){yield Ht();let t=(e(K)?1:0)+(e(V)?2:0)+(e(W)?4:0);return _e==t?!1:(_e=t|0,de("normalize",t==0?null:t,{replace:!0}),me(),ke(),!0)})}function bt(){s(v,[0,70]),s(B,0),s(K,!1),s(V,!1),s(W,!1),_e=0,s(y,["dealt:loss_value","loss:loss_value","off:wars"].map(a=>({value:a,label:a}))),xe=e(y).slice(),aa(["city_min","city_max","time","normalize","selected"],["id"]),de("selected",e(y).map(a=>a.value).join("."),{replace:!0}),me();const t=Le();t&&t.set([e(v)[0],e(v)[1]]),e(P)&&ke()}function _t(t){var d;let a=t.get("time");a&&!isNaN(+a)&&Number.isInteger(+a)&&s(B,+a);let l=t.get("city_min"),n=t.get("city_max");l&&!isNaN(+l)&&Number.isInteger(+l)&&mt(v,e(v)[0]=+l),n&&!isNaN(+n)&&Number.isInteger(+n)&&mt(v,e(v)[1]=+n);let r=t.get("selected");r&&s(y,r.split(".").map(b=>({value:b,label:b}))),xe=e(y).slice(),s(A,((d=e(y))==null?void 0:d.length)===3);let m=t.get("normalize");if(m&&!isNaN(+m)&&Number.isInteger(+m)){let b=+m;s(K,(b&1)!=0),s(V,(b&2)!=0),s(W,(b&4)!=0),_e=b}}let q=$();Qt(()=>pe(null,null,function*(){var l;try{te=new Worker(new URL(""+new URL("../workers/bubbleTraceWorker-zfY8NANJ.js",import.meta.url).href,import.meta.url),{type:"module"})}catch(n){te=null,console.warn("Bubble worker unavailable, using main-thread fallback",n)}ea(["city_min","city_max","time","normalize","selected"],["id"]);let t=ta();_t(t);const a=t.get("id");a?(s(U,a),Ze(e(U))):s(le,"Missing conflict id in URL"),la.create(e(ge),{start:e(v),connect:!0,step:1,tooltips:[{to:n=>`City ${Math.round(n)}`},{to:n=>`City ${Math.round(n)}`}],range:{min:0,max:70},pips:{mode:"steps",density:5,filter:(n,r)=>n%5?0:2}}),ye=n=>{s(v,n.map(r=>parseInt(r))),de("city_min",e(v)[0]==0?null:e(v)[0],{replace:!0}),de("city_max",e(v)[1]==70?null:e(v)[1],{replace:!0}),me(),ke()},(l=Le())==null||l.on("set",ye)})),At(()=>{var a,l,n;je++,te&&(te.terminate(),te=null);const t=Le();if(t&&(ye&&t.off("set",ye),t.destroy()),e(q)){const r=e(q);ie&&((a=r.removeListener)==null||a.call(r,"plotly_animated",ie)),ne&&((l=r.removeListener)==null||l.call(r,"plotly_sliderchange",ne)),(n=be())==null||n.purge(e(q))}});function Ze(t){let a=oa(t,Ye.version.graph_data);ft(a).then(l=>pe(null,null,function*(){s(O,l.name),s(P,l),Pe.clear(),s(Ie,ca(Ye.version.graph_data,l.update_ms)),s(le,null),yield ua(),He(e(P)),s(Y,!0),me(),(typeof window.requestIdleCallback=="function"?r=>window.requestIdleCallback(r,{timeout:2500}):r=>window.setTimeout(r,300))(()=>{const r=va(t,Ye.version.conflict_data);ft(r).catch(()=>{})})})).catch(l=>{console.error("Failed to load bubble graph data",l),s(le,"Could not load conflict graph data. Please try again later."),s(Y,!0)})}function gt(){e(U)&&(s(Y,!1),s(le,null),Ze(e(U)))}function yt(t,a,l,n){return te?new Promise((r,m)=>{const d=te;if(!d){r(Be(t,a[0],a[1],a[2],l,n));return}const b=++pt,g=E=>{const p=E.data;!p||p.id!==b||(d.removeEventListener("message",g),d.removeEventListener("error",_),p.ok?r(p.result):m(new Error(p.error)))},_=E=>{var p;d.removeEventListener("message",g),d.removeEventListener("error",_),m((p=E.error)!=null?p:new Error(E.message))};d.addEventListener("message",g),d.addEventListener("error",_,{once:!0});const C={id:b,data:t,metrics:a,minCity:l,maxCity:n};d.postMessage(C)}).catch(r=>(console.warn("Bubble worker compute failed, falling back to main thread",r),Be(t,a[0],a[1],a[2],l,n))):Promise.resolve(Be(t,a[0],a[1],a[2],l,n))}function xt(t,a,l){var r;const n=t.map(m=>`${m.name}:${m.normalize?1:0}:${m.cumulative?1:0}`).join("|");return`${(r=e(U))!=null?r:"-"}|${n}|${a}-${l}`}function ke(){Ee||(Ee=!0,requestAnimationFrame(()=>{Ee=!1,He(e(P))}))}function Xe(t){let a=t.name;return t.cumulative&&(a+=" (sum)"),t.normalize&&(a+=" (avg)"),a}function Be(t,a,l,n,r,m){let d={x:[0,Number.MIN_SAFE_INTEGER],y:[0,Number.MIN_SAFE_INTEGER],z:[0,Number.MIN_SAFE_INTEGER]},b=Object.keys(d),g=[a,l,n];const _=wa(t,g);if(!_)return null;let C=_.metric_indexes,E=_.metric_is_turn,p=_.metric_normalize,R=_.isAnyTurn,h={};for(let i=0;i<t.coalitions.length;i++){let o=t.coalitions[i],f=o.cities.findIndex(M=>M>=r),c=o.cities.slice().reverse().findIndex(M=>M<=m);c!==-1&&(c=o.cities.length-1-c),f==-1&&(f=0),c==-1&&(c=o.cities.length);let x=o.turn.range[0],S=o.day.range[0],G=R?x:S,D=R?o.turn.range[1]:o.day.range[1];for(let M=0;M<o.alliance_ids.length;M++){let se=o.alliance_ids[M],Lt=ha(o.alliance_names[M],se),Q=[0,0,0],nt=-1;for(let Z=G;Z<=D;Z++){let ve=h[Z];ve||(ve={},h[Z]=ve);let X=ve[i];X||(X={x:[],y:[],id:[],text:[],customdata:[],marker:{size:[]}},ve[i]=X),X.id.push(se),X.text.push(Lt);let Tt=R?Z:Math.floor(Z*12),we=R?Math.floor(Z/12):Z;for(let L=0;L<g.length;L++){let H=E[L];if(!H&&nt==we)continue;let Bt=g[L].cumulative,st=C[L],ot=H?o.turn.data[st][M]:o.day.data[st][M];if(!ot)continue;let De=ot[H?Tt-x:we-S];if(!De||Object.keys(De).length==0)continue;let ze=0;for(let J=f;J<=c;J++)ze+=De[J];let Qe=p[L];if(Qe!=-1){let J=0,ct=o.day.data[0][M];if(!ct)continue;let Ne=ct[we-S];if(!Ne||Ne.length==0)continue;if(Qe==0)for(let ee=f;ee<=c;ee++)J+=Ne[ee];else for(let ee=f;ee<=c;ee++){let Rt=o.cities[ee];J+=Ne[ee]*Rt*Qe}J!=0&&(ze/=J)}Bt?Q[L]+=ze:Q[L]=ze}X.x.push(Q[0]),X.y.push(Q[1]),X.customdata.push(Q[2]);for(let L=0;L<3;L++){let H=b[L];Q[L]<d[H][0]&&(d[H][0]=Q[L]),Q[L]>d[H][1]&&(d[H][1]=Q[L])}nt=we}}}let j=Math.min(...Object.keys(h).map(Number)),F=Math.max(...Object.keys(h).map(Number));return{traces:h,times:{start:j,end:F,is_turn:R},ranges:d}}function He(t){return pe(this,null,function*(){if(!t)return;const a=++je;let l=e(y).map(C=>C.value);if(l.length!=3)return;let n={name:l[0],cumulative:l[0].includes(":"),normalize:e(K)},r={name:l[1],cumulative:l[1].includes(":"),normalize:e(V)},m={name:l[2],cumulative:l[2].includes(":"),normalize:e(W)};const d=[n,r,m],b=xt(d,e(v)[0],e(v)[1]);let g=Pe.get(b);if(!g){const C=yield yt(t,d,e(v)[0],e(v)[1]);if(a!==je||!C)return;g=C,Pe.set(b,g)}if(!g)return;let _=t.coalitions.map(C=>C.name);kt(g.traces,g.times,g.ranges,_,d)})}function kt(t,a,l,n,r){var m=Object.keys(t).map(Number);if(m.length===0)return;s(B,Math.min(Math.max(e(B),0),Math.max(m.length-1,0)));var d=t[a.start+e(B)];if(!d)return;var b=Object.keys(d).map(Number);for(let u=a.start;u<=a.end;u++){let i=t[u];if(!i)continue;let o=0;for(let f=0;f<n.length;f++){let c=i[f];c&&(o=Math.max(o,Math.max(...c.customdata)))}for(let f=0;f<n.length;f++){let c=i[f];c&&(c.marker={size:c.customdata.map(x=>o>0?x/o:1)})}}function g(u,i){let o=t[u];o||(o=t[u]={});let f=o[i];return f||(f=o[i]={x:[],y:[],customdata:[],id:[],text:[],marker:{size:[]}}),f}let _={};var C=[];for(let u=0;u<m.length;u++){let i=[];for(let o=0;o<b.length;o++){let f=b[o],c=_[f];c||(c=_[f]={x:{},y:{},z:{}});let x=g(m[u],f);for(let S=0;S<x.id.length;S++){let G=x.id[S],D=c.x[G],M=c.y[G],se=c.z[G];D||(D=c.x[G]=[],M=c.y[G]=[],se=c.z[G]=[]),D.push(x.x[S]),M.push(x.y[S]),se.push(x.customdata[S]),i.push({x:D.slice(),y:M.slice(),customdata:se.slice(),mode:"lines"})}i.push(x)}C.push({name:m[u],data:i})}var E=[];for(let u=0;u<b.length;u++){let i=b[u];var p=d[i];let o=Object.keys(ya).map(Number).indexOf(i),f=xa(ka,p.id.length,o),c=_[i];c||(c=_[i]={x:{},y:{},z:{}});for(let x=0;x<p.id.length;x++){let S=p.id[x],G=c.x[S],D=c.y[S],M=c.z[S];G||(G=[],D=[],M=[]),E.push({x:G.slice(0,e(B)+1),y:D.slice(0,e(B)+1),customdata:M.slice(0,e(B)+1),mode:"lines",line:{width:.3,color:f[x]},hoverinfo:"all",showlegend:!1,hovertemplate:`${p.text[x]}<br>${r[0].name}: %{x}<br>${r[1].name}: %{y}<br>${r[2].name}: %{customdata}<extra></extra>`})}E.push({name:n[u],x:p.x.slice(),y:p.y.slice(),customdata:p.customdata.slice(),id:p.id.slice(),text:p.text.slice(),mode:"markers+text",textposition:"middle center",textfont:{size:7,color:"rgba(0, 0, 0, 0.75)"},marker:{size:p.marker.size,sizemode:"area",sizeref:.001,sizemin:1,color:f},hovertemplate:`%{text}<br>${r[0].name}: %{x}<br>${r[1].name}: %{y}<br>${r[2].name}: %{customdata}<extra></extra>`})}let R=a.is_turn?da:ma;var h=[];for(let u=0;u<m.length;u++)h.push({method:"animate",label:R(m[u]),args:[[m[u]],{mode:"immediate",transition:{duration:200},frame:{duration:200,redraw:!0}}]});var j={height:window.innerHeight*.8,margin:{l:0,r:0,t:30,b:60},xaxis:{title:Xe(r[0])},yaxis:{title:Xe(r[1])},hovermode:"closest",legend:{x:.5,y:1.1,itemsizing:"constant",xanchor:"center",yanchor:"top"},updatemenus:[{x:0,y:0,yanchor:"top",xanchor:"left",showactive:!1,direction:"left",type:"buttons",pad:{t:87,r:10},buttons:[{method:"animate",args:[null,{mode:"immediate",fromcurrent:!0,transition:{duration:200},frame:{duration:200,redraw:!0}}],label:"Play"},{method:"animate",args:[[null],{mode:"immediate",transition:{duration:0},frame:{duration:0,redraw:!0}}],label:"Pause"}]}],sliders:[{active:e(B),pad:{l:130,t:55},currentvalue:{visible:!0,prefix:"",xanchor:"right",font:{size:20,color:"#666"}},steps:h}]};if(document.documentElement.getAttribute("data-bs-theme")==="dark"){let u=getComputedStyle(document.documentElement).getPropertyValue("--bs-body-bg"),i=getComputedStyle(document.documentElement).getPropertyValue("--bs-body-color");j.plot_bgcolor=u,j.paper_bgcolor=u,j.font={color:i},j.xaxis=Ce(Me({},j.xaxis),{gridcolor:i,zerolinecolor:i,tickfont:{color:i},titlefont:{color:i}}),j.yaxis=Ce(Me({},j.yaxis),{gridcolor:i,zerolinecolor:i,tickfont:{color:i},titlefont:{color:i}}),j.legend=Ce(Me({},j.legend),{font:{color:i}})}fa(["plotjs"]).then(()=>{var o,f,c,x;const u=be();if(!u)return;const i=e(q);u.purge(e(q)),u.react(e(q),{data:E,layout:j,frames:C}),ie&&((o=i.removeListener)==null||o.call(i,"plotly_animated",ie)),ne&&((f=i.removeListener)==null||f.call(i,"plotly_sliderchange",ne)),ie=function(){u.relayout(e(q),{"xaxis.autorange":!0,"yaxis.autorange":!0})},ne=function(S){s(B,S.slider.active),de("time",e(B),{replace:!0}),me()},(c=i.on)==null||c.call(i,"plotly_animated",ie),(x=i.on)==null||x.call(i,"plotly_sliderchange",ne)})}Ae(()=>(e(y),e(K),e(V),e(W),e(B),e(v)),()=>{s(N,(()=>{const t=e(y).map(n=>n.value),a=t.length===Se.length&&t.every((n,r)=>n===Se[r]),l=(e(K)?1:0)+(e(V)?2:0)+(e(W)?4:0);return e(B)!==0||e(v)[0]!==0||e(v)[1]!==70||l!==0||!a})())}),Ae(()=>e(y),()=>{var t;s(A,((t=e(y))==null?void 0:t.length)===3)}),Ae(()=>(e(A),e(P)),()=>{s(fe,e(A)||!e(P)?[]:[...e(P).metric_names.map(t=>({value:t,label:t}))])}),Kt(),Dt();var Re=Pa();Jt("17fhl7v",t=>{var a=za();ae(t,a)});var Ue=k(Re),Ge=k(Ue),Je=k(Ge);{let t=Wt(()=>[{label:"Home",href:`${We}/`},{label:"Conflicts",href:`${We}/conflicts`},{label:e(O)||"Conflict",href:e(U)?`${We}/conflict?id=`+e(U):void 0},{label:"Bubble"}]);sa(Je,{get items(){return e(t)}})}var et=z(Je,2),wt=k(et);w(et),w(Ge);var zt=z(Ge,2);{var Nt=t=>{var a=Na(),l=k(a);Zt(),w(a),ce(()=>{var n,r;ra(a,"href",`https://politicsandwar.fandom.com/wiki/${(n=(e(P),ue(()=>e(P).wiki)))!=null?n:""}`),oe(l,`Wiki:${(r=(e(P),ue(()=>{var m;return(m=e(P))==null?void 0:m.wiki})))!=null?r:""} `)}),ae(t,a)};he(zt,t=>{e(P),ue(()=>{var a;return(a=e(P))==null?void 0:a.wiki})&&t(Nt)})}w(Ue);var tt=z(Ue,2);na(tt,{get conflictId(){return e(U)},active:"bubble"});var Oe=z(tt,2),at=k(Oe);{var Mt=t=>{ba(t)};he(at,t=>{e(Y)||t(Mt)})}var rt=z(at,2);{var Ct=t=>{var a=Ma(),l=k(a),n=k(l,!0);w(l);var r=z(l,2);w(a),ce(()=>oe(n,e(le))),$e("click",r,gt),ae(t,a)};he(rt,t=>{e(le)&&t(Ct)})}var lt=z(rt,2),qe=k(lt),$t=k(qe);vt($t,t=>s(ge,t),()=>e(ge)),w(qe);var It=z(qe,2);{var Pt=t=>{var a=$a(),l=Xt(a),n=z(k(l),2);_a(n,{onReset:bt,get resetDirty(){return e(N)}}),w(l);var r=z(l,2),m=k(r);ia(m,{multiple:!0,get items(){return e(fe)},showChevron:!0,get value(){return e(y)},set value(h){s(y,h)},$$events:{change:ht},$$slots:{empty:(h,j)=>{var F=Ca(),u=k(F,!0);w(F),ce(()=>oe(u,e(A)?"Max 3 items":"No options")),ae(h,F)}},$$legacy:!0}),w(r);var d=z(r,2),b=k(d);w(d);var g=z(d,4),_=z(k(g),2);Ke(_),_.value=_.__value="option1",w(g);var C=z(g,2),E=z(k(C),2);Ke(E),E.value=E.__value="option2",w(C);var p=z(C,2),R=z(k(p),2);Ke(R),R.value=R.__value="option3",w(p),ce(h=>{var j,F;return oe(b,`Metrics: ${h!=null?h:""} • Cities ${(j=(e(v),ue(()=>e(v)[0])))!=null?j:""}-${(F=(e(v),ue(()=>e(v)[1])))!=null?F:""}`)},[()=>(e(y),ue(()=>e(y).map(h=>h.label).join(" / ")))]),Ve(_,()=>e(K),h=>s(K,h)),$e("change",_,Te),Ve(E,()=>e(V),h=>s(V,h)),$e("change",E,Te),Ve(R,()=>e(W),h=>s(W,h)),$e("change",R,Te),ae(t,a)};he(It,t=>{e(P)&&t(Pt)})}w(lt),w(Oe);var Fe=z(Oe,2),it=k(Fe),Et=k(it);vt(Et,t=>s(q,t),()=>e(q)),w(it),w(Fe);var jt=z(Fe,2);{var St=t=>{var a=Ia(),l=k(a,!0);w(a),ce(()=>oe(l,e(Ie))),ae(t,a)};he(jt,t=>{e(Ie)&&t(St)})}w(Re),ce(()=>{var t;return oe(wt,`Conflict: ${(t=e(O))!=null?t:""}`)}),ae(T,Re),Vt()}export{Ya as component};
