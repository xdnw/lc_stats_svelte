var be=(K,V,B)=>new Promise((H,M)=>{var s=C=>{try{m(B.next(C))}catch(D){M(D)}},b=C=>{try{m(B.throw(C))}catch(D){M(D)}},m=C=>C.done?H(C.value):Promise.resolve(C.value).then(s,b);m((B=B.apply(K,V)).next())});import{a as W,f as q,s as L,e as G}from"../chunks/DLCQTpuP.js";import{i as He}from"../chunks/DT10vATe.js";import{o as ze}from"../chunks/Di_BE8QR.js";import{p as Qe,l as Ue,a as Oe,t as j,b as Ge,g as e,s as w,m as T,h as Ye,c as _,e as f,r as g,u as S,n as _e,i as Je,j as se}from"../chunks/DVbRBn6a.js";import{i as Q}from"../chunks/Bxs4rezJ.js";import{h as Ke,a as Ve,g as ge,d as ye,s as Y,b as xe,e as re,i as we,r as Xe}from"../chunks/BLlCKcKh.js";import{c as ie,s as Ze,a as ne}from"../chunks/DnCfu7FQ.js";import{B as et,g as tt,f as at,y as lt,b as U,k as oe,r as J,a as st,P as rt,S as it}from"../chunks/DqDmrPFw.js";import{P as ke,a as nt,s as Ce,c as ot,b as Pe,e as Ae,f as ct,h as $e,d as dt,t as ut}from"../chunks/BX37AVBw.js";import{g as ce,r as de}from"../chunks/C-5gSOKl.js";import{C as ft}from"../chunks/Ce5oxAg0.js";var mt=q('<a class="btn ux-btn fw-bold"> <i class="bi bi-box-arrow-up-right"></i></a>'),vt=q('<div class="alert alert-danger m-2 d-flex justify-content-between align-items-center"><span> </span> <button class="btn btn-sm btn-outline-danger fw-bold">Retry</button></div>'),pt=q("<button> </button>"),ht=q("<button> </button>"),bt=q("<button> </button>"),_t=q('<div class="d-flex justify-content-between align-items-center mb-1"><span class="fw-bold">Layout Picker:</span> <!></div> <!> <hr class="m-1"/> <div class="ux-coalition-panel ux-coalition-panel--compact ux-coalition-panel--red"> <!></div> <div class="ux-coalition-panel ux-coalition-panel--compact ux-coalition-panel--blue"> <!></div> <div class="small text-muted mt-2"> </div>',1),gt=q('<div class="small text-muted text-end mt-2"> </div>'),yt=q(`<div class="container-fluid p-2 ux-page-body"><h1 class="m-0 mb-2 p-2 ux-surface ux-page-title"><div class="ux-page-title-stack"><!> <span class="ux-page-title-main"> </span></div> <!></h1> <!> <div class="ux-surface ux-tab-panel p-2 fw-bold" style="min-height: 116px;"><!> <!> <!></div> <div class="d-flex justify-content-center align-items-center mt-1"><div class="d-flex justify-content-center align-items-center alert alert-danger text-center mb-1 py-1 text-danger">Click or hover over one of the chords and then scroll down to view
            the table.</div></div> <div class="container bg-light-subtle"><div id="my_dataviz"></div> <div class="mt-1" id="myTooltip" style="min-height:15em"></div></div> <!> <br/></div>`);function Dt(K,V){Qe(V,!1);const B=T();let H=T(""),M=T(null),s=T(null),b=T(new Set),m=T("wars"),C=T(!1),D=T(null),X=T("");ze(()=>{Ve(["header","ids"],["id"]);let l=ge();const r=l.get("id");r?(f(M,r),ue(e(M),l)):(f(D,"Missing conflict id in URL"),f(C,!0))});function ue(l,r){f(D,null),f(C,!1);let d=tt(l,ie.version.conflict_data);ye(d).then(n=>be(null,null,function*(){var R,k,$;f(s,n),f(H,n.name),f(X,at(ie.version.conflict_data,n.update_ms)),f(b,new Set([...n.coalitions[0].alliance_ids,...n.coalitions[1].alliance_ids])),f(m,ce(n));let u=r.get("header");u&&((R=e(s))!=null&&R.war_web.headers.includes(u))&&f(m,u);let p=r.get("ids");if(p){let y=p.split(".").map(o=>+o);f(b,new Set(y)),(!((k=e(s))!=null&&k.coalitions[0].alliance_ids.some(o=>e(b).has(o)))||!(($=e(s))!=null&&$.coalitions[1].alliance_ids.some(o=>e(b).has(o))))&&f(b,new Set([...n.coalitions[0].alliance_ids,...n.coalitions[1].alliance_ids]))}yield lt(),O(),f(C,!0),Y(),(typeof window.requestIdleCallback=="function"?y=>window.requestIdleCallback(y,{timeout:2500}):y=>window.setTimeout(y,300))(()=>{const y=st(l,ie.version.graph_data);ye(y).catch(()=>{})})})).catch(n=>{console.error("Failed to load chord web data",n),f(D,"Could not load conflict web data. Please try again later."),f(C,!0)})}function Se(l){f(m,l),xe("header",l),Y(),O()}function Z(l,r){e(s)&&(f(b,ut(e(b),e(s).coalitions,l,r)),xe("ids",Array.from(e(b)).join(".")),Y(),O())}function Me(){e(s)&&(f(m,ce(e(s))),f(b,new Set([...e(s).coalitions[0].alliance_ids,...e(s).coalitions[1].alliance_ids])),Xe(["header","ids"],["id"]),Y(),O())}function Re(){if(!e(M))return;const l=ge();ue(e(M),l)}function O(){Ie(e(s),e(b),e(m))}function Ie(l,r,d){let n={};l.coalitions.forEach(a=>{a.alliance_ids.forEach((i,x)=>{n[i]=U(a.alliance_names[x],i)})});let u=[],p=[],P=[...l.coalitions[0].alliance_ids,...l.coalitions[1].alliance_ids],R=P.filter(a=>r.has(a)),k=[];for(let a of l.coalitions[0].alliance_ids)u.push(ke.REDS),r.has(a)&&(p.push(n[a]),k.push(0));for(let a of l.coalitions[1].alliance_ids)u.push(ke.BLUES),r.has(a)&&(p.push(n[a]),k.push(1));let y=nt(dt,u).filter((a,i)=>r.has(P[i])),F=l.war_web.headers.indexOf(d),h=l.war_web.data[F],t=[];for(let a=0;a<P.length;a++){let i=P[a],x=h[a];if(r.has(i)){let N=x.filter((A,I)=>r.has(P[I]));t.push(N)}}t=t.map(a=>a.length===0?new Array(p.length).fill(0):a),t=t.map(a=>a.map(i=>isNaN(i)||i<0?0:i)),Le(t,p,y,R,k)}function Le(l,r,d,n,u){const p=de(e(m));Ce("#my_dataviz").selectAll("*").remove();const P=Ce("#my_dataviz").append("svg").classed("svg-content-responsive",!0).attr("preserveAspectRatio","xMinYMin meet").attr("viewBox","0 0 600 600").append("g").attr("transform","translate(300,300)").classed("rect",!0).attr("width",440).attr("height",440),R=ot().padAngle(.01).sortSubgroups(Pe).sortChords(Pe)(l);P.datum(R).append("g").classed("rect",!0).attr("width",440).attr("height",440).selectAll("g").data(t=>t.groups).join("g").append("path").style("fill",(t,a)=>d[a]).style("stroke","#222").style("stroke-width","0.25px").attr("d",Ae().innerRadius(210).outerRadius(220));let k=P.datum(R).append("g").selectAll("path").data(t=>t).join("path").attr("d",ct().radius(208)).attr("fill-opacity",.75).attr("stroke-opacity",.5).style("fill",t=>d[t.source.index]).style("stroke",t=>$e(d[t.source.index],25)).style("stroke-width","0.5px"),$=P.datum(R).append("g").selectAll("g").data(t=>t.groups).join("g");$.append("path").style("fill",(t,a)=>d[a]).style("stroke","#222").style("stroke-width","0.25px").attr("d",Ae().innerRadius(210).outerRadius(220)),$.append("text").each(t=>{t.angle=(t.startAngle+t.endAngle)/2}).attr("dy",".35em").attr("transform",t=>`
        rotate(${t.angle*180/Math.PI-90})
        translate(221)
        ${t.angle>Math.PI?"rotate(180)":""}
    `).attr("text-anchor",t=>t.angle>Math.PI?"end":null).style("font-size","9px").text((t,a)=>r[a]);let y=-1,o=-1;n.filter((t,a)=>u[a]===0).length===1?F(u.indexOf(0)):n.filter((t,a)=>u[a]===1).length===1&&F(u.indexOf(1));function F(t){let a=document.getElementById("myTooltip"),i=new Set(l[t].map((c,v)=>c!==0||l[v][t]!==0?v:-1).filter(c=>c!==-1)),x=r.filter((c,v)=>i.has(v)),N=d.filter((c,v)=>i.has(v)),A=l[t].filter((c,v)=>i.has(v)),I=l.map((c,v)=>i.has(v)?c[t]:null).filter(c=>c!==null),z=Array.from({length:A.length},(c,v)=>v);z.sort((c,v)=>A[v]-A[c]),x=z.map(c=>x[c]),N=z.map(c=>N[c]),A=z.map(c=>A[c]),I=z.map(c=>I[c]);let E=`<h5>Selected alliance: ${r[t]} (${e(m)})</h5><div class='small text-muted mb-1'>${p.directionNote(e(m))} Net = Selected value minus Compared value.</div><table class='table fw-bold w-auto'><tr><th>Compared alliance</th><th>${p.primaryToRowLabel(e(m))}</th><th>${p.rowToPrimaryLabel(e(m))}</th><th>Net</th></tr>`;x.forEach((c,v)=>{E+=`<tr><td style='background-color:${$e(N[v],50)};color:white'>${c}</td>`,E+=`<td>${oe(A[v])}</td>`,E+=`<td>${oe(I[v])}</td>`,E+=`<td>${oe(A[v]-I[v])}</td></tr>`}),E+="</table>",a.innerHTML=E}function h(){o!==y&&(o==-1?k.classed("d-none",!1):(k.filter(t=>t.source.index!==o&&t.target.index!==o).classed("d-none",!0),k.filter(t=>t.source.index===o||t.target.index===o).classed("d-none",!1),F(o)),y=o)}$.on("click",function(t,a){o=-1,y=-1,Z(u[a.index],n[a.index])}),$.on("mouseover",function(t,a){o=a.index,requestAnimationFrame(J(100,h))}).on("mouseout",function(t,a){o=-1,requestAnimationFrame(J(100,h))}).on("mouseover touchstart",function(t,a){o=a.index,requestAnimationFrame(J(100,h))}).on("mouseout touchend",function(t,a){o=-1,requestAnimationFrame(J(100,h))})}Ue(()=>(e(s),e(m),e(b)),()=>{f(B,(()=>{if(!e(s))return!1;const l=ce(e(s)),r=e(s).coalitions[0].alliance_ids.length+e(s).coalitions[1].alliance_ids.length;return e(m)!==l||e(b).size!==r})())}),Oe(),He();var ee=yt();Ke("1uauf75",l=>{});var te=_(ee),ae=_(te),fe=_(ae);{let l=Ye(()=>[{label:"Home",href:"/"},{label:"Conflicts",href:"/conflicts"},{label:e(H)||"Conflict",href:e(M)?"/conflict?id="+e(M):void 0},{label:"Chord"}]);et(fe,{get items(){return e(l)}})}var me=w(fe,2),De=_(me);g(me),g(ae);var Ne=w(ae,2);{var Te=l=>{var r=mt(),d=_(r);_e(),g(r),j(()=>{var n,u;Ze(r,"href",`https://politicsandwar.fandom.com/wiki/${(n=(e(s),S(()=>e(s).wiki)))!=null?n:""}`),L(d,`Wiki:${(u=(e(s),S(()=>{var p;return(p=e(s))==null?void 0:p.wiki})))!=null?u:""}Â `)}),W(l,r)};Q(Ne,l=>{e(s),S(()=>{var r;return(r=e(s))==null?void 0:r.wiki})&&l(Te)})}g(te);var ve=w(te,2);ft(ve,{get conflictId(){return e(M)},active:"chord"});var le=w(ve,2),pe=_(le);{var We=l=>{rt(l)};Q(pe,l=>{e(C)||l(We)})}var he=w(pe,2);{var je=l=>{var r=vt(),d=_(r),n=_(d,!0);g(d);var u=w(d,2);g(r),j(()=>L(n,e(D))),G("click",u,Re),W(l,r)};Q(he,l=>{e(D)&&l(je)})}var qe=w(he,2);{var Be=l=>{var r=_t(),d=Je(r),n=w(_(d),2);it(n,{onReset:Me,get resetDirty(){return e(B)}}),g(d);var u=w(d,2);re(u,1,()=>(e(s),S(()=>e(s).war_web.headers)),h=>h,(h,t)=>{var a=pt();let i;var x=_(a,!0);g(a),j(()=>{i=ne(a,1,"btn ux-btn btn-sm ms-1 mb-1 fw-bold",null,i,{active:e(m)===e(t)}),L(x,e(t))}),G("click",a,()=>Se(e(t))),W(h,a)});var p=w(u,4),P=_(p),R=w(P);re(R,1,()=>(e(s),S(()=>e(s).coalitions[0].alliance_ids)),we,(h,t,a)=>{var i=ht();let x;var N=_(i,!0);g(i),j((A,I)=>{x=ne(i,1,"btn ux-btn btn-sm ms-1 mb-1 fw-bold",null,x,A),L(N,I)},[()=>({active:e(b).has(e(t))}),()=>(se(U),e(s),e(t),S(()=>U(e(s).coalitions[0].alliance_names[a],e(t))))]),G("click",i,()=>Z(0,e(t))),W(h,i)}),g(p);var k=w(p,2),$=_(k),y=w($);re(y,1,()=>(e(s),S(()=>e(s).coalitions[1].alliance_ids)),we,(h,t,a)=>{var i=bt();let x;var N=_(i,!0);g(i),j((A,I)=>{x=ne(i,1,"btn ux-btn btn-sm ms-1 mb-1 fw-bold",null,x,A),L(N,I)},[()=>({active:e(b).has(e(t))}),()=>(se(U),e(s),e(t),S(()=>U(e(s).coalitions[1].alliance_names[a],e(t))))]),G("click",i,()=>Z(1,e(t))),W(h,i)}),g(k);var o=w(k,2),F=_(o);g(o),j(h=>{var t,a;L(P,`${(t=(e(s),S(()=>{var i;return(i=e(s))==null?void 0:i.coalitions[0].name})))!=null?t:""}: `),L($,`${(a=(e(s),S(()=>{var i;return(i=e(s))==null?void 0:i.coalitions[1].name})))!=null?a:""}: `),L(F,`${h!=null?h:""}
                Hover a chord to inspect one Selected alliance versus Compared alliances.
                "Net" = Selected value minus Compared value.`)},[()=>(se(de),e(m),S(()=>de(e(m)).directionNote(e(m))))]),W(l,r)};Q(qe,l=>{e(s)&&l(Be)})}g(le);var Fe=w(le,6);{var Ee=l=>{var r=gt(),d=_(r,!0);g(r),j(()=>L(d,e(X))),W(l,r)};Q(Fe,l=>{e(X)&&l(Ee)})}_e(2),g(ee),j(()=>{var l;return L(De,`Conflict: ${(l=e(H))!=null?l:""}`)}),W(K,ee),Ge()}export{Dt as component};
