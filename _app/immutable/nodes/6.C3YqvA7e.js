var lo=Object.defineProperty,co=Object.defineProperties;var uo=Object.getOwnPropertyDescriptors;var Ne=Object.getOwnPropertySymbols;var sn=Object.prototype.hasOwnProperty,ln=Object.prototype.propertyIsEnumerable;var rn=(N,g,x)=>g in N?lo(N,g,{enumerable:!0,configurable:!0,writable:!0,value:x}):N[g]=x,ga=(N,g)=>{for(var x in g||(g={}))sn.call(g,x)&&rn(N,x,g[x]);if(Ne)for(var x of Ne(g))ln.call(g,x)&&rn(N,x,g[x]);return N},ba=(N,g)=>co(N,uo(g));var cn=(N,g)=>{var x={};for(var I in N)sn.call(N,I)&&g.indexOf(I)<0&&(x[I]=N[I]);if(N!=null&&Ne)for(var I of Ne(N))g.indexOf(I)<0&&ln.call(N,I)&&(x[I]=N[I]);return x};import{e as U,a as y,t as C,s as T,h as mo,b as vo,c as Ft}from"../chunks/disclose-version.BGVnXwSC.js";import{i as bn}from"../chunks/legacy.C5xHvBl9.js";import{p as hn,b as yn,c as d,s as v,d as c,r as s,g as t,t as h,m as O,l as Z,a as fo,f as z,$ as _o,j as X,h as V,n as ha,i as Wt}from"../chunks/runtime.Bz3ZCnid.js";import{c as po,o as In,i as L}from"../chunks/index-client.Q1qAUnCw.js";import{f as Se,e as Ot,i as wt,a as go,g as bo,s as ee,h as ho,j as xe,d as yo,r as Io}from"../chunks/binary.C_HE3RDK.js";import{r as Nn,c as dn,s as ie}from"../chunks/_layout.C340yC5l.js";import{v as ya,a as ne,S as No,s as se,f as xo,d as So,E as Ao,w as un,k as mn,t as ko,P as Co,p as Oo,q as vn}from"../chunks/Progress.KQ1k3Mu0.js";import{b as xn}from"../chunks/misc.BJslMcuk.js";import{b as zt,m as wo,r as fn,s as To,c as $o,p as Lo,d as Ro,a as _n,e as le,f as Eo,h as Ko}from"../chunks/kpi.eIc13vkQ.js";import{p as Ut,s as ae}from"../chunks/event-modifiers.BCjtW8R-.js";import{b as Do}from"../chunks/misc.yyZM2rSV.js";import{C as Po}from"../chunks/ConflictRouteTabs.C9YpKmne.js";import{a as Mo,s as Fo}from"../chunks/containerSetup.Ci6TewMh.js";import{t as Sn}from"../chunks/warWeb.da6xX1jT.js";import{p as ce}from"../chunks/props.CYdPwHoV.js";function qt(N,g,x,I,dt){let jt=N.coalitions,Bt=N.damage_header,tt=N.header_type,et=[],D=[],at=[],j=[],ot={},R=null;switch(g){case 0:R=null;break;case 1:R=null;break;case 2:R=null;break}D.push("name");for(let A=0;A<Bt.length;A++){let m=Sn(Bt[A]),it=tt[A];it==0?(D.push(`loss:${m}`),D.push(`dealt:${m.replace("_loss","").replace("loss_","")}`),D.push(`net:${m.replace("_loss","").replace("loss_","")}`)):it==1&&(D.push(`def:${m}`),D.push(`off:${m}`),D.push(`both:${m}`))}at.push(0),g===0?ot.formatCol=[0]:g===1?ot.formatAA=[0]:g===2&&(ot.formatNation=[0]);let G=[Math.max(0,D.indexOf(I)),dt];ot.formatNumber=[],ot.formatMoney=[];for(let A=0;A<D.length;A++)x.includes(D[A])&&j.push(A),A>0&&(D[A].includes("~")||D[A].includes("damage")||D[A].includes("infra")&&!D[A].includes("attacks")?ot.formatMoney.push(A):ot.formatNumber.push(A));let rt=(A,m,it)=>{for(let E=0;E<m.length;E++){let r=m[E],Q=it[E],gt=tt[E],Y;gt==0?Y=Q-r:Y=Q+r,A.push(r),A.push(Q),A.push(Y)}},ut=(A,m)=>{let it=A.alliance_ids,E=A.alliance_names,r=A.nation_ids,Q=A.nation_names,gt=A.nation_aa,Y=A.damage;switch(g){case 0:let Xt=[m];rt(Xt,Y[0],Y[1]),et.push(Xt);break;case 1:let bt=2;for(let F=0;F<it.length;F++){let k=[],It=it[F],Zt=ne(E[F],It);k.push([Zt,It]),rt(k,Y[F*2+bt],Y[F*2+bt+1]),et.push(k)}break;case 2:let $t=2+it.length*2;for(let F=0;F<r.length;F++){let k=[],It=r[F],Zt=ya(Q[F],It),de=gt[F];k.push([Zt,It,de]),rt(k,Y[F*2+$t],Y[F*2+$t+1]),et.push(k)}break}};for(let A=0;A<jt.length;A++){let m=jt[A];ut(m,A)}return{columns:D,data:et,visible:j,searchable:at,cell_format:ot,row_format:R,sort:G}}var Wo=Object.defineProperty,zo=Object.defineProperties,Uo=Object.getOwnPropertyDescriptors,pn=Object.getOwnPropertySymbols,jo=Object.prototype.hasOwnProperty,Bo=Object.prototype.propertyIsEnumerable,gn=(N,g,x)=>g in N?Wo(N,g,{enumerable:!0,configurable:!0,writable:!0,value:x}):N[g]=x,Vo=(N,g)=>{for(var x in g||(g={}))jo.call(g,x)&&gn(N,x,g[x]);if(pn)for(var x of pn(g))Bo.call(g,x)&&gn(N,x,g[x]);return N},Go=(N,g)=>zo(N,Uo(g));function Ia(N){const g=`${Se()}:presets`;try{const x=localStorage.getItem(g);if(!x)return{};const I=JSON.parse(x);return!I||typeof I!="object"?{}:I}catch(x){return console.warn("Failed to read column presets",x),{}}}function Qo(N,g,x){const I=`${Se()}:presets`;try{const dt=Ia(x);dt[N]=Go(Vo({},g),{createdAt:Date.now()}),localStorage.setItem(I,JSON.stringify(dt))}catch(dt){console.warn("Failed to save column preset",dt)}}function Ho(N,g){const x=`${Se()}:presets`;try{const I=Ia(g);Object.prototype.hasOwnProperty.call(I,N)&&(delete I[N],localStorage.setItem(x,JSON.stringify(I)))}catch(I){console.warn("Failed to delete column preset",I)}}var Yo=C('<div class="small text-muted px-2">No saved layouts</div>'),Jo=C('<div class="preset-item px-2 py-1 small svelte-1040e6o"><div class="text-truncate" style="max-width:140px"> </div> <div><button class="btn ux-btn btn-sm me-1">Load</button> <button class="btn btn-sm btn-outline-danger">Delete</button></div></div>'),qo=C('<div class="dropdown d-inline"><button class="btn ux-btn btn-sm" type="button" id="cpDropdown" data-bs-toggle="dropdown" aria-expanded="false">My layouts&nbsp;<i class="bi bi-chevron-down"></i></button> <div class="dropdown-menu p-2" aria-labelledby="cpDropdown" style="min-width:260px;"><div class="input-group input-group-sm mb-2"><input class="form-control form-control-sm" placeholder="Save current as..."> <button class="btn ux-btn btn-sm">Save</button></div> <hr class="dropdown-divider"> <div class="preset-list svelte-1040e6o"><!> <!></div></div></div>');function Xo(N,g){hn(g,!1);let x=ce(g,"currentColumns",24,()=>[]),I=ce(g,"currentSort",8,""),dt=ce(g,"currentOrder",8,"desc"),jt=ce(g,"currentKpis",24,()=>[]),Bt=ce(g,"currentKpiConfig",8,null);const tt=po();let et=O({}),D=O("");function at(){v(et,Ia())}In(at);function j(){const r=(t(D)||"").trim();if(!r){tt("error",{message:"Name required"});return}t(et)[r]&&!confirm(`Overwrite layout "${r}"?`)||(Qo(r,{columns:x(),sort:I(),order:dt(),kpis:jt(),kpiConfig:Bt()}),v(D,""),at(),tt("saved",{name:r}))}function ot(r){const Q=t(et)[r];Q&&tt("load",{name:r,preset:Q})}function R(r){confirm(`Delete layout "${r}"?`)&&(Ho(r),at(),tt("deleted",{name:r}))}bn();var Tt=qo(),G=d(c(Tt),2),rt=c(G),ut=c(rt);Nn(ut);var A=d(ut,2);s(rt);var m=d(rt,4),it=c(m);L(it,()=>Object.keys(t(et)).length===0,r=>{var Q=Yo();y(r,Q)});var E=d(it,2);Ot(E,1,()=>Object.keys(t(et)),wt,(r,Q)=>{var gt=Jo(),Y=c(gt),Xt=c(Y,!0);s(Y);var bt=d(Y,2),$t=c(bt),F=d($t,2);s(bt),s(gt),h(()=>T(Xt,t(Q))),U("click",$t,()=>ot(t(Q))),U("click",F,()=>R(t(Q))),y(r,gt)}),s(m),s(G),s(Tt),xn(ut,()=>t(D),r=>v(D,r)),U("click",A,j),y(N,Tt),yn()}var Zo=vo('<script id="visjs" async src="https://cdnjs.cloudflare.com/ajax/libs/vis-timeline/7.7.3/vis-timeline-graph2d.min.js"><\/script><!---->',1),tr=C('<a class="btn ux-btn fw-bold"> <i class="bi bi-box-arrow-up-right"></i></a>'),er=C("<li><button> </button></li>"),ar=C('<li><button class="btn ux-btn btn-sm">Show KPI</button></li>'),nr=C('<div class="small text-muted mb-2">No cards</div>'),or=C('<div class="d-flex align-items-center justify-content-between gap-2 mb-1"><span class="small text-truncate"> </span> <div class="d-flex gap-1"><button type="button" class="btn btn-sm btn-outline-secondary">↑</button> <button type="button" class="btn btn-sm btn-outline-secondary">↓</button> <button type="button" class="btn btn-sm btn-outline-danger">Remove</button></div></div>'),rr=C('<button type="button" class="btn btn-sm btn-outline-secondary"> </button>'),ir=C("<option> </option>"),sr=C("<option> </option>"),lr=C("<option> </option>"),cr=C('<a class="btn btn-sm btn-outline-secondary w-100 mt-1">Add AAvA widgets from the AAvA page</a>'),dr=C('<div class="small text-muted">Duration</div> <div class="h6 m-0"> </div>',1),ur=C('<div class="small text-muted">Wars tracked</div> <div class="h6 m-0"> </div>',1),mr=C('<div class="small text-muted">Total damage exchanged</div> <div class="h6 m-0"> </div>',1),vr=C('<div class="small text-muted"> </div>'),fr=C('<div class="small text-muted">Damage gap</div> <div class="h6 m-0"> </div> <!>',1),_r=C('<div class="small text-muted"> </div> <div class="h6 m-0"> </div>',1),pr=C('<div class="small text-muted"> </div> <div class="h6 m-0"> </div>',1),gr=C('<div class="small text-muted"> </div>'),br=C('<div class="small text-muted">Offensive wars per nation</div> <div class="h6 m-0"> </div> <!>',1),hr=C("<th>Alliance</th>"),yr=C("<a> </a>"),Ir=C("<a> </a>"),Nr=C("<td><a> </a></td>"),xr=C('<tr><td></td><td><!></td><!><td class="text-end"> </td></tr>'),Sr=C('<div class="small text-muted mb-1"> </div> <div class="table-responsive"><table class="table table-sm table-striped m-0"><thead><tr><th>#</th><th> </th><!><th class="text-end">Value</th></tr></thead><tbody></tbody></table></div>',1),Ar=C('<div class="small text-muted"> </div> <div class="h6 m-0"> </div>',1),kr=C('<div><div class="ux-surface p-3 rounded border h-100 position-relative kpi-card" role="group" draggable="true"><button type="button" class="btn-close kpi-card-close" aria-label="Remove KPI card"></button> <!></div></div>'),Cr=C('<div class="ux-surface p-2 mb-3 rounded border"><div class="d-flex align-items-center justify-content-between mb-2"><h5 class="m-0">KPI</h5> <button type="button" class="btn-close" aria-label="Hide KPI"></button></div> <div class="row g-2"></div></div>'),Or=C('<div class="alert alert-danger m-2 d-flex justify-content-between align-items-center"><span> </span> <button class="btn btn-sm btn-outline-danger fw-bold">Retry</button></div>'),wr=C('<div class="col-md-6 col-sm-12"><div class="col-md-12 ms-2 p-2 rounded border ux-surface"><h3>Casus Belli</h3> <pre> </pre></div></div>'),Tr=C('<div class="col-md-6 col-sm-12"><div class="col-md-12 ms-2 p-2 rounded border ux-surface"><h3>Status</h3> <pre> </pre></div></div>'),$r=C('<hr> <div class="row m-0"><!> <!></div>',1),Lr=C('<div class="small text-muted text-end mt-2"> </div>'),Rr=C('<div class="container-fluid p-2 ux-page-body"><h1 class="m-0 mb-2 p-2 ux-surface ux-page-title"><a href="conflicts" aria-label="Back to conflicts"><i class="bi bi-arrow-left"></i></a> <!></h1> <!> <ul class="layout-picker-bar ux-floating-controls nav fw-bold nav-pills m-0 p-2 ux-surface mb-3 d-flex flex-wrap gap-1"><li class="me-1">Layout Picker:</li> <!> <li><!></li> <!> <li class="dropdown ms-auto" data-bs-auto-close="outside"><button class="btn ux-btn btn-sm" type="button" id="kpiManagerDropdown" data-bs-toggle="dropdown" aria-expanded="false">KPI widgets&nbsp;<i class="bi bi-chevron-down"></i></button> <div class="dropdown-menu p-2" aria-labelledby="kpiManagerDropdown" style="min-width: 340px;"><div class="small text-muted mb-1">KPI cards</div> <!> <!> <hr class="dropdown-divider"> <div class="small text-muted mb-1">Preset cards</div> <div class="d-flex flex-wrap gap-1 mb-2"></div> <hr class="dropdown-divider"> <div class="small text-muted mb-1">Ranking cards</div> <div class="row g-1 mb-2"><div class="col-4"><select class="form-select form-select-sm"><option>Alliance</option><option>Nation</option></select></div> <div class="col-4"><select class="form-select form-select-sm"><option>All</option><option>Coalition 1</option><option>Coalition 2</option><option> </option></select></div> <div class="col-4"><input class="form-control form-control-sm" type="number" min="1"></div> <div class="col-12"><select class="form-select form-select-sm"></select></div> <div class="col-12"><button type="button" class="btn btn-sm btn-outline-secondary w-100">+ Add ranking card</button></div></div> <hr class="dropdown-divider"> <div class="small text-muted mb-1">Metric cards</div> <div class="row g-1"><div class="col-4"><select class="form-select form-select-sm"><option>Alliance</option><option>Nation</option></select></div> <div class="col-4"><select class="form-select form-select-sm"><option>All</option><option>Coalition 1</option><option>Coalition 2</option><option> </option></select></div> <div class="col-4"><select class="form-select form-select-sm"><option>Sum</option><option>Avg</option></select></div> <div class="col-12"><select class="form-select form-select-sm"></select></div> <div class="col-12"><select class="form-select form-select-sm"><option>No normalization</option><!></select></div> <div class="col-12"><button type="button" class="btn btn-sm btn-outline-secondary w-100">+ Add metric card</button></div></div> <hr class="dropdown-divider"> <!></div></li> <li class="d-flex flex-wrap gap-1 justify-content-end"><!></li></ul> <!> <!> <!> <div id="conflict-table-1"></div> <!> <hr> <div class="ux-surface p-2"><h4> </h4> <div class="m-0" id="visualization"></div></div> <!></div>');function Jr(N,g){hn(g,!1);const x=O(),I=O(),dt=O(),jt=O(),Bt=O(),tt=O(),et=O(),D=O(),at=O(),j=O(),ot=O(),R={COALITION:0,ALLIANCE:1,NATION:2};let Tt=O(""),G=O(null),rt=O(!1),ut=O(null),A=O(""),m=O(null),it=["GROUND_TANKS_MUNITIONS_USED_UNNECESSARY","DOUBLE_FORTIFY","GROUND_NO_TANKS_MUNITIONS_USED_UNNECESSARY","GROUND_NO_TANKS_MUNITIONS_USED_UNNECESSARY_INACTIVE","GROUND_TANKS_NO_LOOT_NO_ENEMY_AIR_INACTIVE","GROUND_TANKS_NO_LOOT_NO_ENEMY_AIR","AIRSTRIKE_SOLDIERS_NONE","AIRSTRIKE_SOLDIERS_SHOULD_USE_GROUND","AIRSTRIKE_TANKS_NONE","AIRSTRIKE_SHIP_NONE","AIRSTRIKE_INACTIVE_NO_GROUND","AIRSTRIKE_INACTIVE_NO_SHIP","AIRSTRIKE_FAILED_NOT_DOGFIGHT","AIRSTRIKE_AIRCRAFT_NONE","AIRSTRIKE_AIRCRAFT_NONE_INACTIVE","AIRSTRIKE_AIRCRAFT_LOW","AIRSTRIKE_INFRA","AIRSTRIKE_MONEY","NAVAL_MAX_VS_NONE"].map(e=>`off:${e.toLowerCase().replaceAll("_"," ")} attacks`),E={Summary:{sort:"off:wars",columns:["name","net:damage","off:wars","def:wars","dealt:damage","loss:damage"]},Dealt:{sort:"dealt:damage",columns:["name","dealt:infra","dealt:~$soldier","dealt:~$tank","dealt:~$aircraft","dealt:~$ship","dealt:~$unit","dealt:~$consume","dealt:~$loot","dealt:damage"]},Received:{sort:"loss:damage",columns:["name","loss:infra","loss:~$soldier","loss:~$tank","loss:~$aircraft","loss:~$ship","loss:~$unit","loss:~$consume","loss:~$loot","loss:damage"]},Units:{sort:"dealt:~$unit",columns:["name","dealt:soldier","dealt:tank","dealt:aircraft","dealt:ship","dealt:~$unit","loss:soldier","loss:tank","loss:aircraft","loss:ship","loss:~$unit","net:~$unit"]},Consumption:{sort:"name",columns:["name","loss:~$building","loss:gasoline","loss:munitions","loss:steel","loss:aluminum","loss:consume gas","loss:consume mun"]},Attacks:{sort:"off:attacks",columns:["name","off:attacks",...it]}},r=O({layout:R.COALITION,columns:E.Summary.columns,sort:E.Summary.sort,order:"desc"}),Q;const gt=()=>Oo(),Y=[{id:"preset-duration",kind:"preset",key:"duration"},{id:"preset-total-dmg",kind:"preset",key:"damage-total"},{id:"preset-net-gap",kind:"preset",key:"net-gap"},{id:"preset-off-wars-per-nation",kind:"preset",key:"off-wars-per-nation"}],Xt=[{id:"rank-alliance-net",kind:"ranking",entity:"alliance",metric:"net:damage",scope:"all",limit:8},{id:"rank-nation-net",kind:"ranking",entity:"nation",metric:"net:damage",scope:"all",limit:10}],bt={duration:"Duration",wars:"Wars tracked","damage-total":"Total damage exchanged","net-gap":"Damage gap","c1-dealt":"Coalition 1 dealt","c2-dealt":"Coalition 2 dealt","off-wars-per-nation":"Offensive wars per nation"},$t={all:"All",coalition1:"Coalition 1",coalition2:"Coalition 2",selection:"Selection snapshot"},F=[...Y,...Xt];let k=O([...F]),It=O([]),Zt=O([]),de=O([]),Nt=O(null),Lt=O(!1),Ae=new Set,ke=new Set,oe=O("No selection"),ue=O("nation"),Vt=O("net:damage"),Rt=O("all"),Ce=O(10),me=O("nation"),Gt=O("net:damage"),Et=O("all"),ve=O("sum"),fe=O("");const Oe=()=>`${Se()}:kpi-collapsed`;function Kt(e){return e==null||isNaN(e)?"N/A":e.toLocaleString()}function Qt(e){return wo(e)}function Ht(){if(!t(G))return;const e=fn(t(G));e.widgets=t(k),To(t(G),e)}function Na(e){if(!e||typeof e!="object"||!Array.isArray(e.widgets))return;const a=e.widgets.map(n=>$o(n,Qt)).filter(n=>n!==null);a.length>0&&v(k,a)}function An(){try{if(!t(G))return;const e=fn(t(G));Array.isArray(e.widgets)&&e.widgets.length>0&&Na({widgets:e.widgets})}catch(e){console.warn("Failed to read KPI config",e)}}function xa(e){v(k,t(k).filter(a=>a.id!==e)),Ht()}function Sa(e,a){v(k,Eo(t(k),e,a)),Ht()}function kn(e,a){v(k,Ko(t(k),e,a)),Ht()}function Cn(e){v(Nt,e)}function On(){v(Nt,null)}function wn(e){if(!t(Nt)||t(Nt)===e){v(Nt,null);return}const a=t(k).findIndex(n=>n.id===e);if(a===-1){v(Nt,null);return}kn(t(Nt),a),v(Nt,null)}function we(){const e=Array.from(Ae),a=Array.from(ke),n=[];return e.length>0&&n.push(`${e.length} alliance${e.length===1?"":"s"}`),a.length>0&&n.push(`${a.length} nation${a.length===1?"":"s"}`),{allianceIds:e,nationIds:a,label:n.length>0?n.join(" · "):"No selection"}}function Tn(e,a){return e!=="selection"?$t[e]:a!=null&&a.label?`Selection (${a.label})`:$t.selection}function _e(e){return e!=="selection"?!0:Ae.size>0||ke.size>0}function Aa(e){return t(k).some(a=>a.kind==="preset"&&a.key===e)}function ka(e,a){var u,l,f;const n=new Set,i=new Set;if(e===R.ALLIANCE)for(const p of a){const _=Number((u=p==null?void 0:p[0])==null?void 0:u[1]);Number.isFinite(_)&&n.add(_)}else if(e===R.NATION)for(const p of a){const _=Number((l=p==null?void 0:p[0])==null?void 0:l[1]),b=Number((f=p==null?void 0:p[0])==null?void 0:f[2]);Number.isFinite(_)&&i.add(_),Number.isFinite(b)&&n.add(b)}else if(t(m)&&e===R.COALITION)for(const p of a){const _=Number(p==null?void 0:p[0]);if(!Number.isFinite(_))continue;const b=t(m).coalitions[_];if(b){for(const S of b.alliance_ids)n.add(S);for(const S of b.nation_ids)i.add(S)}}Ae=n,ke=i;const o=we();v(oe,o.label)}function Te(e){v(k,[...t(k),e]),Ht()}function $n(e){Aa(e)||Te({id:Qt("preset"),kind:"preset",key:e})}function Ln(){const e=t(Rt)==="selection"?we():void 0;t(Rt)==="selection"&&!_e(t(Rt))||Te({id:Qt("ranking"),kind:"ranking",entity:t(ue),metric:t(Vt),scope:t(Rt),limit:Math.max(1,t(Ce)),snapshot:e})}function Rn(){const e=t(Et)==="selection"?we():void 0;t(Et)==="selection"&&!_e(t(Et))||Te({id:Qt("metric"),kind:"metric",entity:t(me),metric:t(Gt),scope:t(Et),aggregation:t(ve),source:"conflict",normalizeBy:t(fe)||null,snapshot:e})}function En(){v(Lt,!t(Lt)),localStorage.setItem(Oe(),t(Lt)?"1":"0")}function Kn(){t(Lt)&&(v(Lt,!1),localStorage.setItem(Oe(),"0"))}function Ca(e){return e==="alliance"?t(D):t(at)}function $e(e,a){return Number(e==null?void 0:e[a])||0}function Oa(e,a,n,i=!1){var f,p;if(i&&a===-1)return Number.isFinite(n)?Math.abs(n)<=100&&`${n}`.includes(".")?n.toLocaleString(void 0,{maximumFractionDigits:2}):n.toLocaleString():"0";const u=((p=(f=e==null?void 0:e.cell_format)==null?void 0:f.formatMoney)!=null?p:[]).includes(a),l=Number(n||0).toLocaleString(void 0,{maximumFractionDigits:2});return u?`$${l}`:l}function wa(e,a,n,i){var u,l,f,p,_,b;if(a==="all")return n.data;if(a==="selection"){const S=new Set((u=i==null?void 0:i.allianceIds)!=null?u:[]),w=new Set((l=i==null?void 0:i.nationIds)!=null?l:[]);return e==="alliance"?S.size===0?[]:n.data.filter(P=>{var B;const J=Number((B=P[0])==null?void 0:B[1]);return S.has(J)}):w.size>0?n.data.filter(P=>{var B;const J=Number((B=P[0])==null?void 0:B[1]);return w.has(J)}):S.size>0?n.data.filter(P=>{var B;const J=Number((B=P[0])==null?void 0:B[2]);return S.has(J)}):[]}if(!t(m))return n.data;const o=a==="coalition1"?new Set((p=(f=t(m).coalitions[0])==null?void 0:f.alliance_ids)!=null?p:[]):new Set((b=(_=t(m).coalitions[1])==null?void 0:_.alliance_ids)!=null?b:[]);return n.data.filter(S=>{var P,J;if(e==="alliance"){const B=Number((P=S[0])==null?void 0:P[1]);return o.has(B)}const w=Number((J=S[0])==null?void 0:J[2]);return o.has(w)})}function Dn(e){if(e.source==="aava")return!e.aavaSnapshot||e.entity!=="alliance"?[]:t(m)?_n(t(m),{header:e.aavaSnapshot.header,primaryIds:e.aavaSnapshot.primaryIds,vsIds:e.aavaSnapshot.vsIds}).map(o=>({label:o.alliance[0],allianceId:o.alliance[1],value:$e(o,e.metric)})).sort((o,u)=>u.value-o.value).map(o=>ba(ga({},o),{valueText:Oa(null,-1,o.value,!0)})).slice(0,Math.max(1,e.limit)):[];const a=Ca(e.entity);if(!a)return[];const n=a.columns.indexOf(e.metric);return n===-1?[]:wa(e.entity,e.scope,a,e.snapshot).map(o=>{var f,p,_,b,S;if(e.entity==="alliance"){const w=Number((f=o[0])==null?void 0:f[1]);return{label:ne((p=o[0])==null?void 0:p[0],w),allianceId:w,value:Number(o[n])||0}}const u=Number((_=o[0])==null?void 0:_[1]),l=Number((b=o[0])==null?void 0:b[2]);return{label:ya((S=o[0])==null?void 0:S[0],u),nationId:u,allianceName:ne(Re[l],l),allianceId:l,value:Number(o[n])||0}}).sort((o,u)=>u.value-o.value).map(o=>ba(ga({},o),{valueText:Oa(a,n,o.value)})).slice(0,Math.max(1,e.limit))}function Pn(e){if(e.source==="aava"){if(!e.aavaSnapshot||e.entity!=="alliance"||!t(m))return null;const l=_n(t(m),{header:e.aavaSnapshot.header,primaryIds:e.aavaSnapshot.primaryIds,vsIds:e.aavaSnapshot.vsIds}),f=l.map(_=>$e(_,e.metric));if(f.length===0)return null;if(e.normalizeBy){const _=l.map(S=>$e(S,e.normalizeBy));if(e.aggregation==="sum"){const S=f.reduce((P,J)=>P+J,0),w=_.reduce((P,J)=>P+J,0);return w===0?null:S/w}const b=f.map((S,w)=>{const P=_[w];return P===0?null:S/P}).filter(S=>S!=null);return b.length===0?null:b.reduce((S,w)=>S+w,0)/b.length}const p=f.reduce((_,b)=>_+b,0);return e.aggregation==="avg"?p/f.length:p}const a=Ca(e.entity);if(!a)return null;const n=a.columns.indexOf(e.metric);if(n===-1)return null;const i=wa(e.entity,e.scope,a,e.snapshot),o=i.map(l=>Number(l[n])||0);if(o.length===0)return null;if(e.normalizeBy){const l=a.columns.indexOf(e.normalizeBy);if(l===-1)return null;const f=i.map(_=>Number(_[l])||0);if(e.aggregation==="sum"){const _=o.reduce((S,w)=>S+w,0),b=f.reduce((S,w)=>S+w,0);return b===0?null:_/b}const p=o.map((_,b)=>{const S=f[b];return S===0?null:_/S}).filter(_=>_!=null);return p.length===0?null:p.reduce((_,b)=>_+b,0)/p.length}const u=o.reduce((l,f)=>l+f,0);return e.aggregation==="avg"?u/o.length:u}function Dt(e){return Sn(e)}function Ta(e){var a,n;if(e.source==="aava"){const i=(n=(a=e.aavaSnapshot)==null?void 0:a.header)!=null?n:"wars";return le(e.metric,i)}return Dt(e.metric)}function $a(e){var a,n;if(!e.normalizeBy)return null;if(e.source==="aava"){const i=(n=(a=e.aavaSnapshot)==null?void 0:a.header)!=null?n:"wars";return le(e.normalizeBy,i)}return Dt(e.normalizeBy)}function pe(e){var a,n;if((e.kind==="ranking"||e.kind==="metric")&&e.source==="aava"){const i=((a=e.aavaSnapshot)==null?void 0:a.label)||"AAvA snapshot",o=((n=e.aavaSnapshot)==null?void 0:n.header)||"wars";return`AAvA (${i} · ${o})`}return e.kind==="preset"?"Preset":Tn(e.scope,e.snapshot)}function Mn(e){if(e.kind==="preset")return bt[e.key];if(e.kind==="ranking")return`${e.entity} · ${Ta(e)} · ${pe(e)} · top ${e.limit}`;const a=$a(e)?` per ${$a(e)}`:"";return`${e.aggregation.toUpperCase()} ${e.entity} · ${Ta(e)}${a} · ${pe(e)}`}function Fn(e,a,n,i,o){v(Tt,e.name);const u=qt(e,a,n,i,o);let l=e.coalitions,f=new Set(l[0].alliance_ids),p=new Set(l[1].alliance_ids);a===R.COALITION?u.row_format=(b,S)=>{let w=S[0];w==0?b.classList.add("bg-danger-subtle"):w==1&&b.classList.add("bg-info-subtle")}:a===R.ALLIANCE?u.row_format=(b,S)=>{let w=S[0][1];f.has(w)?b.classList.add("bg-danger-subtle"):p.has(w)&&b.classList.add("bg-info-subtle")}:a===R.NATION&&(u.row_format=(b,S)=>{let w=S[0][2];f.has(w)?b.classList.add("bg-danger-subtle"):p.has(w)&&b.classList.add("bg-info-subtle")}),u.onSelectionChange=b=>{ka(a,b.selectedRows)},ka(a,[]),Q=u;const _=document.getElementById("conflict-table-1");Fo(_,Q)}function Wn(e){let a=e.get("layout");a&&(a==="coalition"?X(r,t(r).layout=R.COALITION):a==="alliance"||a==="1"?X(r,t(r).layout=R.ALLIANCE):(a==="nation"||a==="2")&&X(r,t(r).layout=R.NATION));let n=e.get("sort");n&&X(r,t(r).sort=n);let i=e.get("order");i&&X(r,t(r).order=i);let o=e.get("columns");o&&X(r,t(r).columns=o.split("."));const u=ho("kpiw",e.get("kpiw"));if(u)try{const l=Lo(u,Qt);l.length>0&&v(k,l)}catch(l){console.warn("Failed to parse KPI widgets from URL",l)}}function re(){t(m)&&Fn(t(m),t(r).layout,t(r).columns,t(r).sort,t(r).order)}function Le(e=t(k)){return Ro(e,Qt)}function ge(){return{layout:R.COALITION,sort:E.Summary.sort,order:"desc",columns:E.Summary.columns.join("."),kpiw:Le(F)}}function zn(){const e=Le();xe({layout:t(r).layout,sort:t(r).sort,order:t(r).order,columns:t(r).columns.join("."),kpiw:e},{replace:!0,defaults:ge()}),ee()}function La(e=!1){xe({layout:t(r).layout,sort:t(r).sort,order:t(r).order,columns:t(r).columns.join(".")},{replace:e,defaults:ge()})}function Un(e=!0){const a=Le();xe({layout:t(r).layout,sort:t(r).sort,order:t(r).order,columns:t(r).columns.join("."),kpiw:a},{replace:e,defaults:ge()})}function Ra(e){return e.map(a=>{const o=a,{id:n}=o;return cn(o,["id"])})}function Ea(e){v(ut,null),v(rt,!1);let a=`https://locutus.s3.ap-southeast-2.amazonaws.com/conflicts/${e}.gzip?${dn.version.conflict_data}`;yo(a).then(n=>{v(m,n),v(A,xo(dn.version.conflict_data,n.update_ms)),Ka(n.coalitions[0].alliance_ids,n.coalitions[0].alliance_names),Ka(n.coalitions[1].alliance_ids,n.coalitions[1].alliance_names),re(),n.posts&&Object.keys(n.posts).length&&Gn(n.posts),v(rt,!0),ee()}).catch(n=>{console.error("Failed to load conflict data",n),v(ut,"Could not load conflict data. Please try again later."),v(rt,!0)})}let Re={};function Ka(e,a){for(let n=0;n<e.length;(n+=1)-1)Re[e[n]]=ne(a[n],e[n])}In(()=>{go(["layout","sort","order","columns","kpiw"],["id"]),Mo(),se("getIds",(n,i)=>{var o;return(o=t(m))==null?void 0:o.coalitions[i]}),se("formatNation",n=>{let i=n[2],o=ne(Re[i],i),u=ya(n[0],n[1]);return'<a href="https://politicsandwar.com/alliance/id='+n[2]+'">'+o+'</a> | <a href="https://politicsandwar.com/nation/id='+n[1]+'">'+u+"</a>"}),se("formatAA",n=>{let i=n[1],o=ne(n[0],i);return'<a href="https://politicsandwar.com/alliance/id='+i+'">'+o+"</a>"}),se("formatCol",n=>{let i=n,o=document.createElement("button");return t(m)?(o.setAttribute("type","button"),o.setAttribute("class","ms-1 btn ux-btn btn-sm fw-bold"),o.setAttribute("onclick",`showNames('${t(m).coalitions[i].name}',${i})`),o.textContent=t(m).coalitions[i].name,o.outerHTML):""}),se("download",function(i,o){So(document.getElementById("conflict-table-1").querySelector("table"),i,Ao[o])});const e=bo();Wn(e),v(Lt,localStorage.getItem(Oe())==="1");const a=e.get("id");a?(v(G,a),An(),Ea(t(G))):(v(ut,"Missing conflict id in URL"),v(rt,!0))});function jn(e){X(r,t(r).layout=e),xe({layout:t(r).layout,sort:null,columns:null},{defaults:ge()}),ee(),re()}function Bn(){X(r,t(r).layout=R.COALITION),X(r,t(r).columns=E.Summary.columns),X(r,t(r).sort=E.Summary.sort),X(r,t(r).order="desc"),v(k,[...F]),Ht(),Io(["layout","sort","order","columns","kpiw"],["id"]),Un(!0),ee(),re()}function Vn(){t(G)&&Ea(t(G))}let Da=!1,be=null;function Pa(){const e=document.getElementById("visjs");if(Da&&be&&(e&&e.getAttribute("data-loaded")||typeof gt()!="undefined")){if(!t(m))return;const a=document.getElementById("visualization");if(!a)return;a.hasChildNodes()&&(a.innerHTML="");const n=gt(),i=new n.DataSet;for(const p in be){const _=be[p],b=_[0],S=`https://forum.politicsandwar.com/index.php?/topic/${b}-${_[1]}`,w=_[2],P=new Date(w);i.add({id:b,content:`<a href="${S}" target="_blank">${p}</a>`,start:P})}const o=t(m).start;let u=t(m).end;u===-1&&(u=Date.now());const l={start:o,end:u,height:"75vh",width:"100%",zoomKey:"ctrlKey",orientation:"top",verticalScroll:!0},f=new n.Timeline(a,i,l);f.addCustomTime(o,"t1"),f.addCustomTime(u,"t2")}}function Gn(e){be=e,Da=!0,Pa()}function Qn(e){e.target.setAttribute("data-loaded","true"),Pa()}Z(()=>t(k),()=>{v(It,t(k).filter(e=>e.kind==="preset"))}),Z(()=>t(k),()=>{v(Zt,t(k).filter(e=>e.kind==="ranking"))}),Z(()=>t(k),()=>{v(de,t(k).filter(e=>e.kind==="metric"))}),Z(()=>(t(m),un),()=>{v(x,(()=>{if(!t(m))return"N/A";const e=t(m).start,a=t(m).end===-1?Date.now():t(m).end;return e?un(Math.max(0,Math.round((a-e)/1e3))):"N/A"})())}),Z(()=>(t(m),qt),()=>{v(I,(()=>{if(!t(m))return null;const e=t(m),a=qt(e,R.COALITION,E.Summary.columns,"name","asc"),n=a.columns.indexOf("dealt:damage"),i=a.columns.indexOf("loss:damage"),o=a.columns.indexOf("net:damage"),u=a.columns.indexOf("off:wars"),l=a.columns.indexOf("def:wars");return n===-1||i===-1||o===-1||u===-1||l===-1?null:a.data.slice(0,2).map((f,p)=>{var _,b;return{idx:p,name:(b=(_=e.coalitions[p])==null?void 0:_.name)!=null?b:`Coalition ${p+1}`,dealt:Number(f[n])||0,received:Number(f[i])||0,net:Number(f[o])||0,wars:(Number(f[u])||0)+(Number(f[l])||0)}})})())}),Z(()=>t(I),()=>{v(dt,t(I)?t(I).reduce((e,a)=>e+a.dealt,0):null)}),Z(()=>t(I),()=>{v(jt,t(I)?Math.max(...t(I).map(e=>e.wars)):null)}),Z(()=>t(I),()=>{v(Bt,t(I)?Math.max(...t(I).map(e=>Math.abs(e.net))):null)}),Z(()=>(t(m),qt),()=>{v(tt,(()=>{if(!t(m))return null;const e=qt(t(m),R.NATION,E.Summary.columns,"name","asc"),a=e.columns.indexOf("off:wars");if(a===-1)return null;const n=e.data.length;if(n===0)return null;const i=e.data.reduce((o,u)=>o+(Number(u[a])||0),0);return{totalOffWars:i,totalNations:n,perNation:i/n}})())}),Z(()=>t(I),()=>{v(et,t(I)?t(I).reduce((e,a)=>a.net>e.net?a:e,t(I)[0]):null)}),Z(()=>(t(m),t(r)),()=>{v(D,t(m)?qt(t(m),R.ALLIANCE,t(r).columns,t(r).sort,t(r).order):null)}),Z(()=>(t(m),t(r)),()=>{v(at,t(m)?qt(t(m),R.NATION,t(r).columns,t(r).sort,t(r).order):null)}),Z(()=>t(at),()=>{v(j,t(at)?t(at).columns.filter((e,a)=>{var o,u,l,f;if(a===0)return!1;const n=(u=(o=t(at).cell_format)==null?void 0:o.formatMoney)!=null?u:[],i=(f=(l=t(at).cell_format)==null?void 0:l.formatNumber)!=null?f:[];return n.includes(a)||i.includes(a)}):[])}),Z(()=>(t(j),t(Vt),t(Gt)),()=>{t(j).length>0&&(t(j).includes(t(Vt))||v(Vt,t(j)[0]),t(j).includes(t(Gt))||v(Gt,t(j)[0]))}),Z(()=>(t(r),t(k)),()=>{v(ot,(()=>{const e=E.Summary.columns,a=t(r).columns.length===e.length&&t(r).columns.every((l,f)=>l===e[f]),n=t(r).layout===R.COALITION&&t(r).sort===E.Summary.sort&&t(r).order==="desc"&&a,i=JSON.stringify(Ra(t(k))),o=JSON.stringify(Ra(F));return!(n&&i===o)})())}),fo(),bn();var Ee=Rr();mo(e=>{var a=Zo(),n=z(a),i=d(n);h(()=>{var o;return _o.title=`Conflict ${(o=t(Tt))!=null?o:""}`}),U("load",n,Qn),y(e,a)});var Ke=c(Ee),Ma=d(c(Ke)),Hn=d(Ma);L(Hn,()=>{var e;return(e=t(m))==null?void 0:e.wiki},e=>{var a=tr(),n=c(a);ha(),s(a),h(()=>{var i,o,u;ie(a,"href",`https://politicsandwar.fandom.com/wiki/${(i=t(m).wiki)!=null?i:""}`),T(n,`Wiki:${(u=(o=t(m))==null?void 0:o.wiki)!=null?u:""} `)}),y(e,a)}),s(Ke);var Fa=d(Ke,2);Po(Fa,{get conflictId(){return t(G)},mode:"layout-picker",get currentLayout(){return t(r).layout},active:"coalition",onLayoutSelect:jn});var De=d(Fa,2),Wa=d(c(De),2);Ot(Wa,1,()=>Object.keys(E),wt,(e,a)=>{var n=er(),i=c(n),o=c(i,!0);s(i),s(n),h(()=>{var u;mn(i,`btn ux-btn btn-sm ms-1 fw-bold ${(u=t(r).columns===E[t(a)].columns?"active":"")!=null?u:""}`),T(o,t(a))}),U("click",i,()=>{X(r,t(r).columns=E[t(a)].columns),X(r,t(r).sort=E[t(a)].sort),La(),ee(),re()}),y(e,n)});var Pe=d(Wa,2),Yn=c(Pe),Jn=V(()=>t(It).map(e=>e.key)),qn=V(()=>({widgets:t(k),presetCards:t(It),rankingCards:t(Zt),metricCards:t(de)}));Xo(Yn,{get currentColumns(){return t(r).columns},get currentSort(){return t(r).sort},get currentOrder(){return t(r).order},get currentKpis(){return t(Jn)},get currentKpiConfig(){return t(qn)},$$events:{load:e=>{const a=e.detail.preset;if(X(r,t(r).columns=a.columns),a.sort&&X(r,t(r).sort=a.sort),a.order&&X(r,t(r).order=a.order),a.kpiConfig)Na(a.kpiConfig),Ht();else if(Array.isArray(a.kpis)&&a.kpis.length>0){const n=a.kpis.filter(i=>i in bt).map(i=>i);n.length>0&&(v(k,n.map(i=>({id:Qt("preset"),kind:"preset",key:i}))),Ht())}La(),ee(),re()}}}),s(Pe);var za=d(Pe,2);L(za,()=>t(Lt),e=>{var a=ar(),n=c(a);s(a),U("click",n,Kn),y(e,a)});var Me=d(za,2),Ua=d(c(Me),2),ja=d(c(Ua),2);L(ja,()=>t(k).length===0,e=>{var a=nr();y(e,a)});var Ba=d(ja,2);Ot(Ba,1,()=>t(k),wt,(e,a,n)=>{var i=or(),o=c(i),u=c(o,!0);h(()=>T(u,Mn(t(a)))),s(o);var l=d(o,2),f=c(l);f.disabled=n===0;var p=d(f,2),_=d(p,2);s(l),s(i),h(()=>p.disabled=n===t(k).length-1),U("click",f,Ut(ae(()=>Sa(t(a).id,-1)))),U("click",p,Ut(ae(()=>Sa(t(a).id,1)))),U("click",_,Ut(ae(()=>xa(t(a).id)))),y(e,i)});var Fe=d(Ba,6);Ot(Fe,5,()=>Object.keys(bt),wt,(e,a)=>{var n=rr();const i=V(()=>t(a));h(()=>n.disabled=Aa(t(i)));var o=c(n);s(n),h(()=>{var u;return T(o,`+ ${(u=bt[t(i)])!=null?u:""}`)}),U("click",n,Ut(ae(()=>$n(t(i))))),y(e,n)}),s(Fe);var We=d(Fe,6),ze=c(We),Ue=c(ze);h(()=>{t(ue),Wt(()=>{})});var je=c(Ue);je.value=(je.__value="alliance")==null?"":"alliance";var Va=d(je);Va.value=(Va.__value="nation")==null?"":"nation",s(Ue),s(ze);var Be=d(ze,2),Ve=c(Be);h(()=>{t(Rt),Wt(()=>{t(oe)})});var Ge=c(Ve);Ge.value=(Ge.__value="all")==null?"":"all";var Qe=d(Ge);Qe.value=(Qe.__value="coalition1")==null?"":"coalition1";var He=d(Qe);He.value=(He.__value="coalition2")==null?"":"coalition2";var he=d(He);he.value=(he.__value="selection")==null?"":"selection";var Xn=c(he);s(he),s(Ve),s(Be);var Ye=d(Be,2),Ga=c(Ye);Nn(Ga),s(Ye);var Je=d(Ye,2),qe=c(Je);h(()=>{t(Vt),Wt(()=>{t(j)})}),Ot(qe,5,()=>t(j),wt,(e,a)=>{var n=ir(),i={},o=c(n,!0);h(()=>T(o,Dt(t(a)))),s(n),h(()=>{i!==(i=t(a))&&(n.value=(n.__value=t(a))==null?"":t(a))}),y(e,n)}),s(qe),s(Je);var Qa=d(Je,2),Ha=c(Qa);h(()=>Ha.disabled=!_e(t(Rt))),s(Qa),s(We);var Xe=d(We,6),Ze=c(Xe),ta=c(Ze);h(()=>{t(me),Wt(()=>{})});var ea=c(ta);ea.value=(ea.__value="alliance")==null?"":"alliance";var Ya=d(ea);Ya.value=(Ya.__value="nation")==null?"":"nation",s(ta),s(Ze);var aa=d(Ze,2),na=c(aa);h(()=>{t(Et),Wt(()=>{t(oe)})});var oa=c(na);oa.value=(oa.__value="all")==null?"":"all";var ra=d(oa);ra.value=(ra.__value="coalition1")==null?"":"coalition1";var ia=d(ra);ia.value=(ia.__value="coalition2")==null?"":"coalition2";var ye=d(ia);ye.value=(ye.__value="selection")==null?"":"selection";var Zn=c(ye);s(ye),s(na),s(aa);var sa=d(aa,2),la=c(sa);h(()=>{t(ve),Wt(()=>{})});var ca=c(la);ca.value=(ca.__value="sum")==null?"":"sum";var Ja=d(ca);Ja.value=(Ja.__value="avg")==null?"":"avg",s(la),s(sa);var da=d(sa,2),ua=c(da);h(()=>{t(Gt),Wt(()=>{t(j)})}),Ot(ua,5,()=>t(j),wt,(e,a)=>{var n=sr(),i={},o=c(n,!0);h(()=>T(o,Dt(t(a)))),s(n),h(()=>{i!==(i=t(a))&&(n.value=(n.__value=t(a))==null?"":t(a))}),y(e,n)}),s(ua),s(da);var ma=d(da,2),va=c(ma);h(()=>{t(fe),Wt(()=>{t(j)})});var fa=c(va);fa.value=((fa.__value="")==null,"");var to=d(fa);Ot(to,1,()=>t(j),wt,(e,a)=>{var n=lr(),i={},o=c(n);h(()=>{var u;return T(o,`Per ${(u=Dt(t(a)))!=null?u:""}`)}),s(n),h(()=>{i!==(i=t(a))&&(n.value=(n.__value=t(a))==null?"":t(a))}),y(e,n)}),s(va),s(ma);var qa=d(ma,2),Xa=c(qa);h(()=>Xa.disabled=!_e(t(Et))),s(qa),s(Xe);var eo=d(Xe,4);L(eo,()=>t(G),e=>{var a=cr();h(()=>ie(a,"href",`aava?id=${t(G)}`)),y(e,a)}),s(Ua),s(Me);var Za=d(Me,2),ao=c(Za);No(ao,{onReset:Bn,onSharePrepare:zn,get resetDirty(){return t(ot)}}),s(Za),s(De);var tn=d(De,2);L(tn,()=>t(m)&&!t(Lt),e=>{var a=Cr(),n=c(a),i=d(c(n),2);s(n);var o=d(n,2);Ot(o,5,()=>t(k),wt,(u,l)=>{var f=kr();const p=V(()=>t(l).kind==="ranking");var _=c(f),b=c(_),S=d(b,2);L(S,()=>t(l).kind==="preset",w=>{var P=Ft(),J=z(P);L(J,()=>t(l).key==="duration",B=>{var mt=dr(),ht=d(z(mt),2),vt=c(ht,!0);s(ht),h(()=>T(vt,t(x))),y(B,mt)},B=>{var mt=Ft(),ht=z(mt);L(ht,()=>t(l).key==="wars",vt=>{var xt=ur(),Pt=d(z(xt),2),St=c(Pt,!0);h(()=>T(St,Kt(t(jt)))),s(Pt),y(vt,xt)},vt=>{var xt=Ft(),Pt=z(xt);L(Pt,()=>t(l).key==="damage-total",St=>{var At=mr(),Mt=d(z(At),2),ft=c(Mt,!0);h(()=>T(ft,Kt(t(dt)))),s(Mt),y(St,At)},St=>{var At=Ft(),Mt=z(At);L(Mt,()=>t(l).key==="net-gap",ft=>{var yt=fr(),K=d(z(yt),2),nt=c(K,!0);h(()=>T(nt,Kt(t(Bt)))),s(K);var H=d(K,2);L(H,()=>t(et),kt=>{var _t=vr(),st=c(_t);s(_t),h(()=>{var $;return T(st,`Lead: ${($=t(et).name)!=null?$:""}`)}),y(kt,_t)}),y(ft,yt)},ft=>{var yt=Ft(),K=z(yt);L(K,()=>t(l).key==="c1-dealt",nt=>{var H=_r(),kt=z(H),_t=c(kt);s(kt);var st=d(kt,2),$=c(st,!0);h(()=>{var M,q;return T($,Kt((q=(M=t(I))==null?void 0:M[0])==null?void 0:q.dealt))}),s(st),h(()=>{var M,q,ct,lt;return T(_t,`${(lt=(ct=(q=(M=t(I))==null?void 0:M[0])==null?void 0:q.name)!=null?ct:"Coalition 1")!=null?lt:""} dealt`)}),y(nt,H)},nt=>{var H=Ft(),kt=z(H);L(kt,()=>t(l).key==="c2-dealt",_t=>{var st=pr(),$=z(st),M=c($);s($);var q=d($,2),ct=c(q,!0);h(()=>{var lt,pt;return T(ct,Kt((pt=(lt=t(I))==null?void 0:lt[1])==null?void 0:pt.dealt))}),s(q),h(()=>{var lt,pt,te,Ct;return T(M,`${(Ct=(te=(pt=(lt=t(I))==null?void 0:lt[1])==null?void 0:pt.name)!=null?te:"Coalition 2")!=null?Ct:""} dealt`)}),y(_t,st)},_t=>{var st=Ft(),$=z(st);L($,()=>t(l).key==="off-wars-per-nation",M=>{var q=br(),ct=d(z(q),2),lt=c(ct,!0);h(()=>T(lt,t(tt)?t(tt).perNation.toFixed(2):"N/A")),s(ct);var pt=d(ct,2);L(pt,()=>t(tt),te=>{var Ct=gr();const Ie=V(()=>{var W;return(W=Kt(t(tt).totalOffWars))!=null?W:""}),pa=V(()=>{var W;return(W=Kt(t(tt).totalNations))!=null?W:""});var Yt=c(Ct);h(()=>T(Yt,`${t(Ie)}
                                            offensive / ${t(pa)}
                                            nations`)),s(Ct),y(te,Ct)}),y(M,q)},null,!0),y(_t,st)},!0),y(nt,H)},!0),y(ft,yt)},!0),y(St,At)},!0),y(vt,xt)},!0),y(B,mt)}),y(w,P)},w=>{var P=Ft(),J=z(P);L(J,()=>t(l).kind==="ranking",B=>{var mt=Sr();const ht=V(()=>Dn(t(l)));var vt=z(mt);const xt=V(()=>{var $;return($=t(l).limit)!=null?$:""}),Pt=V(()=>{var $;return($=t(l).entity)!=null?$:""}),St=V(()=>{var $,M,q;return(q=t(l).source==="aava"?le(t(l).metric,(M=($=t(l).aavaSnapshot)==null?void 0:$.header)!=null?M:"wars"):Dt(t(l).metric))!=null?q:""}),At=V(()=>{var $;return($=pe(t(l)))!=null?$:""});var Mt=c(vt);h(()=>T(Mt,`Top ${t(xt)}
                                    ${t(Pt)}s by
                                    ${t(St)}
                                    (${t(At)})`)),s(vt);var ft=d(vt,2),yt=c(ft),K=c(yt),nt=c(K),H=d(c(nt)),kt=c(H,!0);s(H);var _t=d(H);L(_t,()=>t(l).entity==="nation",$=>{var M=hr();y($,M)}),ha(),s(nt),s(K);var st=d(K);Ot(st,5,()=>t(ht),wt,($,M,q)=>{var ct=xr(),lt=c(ct);lt.textContent=q+1;var pt=d(lt),te=c(pt);L(te,()=>t(l).entity==="alliance",Yt=>{var W=yr(),Jt=c(W,!0);s(W),h(()=>{ie(W,"href",`https://politicsandwar.com/alliance/id=${t(M).allianceId}`),T(Jt,t(M).label)}),y(Yt,W)},Yt=>{var W=Ir(),Jt=c(W,!0);s(W),h(()=>{ie(W,"href",`https://politicsandwar.com/nation/id=${t(M).nationId}`),T(Jt,t(M).label)}),y(Yt,W)}),s(pt);var Ct=d(pt);L(Ct,()=>t(l).entity==="nation",Yt=>{var W=Nr(),Jt=c(W),so=c(Jt,!0);s(Jt),s(W),h(()=>{ie(Jt,"href",`https://politicsandwar.com/alliance/id=${t(M).allianceId}`),T(so,t(M).allianceName)}),y(Yt,W)});var Ie=d(Ct),pa=c(Ie,!0);s(Ie),s(ct),h(()=>T(pa,t(M).valueText)),y($,ct)}),s(st),s(yt),s(ft),h(()=>T(kt,t(l).entity==="alliance"?"Alliance":"Nation")),y(B,mt)},B=>{var mt=Ar(),ht=z(mt);const vt=V(()=>{var K;return(K=t(l).aggregation.toUpperCase())!=null?K:""}),xt=V(()=>{var K;return(K=t(l).entity)!=null?K:""}),Pt=V(()=>{var K,nt,H;return(H=t(l).source==="aava"?le(t(l).metric,(nt=(K=t(l).aavaSnapshot)==null?void 0:K.header)!=null?nt:"wars"):Dt(t(l).metric))!=null?H:""}),St=V(()=>{var K,nt,H;return(H=t(l).normalizeBy?` per ${t(l).source==="aava"?le(t(l).normalizeBy,(nt=(K=t(l).aavaSnapshot)==null?void 0:K.header)!=null?nt:"wars"):Dt(t(l).normalizeBy)}`:"")!=null?H:""}),At=V(()=>{var K;return(K=pe(t(l)))!=null?K:""});var Mt=c(ht);h(()=>T(Mt,`${t(vt)}
                                    ${t(xt)}
                                    ${t(Pt)}
                                    ${t(St)}
                                    (${t(At)})`)),s(ht);var ft=d(ht,2),yt=c(ft,!0);h(()=>T(yt,Kt(Pn(t(l))))),s(ft),y(B,mt)},!0),y(w,P)}),s(_),s(f),h(()=>{mn(f,t(p)?"col-12 col-lg-6":"col-12 col-sm-6 col-xl-4"),ko(_,"kpi-card-dragging",t(Nt)===t(l).id)}),U("click",b,()=>xa(t(l).id)),U("dragstart",_,()=>Cn(t(l).id)),U("dragend",_,On),U("dragover",_,Ut(function(w){Do.call(this,g,w)})),U("drop",_,Ut(()=>wn(t(l).id))),y(u,f)}),s(o),s(a),U("click",i,En),y(e,a)});var en=d(tn,2);L(en,()=>!t(rt),e=>{Co(e)});var an=d(en,2);L(an,()=>t(ut),e=>{var a=Or(),n=c(a),i=c(n,!0);s(n);var o=d(n,2);s(a),h(()=>T(i,t(ut))),U("click",o,Vn),y(e,a)});var nn=d(an,4);L(nn,()=>t(r).layout==R.COALITION,e=>{var a=$r(),n=d(z(a),2),i=c(n);L(i,()=>{var u;return(u=t(m))==null?void 0:u.cb},u=>{var l=wr(),f=c(l),p=d(c(f),2),_=c(p,!0);s(p),s(f),s(l),h(()=>{var b;return T(_,(b=t(m))==null?void 0:b.cb)}),y(u,l)});var o=d(i,2);L(o,()=>{var u;return(u=t(m))==null?void 0:u.status},u=>{var l=Tr(),f=c(l),p=d(c(f),2),_=c(p,!0);s(p),s(f),s(l),h(()=>{var b;return T(_,(b=t(m))==null?void 0:b.status)}),y(u,l)}),s(n),y(e,a)});var _a=d(nn,4),on=c(_a);const no=V(()=>{var e,a,n;return(n=vn((a=(e=t(m))==null?void 0:e.start)!=null?a:null))!=null?n:""}),oo=V(()=>{var e,a,n;return(n=vn((a=(e=t(m))==null?void 0:e.end)!=null?a:null))!=null?n:""});var ro=c(on);h(()=>T(ro,`${t(no)} - ${t(oo)}`)),s(on),ha(2),s(_a);var io=d(_a,2);L(io,()=>t(A),e=>{var a=Lr(),n=c(a,!0);s(a),h(()=>T(n,t(A))),y(e,a)}),s(Ee),h(()=>{var e,a,n;T(Ma,` Conflict: ${(e=t(Tt))!=null?e:""} `),T(Xn,`Selection snapshot (${(a=t(oe))!=null?a:""})`),T(Zn,`Selection snapshot (${(n=t(oe))!=null?n:""})`)}),zt(Ue,()=>t(ue),e=>v(ue,e)),zt(Ve,()=>t(Rt),e=>v(Rt,e)),xn(Ga,()=>t(Ce),e=>v(Ce,e)),zt(qe,()=>t(Vt),e=>v(Vt,e)),U("click",Ha,Ut(ae(Ln))),zt(ta,()=>t(me),e=>v(me,e)),zt(na,()=>t(Et),e=>v(Et,e)),zt(la,()=>t(ve),e=>v(ve,e)),zt(ua,()=>t(Gt),e=>v(Gt,e)),zt(va,()=>t(fe),e=>v(fe,e)),U("click",Xa,Ut(ae(Rn))),y(N,Ee),yn()}export{Jr as component};
