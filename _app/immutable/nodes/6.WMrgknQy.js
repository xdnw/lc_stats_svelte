import{a as E,t as N,b as Tt,c as Dt}from"../chunks/disclose-version.xy21-f78.js";import{i as It}from"../chunks/legacy.N0bfMBuo.js";import{p as St,f as z,b as Nt,s as h,g as t,d as kt,$ as Lt,c as b,m as S,e as C,r as x,n as Mt,t as k,i as Rt}from"../chunks/runtime.DMLHWUus.js";import{h as $t,e as D,s as U}from"../chunks/render.CoimT3AH.js";import{o as jt,i as L}from"../chunks/index-client.D_ywJSmp.js";import{N as zt,s as Ft,F as Bt,e as ot,i as it,r as Pt}from"../chunks/Footer.C7bm1xTi.js";import{a as Qt,p as Ut,q as Wt,E as qt,d as Ot,f as Vt,s as W,C as s,x as Gt,z as Ht,i as Kt,t as G,j as Yt,h as rt,r as Jt}from"../chunks/index.DcoiBfme.js";import{a as Xt}from"../chunks/input.DKMbOmpf.js";import{c as ct}from"../chunks/_layout.BJmI2Ulo.js";import{b as dt}from"../chunks/paths.BVsJ1pVq.js";var Zt=Tt('<script id="visjs" async src="https://cdnjs.cloudflare.com/ajax/libs/vis-timeline/7.7.3/vis-timeline-graph2d.min.js"><\/script><!---->',1),te=N("<option> </option>"),ee=N('<div class="d-inline-block ms-2"><div class="input-group ux-inputbar"><label for="source" class="fw-bold input-group-text">Source:</label> <select class="form-select form-select-sm fw-bold"><option>All</option><!></select> <button class="btn ux-btn fw-bold">Create Conflict</button></div></div>'),ae=N('<div class="alert alert-danger m-2 d-flex justify-content-between align-items-center"><span> </span> <button class="btn btn-sm btn-outline-danger fw-bold">Retry</button></div>'),se=N('<button class="btn ux-btn btn-sm ms-1 mb-1"> </button>'),le=N(`<input type="text" class="form-control mb-2" placeholder="Search alliances..."> <div class="d-flex justify-content-left align-items-center ms-1"><div class="ux-callout mb-2">These will toggle the visiblity of conflicts which contain the
          selected alliances. It does NOT affect the individual conflict stats.</div></div> <div class="ux-surface p-2 mb-2"><button class="btn ux-btn btn-sm ms-1 mb-1">Toggle All</button> <br> <!></div>`,1),ne=N('<div class="d-flex gap-1 mb-2"><button class="btn ux-btn btn-sm fw-bold">Copy share link</button> <button class="btn ux-btn btn-sm fw-bold">Reset</button></div> <button class="btn ux-btn mb-2">Filter Alliances&nbsp;<i class="bi"></i></button> <!>',1),oe=N('<div class="small text-muted mt-1"> </div>'),ie=N('<!>  <div class="container-fluid p-2" style="min-height: calc(100vh - 203px);"><h1 class="m-0 mb-2 p-2 ux-surface ux-page-title"><a aria-label="Back to home"><i class="bi bi-arrow-left"></i></a> &nbsp;Conflict <!></h1> <hr class="mt-2 mb-2"> <!> <!> <!> <div id="conflictTable" class="inline-block"></div> <!> <div class="ux-surface p-2 mt-2"><h4 class="m-1">Timeline</h4> <p class="ps-1 ux-muted">Use ctrl+mousewheel to zoom on PC</p> <div class="m-0" id="visualization"></div></div></div> <!>',1);function ge(ut,mt){var nt;St(mt,!1);let H,r=S(null),I=S(["All",0]),F=S(!1),M=S(null),q=S(""),K={},Y={},R=null,f=S(new Set),$=S(!1),B=S("");const J=()=>window.vis;jt(()=>{try{Qt(["ids","guild","guild_id"]),Ut(),window.getIds=(e,a)=>{const n=Y[e][a],m=n.map(i=>K[i]||"AA:"+i);return{alliance_ids:n,alliance_names:m}},window.formatUrl=(e,a,n,m)=>{let i=n[0],o="<span class='text-nowrap'>";for(let c=0;c<=1;(c+=1)-1){let _=document.createElement("button");_.setAttribute("type","button"),_.setAttribute("class","ms-1 btn ux-btn btn-sm fw-bold"),_.setAttribute("onclick",`showNames('${e}',${c})`),_.textContent="C"+(c+1),o+=_.outerHTML}return o+=`&nbsp;<a href="conflict?id=${i}">${e}</a></span>`,o},window.download=function(a,n){Wt(document.getElementById("conflictTable").querySelector("table"),a,qt[n])};let l=`https://locutus.s3.ap-southeast-2.amazonaws.com/conflicts/index.gzip?${ct.version.conflicts}`;Ot(l).then(e=>{h(M,null),h(r,e),h(q,Vt(ct.version.conflicts,e.update_ms));let a=e.alliance_ids,n=e.alliance_names;for(let o=0;o<a.length;(o+=1)-1)K[a[o]]=n[o];let m=new URLSearchParams(window.location.search);const i=m.get("ids");if(i)for(const o of i.split("."))t(f).add(parseInt(o));else for(let o=0;o<a.length;(o+=1)-1)t(f).add(a[o]);R=m.get("guild")||m.get("guild_id"),P(e,R),h(F,!0),W(),Q(!1)}).catch(e=>{console.error("Failed to load conflicts data",e),h(M,"Could not load conflicts data. Please try again later."),h(F,!0)})}catch(l){console.error("Error reading from S3 bucket:",l),h(M,"Could not load conflicts data. Please try again later.")}});function P(l,e){var A;let a=[...l.headers],n=[s.NAME,s.C1_NAME,s.C2_NAME,s.START,s.END,s.WARS,s.ACTIVE_WARS,s.C1_DEALT,s.C2_DEALT,s.CATEGORY],m=[s.NAME],i={},o=[s.END+1,"desc"],c=l.conflicts;t(f).size!=((A=t(r))==null?void 0:A.alliance_ids.length)&&(c=c.filter(d=>{const u=d[s.C1_ID],w=d[s.C2_ID];return u.some(T=>t(f).has(T))||w.some(T=>t(f).has(T))}));let _=a.indexOf("source"),v=l.source_sets,g=l.source_names,p=e&&v?v[e]:null;if(p){h(I,[g[e],parseFloat(e)]),t(I)[0]||kt(I,t(I)[0]=e+" (None Featured)");let d=function(u){if(!p)return!0;let w=_==-1?0:u[_];return!w||w==0||p.includes(w)||parseFloat(e)==w||u[0]==parseInt(e)?!0:w==128};c=c.filter(d),console.log("Filtered rows",c.length)}else console.log("No source set ",e,v,c.length,v);for(let d=0;d<c.length;(d+=1)-1){let u=c[d],w=u[s.NAME];Y[w]=[u[s.C1_ID],u[s.C2_ID]],u[s.C1_NAME],u[s.C2_NAME]}a.push("total"),c=c.map(d=>{const u=d[s.C1_DEALT]+d[s.C2_DEALT];return[...d,u]}),i.formatUrl=[s.NAME],i.formatNumber=[s.WARS,s.ACTIVE_WARS],i.formatMoney=[s.C1_DEALT,s.C2_DEALT,a.length-1],i.formatDate=[s.START,s.END];let y=document.getElementById("conflictTable");H={columns:a,data:c,visible:n,searchable:m,cell_format:i,row_format:(d,u,w)=>{let T=u[5];T==-1?d.classList.add("bg-danger-subtle"):T<Date.now()-432e6?d.classList.add("bg-light-subtle"):d.classList.add("bg-warning-subtle")},sort:o},Gt(y,H)}function ft(l){const a=l.target.value,n=t(r).source_names[a];h(I,[n,a]),R=a==="0"?null:a,rt("guild",a==="0"?null:a),W(),P(t(r),a)}function bt(l){t(f).has(l)?t(f).delete(l):t(f).add(l),X()}function pt(){for(let l=0;l<t(r).alliance_ids.length;(l+=1)-1){let e=t(r).alliance_ids[l];t(f).has(e)?t(f).delete(e):t(f).add(e)}X()}function X(){h(f,t(f)),rt("ids",Array.from(t(f)).join("."),{replace:!0}),W(),P(t(r),R),Q(!0)}function _t(){t(r)&&(h(f,new Set(t(r).alliance_ids)),R=null,h(I,["All",0]),h(B,""),Jt(["ids","guild","guild_id"]),W(),P(t(r),null),Q(!0))}function vt(){window.location.reload()}function Q(l){const e=document.getElementById("visjs");if(t(F)&&t(r)&&(e&&e.getAttribute("data-loaded")||typeof J()!="undefined")){const a=document.getElementById("visualization");if(!a)return;if(a.hasChildNodes()){if(!l)return;a.innerHTML=""}const n=J(),m=new n.DataSet;let i=Date.now(),o=0;console.log("Loading timeline data",t(r).conflicts.length);const c=t(r).alliance_ids.length!=t(f).size;t(r).conflicts.forEach(g=>{if(c&&!g[s.C1_ID].some(u=>t(f).has(u))&&!g[s.C2_ID].some(u=>t(f).has(u)))return;const p=g[s.NAME],y=g[s.START],A=g[s.END];i=Math.min(i,y),o=Math.max(o,A==-1?Date.now():A);const d=`${dt}/conflict?id=${g[s.ID]}`;m.add({id:g[s.ID],content:`<a href="${d}" target="_blank" title="${p}">${p}</a>`,start:y,end:A===-1?Date.now():A})});const _={start:i,end:o,height:"75vh",width:"100%",zoomKey:"ctrlKey",orientation:"top",verticalScroll:!0},v=new n.Timeline(a,m,_);v.addCustomTime(i,"t1"),v.addCustomTime(o,"t2")}}function gt(l){console.log("Script loaded"),l.target.setAttribute("data-loaded","true"),Q(!1)}It();var Z=ie();$t(l=>{var e=Zt();Lt.title="Conflicts";var a=z(e),n=b(a);D("load",a,gt),E(l,e)});var tt=z(Z);zt(tt,{});var O=b(tt,2),V=C(O),et=C(V);Ft(et,"href",`${(nt=dt)!=null?nt:""}/`);var ht=b(et,2);L(ht,()=>t(r)&&t(r).source_names,l=>{var e=ee(),a=C(e),n=b(C(a),2),m=C(n);m.value=(m.__value="0")==null?"":"0";var i=b(m);ot(i,1,()=>Object.entries(t(r).source_names),it,(c,_)=>{let v=()=>t(_)[0],g=()=>t(_)[1];var p=te(),y={},A=C(p,!0);x(p),k(()=>{y!==(y=v())&&(p.value=(p.__value=v())==null?"":v()),p.selected=v()==t(I)[1],U(A,g())}),E(c,p)}),x(n);var o=b(n,2);x(a),x(e),k(()=>m.selected=t(I)[1]==0),D("change",n,ft),D("click",o,()=>Ht("Create Info",`<p>Use the discord bot to run the following command</p>
<p><code>/conflict create_temp</code></p>
<p>Create a temporary conflict between two coalitions
Conflict is not auto updated</p>
<p><b>Arguments:</b><br/>
<code>&lt;col1&gt;</code> - <a href="https://github.com/xdnw/locutus/wiki/arguments#setdballiance">Set</a>
A comma separated list of alliances<br/>
<code>&lt;col2&gt;</code> - <a href="https://github.com/xdnw/locutus/wiki/arguments#setdballiance">Set</a><br/>
<code>&lt;start&gt;</code> - <a href="https://github.com/xdnw/locutus/wiki/arguments#longtimestamp">long[Timestamp]</a>
A unix timestamp, a DMY date or a time difference that will resolve to a timestamp from the current date<br/>
<code>[end]</code> - <a href="https://github.com/xdnw/locutus/wiki/arguments#longtimestamp">Long[Timestamp]</a><br/>
<code>[-g includeGraphs]</code> - <a href="https://github.com/xdnw/locutus/wiki/arguments#boolean">boolean</a></p>
<a class="btn btn-outline-info" href="https://github.com/xdnw/locutus/wiki/conflict_webpage">More info</a>`)),E(l,e)}),x(V);var at=b(V,4);L(at,()=>!t(F),l=>{Kt(l)});var st=b(at,2);L(st,()=>t(M),l=>{var e=ae(),a=C(e),n=C(a,!0);x(a);var m=b(a,2);x(e),k(()=>U(n,t(M))),D("click",m,vt),E(l,e)});var lt=b(st,2);L(lt,()=>t(r),l=>{var e=ne(),a=z(e),n=C(a),m=b(n,2);x(a);var i=b(a,2),o=b(C(i));x(i);var c=b(i,2);L(c,()=>t($),_=>{var v=le(),g=z(v);Pt(g);var p=b(g,4),y=C(p),A=b(y,4);ot(A,1,()=>t(r).alliance_ids,it,(d,u,w)=>{var T=Dt(),xt=z(T);L(xt,()=>t(r).alliance_names[w]&&t(r).alliance_names[w].toLowerCase().includes(t(B).toLowerCase()),At=>{var j=se();const yt=Rt(()=>t(f).has(t(u)));k(()=>G(j,"active",t(yt)));var Et=C(j,!0);x(j),k(()=>U(Et,t(r).alliance_names[w])),D("click",j,()=>bt(t(u))),E(At,j)}),E(d,T)}),x(p),Xt(g,()=>t(B),d=>h(B,d)),D("click",y,()=>pt()),E(_,v)}),k(()=>{G(o,"bi-chevron-down",!t($)),G(o,"bi-chevron-up",t($))}),D("click",n,()=>Yt()),D("click",m,_t),D("click",i,()=>h($,!t($))),E(l,e)});var wt=b(lt,4);L(wt,()=>t(q),l=>{var e=oe(),a=C(e,!0);x(e),k(()=>U(a,t(q))),E(l,e)}),Mt(2),x(O);var Ct=b(O,2);Bt(Ct,{}),E(ut,Z),Nt()}export{ge as component};
