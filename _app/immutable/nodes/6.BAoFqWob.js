var lo=Object.defineProperty,co=Object.defineProperties;var uo=Object.getOwnPropertyDescriptors;var Ne=Object.getOwnPropertySymbols;var sn=Object.prototype.hasOwnProperty,ln=Object.prototype.propertyIsEnumerable;var rn=(x,g,N)=>g in x?lo(x,g,{enumerable:!0,configurable:!0,writable:!0,value:N}):x[g]=N,ga=(x,g)=>{for(var N in g||(g={}))sn.call(g,N)&&rn(x,N,g[N]);if(Ne)for(var N of Ne(g))ln.call(g,N)&&rn(x,N,g[N]);return x},ba=(x,g)=>co(x,uo(g));var cn=(x,g)=>{var N={};for(var I in x)sn.call(x,I)&&g.indexOf(I)<0&&(N[I]=x[I]);if(x!=null&&Ne)for(var I of Ne(x))g.indexOf(I)<0&&ln.call(x,I)&&(N[I]=x[I]);return N};import{e as U,a as y,t as C,s as $,h as mo,b as vo,c as Ft}from"../chunks/disclose-version.BGVnXwSC.js";import{i as bn}from"../chunks/legacy.C5xHvBl9.js";import{p as hn,b as yn,c as d,s as f,d as c,r as l,g as t,t as h,m as O,l as X,a as fo,f as z,$ as _o,j as J,h as q,n as ha,i as zt}from"../chunks/runtime.Bz3ZCnid.js";import{c as po,o as In,i as L}from"../chunks/index-client.Q1qAUnCw.js";import{f as Ae,e as Ot,i as wt,a as go,g as bo,s as ee,h as ho,j as Se,d as yo,r as Io}from"../chunks/binary.C_HE3RDK.js";import{r as xn,c as dn,s as ie}from"../chunks/_layout.C340yC5l.js";import{v as ya,a as ne,S as xo,s as se,f as No,d as So,E as Ao,w as un,k as mn,t as ko,P as Co,p as Oo,q as vn}from"../chunks/Progress.KQ1k3Mu0.js";import{b as Nn}from"../chunks/misc.BJslMcuk.js";import{b as Ut,m as wo,r as fn,s as $o,c as To,p as Lo,d as Ro,a as _n,e as le,f as Eo,h as Ko}from"../chunks/kpi.B8DQYaFM.js";import{p as Wt,s as ae}from"../chunks/event-modifiers.BCjtW8R-.js";import{b as Do}from"../chunks/misc.yyZM2rSV.js";import{C as Po}from"../chunks/ConflictRouteTabs.C9YpKmne.js";import{a as Mo,s as Fo}from"../chunks/containerSetup.Ci6TewMh.js";import{t as Sn}from"../chunks/warWeb.da6xX1jT.js";import{p as ce}from"../chunks/props.CYdPwHoV.js";function Jt(x,g,N,I,dt){let jt=x.coalitions,Bt=x.damage_header,Z=x.header_type,tt=[],D=[],et=[],W=[],nt={},R=null;switch(g){case 0:R=null;break;case 1:R=null;break;case 2:R=null;break}D.push("name");for(let A=0;A<Bt.length;A++){let m=Sn(Bt[A]),rt=Z[A];rt==0?(D.push(`loss:${m}`),D.push(`dealt:${m.replace("_loss","").replace("loss_","")}`),D.push(`net:${m.replace("_loss","").replace("loss_","")}`)):rt==1&&(D.push(`def:${m}`),D.push(`off:${m}`),D.push(`both:${m}`))}et.push(0),g===0?nt.formatCol=[0]:g===1?nt.formatAA=[0]:g===2&&(nt.formatNation=[0]);let B=[Math.max(0,D.indexOf(I)),dt];nt.formatNumber=[],nt.formatMoney=[];for(let A=0;A<D.length;A++)N.includes(D[A])&&W.push(A),A>0&&(D[A].includes("~")||D[A].includes("damage")||D[A].includes("infra")&&!D[A].includes("attacks")?nt.formatMoney.push(A):nt.formatNumber.push(A));let ot=(A,m,rt)=>{for(let E=0;E<m.length;E++){let r=m[E],V=rt[E],gt=Z[E],Q;gt==0?Q=V-r:Q=V+r,A.push(r),A.push(V),A.push(Q)}},ut=(A,m)=>{let rt=A.alliance_ids,E=A.alliance_names,r=A.nation_ids,V=A.nation_names,gt=A.nation_aa,Q=A.damage;switch(g){case 0:let qt=[m];ot(qt,Q[0],Q[1]),tt.push(qt);break;case 1:let bt=2;for(let F=0;F<rt.length;F++){let k=[],It=rt[F],Xt=ne(E[F],It);k.push([Xt,It]),ot(k,Q[F*2+bt],Q[F*2+bt+1]),tt.push(k)}break;case 2:let Tt=2+rt.length*2;for(let F=0;F<r.length;F++){let k=[],It=r[F],Xt=ya(V[F],It),de=gt[F];k.push([Xt,It,de]),ot(k,Q[F*2+Tt],Q[F*2+Tt+1]),tt.push(k)}break}};for(let A=0;A<jt.length;A++){let m=jt[A];ut(m,A)}return{columns:D,data:tt,visible:W,searchable:et,cell_format:nt,row_format:R,sort:B}}var zo=Object.defineProperty,Uo=Object.defineProperties,Wo=Object.getOwnPropertyDescriptors,pn=Object.getOwnPropertySymbols,jo=Object.prototype.hasOwnProperty,Bo=Object.prototype.propertyIsEnumerable,gn=(x,g,N)=>g in x?zo(x,g,{enumerable:!0,configurable:!0,writable:!0,value:N}):x[g]=N,Vo=(x,g)=>{for(var N in g||(g={}))jo.call(g,N)&&gn(x,N,g[N]);if(pn)for(var N of pn(g))Bo.call(g,N)&&gn(x,N,g[N]);return x},Go=(x,g)=>Uo(x,Wo(g));function Ia(x){const g=`${Ae()}:presets`;try{const N=localStorage.getItem(g);if(!N)return{};const I=JSON.parse(N);return!I||typeof I!="object"?{}:I}catch(N){return console.warn("Failed to read column presets",N),{}}}function Qo(x,g,N){const I=`${Ae()}:presets`;try{const dt=Ia(N);dt[x]=Go(Vo({},g),{createdAt:Date.now()}),localStorage.setItem(I,JSON.stringify(dt))}catch(dt){console.warn("Failed to save column preset",dt)}}function Ho(x,g){const N=`${Ae()}:presets`;try{const I=Ia(g);Object.prototype.hasOwnProperty.call(I,x)&&(delete I[x],localStorage.setItem(N,JSON.stringify(I)))}catch(I){console.warn("Failed to delete column preset",I)}}var Yo=C('<div class="small text-muted px-2">No saved layouts</div>'),Jo=C('<div class="preset-item px-2 py-1 small svelte-1040e6o"><div class="text-truncate" style="max-width:140px"> </div> <div><button class="btn ux-btn btn-sm me-1">Load</button> <button class="btn btn-sm btn-outline-danger">Delete</button></div></div>'),qo=C('<div class="dropdown d-inline"><button class="btn ux-btn btn-sm" type="button" id="cpDropdown" data-bs-toggle="dropdown" aria-expanded="false">My layouts&nbsp;<i class="bi bi-chevron-down"></i></button> <div class="dropdown-menu p-2" aria-labelledby="cpDropdown" style="min-width:260px;"><div class="input-group input-group-sm mb-2"><input class="form-control form-control-sm" placeholder="Save current as..."> <button class="btn ux-btn btn-sm">Save</button></div> <hr class="dropdown-divider"> <div class="preset-list svelte-1040e6o"><!> <!></div></div></div>');function Xo(x,g){hn(g,!1);let N=ce(g,"currentColumns",24,()=>[]),I=ce(g,"currentSort",8,""),dt=ce(g,"currentOrder",8,"desc"),jt=ce(g,"currentKpis",24,()=>[]),Bt=ce(g,"currentKpiConfig",8,null);const Z=po();let tt=O({}),D=O("");function et(){f(tt,Ia())}In(et);function W(){const r=(t(D)||"").trim();if(!r){Z("error",{message:"Name required"});return}t(tt)[r]&&!confirm(`Overwrite layout "${r}"?`)||(Qo(r,{columns:N(),sort:I(),order:dt(),kpis:jt(),kpiConfig:Bt()}),f(D,""),et(),Z("saved",{name:r}))}function nt(r){const V=t(tt)[r];V&&Z("load",{name:r,preset:V})}function R(r){confirm(`Delete layout "${r}"?`)&&(Ho(r),et(),Z("deleted",{name:r}))}bn();var $t=qo(),B=d(c($t),2),ot=c(B),ut=c(ot);xn(ut);var A=d(ut,2);l(ot);var m=d(ot,4),rt=c(m);L(rt,()=>Object.keys(t(tt)).length===0,r=>{var V=Yo();y(r,V)});var E=d(rt,2);Ot(E,1,()=>Object.keys(t(tt)),wt,(r,V)=>{var gt=Jo(),Q=c(gt),qt=c(Q,!0);l(Q);var bt=d(Q,2),Tt=c(bt),F=d(Tt,2);l(bt),l(gt),h(()=>$(qt,t(V))),U("click",Tt,()=>nt(t(V))),U("click",F,()=>R(t(V))),y(r,gt)}),l(m),l(B),l($t),Nn(ut,()=>t(D),r=>f(D,r)),U("click",A,W),y(x,$t),yn()}var Zo=vo('<script id="visjs" async src="https://cdnjs.cloudflare.com/ajax/libs/vis-timeline/7.7.3/vis-timeline-graph2d.min.js"><\/script><!---->',1),tr=C('<a class="btn ux-btn fw-bold"> <i class="bi bi-box-arrow-up-right"></i></a>'),er=C("<li><button> </button></li>"),ar=C('<li><button class="btn ux-btn btn-sm">Show KPI</button></li>'),nr=C('<div class="small text-muted mb-2">No cards</div>'),or=C('<div class="d-flex align-items-center justify-content-between gap-2 mb-1"><span class="small text-truncate"> </span> <div class="d-flex gap-1"><button type="button" class="btn btn-sm btn-outline-secondary">↑</button> <button type="button" class="btn btn-sm btn-outline-secondary">↓</button> <button type="button" class="btn btn-sm btn-outline-danger">Remove</button></div></div>'),rr=C('<button type="button" class="btn btn-sm btn-outline-secondary"> </button>'),ir=C("<option> </option>"),sr=C("<option> </option>"),lr=C("<option> </option>"),cr=C('<a class="btn btn-sm btn-outline-secondary w-100 mt-1">Add AAvA widgets from the AAvA page</a>'),dr=C('<div class="small text-muted">Duration</div> <div class="h6 m-0"> </div>',1),ur=C('<div class="small text-muted">Wars tracked</div> <div class="h6 m-0"> </div>',1),mr=C('<div class="small text-muted">Total damage exchanged</div> <div class="h6 m-0"> </div>',1),vr=C('<div class="small text-muted"> </div>'),fr=C('<div class="small text-muted">Damage gap</div> <div class="h6 m-0"> </div> <!>',1),_r=C('<div class="small text-muted"> </div> <div class="h6 m-0"> </div>',1),pr=C('<div class="small text-muted"> </div> <div class="h6 m-0"> </div>',1),gr=C('<div class="small text-muted"> </div>'),br=C('<div class="small text-muted">Participation</div> <div class="h6 m-0"> </div> <!>',1),hr=C("<th>Alliance</th>"),yr=C("<a> </a>"),Ir=C("<a> </a>"),xr=C("<td><a> </a></td>"),Nr=C('<tr><td></td><td><!></td><!><td class="text-end"> </td></tr>'),Sr=C('<div class="small text-muted mb-1"> </div> <div class="table-responsive"><table class="table table-sm table-striped m-0"><thead><tr><th>#</th><th> </th><!><th class="text-end">Value</th></tr></thead><tbody></tbody></table></div>',1),Ar=C('<div class="small text-muted"> </div> <div class="h6 m-0"> </div>',1),kr=C('<div><div class="ux-surface p-3 rounded border h-100 position-relative kpi-card" role="group" draggable="true"><button type="button" class="btn-close kpi-card-close" aria-label="Remove KPI card"></button> <!></div></div>'),Cr=C('<div class="ux-surface p-2 mb-3 rounded border"><div class="d-flex align-items-center justify-content-between mb-2"><h5 class="m-0">KPI</h5> <button type="button" class="btn-close" aria-label="Hide KPI"></button></div> <div class="row g-2"></div></div>'),Or=C('<div class="alert alert-danger m-2 d-flex justify-content-between align-items-center"><span> </span> <button class="btn btn-sm btn-outline-danger fw-bold">Retry</button></div>'),wr=C('<div class="col-md-6 col-sm-12"><div class="col-md-12 ms-2 p-2 rounded border ux-surface"><h3>Casus Belli</h3> <pre> </pre></div></div>'),$r=C('<div class="col-md-6 col-sm-12"><div class="col-md-12 ms-2 p-2 rounded border ux-surface"><h3>Status</h3> <pre> </pre></div></div>'),Tr=C('<hr> <div class="row m-0"><!> <!></div>',1),Lr=C('<div class="small text-muted text-end mt-2"> </div>'),Rr=C('<div class="container-fluid p-2 ux-page-body"><h1 class="m-0 mb-2 p-2 ux-surface ux-page-title"><a href="conflicts" aria-label="Back to conflicts"><i class="bi bi-arrow-left"></i></a> <!></h1> <!> <ul class="layout-picker-bar ux-floating-controls nav fw-bold nav-pills m-0 p-2 ux-surface mb-3 d-flex flex-wrap gap-1"><li class="me-1">Layout Picker:</li> <!> <li><!></li> <!> <li class="dropdown ms-auto" data-bs-auto-close="outside"><button class="btn ux-btn btn-sm" type="button" id="kpiManagerDropdown" data-bs-toggle="dropdown" aria-expanded="false">KPI widgets&nbsp;<i class="bi bi-chevron-down"></i></button> <div class="dropdown-menu p-2" aria-labelledby="kpiManagerDropdown" style="min-width: 340px;"><div class="small text-muted mb-1">KPI cards</div> <!> <!> <hr class="dropdown-divider"> <div class="small text-muted mb-1">Preset cards</div> <div class="d-flex flex-wrap gap-1 mb-2"></div> <hr class="dropdown-divider"> <div class="small text-muted mb-1">Ranking cards</div> <div class="row g-1 mb-2"><div class="col-4"><select class="form-select form-select-sm"><option>Alliance</option><option>Nation</option></select></div> <div class="col-4"><select class="form-select form-select-sm"><option>All</option><option>Coalition 1</option><option>Coalition 2</option><option> </option></select></div> <div class="col-4"><input class="form-control form-control-sm" type="number" min="1"></div> <div class="col-12"><select class="form-select form-select-sm"></select></div> <div class="col-12"><button type="button" class="btn btn-sm btn-outline-secondary w-100">+ Add ranking card</button></div></div> <hr class="dropdown-divider"> <div class="small text-muted mb-1">Metric cards</div> <div class="row g-1"><div class="col-4"><select class="form-select form-select-sm"><option>Alliance</option><option>Nation</option></select></div> <div class="col-4"><select class="form-select form-select-sm"><option>All</option><option>Coalition 1</option><option>Coalition 2</option><option> </option></select></div> <div class="col-4"><select class="form-select form-select-sm"><option>Sum</option><option>Avg</option></select></div> <div class="col-12"><select class="form-select form-select-sm"></select></div> <div class="col-12"><select class="form-select form-select-sm"><option>No normalization</option><!></select></div> <div class="col-12"><button type="button" class="btn btn-sm btn-outline-secondary w-100">+ Add metric card</button></div></div> <hr class="dropdown-divider"> <!></div></li> <li class="d-flex flex-wrap gap-1 justify-content-end"><!></li></ul> <!> <!> <!> <div id="conflict-table-1"></div> <!> <hr> <div class="ux-surface p-2"><h4> </h4> <div class="m-0" id="visualization"></div></div> <!></div>');function Jr(x,g){hn(g,!1);const N=O(),I=O(),dt=O(),jt=O(),Bt=O(),Z=O(),tt=O(),D=O(),et=O(),W=O(),nt=O(),R={COALITION:0,ALLIANCE:1,NATION:2};let $t=O(""),B=O(null),ot=O(!1),ut=O(null),A=O(""),m=O(null),rt=["GROUND_TANKS_MUNITIONS_USED_UNNECESSARY","DOUBLE_FORTIFY","GROUND_NO_TANKS_MUNITIONS_USED_UNNECESSARY","GROUND_NO_TANKS_MUNITIONS_USED_UNNECESSARY_INACTIVE","GROUND_TANKS_NO_LOOT_NO_ENEMY_AIR_INACTIVE","GROUND_TANKS_NO_LOOT_NO_ENEMY_AIR","AIRSTRIKE_SOLDIERS_NONE","AIRSTRIKE_SOLDIERS_SHOULD_USE_GROUND","AIRSTRIKE_TANKS_NONE","AIRSTRIKE_SHIP_NONE","AIRSTRIKE_INACTIVE_NO_GROUND","AIRSTRIKE_INACTIVE_NO_SHIP","AIRSTRIKE_FAILED_NOT_DOGFIGHT","AIRSTRIKE_AIRCRAFT_NONE","AIRSTRIKE_AIRCRAFT_NONE_INACTIVE","AIRSTRIKE_AIRCRAFT_LOW","AIRSTRIKE_INFRA","AIRSTRIKE_MONEY","NAVAL_MAX_VS_NONE"].map(e=>`off:${e.toLowerCase().replaceAll("_"," ")} attacks`),E={Summary:{sort:"off:wars",columns:["name","net:damage","off:wars","def:wars","dealt:damage","loss:damage"]},Dealt:{sort:"dealt:damage",columns:["name","dealt:infra","dealt:~$soldier","dealt:~$tank","dealt:~$aircraft","dealt:~$ship","dealt:~$unit","dealt:~$consume","dealt:~$loot","dealt:damage"]},Received:{sort:"loss:damage",columns:["name","loss:infra","loss:~$soldier","loss:~$tank","loss:~$aircraft","loss:~$ship","loss:~$unit","loss:~$consume","loss:~$loot","loss:damage"]},Units:{sort:"dealt:~$unit",columns:["name","dealt:soldier","dealt:tank","dealt:aircraft","dealt:ship","dealt:~$unit","loss:soldier","loss:tank","loss:aircraft","loss:ship","loss:~$unit","net:~$unit"]},Consumption:{sort:"name",columns:["name","loss:~$building","loss:gasoline","loss:munitions","loss:steel","loss:aluminum","loss:consume gas","loss:consume mun"]},Attacks:{sort:"off:attacks",columns:["name","off:attacks",...rt]}},r=O({layout:R.COALITION,columns:E.Summary.columns,sort:E.Summary.sort,order:"desc"}),V;const gt=()=>Oo(),Q=[{id:"preset-duration",kind:"preset",key:"duration"},{id:"preset-total-dmg",kind:"preset",key:"damage-total"},{id:"preset-net-gap",kind:"preset",key:"net-gap"}],qt=[{id:"rank-alliance-net",kind:"ranking",entity:"alliance",metric:"net:damage",scope:"all",limit:8},{id:"rank-nation-net",kind:"ranking",entity:"nation",metric:"net:damage",scope:"all",limit:10}],bt={duration:"Duration",wars:"Wars tracked","damage-total":"Total damage exchanged","net-gap":"Damage gap","c1-dealt":"Coalition 1 dealt","c2-dealt":"Coalition 2 dealt",participation:"Participation"},Tt={all:"All",coalition1:"Coalition 1",coalition2:"Coalition 2",selection:"Selection snapshot"},F=[...Q,...qt];let k=O([...F]),It=O([]),Xt=O([]),de=O([]),xt=O(null),Lt=O(!1),ke=new Set,Ce=new Set,oe=O("No selection"),ue=O("nation"),Vt=O("net:damage"),Rt=O("all"),Oe=O(10),me=O("nation"),Gt=O("net:damage"),Et=O("all"),ve=O("sum"),fe=O("");const we=()=>`${Ae()}:kpi-collapsed`;function Zt(e){return e==null||isNaN(e)?"N/A":e.toLocaleString()}function Qt(e){return wo(e)}function Ht(){if(!t(B))return;const e=fn(t(B));e.widgets=t(k),$o(t(B),e)}function xa(e){if(!e||typeof e!="object"||!Array.isArray(e.widgets))return;const a=e.widgets.map(n=>To(n,Qt)).filter(n=>n!==null);a.length>0&&f(k,a)}function An(){try{if(!t(B))return;const e=fn(t(B));Array.isArray(e.widgets)&&e.widgets.length>0&&xa({widgets:e.widgets})}catch(e){console.warn("Failed to read KPI config",e)}}function Na(e){f(k,t(k).filter(a=>a.id!==e)),Ht()}function Sa(e,a){f(k,Eo(t(k),e,a)),Ht()}function kn(e,a){f(k,Ko(t(k),e,a)),Ht()}function Cn(e){f(xt,e)}function On(){f(xt,null)}function wn(e){if(!t(xt)||t(xt)===e){f(xt,null);return}const a=t(k).findIndex(n=>n.id===e);if(a===-1){f(xt,null);return}kn(t(xt),a),f(xt,null)}function $e(){const e=Array.from(ke),a=Array.from(Ce),n=[];return e.length>0&&n.push(`${e.length} alliance${e.length===1?"":"s"}`),a.length>0&&n.push(`${a.length} nation${a.length===1?"":"s"}`),{allianceIds:e,nationIds:a,label:n.length>0?n.join(" · "):"No selection"}}function $n(e,a){return e!=="selection"?Tt[e]:a!=null&&a.label?`Selection (${a.label})`:Tt.selection}function _e(e){return e!=="selection"?!0:ke.size>0||Ce.size>0}function Aa(e){return t(k).some(a=>a.kind==="preset"&&a.key===e)}function ka(e,a){var u,s,v;const n=new Set,i=new Set;if(e===R.ALLIANCE)for(const p of a){const _=Number((u=p==null?void 0:p[0])==null?void 0:u[1]);Number.isFinite(_)&&n.add(_)}else if(e===R.NATION)for(const p of a){const _=Number((s=p==null?void 0:p[0])==null?void 0:s[1]),b=Number((v=p==null?void 0:p[0])==null?void 0:v[2]);Number.isFinite(_)&&i.add(_),Number.isFinite(b)&&n.add(b)}else if(t(m)&&e===R.COALITION)for(const p of a){const _=Number(p==null?void 0:p[0]);if(!Number.isFinite(_))continue;const b=t(m).coalitions[_];if(b){for(const S of b.alliance_ids)n.add(S);for(const S of b.nation_ids)i.add(S)}}ke=n,Ce=i;const o=$e();f(oe,o.label)}function Te(e){f(k,[...t(k),e]),Ht()}function Tn(e){Aa(e)||Te({id:Qt("preset"),kind:"preset",key:e})}function Ln(){const e=t(Rt)==="selection"?$e():void 0;t(Rt)==="selection"&&!_e(t(Rt))||Te({id:Qt("ranking"),kind:"ranking",entity:t(ue),metric:t(Vt),scope:t(Rt),limit:Math.max(1,t(Oe)),snapshot:e})}function Rn(){const e=t(Et)==="selection"?$e():void 0;t(Et)==="selection"&&!_e(t(Et))||Te({id:Qt("metric"),kind:"metric",entity:t(me),metric:t(Gt),scope:t(Et),aggregation:t(ve),source:"conflict",normalizeBy:t(fe)||null,snapshot:e})}function En(){f(Lt,!t(Lt)),localStorage.setItem(we(),t(Lt)?"1":"0")}function Kn(){t(Lt)&&(f(Lt,!1),localStorage.setItem(we(),"0"))}function Ca(e){return e==="alliance"?t(D):t(et)}function Le(e,a){return Number(e==null?void 0:e[a])||0}function Oa(e,a,n,i=!1){var v,p;if(i&&a===-1)return Number.isFinite(n)?Math.abs(n)<=100&&`${n}`.includes(".")?n.toLocaleString(void 0,{maximumFractionDigits:2}):n.toLocaleString():"0";const u=((p=(v=e==null?void 0:e.cell_format)==null?void 0:v.formatMoney)!=null?p:[]).includes(a),s=Number(n||0).toLocaleString(void 0,{maximumFractionDigits:2});return u?`$${s}`:s}function wa(e,a,n,i){var u,s,v,p,_,b;if(a==="all")return n.data;if(a==="selection"){const S=new Set((u=i==null?void 0:i.allianceIds)!=null?u:[]),w=new Set((s=i==null?void 0:i.nationIds)!=null?s:[]);return e==="alliance"?S.size===0?[]:n.data.filter(P=>{var j;const H=Number((j=P[0])==null?void 0:j[1]);return S.has(H)}):w.size>0?n.data.filter(P=>{var j;const H=Number((j=P[0])==null?void 0:j[1]);return w.has(H)}):S.size>0?n.data.filter(P=>{var j;const H=Number((j=P[0])==null?void 0:j[2]);return S.has(H)}):[]}if(!t(m))return n.data;const o=a==="coalition1"?new Set((p=(v=t(m).coalitions[0])==null?void 0:v.alliance_ids)!=null?p:[]):new Set((b=(_=t(m).coalitions[1])==null?void 0:_.alliance_ids)!=null?b:[]);return n.data.filter(S=>{var P,H;if(e==="alliance"){const j=Number((P=S[0])==null?void 0:P[1]);return o.has(j)}const w=Number((H=S[0])==null?void 0:H[2]);return o.has(w)})}function Dn(e){if(e.source==="aava")return!e.aavaSnapshot||e.entity!=="alliance"?[]:t(m)?_n(t(m),{header:e.aavaSnapshot.header,primaryIds:e.aavaSnapshot.primaryIds,vsIds:e.aavaSnapshot.vsIds}).map(o=>({label:o.alliance[0],allianceId:o.alliance[1],value:Le(o,e.metric)})).sort((o,u)=>u.value-o.value).map(o=>ba(ga({},o),{valueText:Oa(null,-1,o.value,!0)})).slice(0,Math.max(1,e.limit)):[];const a=Ca(e.entity);if(!a)return[];const n=a.columns.indexOf(e.metric);return n===-1?[]:wa(e.entity,e.scope,a,e.snapshot).map(o=>{var v,p,_,b,S;if(e.entity==="alliance"){const w=Number((v=o[0])==null?void 0:v[1]);return{label:ne((p=o[0])==null?void 0:p[0],w),allianceId:w,value:Number(o[n])||0}}const u=Number((_=o[0])==null?void 0:_[1]),s=Number((b=o[0])==null?void 0:b[2]);return{label:ya((S=o[0])==null?void 0:S[0],u),nationId:u,allianceName:ne(Ee[s],s),allianceId:s,value:Number(o[n])||0}}).sort((o,u)=>u.value-o.value).map(o=>ba(ga({},o),{valueText:Oa(a,n,o.value)})).slice(0,Math.max(1,e.limit))}function Pn(e){if(e.source==="aava"){if(!e.aavaSnapshot||e.entity!=="alliance"||!t(m))return null;const s=_n(t(m),{header:e.aavaSnapshot.header,primaryIds:e.aavaSnapshot.primaryIds,vsIds:e.aavaSnapshot.vsIds}),v=s.map(_=>Le(_,e.metric));if(v.length===0)return null;if(e.normalizeBy){const _=s.map(S=>Le(S,e.normalizeBy));if(e.aggregation==="sum"){const S=v.reduce((P,H)=>P+H,0),w=_.reduce((P,H)=>P+H,0);return w===0?null:S/w}const b=v.map((S,w)=>{const P=_[w];return P===0?null:S/P}).filter(S=>S!=null);return b.length===0?null:b.reduce((S,w)=>S+w,0)/b.length}const p=v.reduce((_,b)=>_+b,0);return e.aggregation==="avg"?p/v.length:p}const a=Ca(e.entity);if(!a)return null;const n=a.columns.indexOf(e.metric);if(n===-1)return null;const i=wa(e.entity,e.scope,a,e.snapshot),o=i.map(s=>Number(s[n])||0);if(o.length===0)return null;if(e.normalizeBy){const s=a.columns.indexOf(e.normalizeBy);if(s===-1)return null;const v=i.map(_=>Number(_[s])||0);if(e.aggregation==="sum"){const _=o.reduce((S,w)=>S+w,0),b=v.reduce((S,w)=>S+w,0);return b===0?null:_/b}const p=o.map((_,b)=>{const S=v[b];return S===0?null:_/S}).filter(_=>_!=null);return p.length===0?null:p.reduce((_,b)=>_+b,0)/p.length}const u=o.reduce((s,v)=>s+v,0);return e.aggregation==="avg"?u/o.length:u}function Kt(e){return Sn(e)}function $a(e){var a,n;if(e.source==="aava"){const i=(n=(a=e.aavaSnapshot)==null?void 0:a.header)!=null?n:"wars";return le(e.metric,i)}return Kt(e.metric)}function Ta(e){var a,n;if(!e.normalizeBy)return null;if(e.source==="aava"){const i=(n=(a=e.aavaSnapshot)==null?void 0:a.header)!=null?n:"wars";return le(e.normalizeBy,i)}return Kt(e.normalizeBy)}function pe(e){var a,n;if((e.kind==="ranking"||e.kind==="metric")&&e.source==="aava"){const i=((a=e.aavaSnapshot)==null?void 0:a.label)||"AAvA snapshot",o=((n=e.aavaSnapshot)==null?void 0:n.header)||"wars";return`AAvA (${i} · ${o})`}return e.kind==="preset"?"Preset":$n(e.scope,e.snapshot)}function Mn(e){if(e.kind==="preset")return bt[e.key];if(e.kind==="ranking")return`${e.entity} · ${$a(e)} · ${pe(e)} · top ${e.limit}`;const a=Ta(e)?` per ${Ta(e)}`:"";return`${e.aggregation.toUpperCase()} ${e.entity} · ${$a(e)}${a} · ${pe(e)}`}function Fn(e,a,n,i,o){f($t,e.name);const u=Jt(e,a,n,i,o);let s=e.coalitions,v=new Set(s[0].alliance_ids),p=new Set(s[1].alliance_ids);a===R.COALITION?u.row_format=(b,S)=>{let w=S[0];w==0?b.classList.add("bg-danger-subtle"):w==1&&b.classList.add("bg-info-subtle")}:a===R.ALLIANCE?u.row_format=(b,S)=>{let w=S[0][1];v.has(w)?b.classList.add("bg-danger-subtle"):p.has(w)&&b.classList.add("bg-info-subtle")}:a===R.NATION&&(u.row_format=(b,S)=>{let w=S[0][2];v.has(w)?b.classList.add("bg-danger-subtle"):p.has(w)&&b.classList.add("bg-info-subtle")}),u.onSelectionChange=b=>{ka(a,b.selectedRows)},ka(a,[]),V=u;const _=document.getElementById("conflict-table-1");Fo(_,V)}function zn(e){let a=e.get("layout");a&&(a==="coalition"?J(r,t(r).layout=R.COALITION):a==="alliance"||a==="1"?J(r,t(r).layout=R.ALLIANCE):(a==="nation"||a==="2")&&J(r,t(r).layout=R.NATION));let n=e.get("sort");n&&J(r,t(r).sort=n);let i=e.get("order");i&&J(r,t(r).order=i);let o=e.get("columns");o&&J(r,t(r).columns=o.split("."));const u=ho("kpiw",e.get("kpiw"));if(u)try{const s=Lo(u,Qt);s.length>0&&f(k,s)}catch(s){console.warn("Failed to parse KPI widgets from URL",s)}}function re(){t(m)&&Fn(t(m),t(r).layout,t(r).columns,t(r).sort,t(r).order)}function Re(e=t(k)){return Ro(e,Qt)}function ge(){return{layout:R.COALITION,sort:E.Summary.sort,order:"desc",columns:E.Summary.columns.join("."),kpiw:Re(F)}}function Un(){const e=Re();Se({layout:t(r).layout,sort:t(r).sort,order:t(r).order,columns:t(r).columns.join("."),kpiw:e},{replace:!0,defaults:ge()}),ee()}function La(e=!1){Se({layout:t(r).layout,sort:t(r).sort,order:t(r).order,columns:t(r).columns.join(".")},{replace:e,defaults:ge()})}function Wn(e=!0){const a=Re();Se({layout:t(r).layout,sort:t(r).sort,order:t(r).order,columns:t(r).columns.join("."),kpiw:a},{replace:e,defaults:ge()})}function Ra(e){return e.map(a=>{const o=a,{id:n}=o;return cn(o,["id"])})}function Ea(e){f(ut,null),f(ot,!1);let a=`https://locutus.s3.ap-southeast-2.amazonaws.com/conflicts/${e}.gzip?${dn.version.conflict_data}`;yo(a).then(n=>{f(m,n),f(A,No(dn.version.conflict_data,n.update_ms)),Ka(n.coalitions[0].alliance_ids,n.coalitions[0].alliance_names),Ka(n.coalitions[1].alliance_ids,n.coalitions[1].alliance_names),re(),n.posts&&Object.keys(n.posts).length&&Gn(n.posts),f(ot,!0),ee()}).catch(n=>{console.error("Failed to load conflict data",n),f(ut,"Could not load conflict data. Please try again later."),f(ot,!0)})}let Ee={};function Ka(e,a){for(let n=0;n<e.length;(n+=1)-1)Ee[e[n]]=ne(a[n],e[n])}In(()=>{go(["layout","sort","order","columns","kpiw"],["id"]),Mo(),se("getIds",(n,i)=>{var o;return(o=t(m))==null?void 0:o.coalitions[i]}),se("formatNation",n=>{let i=n[2],o=ne(Ee[i],i),u=ya(n[0],n[1]);return'<a href="https://politicsandwar.com/alliance/id='+n[2]+'">'+o+'</a> | <a href="https://politicsandwar.com/nation/id='+n[1]+'">'+u+"</a>"}),se("formatAA",n=>{let i=n[1],o=ne(n[0],i);return'<a href="https://politicsandwar.com/alliance/id='+i+'">'+o+"</a>"}),se("formatCol",n=>{let i=n,o=document.createElement("button");return t(m)?(o.setAttribute("type","button"),o.setAttribute("class","ms-1 btn ux-btn btn-sm fw-bold"),o.setAttribute("onclick",`showNames('${t(m).coalitions[i].name}',${i})`),o.textContent=t(m).coalitions[i].name,o.outerHTML):""}),se("download",function(i,o){So(document.getElementById("conflict-table-1").querySelector("table"),i,Ao[o])});const e=bo();zn(e),f(Lt,localStorage.getItem(we())==="1");const a=e.get("id");a?(f(B,a),An(),Ea(t(B))):(f(ut,"Missing conflict id in URL"),f(ot,!0))});function jn(e){J(r,t(r).layout=e),Se({layout:t(r).layout,sort:null,columns:null},{defaults:ge()}),ee(),re()}function Bn(){J(r,t(r).layout=R.COALITION),J(r,t(r).columns=E.Summary.columns),J(r,t(r).sort=E.Summary.sort),J(r,t(r).order="desc"),f(k,[...F]),Ht(),Io(["layout","sort","order","columns","kpiw"],["id"]),Wn(!0),ee(),re()}function Vn(){t(B)&&Ea(t(B))}let Da=!1,be=null;function Pa(){const e=document.getElementById("visjs");if(Da&&be&&(e&&e.getAttribute("data-loaded")||typeof gt()!="undefined")){if(!t(m))return;const a=document.getElementById("visualization");if(!a)return;a.hasChildNodes()&&(a.innerHTML="");const n=gt(),i=new n.DataSet;for(const p in be){const _=be[p],b=_[0],S=`https://forum.politicsandwar.com/index.php?/topic/${b}-${_[1]}`,w=_[2],P=new Date(w);i.add({id:b,content:`<a href="${S}" target="_blank">${p}</a>`,start:P})}const o=t(m).start;let u=t(m).end;u===-1&&(u=Date.now());const s={start:o,end:u,height:"75vh",width:"100%",zoomKey:"ctrlKey",orientation:"top",verticalScroll:!0},v=new n.Timeline(a,i,s);v.addCustomTime(o,"t1"),v.addCustomTime(u,"t2")}}function Gn(e){be=e,Da=!0,Pa()}function Qn(e){e.target.setAttribute("data-loaded","true"),Pa()}X(()=>t(k),()=>{f(It,t(k).filter(e=>e.kind==="preset"))}),X(()=>t(k),()=>{f(Xt,t(k).filter(e=>e.kind==="ranking"))}),X(()=>t(k),()=>{f(de,t(k).filter(e=>e.kind==="metric"))}),X(()=>(t(m),un),()=>{f(N,(()=>{if(!t(m))return"N/A";const e=t(m).start,a=t(m).end===-1?Date.now():t(m).end;return e?un(Math.max(0,Math.round((a-e)/1e3))):"N/A"})())}),X(()=>(t(m),Jt),()=>{f(I,(()=>{if(!t(m))return null;const e=t(m),a=Jt(e,R.COALITION,E.Summary.columns,"name","asc"),n=a.columns.indexOf("dealt:damage"),i=a.columns.indexOf("loss:damage"),o=a.columns.indexOf("net:damage"),u=a.columns.indexOf("off:wars"),s=a.columns.indexOf("def:wars");return n===-1||i===-1||o===-1||u===-1||s===-1?null:a.data.slice(0,2).map((v,p)=>{var _,b;return{idx:p,name:(b=(_=e.coalitions[p])==null?void 0:_.name)!=null?b:`Coalition ${p+1}`,dealt:Number(v[n])||0,received:Number(v[i])||0,net:Number(v[o])||0,wars:(Number(v[u])||0)+(Number(v[s])||0)}})})())}),X(()=>t(I),()=>{f(dt,t(I)?t(I).reduce((e,a)=>e+a.dealt,0):null)}),X(()=>t(I),()=>{f(jt,t(I)?Math.max(...t(I).map(e=>e.wars)):null)}),X(()=>t(I),()=>{f(Bt,t(I)?Math.max(...t(I).map(e=>Math.abs(e.net))):null)}),X(()=>(t(m),Jt),()=>{f(Z,(()=>{if(!t(m))return null;const e=Jt(t(m),R.NATION,E.Summary.columns,"name","asc"),a=e.columns.indexOf("off:wars"),n=e.columns.indexOf("def:wars");if(a===-1||n===-1)return null;const i=e.data.length;if(i===0)return null;const o=e.data.filter(u=>{const s=Number(u[a])||0,v=Number(u[n])||0;return s+v>0}).length;return{active:o,total:i,pct:o/i*100}})())}),X(()=>t(I),()=>{f(tt,t(I)?t(I).reduce((e,a)=>a.net>e.net?a:e,t(I)[0]):null)}),X(()=>(t(m),t(r)),()=>{f(D,t(m)?Jt(t(m),R.ALLIANCE,t(r).columns,t(r).sort,t(r).order):null)}),X(()=>(t(m),t(r)),()=>{f(et,t(m)?Jt(t(m),R.NATION,t(r).columns,t(r).sort,t(r).order):null)}),X(()=>t(et),()=>{f(W,t(et)?t(et).columns.filter((e,a)=>{var o,u,s,v;if(a===0)return!1;const n=(u=(o=t(et).cell_format)==null?void 0:o.formatMoney)!=null?u:[],i=(v=(s=t(et).cell_format)==null?void 0:s.formatNumber)!=null?v:[];return n.includes(a)||i.includes(a)}):[])}),X(()=>(t(W),t(Vt),t(Gt)),()=>{t(W).length>0&&(t(W).includes(t(Vt))||f(Vt,t(W)[0]),t(W).includes(t(Gt))||f(Gt,t(W)[0]))}),X(()=>(t(r),t(k)),()=>{f(nt,(()=>{const e=E.Summary.columns,a=t(r).columns.length===e.length&&t(r).columns.every((s,v)=>s===e[v]),n=t(r).layout===R.COALITION&&t(r).sort===E.Summary.sort&&t(r).order==="desc"&&a,i=JSON.stringify(Ra(t(k))),o=JSON.stringify(Ra(F));return!(n&&i===o)})())}),fo(),bn();var Ke=Rr();mo(e=>{var a=Zo(),n=z(a),i=d(n);h(()=>{var o;return _o.title=`Conflict ${(o=t($t))!=null?o:""}`}),U("load",n,Qn),y(e,a)});var De=c(Ke),Ma=d(c(De)),Hn=d(Ma);L(Hn,()=>{var e;return(e=t(m))==null?void 0:e.wiki},e=>{var a=tr(),n=c(a);ha(),l(a),h(()=>{var i,o,u;ie(a,"href",`https://politicsandwar.fandom.com/wiki/${(i=t(m).wiki)!=null?i:""}`),$(n,`Wiki:${(u=(o=t(m))==null?void 0:o.wiki)!=null?u:""} `)}),y(e,a)}),l(De);var Fa=d(De,2);Po(Fa,{get conflictId(){return t(B)},mode:"layout-picker",get currentLayout(){return t(r).layout},active:"coalition",onLayoutSelect:jn});var Pe=d(Fa,2),za=d(c(Pe),2);Ot(za,1,()=>Object.keys(E),wt,(e,a)=>{var n=er(),i=c(n),o=c(i,!0);l(i),l(n),h(()=>{var u;mn(i,`btn ux-btn btn-sm ms-1 fw-bold ${(u=t(r).columns===E[t(a)].columns?"active":"")!=null?u:""}`),$(o,t(a))}),U("click",i,()=>{J(r,t(r).columns=E[t(a)].columns),J(r,t(r).sort=E[t(a)].sort),La(),ee(),re()}),y(e,n)});var Me=d(za,2),Yn=c(Me),Jn=q(()=>t(It).map(e=>e.key)),qn=q(()=>({widgets:t(k),presetCards:t(It),rankingCards:t(Xt),metricCards:t(de)}));Xo(Yn,{get currentColumns(){return t(r).columns},get currentSort(){return t(r).sort},get currentOrder(){return t(r).order},get currentKpis(){return t(Jn)},get currentKpiConfig(){return t(qn)},$$events:{load:e=>{const a=e.detail.preset;if(J(r,t(r).columns=a.columns),a.sort&&J(r,t(r).sort=a.sort),a.order&&J(r,t(r).order=a.order),a.kpiConfig)xa(a.kpiConfig),Ht();else if(Array.isArray(a.kpis)&&a.kpis.length>0){const n=a.kpis.filter(i=>i in bt).map(i=>i);n.length>0&&(f(k,n.map(i=>({id:Qt("preset"),kind:"preset",key:i}))),Ht())}La(),ee(),re()}}}),l(Me);var Ua=d(Me,2);L(Ua,()=>t(Lt),e=>{var a=ar(),n=c(a);l(a),U("click",n,Kn),y(e,a)});var Fe=d(Ua,2),Wa=d(c(Fe),2),ja=d(c(Wa),2);L(ja,()=>t(k).length===0,e=>{var a=nr();y(e,a)});var Ba=d(ja,2);Ot(Ba,1,()=>t(k),wt,(e,a,n)=>{var i=or(),o=c(i),u=c(o,!0);h(()=>$(u,Mn(t(a)))),l(o);var s=d(o,2),v=c(s);v.disabled=n===0;var p=d(v,2),_=d(p,2);l(s),l(i),h(()=>p.disabled=n===t(k).length-1),U("click",v,Wt(ae(()=>Sa(t(a).id,-1)))),U("click",p,Wt(ae(()=>Sa(t(a).id,1)))),U("click",_,Wt(ae(()=>Na(t(a).id)))),y(e,i)});var ze=d(Ba,6);Ot(ze,5,()=>Object.keys(bt),wt,(e,a)=>{var n=rr();const i=q(()=>t(a));h(()=>n.disabled=Aa(t(i)));var o=c(n);l(n),h(()=>{var u;return $(o,`+ ${(u=bt[t(i)])!=null?u:""}`)}),U("click",n,Wt(ae(()=>Tn(t(i))))),y(e,n)}),l(ze);var Ue=d(ze,6),We=c(Ue),je=c(We);h(()=>{t(ue),zt(()=>{})});var Be=c(je);Be.value=(Be.__value="alliance")==null?"":"alliance";var Va=d(Be);Va.value=(Va.__value="nation")==null?"":"nation",l(je),l(We);var Ve=d(We,2),Ge=c(Ve);h(()=>{t(Rt),zt(()=>{t(oe)})});var Qe=c(Ge);Qe.value=(Qe.__value="all")==null?"":"all";var He=d(Qe);He.value=(He.__value="coalition1")==null?"":"coalition1";var Ye=d(He);Ye.value=(Ye.__value="coalition2")==null?"":"coalition2";var he=d(Ye);he.value=(he.__value="selection")==null?"":"selection";var Xn=c(he);l(he),l(Ge),l(Ve);var Je=d(Ve,2),Ga=c(Je);xn(Ga),l(Je);var qe=d(Je,2),Xe=c(qe);h(()=>{t(Vt),zt(()=>{t(W)})}),Ot(Xe,5,()=>t(W),wt,(e,a)=>{var n=ir(),i={},o=c(n,!0);h(()=>$(o,Kt(t(a)))),l(n),h(()=>{i!==(i=t(a))&&(n.value=(n.__value=t(a))==null?"":t(a))}),y(e,n)}),l(Xe),l(qe);var Qa=d(qe,2),Ha=c(Qa);h(()=>Ha.disabled=!_e(t(Rt))),l(Qa),l(Ue);var Ze=d(Ue,6),ta=c(Ze),ea=c(ta);h(()=>{t(me),zt(()=>{})});var aa=c(ea);aa.value=(aa.__value="alliance")==null?"":"alliance";var Ya=d(aa);Ya.value=(Ya.__value="nation")==null?"":"nation",l(ea),l(ta);var na=d(ta,2),oa=c(na);h(()=>{t(Et),zt(()=>{t(oe)})});var ra=c(oa);ra.value=(ra.__value="all")==null?"":"all";var ia=d(ra);ia.value=(ia.__value="coalition1")==null?"":"coalition1";var sa=d(ia);sa.value=(sa.__value="coalition2")==null?"":"coalition2";var ye=d(sa);ye.value=(ye.__value="selection")==null?"":"selection";var Zn=c(ye);l(ye),l(oa),l(na);var la=d(na,2),ca=c(la);h(()=>{t(ve),zt(()=>{})});var da=c(ca);da.value=(da.__value="sum")==null?"":"sum";var Ja=d(da);Ja.value=(Ja.__value="avg")==null?"":"avg",l(ca),l(la);var ua=d(la,2),ma=c(ua);h(()=>{t(Gt),zt(()=>{t(W)})}),Ot(ma,5,()=>t(W),wt,(e,a)=>{var n=sr(),i={},o=c(n,!0);h(()=>$(o,Kt(t(a)))),l(n),h(()=>{i!==(i=t(a))&&(n.value=(n.__value=t(a))==null?"":t(a))}),y(e,n)}),l(ma),l(ua);var va=d(ua,2),fa=c(va);h(()=>{t(fe),zt(()=>{t(W)})});var _a=c(fa);_a.value=((_a.__value="")==null,"");var to=d(_a);Ot(to,1,()=>t(W),wt,(e,a)=>{var n=lr(),i={},o=c(n);h(()=>{var u;return $(o,`Per ${(u=Kt(t(a)))!=null?u:""}`)}),l(n),h(()=>{i!==(i=t(a))&&(n.value=(n.__value=t(a))==null?"":t(a))}),y(e,n)}),l(fa),l(va);var qa=d(va,2),Xa=c(qa);h(()=>Xa.disabled=!_e(t(Et))),l(qa),l(Ze);var eo=d(Ze,4);L(eo,()=>t(B),e=>{var a=cr();h(()=>ie(a,"href",`aava?id=${t(B)}`)),y(e,a)}),l(Wa),l(Fe);var Za=d(Fe,2),ao=c(Za);xo(ao,{onReset:Bn,onSharePrepare:Un,get resetDirty(){return t(nt)}}),l(Za),l(Pe);var tn=d(Pe,2);L(tn,()=>t(m)&&!t(Lt),e=>{var a=Cr(),n=c(a),i=d(c(n),2);l(n);var o=d(n,2);Ot(o,5,()=>t(k),wt,(u,s)=>{var v=kr();const p=q(()=>t(s).kind==="ranking");var _=c(v),b=c(_),S=d(b,2);L(S,()=>t(s).kind==="preset",w=>{var P=Ft(),H=z(P);L(H,()=>t(s).key==="duration",j=>{var mt=dr(),ht=d(z(mt),2),vt=c(ht,!0);l(ht),h(()=>$(vt,t(N))),y(j,mt)},j=>{var mt=Ft(),ht=z(mt);L(ht,()=>t(s).key==="wars",vt=>{var Nt=ur(),Dt=d(z(Nt),2),St=c(Dt,!0);h(()=>$(St,Zt(t(jt)))),l(Dt),y(vt,Nt)},vt=>{var Nt=Ft(),Dt=z(Nt);L(Dt,()=>t(s).key==="damage-total",St=>{var At=mr(),Pt=d(z(At),2),ft=c(Pt,!0);h(()=>$(ft,Zt(t(dt)))),l(Pt),y(St,At)},St=>{var At=Ft(),Pt=z(At);L(Pt,()=>t(s).key==="net-gap",ft=>{var yt=fr(),K=d(z(yt),2),at=c(K,!0);h(()=>$(at,Zt(t(Bt)))),l(K);var G=d(K,2);L(G,()=>t(tt),kt=>{var _t=vr(),it=c(_t);l(_t),h(()=>{var T;return $(it,`Lead: ${(T=t(tt).name)!=null?T:""}`)}),y(kt,_t)}),y(ft,yt)},ft=>{var yt=Ft(),K=z(yt);L(K,()=>t(s).key==="c1-dealt",at=>{var G=_r(),kt=z(G),_t=c(kt);l(kt);var it=d(kt,2),T=c(it,!0);h(()=>{var M,Y;return $(T,Zt((Y=(M=t(I))==null?void 0:M[0])==null?void 0:Y.dealt))}),l(it),h(()=>{var M,Y,ct,st;return $(_t,`${(st=(ct=(Y=(M=t(I))==null?void 0:M[0])==null?void 0:Y.name)!=null?ct:"Coalition 1")!=null?st:""} dealt`)}),y(at,G)},at=>{var G=Ft(),kt=z(G);L(kt,()=>t(s).key==="c2-dealt",_t=>{var it=pr(),T=z(it),M=c(T);l(T);var Y=d(T,2),ct=c(Y,!0);h(()=>{var st,pt;return $(ct,Zt((pt=(st=t(I))==null?void 0:st[1])==null?void 0:pt.dealt))}),l(Y),h(()=>{var st,pt,te,Ct;return $(M,`${(Ct=(te=(pt=(st=t(I))==null?void 0:st[1])==null?void 0:pt.name)!=null?te:"Coalition 2")!=null?Ct:""} dealt`)}),y(_t,it)},_t=>{var it=Ft(),T=z(it);L(T,()=>t(s).key==="participation",M=>{var Y=br(),ct=d(z(Y),2),st=c(ct,!0);h(()=>$(st,t(Z)?`${t(Z).pct.toFixed(1)}%`:"N/A")),l(ct);var pt=d(ct,2);L(pt,()=>t(Z),te=>{var Ct=gr(),Ie=c(Ct);l(Ct),h(()=>{var xe,Mt;return $(Ie,`${(xe=t(Z).active)!=null?xe:""}/${(Mt=t(Z).total)!=null?Mt:""}
                                            nations with at least one war`)}),y(te,Ct)}),y(M,Y)},null,!0),y(_t,it)},!0),y(at,G)},!0),y(ft,yt)},!0),y(St,At)},!0),y(vt,Nt)},!0),y(j,mt)}),y(w,P)},w=>{var P=Ft(),H=z(P);L(H,()=>t(s).kind==="ranking",j=>{var mt=Sr();const ht=q(()=>Dn(t(s)));var vt=z(mt);const Nt=q(()=>{var T;return(T=t(s).limit)!=null?T:""}),Dt=q(()=>{var T;return(T=t(s).entity)!=null?T:""}),St=q(()=>{var T,M,Y;return(Y=t(s).source==="aava"?le(t(s).metric,(M=(T=t(s).aavaSnapshot)==null?void 0:T.header)!=null?M:"wars"):Kt(t(s).metric))!=null?Y:""}),At=q(()=>{var T;return(T=pe(t(s)))!=null?T:""});var Pt=c(vt);h(()=>$(Pt,`Top ${t(Nt)}
                                    ${t(Dt)}s by
                                    ${t(St)}
                                    (${t(At)})`)),l(vt);var ft=d(vt,2),yt=c(ft),K=c(yt),at=c(K),G=d(c(at)),kt=c(G,!0);l(G);var _t=d(G);L(_t,()=>t(s).entity==="nation",T=>{var M=hr();y(T,M)}),ha(),l(at),l(K);var it=d(K);Ot(it,5,()=>t(ht),wt,(T,M,Y)=>{var ct=Nr(),st=c(ct);st.textContent=Y+1;var pt=d(st),te=c(pt);L(te,()=>t(s).entity==="alliance",Mt=>{var lt=yr(),Yt=c(lt,!0);l(lt),h(()=>{ie(lt,"href",`https://politicsandwar.com/alliance/id=${t(M).allianceId}`),$(Yt,t(M).label)}),y(Mt,lt)},Mt=>{var lt=Ir(),Yt=c(lt,!0);l(lt),h(()=>{ie(lt,"href",`https://politicsandwar.com/nation/id=${t(M).nationId}`),$(Yt,t(M).label)}),y(Mt,lt)}),l(pt);var Ct=d(pt);L(Ct,()=>t(s).entity==="nation",Mt=>{var lt=xr(),Yt=c(lt),so=c(Yt,!0);l(Yt),l(lt),h(()=>{ie(Yt,"href",`https://politicsandwar.com/alliance/id=${t(M).allianceId}`),$(so,t(M).allianceName)}),y(Mt,lt)});var Ie=d(Ct),xe=c(Ie,!0);l(Ie),l(ct),h(()=>$(xe,t(M).valueText)),y(T,ct)}),l(it),l(yt),l(ft),h(()=>$(kt,t(s).entity==="alliance"?"Alliance":"Nation")),y(j,mt)},j=>{var mt=Ar(),ht=z(mt);const vt=q(()=>{var K;return(K=t(s).aggregation.toUpperCase())!=null?K:""}),Nt=q(()=>{var K;return(K=t(s).entity)!=null?K:""}),Dt=q(()=>{var K,at,G;return(G=t(s).source==="aava"?le(t(s).metric,(at=(K=t(s).aavaSnapshot)==null?void 0:K.header)!=null?at:"wars"):Kt(t(s).metric))!=null?G:""}),St=q(()=>{var K,at,G;return(G=t(s).normalizeBy?` per ${t(s).source==="aava"?le(t(s).normalizeBy,(at=(K=t(s).aavaSnapshot)==null?void 0:K.header)!=null?at:"wars"):Kt(t(s).normalizeBy)}`:"")!=null?G:""}),At=q(()=>{var K;return(K=pe(t(s)))!=null?K:""});var Pt=c(ht);h(()=>$(Pt,`${t(vt)}
                                    ${t(Nt)}
                                    ${t(Dt)}
                                    ${t(St)}
                                    (${t(At)})`)),l(ht);var ft=d(ht,2),yt=c(ft,!0);h(()=>$(yt,Zt(Pn(t(s))))),l(ft),y(j,mt)},!0),y(w,P)}),l(_),l(v),h(()=>{mn(v,t(p)?"col-12 col-lg-6":"col-12 col-sm-6 col-xl-4"),ko(_,"kpi-card-dragging",t(xt)===t(s).id)}),U("click",b,()=>Na(t(s).id)),U("dragstart",_,()=>Cn(t(s).id)),U("dragend",_,On),U("dragover",_,Wt(function(w){Do.call(this,g,w)})),U("drop",_,Wt(()=>wn(t(s).id))),y(u,v)}),l(o),l(a),U("click",i,En),y(e,a)});var en=d(tn,2);L(en,()=>!t(ot),e=>{Co(e)});var an=d(en,2);L(an,()=>t(ut),e=>{var a=Or(),n=c(a),i=c(n,!0);l(n);var o=d(n,2);l(a),h(()=>$(i,t(ut))),U("click",o,Vn),y(e,a)});var nn=d(an,4);L(nn,()=>t(r).layout==R.COALITION,e=>{var a=Tr(),n=d(z(a),2),i=c(n);L(i,()=>{var u;return(u=t(m))==null?void 0:u.cb},u=>{var s=wr(),v=c(s),p=d(c(v),2),_=c(p,!0);l(p),l(v),l(s),h(()=>{var b;return $(_,(b=t(m))==null?void 0:b.cb)}),y(u,s)});var o=d(i,2);L(o,()=>{var u;return(u=t(m))==null?void 0:u.status},u=>{var s=$r(),v=c(s),p=d(c(v),2),_=c(p,!0);l(p),l(v),l(s),h(()=>{var b;return $(_,(b=t(m))==null?void 0:b.status)}),y(u,s)}),l(n),y(e,a)});var pa=d(nn,4),on=c(pa);const no=q(()=>{var e,a,n;return(n=vn((a=(e=t(m))==null?void 0:e.start)!=null?a:null))!=null?n:""}),oo=q(()=>{var e,a,n;return(n=vn((a=(e=t(m))==null?void 0:e.end)!=null?a:null))!=null?n:""});var ro=c(on);h(()=>$(ro,`${t(no)} - ${t(oo)}`)),l(on),ha(2),l(pa);var io=d(pa,2);L(io,()=>t(A),e=>{var a=Lr(),n=c(a,!0);l(a),h(()=>$(n,t(A))),y(e,a)}),l(Ke),h(()=>{var e,a,n;$(Ma,` Conflict: ${(e=t($t))!=null?e:""} `),$(Xn,`Selection snapshot (${(a=t(oe))!=null?a:""})`),$(Zn,`Selection snapshot (${(n=t(oe))!=null?n:""})`)}),Ut(je,()=>t(ue),e=>f(ue,e)),Ut(Ge,()=>t(Rt),e=>f(Rt,e)),Nn(Ga,()=>t(Oe),e=>f(Oe,e)),Ut(Xe,()=>t(Vt),e=>f(Vt,e)),U("click",Ha,Wt(ae(Ln))),Ut(ea,()=>t(me),e=>f(me,e)),Ut(oa,()=>t(Et),e=>f(Et,e)),Ut(ca,()=>t(ve),e=>f(ve,e)),Ut(ma,()=>t(Gt),e=>f(Gt,e)),Ut(fa,()=>t(fe),e=>f(fe,e)),U("click",Xa,Wt(ae(Rn))),y(x,Ke),yn()}export{Jr as component};
