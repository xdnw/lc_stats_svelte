import{s as W,u as ue,o as ie,y as me,c as fe,z as be,h as pe,l as he}from"./Progress.sJimGKi_.js";import{u as ge,h as ye}from"./misc.CV3rZvPR.js";function we(o){W("formatNumber",(n,r,b,x)=>n==0?"0":n<1e3&&n>-1e3?n.toString():o.commafy(n)),W("formatMoney",(n,r,b,x)=>n==0?"$0":n<1e3&&n>-1e3?`$${n.toString()}`:`$${o.commafy(n)}`),W("formatDate",(n,r,b,x)=>o.formatDate(n)),W("showNames",(n,r)=>{const b=ue("getIds");if(!b)return;const x=b(n,r),S=x.alliance_ids,I=`Coalition ${r+1}: ${n}`,N=document.createElement("ul");for(let _=0;_<S.length;_++){const A=S[_],Q=o.formatAllianceName(x.alliance_names[_],A),F=document.createElement("a");F.setAttribute("href",`https://politicsandwar.com/alliance/id=${A}`),F.textContent=Q;const z=document.createElement("li");z.appendChild(F),N.appendChild(z)}const v=document.createElement("div"),L=document.createElement("kbd"),E=S.join(",");L.textContent=E,L.setAttribute("readonly","true"),L.setAttribute("class","form-control m-0"),v.appendChild(L);const c=`<button class='btn btn-outline-info btn-sm position-absolute top-0 end-0 m-3' onclick='copyToClipboard("${E}")'><i class='bi bi-clipboard'></i></button>`;v.innerHTML+=c,v.appendChild(N),o.modalWithCloseButton(I,v)}),W("copyToClipboard",n=>{navigator.clipboard.writeText(n).then(()=>{alert("Copied to clipboard")}).catch(r=>{alert("Failed to copy to clipboard"+r)})})}function ke(){we({commafy:ie,formatDate:me,formatAllianceName:fe,modalWithCloseButton:be})}function Ce(o){return o.ensureScriptsLoaded(["jqjs"]).then(()=>{if(typeof jQuery=="undefined")return Promise.reject(new Error("jQuery did not load correctly"))})}function ve(o){return o.ensureScriptsLoaded(["dtjs1","dtjs2","dtjs3"])}function xe(o,n,r){const b=`tblCol-${n}`,x=`dropdownMenuButton-${n}`,S=`table-search-${n}`;o.appendChild(r.htmlToElement(`<div class="ux-toolbar">
    <button class="btn ux-btn" type="button" data-bs-toggle="collapse" data-bs-target="#${b}" aria-expanded="false" aria-controls="${b}">
    <i class="bi bi-layout-three-columns"></i>&nbsp;Customize Columns&nbsp;<i class="bi bi-chevron-down"></i></button>
    <div class="dropdown d-inline">
    <button class="btn ux-btn" type="button" id="${x}" data-bs-toggle="dropdown" aria-expanded="false">
    Export&nbsp;<i class="bi bi-chevron-down"></i>
    </button>
    <ul class="dropdown-menu" aria-labelledby="${x}">
    <li><button class="dropdown-item fw-bold" type="button" onclick="download(false, 'CSV')"><kbd><i class="bi bi-download"></i> ,</kbd> Download CSV</button></li>
    <li><button class="dropdown-item fw-bold" type="button" onclick="download(true, 'CSV')"><kbd><i class="bi bi-copy"></i> ,</kbd> Copy CSV</button></li>
    <li><button class="dropdown-item fw-bold" type="button" onclick="download(false, 'TSV')"><kbd><i class="bi bi-download"></i><i class="bi bi-indent"></i></kbd> Download TSV</button></li>
    <li><button class="dropdown-item fw-bold" type="button" onclick="download(true, 'TSV')"><kbd><i class="bi bi-copy"></i><i class="bi bi-indent"></i></kbd> Copy TSV</button></li>
    </ul>
    </div>
    </div>`)),o.appendChild(r.htmlToElement(`<div class="collapse table-toggles mb-2" id="${b}">
    <input id="${S}" class="form-control-sm w-100 mb-2" type="search" placeholder="Search columns" aria-label="Search columns">
    <div class="ux-callout mb-2">
            Use the buttons at the bottom of the table to hide/show columns. Drag the header to reorder columns.
    </div>
    </div>`)),o.appendChild(r.htmlToElement(`<div class="ux-table-wrap"><table id="${n}" class="bg-body-secondary border table compact table-bordered table-striped d-none" style="width:100%">
        <thead class="table-info"><tr></tr></thead>
        <tbody></tbody>
        <tfoot><tr></tr></tfoot>
    </table></div>`)),o.getElementsByTagName("input")[0].addEventListener("input",function(){var N;const v=o.getElementsByClassName("table-toggles");for(let L=0;L<v.length;L++){const E=v[L].getElementsByTagName("button");for(let c=0;c<E.length;c++)(N=E[c].textContent)!=null&&N.toLowerCase().includes(this.value.toLowerCase())?E[c].classList.remove("d-none"):E[c].classList.add("d-none")}})}function Se(o,n,r,b){function x(S){const I=(S!=null?S:"").toLowerCase();return I.includes("selected")?"ux-col-selected":I.includes("compared")||I.includes("confirmed")?"ux-col-compared":""}Ce(b).then(()=>{var S;const I=$(n),N=r.visible,v=r.columns,L=r.data,E=r.searchable,c=r.cell_format,_=r.row_format;let A=r.sort;const Q=r.onSelectionChange;A==null&&(A=[0,"asc"]);function F(e){return c.formatNumber&&c.formatNumber.includes(e)||c.formatMoney&&c.formatMoney.includes(e)}function z(e){return!!(c.formatMoney&&c.formatMoney.includes(e))}function ne(e,C){const u=Math.round(e*100)/100;return C?`$${b.commafy(u)}`:b.commafy(u)}const oe={};if(c!=null)for(const e in c){const C=c[e];for(const u of C){const y=window[e];oe[u]=y,y==null&&console.log("No function found for "+e)}}const G=[];if(v.length>0)for(let e=0;e<v.length;e++){const C=x(v[e]),u={data:e,className:`details-control ${C}`.trim(),defaultContent:""},y=oe[e];y!=null&&(u.render=y,(y==window.formatNumber||y==window.formatMoney)&&(u.orderDataType="numeric-comma")),G.push(u)}const J=[null],le=o.querySelector("thead tr"),K=o.querySelector("tfoot tr"),se=o.querySelector(".table-toggles");function X(e,C){const u=e.closest("th");if(!u||J[0]==null)return;const y=J[0].column(u.cellIndex);y.search()!==e.value&&y.search(e.value).draw()}function ce(e){e.stopPropagation()}if(le&&K&&se){const e=document.createDocumentFragment(),C=document.createDocumentFragment(),u=document.createElement("tr");u.className="ux-summary-row";const y=document.createElement("th");y.textContent="#",e.appendChild(y);const Y=document.createElement("th");C.appendChild(Y);const V=document.createElement("th");V.className="ux-summary-actions",V.innerHTML='<button type="button" class="btn btn-sm ux-btn ux-select-visible-btn" title="Select all filtered" aria-label="Select all filtered"><i class="bi bi-square" aria-hidden="true"></i></button>',u.appendChild(V);for(let m=0;m<G.length;m++){const R=G[m],q=v[m];N!=null&&(R.visible=N.includes(m));const j=document.createElement("th"),P=document.createElement("th"),H=document.createElement("th");if(H.className="ux-summary-cell",q!=null){const B=x(q);if(B&&(j.classList.add(B),P.classList.add(B),H.classList.add(B)),E==null||E.includes(m)){const d=document.createElement("input");d.type="text",d.placeholder=q,d.style.width="100%",d.addEventListener("keyup",X.bind(null,d)),d.addEventListener("change",X.bind(null,d)),d.addEventListener("clear",X.bind(null,d)),d.addEventListener("click",ce),j.appendChild(d)}else j.textContent=q;if(m!=0){const d=document.createElement("button");d.className="toggle-vis ux-toggle-btn btn btn-sm fw-bold",d.dataset.column=(m+1).toString(),d.textContent=q,P.appendChild(d),R.visible||(d.classList.add("is-hidden"),d.oldParent=P,se.appendChild(d))}}e.appendChild(j),C.appendChild(P),u.appendChild(H)}le.appendChild(e),K.appendChild(C),(S=K.parentElement)==null||S.appendChild(u)}ve(b).then(()=>{const e=new Set;let C=null;function u(t){if(!Q)return;const l=Array.from(e),s=l.map(i=>t.row(i).data()).filter(i=>i!=null);Q({selectedRowIndexes:l,selectedRows:s})}function y(t){return t.rows({search:"applied"}).indexes().toArray()}function Y(t){return t.rows({search:"applied",page:"current"}).indexes().toArray()}function V(t){const l=y(t),s=l.filter(w=>e.has(w)),i=s.length>0?s:l,p=y(t),a=p.length>0&&p.every(w=>e.has(w)),f=a?"Deselect all filtered":"Select all filtered",h=o.querySelector("tfoot tr.ux-summary-row");if(!h)return;const k=h.querySelector(".ux-select-visible-btn");if(k){const w=k.querySelector("i");w&&(w.className=a?"bi bi-check2-square":"bi bi-square"),k.title=f,k.setAttribute("aria-label",f)}const g=t.columns(":visible").indexes().toArray().filter(w=>w>0);let T=1;for(const w of g){const M=h.children[T];if(T++,!M)continue;const D=w-1,O=F(D);if(M.style.display="",!O){M.textContent="";continue}const Z=i.map(ee=>{const U=t.row(ee).data(),te=U?U[D]:0;return typeof te=="number"?te:Number(te)||0});if(Z.length===0){M.textContent="";continue}const ae=Z.reduce((ee,U)=>ee+U,0),de=ae/Z.length,re=z(D);M.innerHTML=`<div class="ux-summary-values"><span>Σ ${ne(ae,re)}</span><span>x̄ ${ne(de,re)}</span></div>`}for(;T<h.children.length;){const w=h.children[T];T++,w&&(w.textContent="")}}$.fn.dataTableExt.oStdClasses.sWrapper="py-2 px-2 dataTables_wrapper";const m=J[0]=I.DataTable({dom:"rt<'ux-dt-bottom'plf>",columns:[{data:null,title:"#",orderable:!1,searchable:!1,className:"dt-center p-0",defaultContent:""},...G],colReorder:!0,data:L,paging:!0,lengthMenu:[[10,25,50,100,-1],[10,25,50,100,"All"]],pageLength:10,deferRender:!0,orderClasses:!1,order:[A],autoWidth:!1,searchHighlight:!1,info:!1,processing:!1,stateSave:!1,scrollX:!1,initComplete:function(){const t=this.api();t.columns.adjust(),V(t)},rowCallback:function(t,l,s,i){const a=this.api().row(t).index(),f=e.has(a);$(t).toggleClass("table-active",f),$("td:eq(0)",t).html(`<label class="d-inline-flex align-items-center m-0 ux-row-index"><input type="checkbox" class="ux-row-select" ${f?"checked":""} /><span>${i+1}</span></label>`),_&&_(t,l,i)},drawCallback:function(){V(this.api())}});m.on("column-reorder",function(t,l,s){m.draw(!1)});function R(t){t.stopPropagation()}function q(){o.querySelectorAll(".table-toggles button, .dataTables_wrapper button").forEach(s=>{s.classList.contains("ux-select-visible-btn")||s.addEventListener("click",R)}),o.querySelectorAll(".table-toggles input, thead input, tfoot input").forEach(s=>{s.addEventListener("click",R)})}function j(t,l){t.querySelectorAll(".toggle-vis").forEach(i=>{i.addEventListener("click",function(p){var a;p.preventDefault();const f=p.currentTarget,h=l.column(f.getAttribute("data-column"));if(h.visible(!h.visible()),f.classList.toggle("is-hidden",!h.visible()),f.parentElement&&f.parentElement.tagName==="TH"){f.oldParent=f.parentElement;const g=t.querySelector(".table-toggles");g.appendChild(f);const T=g.querySelector("input"),w=(a=f.textContent)!=null?a:"";T&&T.value&&!w.toLowerCase().includes(T.value.toLowerCase())&&f.classList.add("d-none")}else{const g=f.oldParent;g&&g.appendChild(f)}const k=l.columns().indexes().filter(g=>g>0&&l.column(g).visible()).map(g=>v[g-1]).toArray();b.setQueryParam("columns",k.join(".")),l.columns.adjust().draw(!1)})})}function P(t){let l="";return m.columns().every(function(s){if(s===0)return;const i=[];c.formatNumber!=null&&i.push(...c.formatNumber),c.formatMoney!=null&&i.push(...c.formatMoney);const p=v[s-1];if(p!=null&&!m.column(s).visible()){let a=t[s-1];i.includes(s-1)&&(a=a.toLocaleString("en-US")),l+="<tr><td>"+p+"</td><td>"+a+"</td></tr>"}}),l===""&&(l="No extra info"),'<table class="bg-body-secondary table table-striped table-bordered compact" cellspacing="0" border="0">'+l+"</table>"}function H(t,l){t.querySelector("tbody").addEventListener("click",function(s){const i=s.target;if(i.classList.contains("details-control")){const p=i.closest("tr");if(!p)return;const a=l.row(p);a.child.isShown()?(a.child.hide(),p.classList.remove("shown")):(a.child(P(a.data())).show(),p.classList.add("shown"))}})}function B(t,l){t.querySelector("tbody").addEventListener("click",function(s){const i=s.target;if(!i.classList.contains("ux-row-select"))return;const p=i.closest("tr");if(!p)return;const a=l.row(p).index(),h=i.checked,k=Y(l),g=k.indexOf(a);if(s.shiftKey&&C!=null&&g>=0){const w=Math.min(C,g),M=Math.max(C,g);for(let D=w;D<=M;D++){const O=k[D];h?e.add(O):e.delete(O)}}else h?e.add(a):e.delete(a);C=g>=0?g:null,u(l),l.draw(!1)})}function d(t){const l=o.querySelector("tfoot tr.ux-summary-row");l&&l.addEventListener("click",function(s){if(!s.target.closest(".ux-select-visible-btn"))return;const a=y(t);a.length>0&&a.every(h=>e.has(h))?a.forEach(h=>e.delete(h)):a.forEach(h=>e.add(h)),u(t),t.draw(!1)})}q(),j(o,m),H(n,m),B(n,m),d(m),u(m),n.classList.remove("d-none"),m.columns.adjust().draw(!1)})})}function Le(o,n,r){o.innerHTML="",xe(o,r.uuidv4(),r);const b=o.getElementsByTagName("table")[0];return Se(o,b,n,r),b}function $e(o,n){return Le(o,n,{uuidv4:ge,htmlToElement:ye,commafy:ie,setQueryParam:pe,ensureScriptsLoaded:he})}export{ke as a,$e as s};
