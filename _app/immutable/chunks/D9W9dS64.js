import{s as K,p as re,x as de,b as ue,z as me,o as ce,h as be,A as fe,C as he}from"./BrECN6iW.js";import{b as pe}from"./D5oqsy_p.js";function ye(o){K("formatNumber",(n,c,d,C)=>n==0?"0":n<1e3&&n>-1e3?n.toString():o.commafy(n)),K("formatMoney",(n,c,d,C)=>n==0?"$0":n<1e3&&n>-1e3?"$".concat(n.toString()):"$".concat(o.commafy(n))),K("formatDate",(n,c,d,C)=>o.formatDate(n)),K("showNames",(n,c)=>{const d=re("getIds");if(!d)return;const C=d(n,c),L=C.alliance_ids,M="Coalition ".concat(c+1,": ").concat(n),R=document.createElement("ul");for(let _=0;_<L.length;_++){const D=L[_],U=o.formatAllianceName(C.alliance_names[_],D),Q=document.createElement("a");Q.setAttribute("href","https://politicsandwar.com/alliance/id=".concat(D)),Q.textContent=U;const X=document.createElement("li");X.appendChild(Q),R.appendChild(X)}const y=document.createElement("div"),j=document.createElement("kbd"),W=L.join(",");j.textContent=W,j.setAttribute("readonly","true"),j.setAttribute("class","form-control m-0"),y.appendChild(j);const w=`<button class='btn btn-outline-info btn-sm position-absolute top-0 end-0 m-3' onclick='copyToClipboard("`.concat(W,`")'><i class='bi bi-clipboard'></i></button>`);y.innerHTML+=w,y.appendChild(R),o.modalWithCloseButton(M,y)}),K("copyToClipboard",n=>{navigator.clipboard.writeText(n).then(()=>{alert("Copied to clipboard")}).catch(c=>{alert("Failed to copy to clipboard"+c)})})}function Le(){ye({commafy:ce,formatDate:me,formatAllianceName:ue,modalWithCloseButton:de})}function we(o){return o.ensureScriptsLoaded(["jqjs"]).then(()=>{if(typeof jQuery=="undefined")return Promise.reject(new Error("jQuery did not load correctly"))})}function ge(o){return o.ensureScriptsLoaded(["dtjs1","dtjs2","dtjs3"])}function xe(o,n,c){const d="tblColModal-".concat(n),C="dropdownMenuButton-".concat(n);o.appendChild(c.htmlToElement(`<div class="ux-toolbar">
    <button class="btn ux-btn" type="button" data-bs-toggle="modal" data-bs-target="#`.concat(d,'" aria-expanded="false" aria-controls="').concat(d,`">
    <i class="bi bi-layout-three-columns"></i>&nbsp;Customize Columns&nbsp;<i class="bi bi-chevron-down"></i></button>
    <div class="dropdown d-inline">
    <button class="btn ux-btn" type="button" id="`).concat(C,`" data-bs-toggle="dropdown" aria-expanded="false">
    Export&nbsp;<i class="bi bi-chevron-down"></i>
    </button>
    <ul class="dropdown-menu" aria-labelledby="`).concat(C,`">
    <li><button class="dropdown-item fw-bold" type="button" onclick="download(false, 'CSV')"><kbd><i class="bi bi-download"></i> ,</kbd> Download CSV</button></li>
    <li><button class="dropdown-item fw-bold" type="button" onclick="download(true, 'CSV')"><kbd><i class="bi bi-copy"></i> ,</kbd> Copy CSV</button></li>
    <li><button class="dropdown-item fw-bold" type="button" onclick="download(false, 'TSV')"><kbd><i class="bi bi-download"></i><i class="bi bi-indent"></i></kbd> Download TSV</button></li>
    <li><button class="dropdown-item fw-bold" type="button" onclick="download(true, 'TSV')"><kbd><i class="bi bi-copy"></i><i class="bi bi-indent"></i></kbd> Copy TSV</button></li>
    </ul>
    </div>
    </div>`))),o.appendChild(c.htmlToElement('<div class="modal fade" id="'.concat(d,'" tabindex="-1" aria-labelledby="').concat(d,`-label" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-scrollable">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="`).concat(d,`-label">Customize Columns</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="ux-callout mb-2">
                    Search and toggle visible columns. Changes apply immediately.
                </div>
                <input class="form-control mb-2 ux-colmgr-search" type="search" placeholder="Search columns" aria-label="Search columns">
                <div class="d-flex flex-wrap align-items-center gap-2 mb-2">
                    <button class="btn ux-btn btn-sm ux-colmgr-all" type="button">Show all</button>
                    <button class="btn ux-btn btn-sm ux-colmgr-none" type="button">Hide all</button>
                    <span class="small ux-muted ux-colmgr-count"></span>
                </div>
                <div class="ux-surface p-2 ux-colmgr-list" style="max-height:50vh;overflow:auto;"></div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>`))),o.appendChild(c.htmlToElement('<div class="ux-table-wrap"><table id="'.concat(n,`" class="bg-body-secondary border table compact table-bordered table-striped d-none" style="width:100%">
        <thead class="table-info"><tr></tr></thead>
        <tbody></tbody>
        <tfoot><tr></tr></tfoot>
    </table></div>`)))}function Ce(o,n,c,d){function C(L){const M=(L!=null?L:"").toLowerCase();return M.includes("selected")?"ux-col-selected":M.includes("compared")||M.includes("confirmed")?"ux-col-compared":""}we(d).then(()=>{var L;const M=$(n),R=c.visible,y=c.columns,j=c.data,W=c.searchable,w=c.cell_format,_=c.row_format;let D=c.sort;const U=c.onSelectionChange;D==null&&(D=[0,"asc"]);function Q(t){return w.formatNumber&&w.formatNumber.includes(t)||w.formatMoney&&w.formatMoney.includes(t)}function X(t){return!!(w.formatMoney&&w.formatMoney.includes(t))}function le(t,g){const u=Math.round(t*100)/100;return g?"$".concat(d.commafy(u)):d.commafy(u)}const se={};if(w!=null)for(const t in w){const g=w[t];for(const u of g){const p=window[t];se[u]=p,p==null&&console.log("No function found for "+t)}}const Y=[];if(y.length>0)for(let t=0;t<y.length;t++){const g=C(y[t]),u={data:t,className:"details-control ".concat(g).trim(),defaultContent:""},p=se[t];p!=null&&(u.render=p,(p==window.formatNumber||p==window.formatMoney)&&(u.orderDataType="numeric-comma")),Y.push(u)}const ee=[null],ae=o.querySelector("thead tr"),te=o.querySelector("tfoot tr");function ne(t,g){const u=t.closest("th");if(!u||ee[0]==null)return;const p=ee[0].column(u);p.search()!==t.value&&p.search(t.value).draw()}function ie(t){t.stopPropagation()}if(ae&&te){const t=document.createDocumentFragment(),g=document.createDocumentFragment(),u=document.createElement("tr");u.className="ux-summary-row";const p=document.createElement("th");p.textContent="#",t.appendChild(p);const oe=document.createElement("th");g.appendChild(oe);const B=document.createElement("th");B.className="ux-summary-actions",B.innerHTML='<button type="button" class="btn btn-sm ux-btn ux-select-visible-btn" title="Select all filtered" aria-label="Select all filtered"><i class="bi bi-square" aria-hidden="true"></i></button>',u.appendChild(B);for(let m=0;m<Y.length;m++){const z=Y[m],q=y[m];R!=null&&(z.visible=R.includes(m));const F=document.createElement("th"),G=document.createElement("th"),O=document.createElement("th");if(O.className="ux-summary-cell",q!=null){const A=C(q);if(A&&(F.classList.add(A),G.classList.add(A),O.classList.add(A)),W==null||W.includes(m)){const e=document.createElement("input");e.type="text",e.placeholder=q,e.style.width="100%",e.addEventListener("keyup",ne.bind(null,e)),e.addEventListener("change",ne.bind(null,e)),e.addEventListener("clear",ne.bind(null,e)),e.addEventListener("click",ie),F.appendChild(e)}else F.textContent=q;G.textContent=m===0?"":q}t.appendChild(F),g.appendChild(G),u.appendChild(O)}ae.appendChild(t),te.appendChild(g),(L=te.parentElement)==null||L.appendChild(u)}ge(d).then(()=>{const t=new Set;let g=null;function u(e){if(!U)return;const l=Array.from(t),s=l.map(i=>e.row(i).data()).filter(i=>i!=null);U({selectedRowIndexes:l,selectedRows:s})}function p(e){return e.rows({search:"applied"}).indexes().toArray()}function oe(e){return e.rows({search:"applied",page:"current"}).indexes().toArray()}function B(e){const l=p(e),s=l.filter(r=>t.has(r)),i=s.length>0?s:l,b=p(e),a=b.length>0&&b.every(r=>t.has(r)),S=a?"Deselect all filtered":"Select all filtered",f=o.querySelector("tfoot tr.ux-summary-row");if(!f)return;const k=f.querySelector(".ux-select-visible-btn");if(k){const r=k.querySelector("i");r&&(r.className=a?"bi bi-check2-square":"bi bi-square"),k.title=S,k.setAttribute("aria-label",S)}const T=e.columns(":visible").indexes().toArray().filter(r=>r>0);let N=1;for(const r of T){const h=f.children[N];if(N++,!h)continue;const E=r-1,V=Q(E);if(h.style.display="",!V){h.textContent="";continue}const P=i.map(I=>{const v=e.row(I).data(),H=v?v[E]:0;return typeof H=="number"?H:Number(H)||0});if(P.length===0){h.textContent="";continue}const x=P.reduce((I,v)=>I+v,0),Z=x/P.length,J=X(E);h.innerHTML='<div class="ux-summary-values"><span>Σ '.concat(le(x,J),"</span><span>x̄ ").concat(le(Z,J),"</span></div>")}for(;N<f.children.length;){const r=f.children[N];N++,r&&(r.textContent="")}}$.fn.dataTableExt.oStdClasses.sWrapper="py-2 px-2 dataTables_wrapper";const m=ee[0]=M.DataTable({dom:"rt<'ux-dt-bottom'plf>",columns:[{data:null,title:"#",orderable:!1,searchable:!1,className:"dt-center p-0",defaultContent:""},...Y],colReorder:!0,data:j,paging:!0,lengthMenu:[[10,25,50,100,-1],[10,25,50,100,"All"]],pageLength:10,deferRender:!0,orderClasses:!1,order:[D],autoWidth:!1,searchHighlight:!1,info:!1,processing:!1,stateSave:!1,scrollX:!1,initComplete:function(){const e=this.api();e.columns.adjust(),B(e)},rowCallback:function(e,l,s,i){const a=this.api().row(e).index(),S=t.has(a);$(e).toggleClass("table-active",S),$("td:eq(0)",e).html('<label class="d-inline-flex align-items-center m-0 ux-row-index"><input type="checkbox" class="ux-row-select" '.concat(S?"checked":""," /><span>").concat(i+1,"</span></label>")),_&&_(e,l,i)},drawCallback:function(){B(this.api())}});m.on("column-reorder",function(e,l,s){m.draw(!1)});function z(e){const l=e.columns().indexes().filter(s=>s>0&&e.column(s).visible()).map(s=>y[s-1]).toArray();d.setQueryParam("columns",l.join("."))}function q(e){const l=o.querySelector(".ux-colmgr-search"),s=o.querySelector(".ux-colmgr-list"),i=o.querySelector(".ux-colmgr-count"),b=o.querySelector(".ux-colmgr-all"),a=o.querySelector(".ux-colmgr-none");if(!l||!s||!i||!b||!a)return;const S=l,f=s,k=i,T=b,N=a;function r(){var h;const E=S.value.trim().toLowerCase();f.innerHTML="";let V=0,P=0;for(let x=0;x<y.length;x++){if(x===0)continue;const Z=(h=y[x])!=null?h:"",J=e.column(x+1).visible();if(J&&V++,E&&!Z.toLowerCase().includes(E))continue;P++;const I=document.createElement("label");I.className="form-check d-flex align-items-center gap-2 mb-1";const v=document.createElement("input");v.type="checkbox",v.className="form-check-input mt-0",v.checked=J,v.addEventListener("change",()=>{e.column(x+1).visible(v.checked),z(e),e.columns.adjust().draw(!1),r()});const H=document.createElement("span");H.textContent=Z,I.appendChild(v),I.appendChild(H),f.appendChild(I)}if(P===0){const x=document.createElement("div");x.className="small ux-muted",x.textContent="No columns match your search.",f.appendChild(x)}k.textContent="Visible: ".concat(V,"/").concat(Math.max(0,y.length-1))}S.addEventListener("input",r),T.addEventListener("click",()=>{for(let h=1;h<y.length;h++)e.column(h+1).visible(!0,!1);z(e),e.columns.adjust().draw(!1),r()}),N.addEventListener("click",()=>{for(let h=1;h<y.length;h++)e.column(h+1).visible(!1,!1);z(e),e.columns.adjust().draw(!1),r()}),r(),e.on("column-visibility",r)}function F(e){let l="";return m.columns().every(function(s){if(s===0)return;const i=[];w.formatNumber!=null&&i.push(...w.formatNumber),w.formatMoney!=null&&i.push(...w.formatMoney);const b=y[s-1];if(b!=null&&!m.column(s).visible()){let a=e[s-1];i.includes(s-1)&&(a=a.toLocaleString("en-US")),l+="<tr><td>"+b+"</td><td>"+a+"</td></tr>"}}),l===""&&(l="No extra info"),'<table class="bg-body-secondary table table-striped table-bordered compact" cellspacing="0" border="0">'+l+"</table>"}function G(e,l){e.querySelector("tbody").addEventListener("click",function(s){const i=s.target;if(i.classList.contains("details-control")){const b=i.closest("tr");if(!b)return;const a=l.row(b);a.child.isShown()?(a.child.hide(),b.classList.remove("shown")):(a.child(F(a.data())).show(),b.classList.add("shown"))}})}function O(e,l){e.querySelector("tbody").addEventListener("click",function(s){const i=s.target;if(!i.classList.contains("ux-row-select"))return;const b=i.closest("tr");if(!b)return;const a=l.row(b).index(),f=i.checked,k=oe(l),T=k.indexOf(a);if(s.shiftKey&&g!=null&&T>=0){const r=Math.min(g,T),h=Math.max(g,T);for(let E=r;E<=h;E++){const V=k[E];f?t.add(V):t.delete(V)}}else f?t.add(a):t.delete(a);g=T>=0?T:null,u(l),l.draw(!1)})}function A(e){const l=o.querySelector("tfoot tr.ux-summary-row");l&&l.addEventListener("click",function(s){if(!s.target.closest(".ux-select-visible-btn"))return;const a=p(e);a.length>0&&a.every(f=>t.has(f))?a.forEach(f=>t.delete(f)):a.forEach(f=>t.add(f)),u(e),e.draw(!1)})}q(m),G(n,m),O(n,m),A(m),u(m),n.classList.remove("d-none"),m.columns.adjust().draw(!1)})})}function ve(o,n,c){o.innerHTML="",xe(o,c.uuidv4(),c);const d=o.getElementsByTagName("table")[0];return Ce(o,d,n,c),d}function ke(o,n){return ve(o,n,{uuidv4:he,htmlToElement:fe,commafy:ce,setQueryParam:pe,ensureScriptsLoaded:be})}export{Le as a,ke as s};
