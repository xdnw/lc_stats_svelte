import{k as v}from"./runtime.mdILdFMH.js";import{l as w}from"./disclose-version.B0B114Pu.js";import{i as A}from"./props.C-lgak6u.js";import"./Progress.sJimGKi_.js";import{r as S,t as I}from"./warWeb.da6xX1jT.js";function _(r,t,e){if(r.multiple)return N(r,t);for(var n of r.options){var i=l(n);if(A(i,t)){n.selected=!0;return}}(!e||t!==void 0)&&(r.selectedIndex=-1)}function k(r,t){v(()=>{var e=new MutationObserver(()=>{var n=r.__value;_(r,n)});return e.observe(r,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),()=>{e.disconnect()}})}function T(r,t){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:t;var n=!0;w(r,"change",()=>{var i;if(r.multiple)i=[].map.call(r.querySelectorAll(":checked"),l);else{var a=r.querySelector(":checked");i=a&&l(a)}e(i)}),v(()=>{var i=t();if(_(r,i,n),n&&i===void 0){var a=r.querySelector(":checked");a!==null&&(i=l(a),e(i))}r.__value=i,n=!1}),k(r)}function N(r,t){for(var e of r.options)e.selected=~t.indexOf(l(e))}function l(r){return"__value"in r?r.__value:r.value}const R=["primary_to_row","row_to_primary","net","total","primary_share_pct","row_share_pct","abs_net"];function C(r){const t=S(r);return{primary_to_row:t.primaryToRowLabel(r),row_to_primary:t.rowToPrimaryLabel(r),net:"Net",total:"Total",primary_share_pct:"Selected share %",row_share_pct:"Compared share %",abs_net:"Abs Net"}}function B(r,t){var e;return(e=C(t)[r])!=null?e:I(r)}var O=Object.defineProperty,d=Object.getOwnPropertySymbols,K=Object.prototype.hasOwnProperty,P=Object.prototype.propertyIsEnumerable,p=(r,t,e)=>t in r?O(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,c=(r,t)=>{for(var e in t||(t={}))K.call(t,e)&&p(r,e,t[e]);if(d)for(var e of d(t))P.call(t,e)&&p(r,e,t[e]);return r};const x=new Set(["duration","wars","damage-total","net-gap","c1-dealt","c2-dealt","participation"]),f={version:1,widgets:[]};function z(r){const t=(r!=null?r:"").trim();return t.length>0?t:"unknown"}function b(r){return`lc_stats:conflict:${z(r)}:kpi-config`}function D(r){try{const t=b(r),e=localStorage.getItem(t);if(!e)return c({},f);const n=JSON.parse(e);return!n||typeof n!="object"?c({},f):{version:1,widgets:Array.isArray(n.widgets)?n.widgets:Array.isArray(n.conflictWidgets)?n.conflictWidgets:[]}}catch(t){return console.warn("Failed to read shared KPI config",t),c({},f)}}function q(r,t){var e;try{const n=b(r);localStorage.setItem(n,JSON.stringify({version:1,widgets:(e=t.widgets)!=null?e:[]}))}catch(n){console.warn("Failed to save shared KPI config",n)}}function h(r){return`${r}-${Math.random().toString(36).slice(2,10)}`}function m(r){return r==="all"||r==="coalition1"||r==="coalition2"||r==="selection"}function g(r){if(!r||typeof r!="object")return;const t=r,e=Array.isArray(t.allianceIds)?t.allianceIds.map(a=>Number(a)).filter(a=>Number.isFinite(a)):[],n=Array.isArray(t.nationIds)?t.nationIds.map(a=>Number(a)).filter(a=>Number.isFinite(a)):[],i=typeof t.label=="string"?t.label:"Selection snapshot";return{allianceIds:e,nationIds:n,label:i}}function y(r){if(!r||typeof r!="object")return;const t=r,e=t.primaryCoalitionIndex===1?1:0,n=typeof t.header=="string"?t.header:"wars",i=typeof t.label=="string"?t.label:"AAvA snapshot",a=Array.isArray(t.primaryIds)?t.primaryIds.map(o=>Number(o)).filter(o=>Number.isFinite(o)):[],s=Array.isArray(t.vsIds)?t.vsIds.map(o=>Number(o)).filter(o=>Number.isFinite(o)):[];return{primaryCoalitionIndex:e,header:n,label:i,primaryIds:a,vsIds:s}}function E(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:h;if(!r||typeof r!="object")return null;const e=r;if(e.kind==="preset")return x.has(e.key)?{id:typeof e.id=="string"?e.id:t("preset"),kind:"preset",key:e.key}:null;if(e.kind==="ranking"){if(!(e.entity==="alliance"||e.entity==="nation")||!m(e.scope)||typeof e.metric!="string")return null;const n=g(e.snapshot),i=y(e.aavaSnapshot);return{id:typeof e.id=="string"?e.id:t("ranking"),kind:"ranking",entity:e.entity,metric:e.metric,scope:e.scope,limit:Math.max(1,Number(e.limit)||10),source:e.source==="aava"?"aava":"conflict",snapshot:n,aavaSnapshot:i}}if(e.kind==="metric"){if(!(e.entity==="alliance"||e.entity==="nation")||!m(e.scope)||!(e.aggregation==="sum"||e.aggregation==="avg")||typeof e.metric!="string")return null;const n=g(e.snapshot),i=y(e.aavaSnapshot);return{id:typeof e.id=="string"?e.id:t("metric"),kind:"metric",entity:e.entity,metric:e.metric,scope:e.scope,aggregation:e.aggregation,source:e.source==="aava"?"aava":"conflict",normalizeBy:typeof e.normalizeBy=="string"?e.normalizeBy:null,snapshot:n,aavaSnapshot:i}}return null}function $(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:h;if(!r||typeof r!="object")return[];const e=r,n=[],i=(a,s)=>{if(Array.isArray(a))for(const o of a){const u=E(o,t);(u==null?void 0:u.kind)===s&&n.push(u)}};return i(e.presetCards,"preset"),i(e.rankingCards,"ranking"),i(e.metricCards,"metric"),n}function H(r,t,e){const n=[...r],i=n.findIndex(o=>o.id===t);if(i===-1)return r;const a=i+e;if(a<0||a>=n.length)return r;const[s]=n.splice(i,1);return n.splice(a,0,s),n}function J(r,t,e){const n=[...r],i=n.findIndex(s=>s.id===t);if(i===-1||i===e||e<0||e>=n.length)return r;const[a]=n.splice(i,1);return n.splice(e,0,a),n}export{R as A,E as a,T as b,$ as c,B as d,H as e,J as f,C as g,h as m,D as r,q as s};
