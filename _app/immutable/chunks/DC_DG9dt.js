import{b as Da,w as Ha,v as Ga}from"./BrECN6iW.js";import{c as Ja,a as g,s as A,e as X,f as k}from"./ByHfNYyH.js";import{i as qa}from"./DPmMxCJa.js";import{c as Qa}from"./TrlPcG3m.js";import{p as Ua,i as ue,b as Va,c as l,r,s as o,j as N,u,n as Ya,t as P,g as n,h as Xa}from"./MAWq1Bs-.js";import{i as Z}from"./DRn8owhI.js";import{e as $,i as ee}from"./D5oqsy_p.js";import{s as aa,r as Za,f as oe}from"./CnrOJzGS.js";import{p as s}from"./BTi-TpZb.js";import{t as $a,r as et}from"./C-5gSOKl.js";const ta=new WeakMap;function at(a){const e=ta.get(a);if(e)return e;const t=a.coalitions[0].alliance_ids,i=a.coalitions[1].alliance_ids,v=[...t,...i],c=new Map;for(let D=0;D<v.length;D++)c.set(v[D],D);const K={};a.coalitions.forEach(D=>{D.alliance_ids.forEach((Q,se)=>{K[Q]=Da(D.alliance_names[se],Q)})});const T={allAllianceIds:v,indexByAllianceId:c,allianceNameById:K};return ta.set(a,T),T}function jt(a,e){var t,i,v,c,K;const{allAllianceIds:T,indexByAllianceId:D,allianceNameById:Q}=at(a),se=a.war_web.headers.indexOf(e.header);if(se<0)return[];const pe=a.war_web.data[se],Se=e.primaryIds.map(x=>{var E;return(E=D.get(x))!=null?E:-1}).filter(x=>x>=0),ye=e.vsIds.map(x=>{var E;return(E=D.get(x))!=null?E:-1}).filter(x=>x>=0),ce=[];let ie=0,me=0;for(const x of ye){let E=0,J=0;for(const ge of Se){const _e=(i=(t=pe[ge])==null?void 0:t[x])!=null?i:0,ae=(c=(v=pe[x])==null?void 0:v[ge])!=null?c:0;E+=Number.isFinite(_e)?_e:0,J+=Number.isFinite(ae)?ae:0}ie+=E,me+=J;const fe=T[x];ce.push({alliance:[(K=Q[fe])!=null?K:"AA:".concat(fe),fe],primary_to_row:E,row_to_primary:J,net:E-J,total:E+J,primary_share_pct:0,row_share_pct:0,abs_net:Math.abs(E-J)})}return ce.forEach(x=>{x.primary_share_pct=ie>0?x.primary_to_row/ie*100:0,x.row_share_pct=me>0?x.row_to_primary/me*100:0}),ce}var tt=k('<div class="small text-muted mt-1"> </div>'),rt=k('<div class="small text-muted">No KPI cards yet.</div>'),it=k('<div class="border rounded p-2 d-flex align-items-start justify-content-between gap-2"><div class="small flex-grow-1"><span class="text-muted me-1"></span> </div> <div class="d-flex gap-1"><button type="button" class="btn btn-sm btn-outline-secondary">Up</button> <button type="button" class="btn btn-sm btn-outline-secondary">Down</button> <button type="button" class="btn btn-sm btn-outline-danger">Remove</button></div></div>'),nt=k('<div class="d-flex flex-column gap-2"></div>'),lt=k('<div class="border rounded p-2 d-flex align-items-center justify-content-between gap-2"><div><div class="small fw-semibold"> </div> <div class="small text-muted"> </div></div> <button type="button" class="btn btn-sm btn-outline-secondary">Add</button></div>'),ot=k('<h6 class="mb-2">Preset cards</h6> <div class="small text-muted mb-2">Quick summaries with fixed definitions.</div> <div class="d-flex flex-column gap-2 mb-3"></div>',1),st=k("<option> </option>"),ct=k("<option> </option>"),dt=k("<option> </option>"),vt=k('<div class="small text-warning mb-3"> </div>'),ut=k('<h6 class="mb-2">Ranking card</h6> <div class="row g-2 mb-2"><div class="col-4"><label class="form-label small mb-1" for="kpi-ranking-entity">Entity</label> <select id="kpi-ranking-entity" class="form-select form-select-sm"></select></div> <div class="col-4"><label class="form-label small mb-1" for="kpi-ranking-scope">Scope</label> <select id="kpi-ranking-scope" class="form-select form-select-sm"></select></div> <div class="col-4"><label class="form-label small mb-1" for="kpi-ranking-limit">Top N</label> <input id="kpi-ranking-limit" class="form-control form-control-sm" type="number" min="1" max="50"/></div> <div class="col-12"><label class="form-label small mb-1" for="kpi-ranking-metric">Metric</label> <select id="kpi-ranking-metric" class="form-select form-select-sm"></select></div></div> <div class="kpi-preview mb-2 svelte-1oyyqgi"><div class="small fw-semibold">Preview</div> <div class="small"> </div> <div class="small text-muted"> </div></div> <button type="button" class="btn btn-sm btn-outline-secondary w-100 mb-3">Add ranking card</button> <!>',1),mt=k("<option> </option>"),ft=k("<option> </option>"),_t=k("<option> </option>"),bt=k("<option> </option>"),pt=k('<div class="small text-warning mt-2"> </div>'),yt=k('<h6 class="mb-2">Metric card</h6> <div class="row g-2 mb-2"><div class="col-4"><label class="form-label small mb-1" for="kpi-metric-entity">Entity</label> <select id="kpi-metric-entity" class="form-select form-select-sm"></select></div> <div class="col-4"><label class="form-label small mb-1" for="kpi-metric-scope">Scope</label> <select id="kpi-metric-scope" class="form-select form-select-sm"></select></div> <div class="col-4"><label class="form-label small mb-1" for="kpi-metric-agg">Aggregation</label> <select id="kpi-metric-agg" class="form-select form-select-sm"><option>Sum</option><option>Average</option></select></div> <div class="col-12"><label class="form-label small mb-1" for="kpi-metric-metric">Metric</label> <select id="kpi-metric-metric" class="form-select form-select-sm"></select></div> <div class="col-12"><label class="form-label small mb-1" for="kpi-metric-normalize">Normalize by (optional)</label> <select id="kpi-metric-normalize" class="form-select form-select-sm"><option>No normalization</option><!></select></div></div> <div class="kpi-preview mb-2 svelte-1oyyqgi"><div class="small fw-semibold">Preview</div> <div class="small"> </div> <div class="small text-muted"> </div></div> <button type="button" class="btn btn-sm btn-outline-secondary w-100">Add metric card</button> <!>',1),gt=k('<div class="border rounded p-2"><div class="small fw-semibold"> </div> <div class="small text-muted"> </div></div>'),ht=k('<hr/> <details><summary class="small fw-semibold cursor-pointer">Metric glossary</summary> <div class="mt-2 d-flex flex-column gap-2"></div></details>',1),kt=k('<hr/> <a class="btn btn-sm btn-outline-secondary w-100">Add AAvA widgets from the AAvA page</a>',1),At=k(`<div class="modal fade show d-block" tabindex="-1" role="dialog" aria-modal="true"><div class="modal-dialog modal-xl modal-dialog-scrollable" role="document"><div class="modal-content"><div class="modal-header"><div><h5 class="modal-title"> </h5> <!></div> <button type="button" class="btn-close" aria-label="Close"></button></div> <div class="modal-body"><div class="row g-3"><div class="col-12 col-lg-6"><h6 class="mb-2">Widget layout</h6> <div class="small text-muted mb-2">Reorder cards to control render order on the KPI
                                dashboard.</div> <!></div> <div class="col-12 col-lg-6"><!> <!> <!> <!> <!></div></div></div> <div class="modal-footer"><button class="btn btn-outline-secondary">Close</button></div></div></div></div> <div class="modal-backdrop fade show"></div>`,1);function Dt(a,e){Ua(e,!1);let t=s(e,"open",8,!1),i=s(e,"title",8,"KPI Builder"),v=s(e,"description",8,""),c=s(e,"widgets",24,()=>[]),K=s(e,"showPresetSection",8,!0),T=s(e,"showRankingSection",8,!0),D=s(e,"showMetricSection",8,!0),Q=s(e,"presetCardLabels",8,null),se=s(e,"presetCardDescriptions",24,()=>({})),pe=s(e,"rankingEntityOptions",24,()=>[{value:"alliance",label:"Alliance"},{value:"nation",label:"Nation"}]),Se=s(e,"metricEntityOptions",24,()=>[{value:"alliance",label:"Alliance"},{value:"nation",label:"Nation"}]),ye=s(e,"scopeOptions",24,()=>[{value:"all",label:"All"},{value:"coalition1",label:"Coalition 1"},{value:"coalition2",label:"Coalition 2"},{value:"selection",label:"Selection"}]),ce=s(e,"rankingEntityToAdd",12,"nation"),ie=s(e,"rankingMetricToAdd",12,""),me=s(e,"rankingScopeToAdd",12,"all"),x=s(e,"rankingLimitToAdd",12,10),E=s(e,"metricEntityToAdd",12,"nation"),J=s(e,"metricMetricToAdd",12,""),fe=s(e,"metricScopeToAdd",12,"all"),ge=s(e,"metricAggToAdd",12,"sum"),_e=s(e,"metricNormalizeByToAdd",12,""),ae=s(e,"metricsOptions",24,()=>[]),pa=s(e,"selectedSnapshotLabel",8,"No selection"),Fe=s(e,"canAddRanking",8,!0),Be=s(e,"canAddMetric",8,!0),We=s(e,"canAddRankingReason",8,""),je=s(e,"canAddMetricReason",8,""),De=s(e,"showMetricGlossary",8,!1),ya=s(e,"showAavaHint",8,!1),He=s(e,"aavaHref",8,null),Ge=s(e,"widgetManagerLabel",8,()=>""),U=s(e,"metricLabel",8,_=>_),he=s(e,"metricDescription",8,()=>"Choose a metric");const be=Qa();function Ne(){be("close")}function ga(_){be("removeWidget",{id:_})}function Je(_,H){be("moveWidget",{id:_,delta:H})}function ha(_){be("addPreset",{key:_})}function ka(){be("addRanking")}function Aa(){be("addMetric")}function Ce(_){return _.value!=="selection"?_.label:`${_.label} (${pa()})`}function qe(_){const H=ye().find(F=>F.value===_);return H?Ce(H):_}function xa(){var H,F;const _=(F=(H=pe().find(de=>de.value===ce()))==null?void 0:H.label)!=null?F:ce();return`Top ${Math.max(1,Number(x())||1)} ${_.toLowerCase()}s by ${U()(ie())} in ${qe(me())}`}function Ia(){var F,de;const _=(de=(F=Se().find(Me=>Me.value===E()))==null?void 0:F.label)!=null?de:E(),H=_e()?` per ${U()(_e())}`:"";return`${ge().toUpperCase()} ${_.toLowerCase()} ${U()(J())}${H} in ${qe(fe())}`}function wa(){return ae().map(_=>({metric:_,label:U()(_),description:he()(_)}))}qa();var Qe=Ja(),Sa=ue(Qe);{var Na=_=>{var H=At(),F=ue(H),de=l(F),Me=l(de),Pe=l(Me),Te=l(Pe),Ee=l(Te),Ma=l(Ee,!0);r(Ee);var Ca=o(Ee,2);{var Pa=d=>{var p=tt(),I=l(p,!0);r(p),P(()=>A(I,v())),g(d,p)};Z(Ca,d=>{v()&&d(Pa)})}r(Te);var Ta=o(Te,2);r(Pe);var ze=o(Pe,2),Ue=l(ze),Oe=l(Ue),Ea=o(l(Oe),4);{var za=d=>{var p=rt();g(d,p)},Oa=d=>{var p=nt();$(p,5,c,ee,(I,M,z)=>{var y=it(),w=l(y),C=l(w);C.textContent=`#${z+1}`;var R=o(C);r(w);var L=o(w,2),O=l(L);O.disabled=z===0;var B=o(O,2),G=o(B,2);r(L),r(y),P(W=>{A(R,` ${W!=null?W:""}`),B.disabled=(N(c()),u(()=>z===c().length-1))},[()=>(N(Ge()),n(M),u(()=>Ge()(n(M))))]),X("click",O,()=>Je(n(M).id,-1)),X("click",B,()=>Je(n(M).id,1)),X("click",G,()=>ga(n(M).id)),g(I,y)}),r(p),g(d,p)};Z(Ea,d=>{N(c()),u(()=>c().length===0)?d(za):d(Oa,!1)})}r(Oe);var Ve=o(Oe,2),Ye=l(Ve);{var Ra=d=>{var p=ot(),I=o(ue(p),4);$(I,5,()=>(N(Q()),u(()=>Object.keys(Q()))),ee,(M,z)=>{const y=Xa(()=>n(z));var w=lt(),C=l(w),R=l(C),L=l(R,!0);r(R);var O=o(R,2),B=l(O,!0);r(O),r(C);var G=o(C,2);r(w),P(W=>{A(L,(N(Q()),N(n(y)),u(()=>Q()[n(y)]))),A(B,(N(se()),N(n(y)),u(()=>{var te;return(te=se()[n(y)])!=null?te:"Fixed KPI summary card."}))),G.disabled=W},[()=>(N(c()),N(n(y)),u(()=>c().some(W=>W.kind==="preset"&&W.key===n(y))))]),X("click",G,()=>ha(n(y))),g(M,w)}),r(I),g(d,p)};Z(Ye,d=>{K()&&Q()&&d(Ra)})}var Xe=o(Ye,2);{var La=d=>{var p=ut(),I=o(ue(p),2),M=l(I),z=o(l(M),2);$(z,5,pe,ee,(j,f)=>{var h=st(),re=l(h,!0);r(h);var V={};P(()=>{var ne;A(re,(n(f),u(()=>n(f).label))),V!==(V=(n(f),u(()=>n(f).value)))&&(h.value=(ne=h.__value=(n(f),u(()=>n(f).value)))!=null?ne:"")}),g(j,h)}),r(z),r(M);var y=o(M,2),w=o(l(y),2);$(w,5,ye,ee,(j,f)=>{var h=ct(),re=l(h,!0);r(h);var V={};P(ne=>{var S;A(re,ne),V!==(V=(n(f),u(()=>n(f).value)))&&(h.value=(S=h.__value=(n(f),u(()=>n(f).value)))!=null?S:"")},[()=>(n(f),u(()=>Ce(n(f))))]),g(j,h)}),r(w),r(y);var C=o(y,2),R=o(l(C),2);Za(R),r(C);var L=o(C,2),O=o(l(L),2);$(O,5,ae,ee,(j,f)=>{var h=dt(),re=l(h,!0);r(h);var V={};P(ne=>{var S;A(re,ne),V!==(V=n(f))&&(h.value=(S=h.__value=n(f))!=null?S:"")},[()=>(N(U()),n(f),u(()=>U()(n(f))))]),g(j,h)}),r(O),r(L),r(I);var B=o(I,2),G=o(l(B),2),W=l(G,!0);r(G);var te=o(G,2),ke=l(te,!0);r(te),r(B);var Ae=o(B,2),xe=o(Ae,2);{var Ie=j=>{var f=vt(),h=l(f,!0);r(f),P(()=>A(h,We())),g(j,f)};Z(xe,j=>{!Fe()&&We()&&j(Ie)})}P((j,f)=>{A(W,j),A(ke,f),Ae.disabled=!Fe()},[()=>u(xa),()=>(N(he()),N(ie()),u(()=>he()(ie())))]),oe(z,ce),oe(w,me),Ga(R,x),oe(O,ie),X("click",Ae,ka),g(d,p)};Z(Xe,d=>{T()&&d(La)})}var Ze=o(Xe,2);{var Ka=d=>{var p=yt(),I=o(ue(p),2),M=l(I),z=o(l(M),2);$(z,5,Se,ee,(S,m)=>{var b=mt(),ve=l(b,!0);r(b);var q={};P(()=>{var Y;A(ve,(n(m),u(()=>n(m).label))),q!==(q=(n(m),u(()=>n(m).value)))&&(b.value=(Y=b.__value=(n(m),u(()=>n(m).value)))!=null?Y:"")}),g(S,b)}),r(z),r(M);var y=o(M,2),w=o(l(y),2);$(w,5,ye,ee,(S,m)=>{var b=ft(),ve=l(b,!0);r(b);var q={};P(Y=>{var le;A(ve,Y),q!==(q=(n(m),u(()=>n(m).value)))&&(b.value=(le=b.__value=(n(m),u(()=>n(m).value)))!=null?le:"")},[()=>(n(m),u(()=>Ce(n(m))))]),g(S,b)}),r(w),r(y);var C=o(y,2),R=o(l(C),2),L=l(R);L.value=L.__value="sum";var O=o(L);O.value=O.__value="avg",r(R),r(C);var B=o(C,2),G=o(l(B),2);$(G,5,ae,ee,(S,m)=>{var b=_t(),ve=l(b,!0);r(b);var q={};P(Y=>{var le;A(ve,Y),q!==(q=n(m))&&(b.value=(le=b.__value=n(m))!=null?le:"")},[()=>(N(U()),n(m),u(()=>U()(n(m))))]),g(S,b)}),r(G),r(B);var W=o(B,2),te=o(l(W),2),ke=l(te);ke.value=ke.__value="";var Ae=o(ke);$(Ae,1,ae,ee,(S,m)=>{var b=bt(),ve=l(b);r(b);var q={};P(Y=>{var le;A(ve,`Per ${Y!=null?Y:""}`),q!==(q=n(m))&&(b.value=(le=b.__value=n(m))!=null?le:"")},[()=>(N(U()),n(m),u(()=>U()(n(m))))]),g(S,b)}),r(te),r(W),r(I);var xe=o(I,2),Ie=o(l(xe),2),j=l(Ie,!0);r(Ie);var f=o(Ie,2),h=l(f,!0);r(f),r(xe);var re=o(xe,2),V=o(re,2);{var ne=S=>{var m=pt(),b=l(m,!0);r(m),P(()=>A(b,je())),g(S,m)};Z(V,S=>{!Be()&&je()&&S(ne)})}P((S,m)=>{A(j,S),A(h,m),re.disabled=!Be()},[()=>u(Ia),()=>(N(he()),N(J()),u(()=>he()(J())))]),oe(z,E),oe(w,fe),oe(R,ge),oe(G,J),oe(te,_e),X("click",re,Aa),g(d,p)};Z(Ze,d=>{D()&&d(Ka)})}var $e=o(Ze,2);{var Fa=d=>{var p=ht(),I=o(ue(p),2),M=o(l(I),2);$(M,5,()=>u(wa),ee,(z,y)=>{var w=gt(),C=l(w),R=l(C,!0);r(C);var L=o(C,2),O=l(L,!0);r(L),r(w),P(()=>{A(R,(n(y),u(()=>n(y).label))),A(O,(n(y),u(()=>n(y).description)))}),g(z,w)}),r(M),r(I),g(d,p)};Z($e,d=>{N(De()),N(ae()),u(()=>De()&&ae().length>0)&&d(Fa)})}var Ba=o($e,2);{var Wa=d=>{var p=kt(),I=o(ue(p),2);P(()=>aa(I,"href",He())),g(d,p)};Z(Ba,d=>{ya()&&He()&&d(Wa)})}r(Ve),r(Ue),r(ze);var ea=o(ze,2),ja=l(ea);r(ea),r(Me),r(de),r(F),Ya(2),P(()=>{aa(F,"aria-label",i()),A(Ma,i())}),X("click",Ta,Ne),X("click",ja,Ne),X("click",F,Ha(Ne)),X("keydown",F,d=>{d.key==="Escape"&&Ne()}),g(_,H)};Z(Sa,_=>{t()&&_(Na)})}g(a,Qe),Va()}const Ht=["primary_to_row","row_to_primary","net","total","primary_share_pct","row_share_pct","abs_net"];function xt(a){const e=et(a);return{primary_to_row:e.primaryToRowLabel(a),row_to_primary:e.rowToPrimaryLabel(a),net:"Net",total:"Total",primary_share_pct:"Selected share %",row_share_pct:"Compared share %",abs_net:"Abs Net"}}function Gt(a,e){var t;return(t=xt(e)[a])!=null?t:$a(a)}var It=Object.defineProperty,ra=Object.getOwnPropertySymbols,wt=Object.prototype.hasOwnProperty,St=Object.prototype.propertyIsEnumerable,ia=(a,e,t)=>e in a?It(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t,Re=(a,e)=>{for(var t in e||(e={}))wt.call(e,t)&&ia(a,t,e[t]);if(ra)for(var t of ra(e))St.call(e,t)&&ia(a,t,e[t]);return a};const Nt=new Set(["duration","wars","damage-total","net-gap","c1-dealt","c2-dealt","off-wars-per-nation"]),Le={version:1,widgets:[]};function Mt(a){const e=(a!=null?a:"").trim();return e.length>0?e:"unknown"}function ba(a){return"lc_stats:conflict:".concat(Mt(a),":kpi-config")}function Jt(a){try{const e=ba(a),t=localStorage.getItem(e);if(!t)return Re({},Le);const i=JSON.parse(t);return!i||typeof i!="object"?Re({},Le):{version:1,widgets:Array.isArray(i.widgets)?i.widgets:[]}}catch(e){return console.warn("Failed to read shared KPI config",e),Re({},Le)}}function qt(a,e){var t;try{const i=ba(a);localStorage.setItem(i,JSON.stringify({version:1,widgets:(t=e.widgets)!=null?t:[]}))}catch(i){console.warn("Failed to save shared KPI config",i)}}function Ke(a){return"".concat(a,"-").concat(Math.random().toString(36).slice(2,10))}function na(a){return a==="all"||a==="coalition1"||a==="coalition2"||a==="selection"}function la(a){if(!a||typeof a!="object")return;const e=a,t=Array.isArray(e.allianceIds)?e.allianceIds.map(c=>Number(c)).filter(c=>Number.isFinite(c)):[],i=Array.isArray(e.nationIds)?e.nationIds.map(c=>Number(c)).filter(c=>Number.isFinite(c)):[],v=typeof e.label=="string"?e.label:"Selection snapshot";return{allianceIds:t,nationIds:i,label:v}}function oa(a){if(!a||typeof a!="object")return;const e=a,t=e.primaryCoalitionIndex===1?1:0,i=typeof e.header=="string"?e.header:"wars",v=typeof e.label=="string"?e.label:"AAvA snapshot",c=Array.isArray(e.primaryIds)?e.primaryIds.map(T=>Number(T)).filter(T=>Number.isFinite(T)):[],K=Array.isArray(e.vsIds)?e.vsIds.map(T=>Number(T)).filter(T=>Number.isFinite(T)):[];return{primaryCoalitionIndex:t,header:i,label:v,primaryIds:c,vsIds:K}}function we(a){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Ke;if(!a||typeof a!="object")return null;const t=a;if(t.kind==="preset")return Nt.has(t.key)?{id:typeof t.id=="string"?t.id:e("preset"),kind:"preset",key:t.key}:null;if(t.kind==="ranking"){if(!(t.entity==="alliance"||t.entity==="nation")||!na(t.scope)||typeof t.metric!="string")return null;const i=la(t.snapshot),v=oa(t.aavaSnapshot);return{id:typeof t.id=="string"?t.id:e("ranking"),kind:"ranking",entity:t.entity,metric:t.metric,scope:t.scope,limit:Math.max(1,Number(t.limit)||10),source:t.source==="aava"?"aava":"conflict",snapshot:i,aavaSnapshot:v}}if(t.kind==="metric"){if(!(t.entity==="alliance"||t.entity==="nation")||!na(t.scope)||!(t.aggregation==="sum"||t.aggregation==="avg")||typeof t.metric!="string")return null;const i=la(t.snapshot),v=oa(t.aavaSnapshot);return{id:typeof t.id=="string"?t.id:e("metric"),kind:"metric",entity:t.entity,metric:t.metric,scope:t.scope,aggregation:t.aggregation,source:t.source==="aava"?"aava":"conflict",normalizeBy:typeof t.normalizeBy=="string"?t.normalizeBy:null,snapshot:i,aavaSnapshot:v}}return null}function sa(a){if(a==="coalition1")return"c1";if(a==="coalition2")return"c2";if(a==="selection")return"sel"}function ca(a){return a==="c1"?"coalition1":a==="c2"?"coalition2":a==="sel"?"selection":"all"}function da(a){return a==="alliance"?"a":"n"}function va(a){return a==="a"?"alliance":"nation"}function ua(a){var e,t;if(!a)return;const i=(e=a.allianceIds)!=null&&e.length?[...a.allianceIds]:void 0,v=(t=a.nationIds)!=null&&t.length?[...a.nationIds]:void 0;if(!(!i&&!v))return{a:i,n:v}}function ma(a){if(a)return{allianceIds:Array.isArray(a.a)?a.a.map(e=>Number(e)).filter(e=>Number.isFinite(e)):[],nationIds:Array.isArray(a.n)?a.n.map(e=>Number(e)).filter(e=>Number.isFinite(e)):[],label:"Selection snapshot"}}function fa(a){var e,t;if(!a)return;const i=a.header&&a.header!=="wars"?a.header:void 0,v=(e=a.primaryIds)!=null&&e.length?[...a.primaryIds]:void 0,c=(t=a.vsIds)!=null&&t.length?[...a.vsIds]:void 0;if(!(!i&&!v&&!c))return{h:i,p:v,v:c}}function _a(a){if(a)return{header:typeof a.h=="string"?a.h:"wars",primaryCoalitionIndex:0,primaryIds:Array.isArray(a.p)?a.p.map(e=>Number(e)).filter(e=>Number.isFinite(e)):[],vsIds:Array.isArray(a.v)?a.v.map(e=>Number(e)).filter(e=>Number.isFinite(e)):[],label:"AAvA snapshot"}}function Ct(a){return a.kind==="preset"?{k:"p",p:a.key}:a.kind==="ranking"?{k:"r",e:da(a.entity),m:a.metric,s:sa(a.scope),l:a.limit!==10?Math.max(1,Number(a.limit)||10):void 0,z:a.source==="aava"?"a":void 0,ss:a.scope==="selection"?ua(a.snapshot):void 0,as:a.source==="aava"?fa(a.aavaSnapshot):void 0}:{k:"m",e:da(a.entity),m:a.metric,s:sa(a.scope),g:a.aggregation==="avg"?"a":void 0,n:typeof a.normalizeBy=="string"&&a.normalizeBy.length>0?a.normalizeBy:void 0,z:a.source==="aava"?"a":void 0,ss:a.scope==="selection"?ua(a.snapshot):void 0,as:a.source==="aava"?fa(a.aavaSnapshot):void 0}}function Pt(a){if(!a||typeof a!="object")return null;const e=a;return e.k==="p"?we({kind:"preset",key:e.p}):e.k==="r"?!(e.e==="a"||e.e==="n")||typeof e.m!="string"?null:we({kind:"ranking",entity:va(e.e),metric:e.m,scope:ca(e.s),limit:Number(e.l)||10,source:e.z==="a"?"aava":"conflict",snapshot:ma(e.ss),aavaSnapshot:_a(e.as)}):e.k==="m"?!(e.e==="a"||e.e==="n")||typeof e.m!="string"?null:we({kind:"metric",entity:va(e.e),metric:e.m,scope:ca(e.s),aggregation:e.g==="a"?"avg":"sum",source:e.z==="a"?"aava":"conflict",normalizeBy:typeof e.n=="string"?e.n:null,snapshot:ma(e.ss),aavaSnapshot:_a(e.as)}):null}function Qt(a){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Ke;try{if(!a||a.length===0)return null;const t=a.map(i=>we(i,e)).filter(i=>i!==null).map(i=>Ct(i)).filter(i=>i!==null);return t.length===0?null:JSON.stringify(t)}catch(t){return console.warn("Failed to serialize compact KPI widgets",t),null}}function Ut(a){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Ke;try{const t=JSON.parse(a);return Array.isArray(t)?t.map(i=>Pt(i)).filter(i=>i!==null).map(i=>we(i,e)):[]}catch(t){return[]}}function Vt(a,e,t){const i=[...a],v=i.findIndex(T=>T.id===e);if(v===-1)return a;const c=v+t;if(c<0||c>=i.length)return a;const[K]=i.splice(v,1);return i.splice(c,0,K),i}function Yt(a,e,t){const i=[...a],v=i.findIndex(K=>K.id===e);if(v===-1||v===t||t<0||t>=i.length)return a;const[c]=i.splice(v,1);return i.splice(t,0,c),i}export{Ht as A,Dt as K,qt as a,Vt as b,jt as c,Qt as d,Gt as e,Yt as f,xt as g,Ke as m,Ut as p,Jt as r,we as s};
