import{s as W,l as ut,q as mt,b as ft,t as bt,k as rt,h as pt,u as ht,v as gt}from"./DqDmrPFw.js";import{b as yt}from"./BLlCKcKh.js";function wt(o){W("formatNumber",(n,c,b,x)=>n==0?"0":n<1e3&&n>-1e3?n.toString():o.commafy(n)),W("formatMoney",(n,c,b,x)=>n==0?"$0":n<1e3&&n>-1e3?"$".concat(n.toString()):"$".concat(o.commafy(n))),W("formatDate",(n,c,b,x)=>o.formatDate(n)),W("showNames",(n,c)=>{const b=ut("getIds");if(!b)return;const x=b(n,c),S=x.alliance_ids,N="Coalition ".concat(c+1,": ").concat(n),I=document.createElement("ul");for(let _=0;_<S.length;_++){const D=S[_],Q=o.formatAllianceName(x.alliance_names[_],D),F=document.createElement("a");F.setAttribute("href","https://politicsandwar.com/alliance/id=".concat(D)),F.textContent=Q;const z=document.createElement("li");z.appendChild(F),I.appendChild(z)}const v=document.createElement("div"),L=document.createElement("kbd"),E=S.join(",");L.textContent=E,L.setAttribute("readonly","true"),L.setAttribute("class","form-control m-0"),v.appendChild(L);const i=`<button class='btn btn-outline-info btn-sm position-absolute top-0 end-0 m-3' onclick='copyToClipboard("`.concat(E,`")'><i class='bi bi-clipboard'></i></button>`);v.innerHTML+=i,v.appendChild(I),o.modalWithCloseButton(N,v)}),W("copyToClipboard",n=>{navigator.clipboard.writeText(n).then(()=>{alert("Copied to clipboard")}).catch(c=>{alert("Failed to copy to clipboard"+c)})})}function kt(){wt({commafy:rt,formatDate:bt,formatAllianceName:ft,modalWithCloseButton:mt})}function Ct(o){return o.ensureScriptsLoaded(["jqjs"]).then(()=>{if(typeof jQuery=="undefined")return Promise.reject(new Error("jQuery did not load correctly"))})}function vt(o){return o.ensureScriptsLoaded(["dtjs1","dtjs2","dtjs3"])}function xt(o,n,c){const b="tblCol-".concat(n),x="dropdownMenuButton-".concat(n),S="table-search-".concat(n);o.appendChild(c.htmlToElement(`<div class="ux-toolbar">
    <button class="btn ux-btn" type="button" data-bs-toggle="collapse" data-bs-target="#`.concat(b,'" aria-expanded="false" aria-controls="').concat(b,`">
    <i class="bi bi-layout-three-columns"></i>&nbsp;Customize Columns&nbsp;<i class="bi bi-chevron-down"></i></button>
    <div class="dropdown d-inline">
    <button class="btn ux-btn" type="button" id="`).concat(x,`" data-bs-toggle="dropdown" aria-expanded="false">
    Export&nbsp;<i class="bi bi-chevron-down"></i>
    </button>
    <ul class="dropdown-menu" aria-labelledby="`).concat(x,`">
    <li><button class="dropdown-item fw-bold" type="button" onclick="download(false, 'CSV')"><kbd><i class="bi bi-download"></i> ,</kbd> Download CSV</button></li>
    <li><button class="dropdown-item fw-bold" type="button" onclick="download(true, 'CSV')"><kbd><i class="bi bi-copy"></i> ,</kbd> Copy CSV</button></li>
    <li><button class="dropdown-item fw-bold" type="button" onclick="download(false, 'TSV')"><kbd><i class="bi bi-download"></i><i class="bi bi-indent"></i></kbd> Download TSV</button></li>
    <li><button class="dropdown-item fw-bold" type="button" onclick="download(true, 'TSV')"><kbd><i class="bi bi-copy"></i><i class="bi bi-indent"></i></kbd> Copy TSV</button></li>
    </ul>
    </div>
    </div>`))),o.appendChild(c.htmlToElement('<div class="collapse table-toggles mb-2" id="'.concat(b,`">
    <input id="`).concat(S,`" class="form-control-sm w-100 mb-2" type="search" placeholder="Search columns" aria-label="Search columns">
    <div class="ux-callout mb-2">
            Use the buttons at the bottom of the table to hide/show columns. Drag the header to reorder columns.
    </div>
    </div>`))),o.appendChild(c.htmlToElement('<div class="ux-table-wrap"><table id="'.concat(n,`" class="bg-body-secondary border table compact table-bordered table-striped d-none" style="width:100%">
        <thead class="table-info"><tr></tr></thead>
        <tbody></tbody>
        <tfoot><tr></tr></tfoot>
    </table></div>`))),o.getElementsByTagName("input")[0].addEventListener("input",function(){var I;const v=o.getElementsByClassName("table-toggles");for(let L=0;L<v.length;L++){const E=v[L].getElementsByTagName("button");for(let i=0;i<E.length;i++)(I=E[i].textContent)!=null&&I.toLowerCase().includes(this.value.toLowerCase())?E[i].classList.remove("d-none"):E[i].classList.add("d-none")}})}function St(o,n,c,b){function x(S){const N=(S!=null?S:"").toLowerCase();return N.includes("selected")?"ux-col-selected":N.includes("compared")||N.includes("confirmed")?"ux-col-compared":""}Ct(b).then(()=>{var S;const N=$(n),I=c.visible,v=c.columns,L=c.data,E=c.searchable,i=c.cell_format,_=c.row_format;let D=c.sort;const Q=c.onSelectionChange;D==null&&(D=[0,"asc"]);function F(t){return i.formatNumber&&i.formatNumber.includes(t)||i.formatMoney&&i.formatMoney.includes(t)}function z(t){return!!(i.formatMoney&&i.formatMoney.includes(t))}function nt(t,C){const u=Math.round(t*100)/100;return C?"$".concat(b.commafy(u)):b.commafy(u)}const ot={};if(i!=null)for(const t in i){const C=i[t];for(const u of C){const y=window[t];ot[u]=y,y==null&&console.log("No function found for "+t)}}const G=[];if(v.length>0)for(let t=0;t<v.length;t++){const C=x(v[t]),u={data:t,className:"details-control ".concat(C).trim(),defaultContent:""},y=ot[t];y!=null&&(u.render=y,(y==window.formatNumber||y==window.formatMoney)&&(u.orderDataType="numeric-comma")),G.push(u)}const J=[null],lt=o.querySelector("thead tr"),K=o.querySelector("tfoot tr"),st=o.querySelector(".table-toggles");function X(t,C){const u=t.closest("th");if(!u||J[0]==null)return;const y=J[0].column(u);y.search()!==t.value&&y.search(t.value).draw()}function it(t){t.stopPropagation()}if(lt&&K&&st){const t=document.createDocumentFragment(),C=document.createDocumentFragment(),u=document.createElement("tr");u.className="ux-summary-row";const y=document.createElement("th");y.textContent="#",t.appendChild(y);const Y=document.createElement("th");C.appendChild(Y);const V=document.createElement("th");V.className="ux-summary-actions",V.innerHTML='<button type="button" class="btn btn-sm ux-btn ux-select-visible-btn" title="Select all filtered" aria-label="Select all filtered"><i class="bi bi-square" aria-hidden="true"></i></button>',u.appendChild(V);for(let m=0;m<G.length;m++){const R=G[m],q=v[m];I!=null&&(R.visible=I.includes(m));const j=document.createElement("th"),P=document.createElement("th"),H=document.createElement("th");if(H.className="ux-summary-cell",q!=null){const B=x(q);if(B&&(j.classList.add(B),P.classList.add(B),H.classList.add(B)),E==null||E.includes(m)){const d=document.createElement("input");d.type="text",d.placeholder=q,d.style.width="100%",d.addEventListener("keyup",X.bind(null,d)),d.addEventListener("change",X.bind(null,d)),d.addEventListener("clear",X.bind(null,d)),d.addEventListener("click",it),j.appendChild(d)}else j.textContent=q;if(m!=0){const d=document.createElement("button");d.className="toggle-vis ux-toggle-btn btn btn-sm fw-bold",d.dataset.column=(m+1).toString(),d.textContent=q,P.appendChild(d),R.visible||(d.classList.add("is-hidden"),d.oldParent=P,st.appendChild(d))}}t.appendChild(j),C.appendChild(P),u.appendChild(H)}lt.appendChild(t),K.appendChild(C),(S=K.parentElement)==null||S.appendChild(u)}vt(b).then(()=>{const t=new Set;let C=null;function u(e){if(!Q)return;const l=Array.from(t),s=l.map(r=>e.row(r).data()).filter(r=>r!=null);Q({selectedRowIndexes:l,selectedRows:s})}function y(e){return e.rows({search:"applied"}).indexes().toArray()}function Y(e){return e.rows({search:"applied",page:"current"}).indexes().toArray()}function V(e){const l=y(e),s=l.filter(w=>t.has(w)),r=s.length>0?s:l,p=y(e),a=p.length>0&&p.every(w=>t.has(w)),f=a?"Deselect all filtered":"Select all filtered",h=o.querySelector("tfoot tr.ux-summary-row");if(!h)return;const k=h.querySelector(".ux-select-visible-btn");if(k){const w=k.querySelector("i");w&&(w.className=a?"bi bi-check2-square":"bi bi-square"),k.title=f,k.setAttribute("aria-label",f)}const g=e.columns(":visible").indexes().toArray().filter(w=>w>0);let T=1;for(const w of g){const M=h.children[T];if(T++,!M)continue;const A=w-1,O=F(A);if(M.style.display="",!O){M.textContent="";continue}const Z=r.map(tt=>{const U=e.row(tt).data(),et=U?U[A]:0;return typeof et=="number"?et:Number(et)||0});if(Z.length===0){M.textContent="";continue}const at=Z.reduce((tt,U)=>tt+U,0),dt=at/Z.length,ct=z(A);M.innerHTML='<div class="ux-summary-values"><span>Σ '.concat(nt(at,ct),"</span><span>x̄ ").concat(nt(dt,ct),"</span></div>")}for(;T<h.children.length;){const w=h.children[T];T++,w&&(w.textContent="")}}$.fn.dataTableExt.oStdClasses.sWrapper="py-2 px-2 dataTables_wrapper";const m=J[0]=N.DataTable({dom:"rt<'ux-dt-bottom'plf>",columns:[{data:null,title:"#",orderable:!1,searchable:!1,className:"dt-center p-0",defaultContent:""},...G],colReorder:!0,data:L,paging:!0,lengthMenu:[[10,25,50,100,-1],[10,25,50,100,"All"]],pageLength:10,deferRender:!0,orderClasses:!1,order:[D],autoWidth:!1,searchHighlight:!1,info:!1,processing:!1,stateSave:!1,scrollX:!1,initComplete:function(){const e=this.api();e.columns.adjust(),V(e)},rowCallback:function(e,l,s,r){const a=this.api().row(e).index(),f=t.has(a);$(e).toggleClass("table-active",f),$("td:eq(0)",e).html('<label class="d-inline-flex align-items-center m-0 ux-row-index"><input type="checkbox" class="ux-row-select" '.concat(f?"checked":""," /><span>").concat(r+1,"</span></label>")),_&&_(e,l,r)},drawCallback:function(){V(this.api())}});m.on("column-reorder",function(e,l,s){m.draw(!1)});function R(e){e.stopPropagation()}function q(){o.querySelectorAll(".table-toggles button, .dataTables_wrapper button").forEach(s=>{s.classList.contains("ux-select-visible-btn")||s.addEventListener("click",R)}),o.querySelectorAll(".table-toggles input, thead input, tfoot input").forEach(s=>{s.addEventListener("click",R)})}function j(e,l){e.querySelectorAll(".toggle-vis").forEach(r=>{r.addEventListener("click",function(p){var a;p.preventDefault();const f=p.currentTarget,h=l.column(f.getAttribute("data-column"));if(h.visible(!h.visible()),f.classList.toggle("is-hidden",!h.visible()),f.parentElement&&f.parentElement.tagName==="TH"){f.oldParent=f.parentElement;const g=e.querySelector(".table-toggles");g.appendChild(f);const T=g.querySelector("input"),w=(a=f.textContent)!=null?a:"";T&&T.value&&!w.toLowerCase().includes(T.value.toLowerCase())&&f.classList.add("d-none")}else{const g=f.oldParent;g&&g.appendChild(f)}const k=l.columns().indexes().filter(g=>g>0&&l.column(g).visible()).map(g=>v[g-1]).toArray();b.setQueryParam("columns",k.join(".")),l.columns.adjust().draw(!1)})})}function P(e){let l="";return m.columns().every(function(s){if(s===0)return;const r=[];i.formatNumber!=null&&r.push(...i.formatNumber),i.formatMoney!=null&&r.push(...i.formatMoney);const p=v[s-1];if(p!=null&&!m.column(s).visible()){let a=e[s-1];r.includes(s-1)&&(a=a.toLocaleString("en-US")),l+="<tr><td>"+p+"</td><td>"+a+"</td></tr>"}}),l===""&&(l="No extra info"),'<table class="bg-body-secondary table table-striped table-bordered compact" cellspacing="0" border="0">'+l+"</table>"}function H(e,l){e.querySelector("tbody").addEventListener("click",function(s){const r=s.target;if(r.classList.contains("details-control")){const p=r.closest("tr");if(!p)return;const a=l.row(p);a.child.isShown()?(a.child.hide(),p.classList.remove("shown")):(a.child(P(a.data())).show(),p.classList.add("shown"))}})}function B(e,l){e.querySelector("tbody").addEventListener("click",function(s){const r=s.target;if(!r.classList.contains("ux-row-select"))return;const p=r.closest("tr");if(!p)return;const a=l.row(p).index(),h=r.checked,k=Y(l),g=k.indexOf(a);if(s.shiftKey&&C!=null&&g>=0){const w=Math.min(C,g),M=Math.max(C,g);for(let A=w;A<=M;A++){const O=k[A];h?t.add(O):t.delete(O)}}else h?t.add(a):t.delete(a);C=g>=0?g:null,u(l),l.draw(!1)})}function d(e){const l=o.querySelector("tfoot tr.ux-summary-row");l&&l.addEventListener("click",function(s){if(!s.target.closest(".ux-select-visible-btn"))return;const a=y(e);a.length>0&&a.every(h=>t.has(h))?a.forEach(h=>t.delete(h)):a.forEach(h=>t.add(h)),u(e),e.draw(!1)})}q(),j(o,m),H(n,m),B(n,m),d(m),u(m),n.classList.remove("d-none"),m.columns.adjust().draw(!1)})})}function Lt(o,n,c){o.innerHTML="",xt(o,c.uuidv4(),c);const b=o.getElementsByTagName("table")[0];return St(o,b,n,c),b}function Nt(o,n){return Lt(o,n,{uuidv4:gt,htmlToElement:ht,commafy:rt,setQueryParam:yt,ensureScriptsLoaded:pt})}export{kt as a,Nt as s};
